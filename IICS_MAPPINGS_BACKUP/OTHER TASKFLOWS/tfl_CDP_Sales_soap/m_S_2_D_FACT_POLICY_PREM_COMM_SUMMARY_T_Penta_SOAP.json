[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select \ncast(max_sid as integer) as max_sid,\ncast(src_sys_cd as varchar(10)) as src_sys_cd,\ncast(policy_item_id as varchar(35)) as policy_item_id,\ncast(mv_id as integer) as mv_id,\ncast(policy_num as varchar(35)) as policy_num,\npolicy_exp_dt,\ncast(policy_status_cd as varchar(10)) as policy_status_cd,\ncast(policy_status_desc as varchar(80))as policy_status_desc,\ncast(cancel_dt as varchar(50)) as cancel_dt,\ncast(cancel_type as varchar(50)) as cancel_type,\ncast(cancel_reason_cd as varchar(10)) as cancel_reason_cd,\ncast(cancel_reason_desc as varchar(80)) as cancel_reason_desc,\ncast(facultativo_ind as varchar(1)) as facultativo_ind,\ncast(coins_type_cd as varchar(10)) as coins_type_cd,\ncast(coins_pct as decimal(8,4)) coins_pct,\ncast(coins_amt as decimal (25,10)) as coins_amt,\ncast(curr_cd as varchar(10)) as curr_cd,\ncast(mv_reason_cd as varchar(10)) as mv_reason_cd,\ncast(mv_reason_desc as varchar(80)) as mv_reason_desc,\nitem_eff_dt,\nitem_exp_dt,\ncast(fronting_policy_ind as varchar(1)) as fronting_policy_ind,\ncast(ceded_share_part_prem_amt as decimal (25,10)) as ceded_share_part_prem_amt,\ncast(surplus_retained_prem_amt as decimal (25,10)) as surplus_retained_prem_amt,\ncast(facult_prem_amt as decimal (25,10)) as facult_prem_amt,\ncast(retained_prem_amt as decimal (25,10)) as retained_prem_amt,\ncast(direct_retained_prem_amt as decimal (25,10)) as direct_retained_prem_amt,\ncast(prem_retained_74_amt as decimal (25,10)) as prem_retained_74_amt,\ncast(retained_share_part_prem_amt as decimal (25,10)) as retained_share_part_prem_amt,\ncast(remarque_comm_amt as decimal (25,10)) as remarque_comm_amt,\ncast(liberty_reins_optional_prem_amt as decimal (25,10)) as liberty_reins_optional_prem_amt,\ncast(nwp_amt as decimal (25,10)) as nwp_amt,\ncast(cwp_amt as decimal (25,10)) as cwp_amt,\ncast(gwp_amt as decimal (25,10)) as gwp_amt,\ncast(endorsement_prem_amt as decimal (25,10)) as endorsement_prem_amt,\ncast(broker_comm_amt as decimal (25,10)) as broker_comm_amt,\ncast(dim_policy_key as integer) as dim_policy_key,\ncast(dim_lob_key as integer) as dim_lob_key,\ncast(dim_broker_key as integer) as dim_broker_key,\ncast(dim_branch_office_key as integer) as dim_branch_office_key,\ncast(dim_policyholder_key as integer) as dim_policyholder_key,\ncast(dim_risk_key as integer) as dim_risk_key,\ncast(dim_prd_pln_hrchy_key as integer) as dim_prd_pln_hrchy_key,\ncast(dim_insured_key as integer) as dim_insured_key,\ncast(actv_rec_ind as varchar(1)) as actv_rec_ind,\ncast(etl_audit_id as integer) as etl_audit_id,\ncast(policy_item_num as integer) as policy_item_num,\ncast(broker_branch_rlshp_id as varchar(24)) as broker_branch_rlshp_id,\npolicy_issue_dt,\nmv_dt,\npolicy_eff_dt,\nacct_yr,\nacct_mth,\ncast(surplus_ceded_prem_amt as decimal (25,10)) as surplus_ceded_prem_amt ,\ncast(agreement as varchar(100)) as agreement,\nacct_dt,\ncast(sales_exec_rut as varchar(35)) as sales_exec_rut,\ncast(sales_exec_name as varchar(100)) as sales_exec_name,\ncast(branch_office_name_2 as varchar(100)) as branch_office_name_2,\ncast(management_name as varchar(100)) as management_name,\ncast(regional_name as varchar(100)) as regional_name,\ncast(ramo_plan as varchar(100)) as ramo_plan,\ncast(flota as varchar(10)) as flota,\ncast(usgaap_period as integer) as usgaap_period,\nmov_acc_dt,\nmov_eff_dt\nfrom (\nselect\nLKP_MAXSID.MAX_SID AS MAX_SID,\nsrc.*  from (\nselect \n'penta' as src_sys_cd,\ntrunc(cast(POLIZA as varchar))||'-'||trunc(cast(ITEM as varchar)) as policy_item_id,\n1 as mv_id,\ntrim(poliza) as policy_num,\nto_date(termino_vigencia,'DD-MM-YYYY') as policy_exp_dt,\n3 as policy_status_cd,\n'VENCIDA' as policy_status_desc,\nnull as cancel_dt,\nnull as cancel_type,\nnull as cancel_reason_cd,\nnull as cancel_reason_desc,\n'N' as facultativo_ind,\n0 as coins_type_cd,\nnull as coins_pct,\n0 as coins_amt,\n'CLF' as curr_cd,\n100 as mv_reason_cd,\n'NUEVA PRODUCCI\u00c3\u201cN' as mv_reason_desc,\nto_date(inicio_vigencia,'DD-MM-YYYY') as item_eff_dt,\nto_date(termino_vigencia,'DD-MM-YYYY') as  item_exp_dt,\n'N' as fronting_policy_ind,\n0 as ceded_share_part_prem_amt,\n0 as surplus_retained_prem_amt,\n0 as facult_prem_amt,\nprima_directa_mo as retained_prem_amt,\n0 as direct_retained_prem_amt,\n0 as prem_retained_74_amt,\n0 as retained_share_part_prem_amt,\n0 as remarque_comm_amt,\n0 as liberty_reins_optional_prem_amt,\nprima_directa_mo as nwp_amt,\n0 as cwp_amt,\nprima_directa_mo as gwp_amt ,\n0 as endorsement_prem_amt,\n0 as broker_comm_amt,\n0 as dim_policy_key,\nNVL(lob.dim_lob_key,0) as dim_lob_key,\nNVL(broker.dim_broker_key,0) as dim_broker_key,\nNVL(branch.dim_branch_office_key,0) as dim_branch_office_key ,\nNVL(policyholder.dim_policyholder_key,0) as dim_policyholder_key ,\n0 as dim_risk_key,\n0 as dim_prd_pln_hrchy_key,\nNVL(insured.dim_insured_key,0) as dim_insured_key,\n'Y' as actv_rec_ind,\n0 as etl_audit_id,\nITEM as policy_item_num,\n0 as broker_branch_rlshp_id,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as policy_issue_dt,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as mv_dt,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as policy_eff_dt,\ncast(SUBSTRING(mes_contable,1,4) as varchar) as acct_yr,\nCAST(SUBSTRING(mes_contable,5,6) AS VARCHAR(2)) as acct_mth,\n0 as surplus_ceded_prem_amt,\nrut_ejecutivo as sales_exec_rut,\nnull as sales_exec_name,\nnull as branch_office_name_2,\nnull as management_name,\nnull as regional_name,\nnull as ramo_plan,\nnull as agreement,\ncast((mes_contable||'01') as timestamp) as acct_dt,\n'-' as flota,\ncase when acct_yr||acct_mth > to_char (policy_eff_dt, 'YYYYMM') then acct_yr||acct_mth\nelse to_char (policy_eff_dt, 'YYYYMM') end as  usgaap_period,\ncast((mes_contable||'01') as date ) as mov_acc_dt ,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as mov_eff_dt,\n1 as dummy\nfrom (\nselect distinct trim(poliza) poliza ,item,prima_directa_mo,inicio_vigencia,\ntermino_vigencia,mes_contable,codigo_ramo,rut_corredor,rut_asegurado,\nrut_contratante,codigo_sucursal,rut_ejecutivo\nfrom cdp_stg_dwh.stg_informeventas  A\ninner join \n(select poliza as policy,MAX(TO_DATE(SUBSTRING(Fecha_proceso,3,12),'DD-MM-YYYY')) AS upd_date  from cdp_stg_dwh.stg_informeventas \nWHERE trim(codigo_ramo)='24'\ngroup by poliza) B\nON A.poliza=B.policy\nand TO_DATE(SUBSTRING(A.Fecha_proceso,3,12),'DD-MM-YYYY')= B.upd_date\nWHERE trim(A.codigo_ramo)='24'\n) stg_informeventas\nleft join \n(select min(dim_lob_key) as dim_lob_key,lob_cd \nfrom cdp_dwh.dim_lob_t where src_sys_cd='penta' and lob_cd='24' group by lob_cd) lob\non trim(stg_informeventas.codigo_ramo)=lob.lob_cd\nleft join\n(select min(dim_broker_key) as dim_broker_key,broker_rut_num \nfrom cdp_dwh.dim_broker_t where src_sys_cd='axis' group by broker_rut_num) broker\non stg_informeventas.rut_corredor=substring(broker.broker_rut_num,1,length(broker.broker_rut_num)-1)\nleft join\n(select  min(dim_policyholder_key) as dim_policyholder_key,policyholder_rut_num \nfrom cdp_dwh.dim_policyholder_t where src_sys_cd='penta' group by policyholder_rut_num) policyholder\non trim(stg_informeventas.rut_contratante)=policyholder.policyholder_rut_num\nleft join\n(select  min(dim_branch_office_key) as dim_branch_office_key,branch_office_cd \nfrom cdp_dwh.dim_branch_office_t where src_sys_cd='penta' group by branch_office_cd) branch\non stg_informeventas.codigo_sucursal=branch.branch_office_cd\nleft join\n(select min (dim_insured_key) as dim_insured_key ,insured_rut_num \nfrom cdp_dwh.dim_insured_t where src_sys_cd='penta' group by insured_rut_num ) insured\non stg_informeventas.rut_asegurado=insured.insured_rut_num\n)src\nleft outer join\n(select 1 as dummy, max(fact_policy_item_mv_key) as MAX_SID from \ncdp_dwh.fact_policy_prem_comm_summary_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy )"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.oprRuntimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "DELETE FROM cdp_dwh.fact_policy_prem_comm_summary_t\nWHERE src_sys_cd='penta' and etl_audit_id=0;"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "DELETE FROM cdp_dwh.fact_policy_prem_comm_summary_t\nWHERE src_sys_cd='penta' and etl_audit_id=0;"
    }
]