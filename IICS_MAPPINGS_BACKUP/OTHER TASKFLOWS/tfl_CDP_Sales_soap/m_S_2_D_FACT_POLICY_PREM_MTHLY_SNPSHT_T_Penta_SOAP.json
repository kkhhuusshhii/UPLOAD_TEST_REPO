[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\ncast(max_sid as integer) as max_sid,\ncast(src_sys_cd as varchar(10)) as src_sys_cd,\ncast(policy_item_id as varchar(35)) as policy_item_id,\ncast(mv_id as integer) as mv_id,\ncast(prem_amt as decimal (25,10)) as prem_amt,\ncast(curr_cd as varchar(10)) as curr_cd,\ncast(receipt_type_cd as varchar(10)) as receipt_type_cd,\ncast(receipt_type_desc as varchar(80)) as receipt_type_desc,\ncast(cov_cd as varchar(10)) as cov_cd,\nreceipt_issue_dt,\nreceipt_exp_dt,\ncast(receipt_num as varchar(35)) as receipt_num,\ncast(mv_reason_cd as varchar(10)) as mv_reason_cd,\ncast(mv_reason_desc as varchar(80)) as mv_reason_desc,\nmv_eff_dt,\nmv_exp_dt,\nactv_rec_ind,\ncast(etl_audit_id as integer) as etl_audit_id,\ncast(dim_insured_key as integer) as dim_insured_key,\ncast(dim_policyholder_key as integer) as dim_policyholder_key,\ncast(dim_policy_key as integer) as dim_policy_key,\ncast(dim_risk_key as integer) as dim_risk_key,\ncast(dim_cov_key as integer) as dim_cov_key,\ncast(dim_prd_pln_hrchy_key as integer) as dim_prd_pln_hrchy_key,\ncast(dim_branch_office_key as integer) as dim_branch_office_key,\ncast(dim_lob_key as integer) as dim_lob_key,\ncast(dim_fecu_lob_key as integer) as dim_fecu_lob_key,\ncast(dim_broker_key as integer) as dim_broker_key,\ncast(receipt_status_cd as varchar(10)) as receipt_status_cd,\ncast(receipt_status_desc as varchar(80)) as receipt_status_desc,\ncast(policy_num as varchar(35)) as policy_num  ,\npolicy_eff_dt,\npolicy_exp_dt,\npolicy_issue_dt,\ncast(policy_status_cd as varchar(10)) as policy_status_cd,\ncast(policy_status_desc as varchar(80)) as policy_status_desc,\ncast(policy_item_num as varchar(35)) as policy_item_num,\ncast(receipt_mv_id as integer) as receipt_mv_id,\nreceipt_mv_dt,\nmv_dt,\nreceipt_eff_dt,\naccountability_yr,\ncast(net_direct_prem_amt as decimal (25,10)) as net_direct_prem_amt,\ncast(direct_tax_amt as decimal (25,10)) as direct_tax_amt ,\ncast(direct_comm_amt as decimal (25,10)) as direct_comm_amt,\ncast(gross_comm_retention_pct as decimal (11,2)) as gross_comm_retention_pct,\ncast(gross_comm_retained_amt as decimal (25,10)) as gross_comm_retained_amt,\ncast(prem_rate_amt as decimal (25,10)) as prem_rate_amt,\ncast(net_accrued_prem_amt as decimal (25,10)) as net_accrued_prem_amt,\ncast(accrued_fee_amt as decimal (25,10)) as accrued_fee_amt,\ncast(gross_prem_participate_amt as decimal (25,10)) as gross_prem_participate_amt,\ncast(net_prem_participate_amt as decimal (25,10)) as net_prem_participate_amt,\ncast(tax_participate_amt as decimal (25,10)) as tax_participate_amt,\ncast(gross_comm_participate_amt as decimal (25,10)) as gross_comm_participate_amt,\ncast(affects_prem_participate_amt as decimal (25,10)) as affects_prem_participate_amt,\ncast(exempt_prem_participate_amt as decimal (25,10)) as exempt_prem_participate_amt,\ncast(affects_prem_direct_amt as decimal (25,10)) as affects_prem_direct_amt,\ncast(exempt_prem_direct_amt as decimal (25,10)) as exempt_prem_direct_amt,\ncast(comm_pct as decimal (11,2)) as comm_pct,\ncast(insured_amt as decimal (25,10)) as insured_amt,\ncast(pct_of_our_participation as decimal (11,2)) as pct_of_our_participation,\naccountability_mth,\ncast(usgaap_period as integer ) as usgaap_period \nfrom \n(select LKP_MAXSID.MAX_SID AS MAX_SID,\nsrc.*  \nfrom\n (\nselect\n'penta' as src_sys_cd,\ntrunc(cast(POLIZA as varchar))||'-'||trunc(cast(ITEM as varchar)) as policy_item_id,\n1 as mv_id,\nprima_directa_mo as prem_amt,\n'CLF' as curr_cd,\nNULL as receipt_type_cd,\nNULL as receipt_type_desc,\nNULL as cov_cd,\nto_date(inicio_vigencia,'DD-MM-YYYY') as receipt_issue_dt,\nto_date(termino_vigencia,'DD-MM-YYYY') as receipt_exp_dt,\nNULL as receipt_num,\n'100' as mv_reason_cd,\n'NUEVA PRODUCCI\u00c3\u201cN' as mv_reason_desc,\nto_date(inicio_vigencia,'DD-MM-YYYY') as mv_eff_dt,\nto_date(termino_vigencia,'DD-MM-YYYY') as mv_exp_dt,\n'Y' as actv_rec_ind,\n0 as etl_audit_id,\nNVL(insured.dim_insured_key,0) as dim_insured_key,\nNVL(policyholder.dim_policyholder_key,0) as dim_policyholder_key,\n0 as dim_policy_key,\n0 as dim_risk_key,\n0 as dim_cov_key,\n0 as dim_prd_pln_hrchy_key,\nNVL(branch.dim_branch_office_key,0) as dim_branch_office_key,\nNVL(lob.dim_lob_key,0) as dim_lob_key,\n78 as dim_fecu_lob_key,\nNVL(broker.dim_broker_key,0) as dim_broker_key,\nnull as receipt_status_cd,\nnull as receipt_status_desc,\ntrim(poliza) as policy_num,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as  policy_eff_dt,\nto_date(termino_vigencia,'DD-MM-YYYY') as policy_exp_dt,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as policy_issue_dt,\n'3' as policy_status_cd,\n'VENCIDA' as policy_status_desc,\nitem as policy_item_num,\n1 as receipt_mv_id,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as receipt_mv_dt,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as mv_dt,\nto_date(inicio_vigencia,'DD-MM-YYYY')  as receipt_eff_dt,\ncast(SUBSTRING(mes_contable,1,4) as varchar(4)) as accountability_yr,\nprima_directa_mo as net_direct_prem_amt,\n0 as direct_tax_amt,\n0 as direct_comm_amt,\n0 as gross_comm_retention_pct,\n0 as gross_comm_retained_amt,\n0 as prem_rate_amt,\nprima_directa_mo as net_accrued_prem_amt,\n0 as accrued_fee_amt,\n0 as gross_prem_participate_amt,\n0 as net_prem_participate_amt,\n0 as tax_participate_amt,\n0 as gross_comm_participate_amt,\n0 as affects_prem_participate_amt,\n0 as exempt_prem_participate_amt,\n0 as affects_prem_direct_amt,\nprima_directa_mo as exempt_prem_direct_amt,\n0 as comm_pct,\n0 as insured_amt,\n100 as pct_of_our_participation,\nCAST(SUBSTRING(mes_contable,5,6) AS VARCHAR(2)) as accountability_mth,\ncase when accountability_yr||accountability_mth > to_char (policy_eff_dt, 'YYYYMM') then accountability_yr||accountability_mth\nelse to_char (policy_eff_dt, 'YYYYMM') end as  usgaap_period,\n1 as dummy\nfrom (select distinct trim(poliza) poliza ,item,prima_directa_mo,inicio_vigencia,\ntermino_vigencia,mes_contable,codigo_ramo,rut_corredor,rut_asegurado,\nrut_contratante,codigo_sucursal,rut_ejecutivo\nfrom cdp_stg_dwh.stg_informeventas  A\ninner join \n(select poliza as policy,MAX(TO_DATE(SUBSTRING(Fecha_proceso,3,12),'DD-MM-YYYY')) AS upd_date  from cdp_stg_dwh.stg_informeventas \nWHERE trim(codigo_ramo)='24'\ngroup by poliza) B\nON A.poliza=B.policy\nand TO_DATE(SUBSTRING(A.Fecha_proceso,3,12),'DD-MM-YYYY')= B.upd_date\nWHERE trim(A.codigo_ramo)='24'\n) stg_informeventas\nleft join \n(select min(dim_lob_key) as dim_lob_key,lob_cd \nfrom cdp_dwh.dim_lob_t where src_sys_cd='penta' and lob_cd='24' group by lob_cd) lob\non trim(stg_informeventas.codigo_ramo)=lob.lob_cd\nleft join\n(select min(dim_broker_key) as dim_broker_key,broker_rut_num \nfrom cdp_dwh.dim_broker_t where src_sys_cd='axis' group by broker_rut_num) broker\non stg_informeventas.rut_corredor=substring(broker.broker_rut_num,1,length(broker.broker_rut_num)-1)\nleft join\n(select min (dim_insured_key) as dim_insured_key ,insured_rut_num \nfrom cdp_dwh.dim_insured_t where src_sys_cd='penta' group by insured_rut_num ) insured\non stg_informeventas.rut_asegurado=insured.insured_rut_num\nleft join\n(select  min(dim_policyholder_key) as dim_policyholder_key,policyholder_rut_num \nfrom cdp_dwh.dim_policyholder_t where src_sys_cd='penta' group by policyholder_rut_num) policyholder\non trim(stg_informeventas.rut_contratante)=policyholder.policyholder_rut_num\nleft join\n(select  min(dim_branch_office_key) as dim_branch_office_key,branch_office_cd from \ncdp_dwh.dim_branch_office_t where src_sys_cd='penta' group by branch_office_cd) branch\non stg_informeventas.codigo_sucursal=branch.branch_office_cd\n)src\nleft outer join\n(select 1 as dummy, max(fact_policy_prem_mthly_snpsht_key) as MAX_SID from \ncdp_dwh.fact_policy_prem_mthly_snpsht_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy)"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.oprRuntimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "DELETE FROM cdp_dwh.fact_policy_prem_mthly_snpsht_t\nWHERE src_sys_cd='penta' and etl_audit_id=0;"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "DELETE FROM cdp_dwh.fact_policy_prem_mthly_snpsht_t\nWHERE src_sys_cd='penta' and etl_audit_id=0;"
    }
]