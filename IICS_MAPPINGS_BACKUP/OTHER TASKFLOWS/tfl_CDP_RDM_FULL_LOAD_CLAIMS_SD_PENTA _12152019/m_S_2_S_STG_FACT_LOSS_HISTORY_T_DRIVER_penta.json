[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select distinct claim_num,\nnvl(claimant_num,0) claimant_num,\nnvl(loss_item_num,0) loss_item_num,\ncurr_code,\nnvl(recd_effective_dt,'2000-01-01 00:00:00') recd_effective_dt,\nType_ind,\nparty_ind,\ncast(current_timestamp as timestamp) recd_process_dtm from(\n--------Vehicle Repair------------------------------\nselect distinct cast(clm.claim_num as varchar(35)) claim_num,\ncast((case when clm.id_tercero=0 then l3.claimant_num\n   when clm.id_tercero>0 then l4.claimant_num else 0 end) as integer) claimant_num,\n                cast((case when clm.id_tercero=0 then l1.loss_item_num\n     when clm.id_tercero>0 then l2.loss_item_num else 0 end) as integer) loss_item_num,\ncast(x.curr_cd as varchar(10)) curr_code,\ncast(clm.fecha_ultima_modif as date) recd_effective_dt,\ncast('Vehicle' as varchar(20)) Type_ind,\ncast((case when clm.id_tercero=0 then 'Insured' else 'Thirdparty' end) as varchar(20)) party_ind   \nfrom (select distinct nro_siniestro claim_num,id_tercero,patente,fecha_ultima_modif from cdp_ods.bd_sinie_x_rsin_matriz_danos \nwhere nro_siniestro!=0--504911--541100\n) clm\nleft outer join\n(select distinct loss_item.loss_item_num,perfil.per_int_sinies claim_num,loss_item.lic_plate_num  from(select distinct claim_num,loss_item_num,loss_item_id,lic_plate_num from cdp_dwh.dim_loss_item_t \nwhere src_sys_cd='penta') loss_item,cdp_ods.bd_sinie_x_sin_perfil perfil\nwhere loss_item.claim_num=perfil.per_int_sinies\nand perfil.per_int_rutase = loss_item.loss_item_id ) l1 \non clm.claim_num=l1.claim_num and clm.id_tercero=0 --and clm.patente=l1.lic_plate_num\nleft outer join\ncdp_dwh.dim_loss_item_t l2 \non clm.claim_num=l2.claim_num and  clm.id_tercero>0 and clm.patente=l1.lic_plate_num and l2.src_sys_cd='penta'\nleft outer join\n(select distinct clmnt.claimant_num,perfil.per_int_sinies claim_num,clmnt.claimant_id  from(select distinct claim_num,claimant_num,claimant_id from cdp_dwh.dim_claimant_t \nwhere src_sys_cd='penta') clmnt,cdp_ods.bd_sinie_x_sin_perfil perfil\nwhere clmnt.claim_num=perfil.per_int_sinies\nand perfil.per_int_rutase = clmnt.claimant_id ) l3\non clm.claim_num=l3.claim_num and clm.id_tercero=0 --and clm.patente=split_part(l3.claimant_id,'-',3) \nleft outer join\ncdp_dwh.dim_claimant_t l4\non clm.claim_num=l4.claim_num and  clm.id_tercero>0 and clm.patente=split_part(l4.claimant_id,'-',3)  and l4.src_sys_cd='penta'\nleft outer join \n(SELECT mkt_ref_code_desc as curr_cd,ref_cd from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='currency_type' and src_sys_cd='penta')X\non 4=X.ref_cd\nunion\n--------------------reserve-------------------\n\nselect distinct \nCAST(gst.Siniestro AS VARCHAR(35)) as claim_num,\nCAST((case when gst.tipoliquabogado = 1 then 3\nwhen  gst.tipoliquabogado =2 then 1 else null end) AS INTEGER)  claimant_num,\nCAST((case when gst.tipoliquabogado = 1 then 3\nwhen  gst.tipoliquabogado = 2 then 1 else null end) AS INTEGER) as loss_item_num,\ncast(A.curr_cd as varchar(10)) curr_cd,\ncast(cast(case when AnoContable is null then '1990' else cast(AnoContable as varchar(4)) end ||\ncase when mescontable is null then '01' else (case when length (cast(MesContable as varchar(2)))=1 then '0'|| cast(MesContable as varchar(2)) else  cast(MesContable as varchar(2)) end) end||\ncast('01' as varchar(2)) as varchar(10)) as date) record_eff_dtm,\ncast('Reserve' as varchar(20)) Type_ind,\ncast((case when gst.TipoLiquAbogado=2 then 'Insured'\n     when gst.TipoLiquAbogado=1 then 'Thirdparty' end)  as varchar(20)) party_ind \nfrom\n(select * from cdp_ods.gstmst_gst_provision where Siniestro!=0) gst\n/*left outer join\n(select distinct Siniestro,TipoLiquAbogado,cast(cast(case when AnoContable is null then '1990' else cast(AnoContable as varchar(4)) end ||\ncase when mescontable is null then '01' else (case when length (cast(MesContable as varchar(2)))=1 then '0'|| cast(MesContable as varchar(2)) else  cast(MesContable as varchar(2)) end) end||\ncast('01' as varchar(2)) as varchar(10)) as date) record_eff_dtm from cdp_ods.gstmst_gst_provision \nwhere TipoLiquAbogado=2\nunion\nselect distinct Siniestro,TipoLiquAbogado,cast(cast(case when AnoContable is null then '1990' else cast(AnoContable as varchar(4)) end ||\ncase when mescontable is null then '01' else (case when length (cast(MesContable as varchar(2)))=1 then '0'|| cast(MesContable as varchar(2)) else  cast(MesContable as varchar(2)) end) end||\ncast('01' as varchar(2)) as varchar(10)) as date) record_eff_dtm from cdp_ods.gstmst_gst_provision \nwhere TipoLiquAbogado=1) recd_dt\non recd_dt.Siniestro=gst.Siniestro*/\nleft join \n(SELECT distinct mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')A\non 4=A.ref_cd\n\n------------------order summary------------------------\n\nunion\n\nselect \ncast(sr.claim_num as varchar(35)) claim_num,\ncast((case when sr.id_tercero=0 then c1.claimant_num when sr.id_tercero>0 then c3.claimant_num end) as integer) claimant_num,\ncast((case when sr.id_tercero=0 then l1.loss_item_num when sr.id_tercero>0 then l3.loss_item_num end) as integer) loss_item_num,\ncast(x.curr_cd as varchar(10)) curr_code,\ncast(sr.recd_dt as date) record_eff_date,\ncast('Ordersummary' as varchar(20)) Type_ind,\ncast((case when sr.id_tercero>0 then 'Thirdparty' when sr.id_tercero=0 then 'Insured' end) as varchar(20)) as party_ind\nfrom\n(\n/*********DRIVER - Total 3 paths ***********/\n/****Order from Valorizada****/\nSelect distinct\n--sp.fecha_aprobacion,\nmd.nro_siniestro as claim_num,\nmd.id_tercero,\nmd.patente,\nmdet.id_mat_danos,\nmdet.codigo_oficina,\nmdet.fecha_modif_alta_reg recd_dt\nfrom \n --select * from\n-- cdp_ods.bd_sinie_x_rsin_orden_valorizada  ov,\n--cdp_ods.bd_sinie_x_rsin_solicitud_pago    sp,\ncdp_ods.bd_sinie_x_rsin_det_matriz_danos mdet,\ncdp_ods.bd_sinie_x_rsin_matriz_danos  md\n--cdp_ods.SnsMst_SinPag_AprPagDet l\nwhere\n--ov.nro_solicitud_pago = sp.nro_solicitud_pago\n--and \n--ov.situacion='V'\n  -- ov.id_mat_dano=mdet.id_mat_danos\n  --and ov.codigo_oficina=mdet.codigo_oficina\n   mdet.id_mat_danos=md.id_mat_dano\n  and mdet.codigo_oficina=md.codigo_oficina\n  --and mdet.rut_taller_reparac=mdet.codigo_proveedor --orden_valorizada\n-- and mdet.tipo_detalle_rsd=2\n  --and l.Folio=sp.nro_orden_pago\n  union\n  \n  Select distinct\n--sp.fecha_aprobacion,\nmd.nro_siniestro as claim_num,\nmd.id_tercero,\nmd.patente,\nmdet.id_mat_danos,\nmdet.codigo_oficina,\nov.fecha_creacion_orden recd_dt\nfrom \n --select * from\n  cdp_ods.bd_sinie_x_rsin_orden_valorizada  ov,\n--cdp_ods.bd_sinie_x_rsin_solicitud_pago    sp,\ncdp_ods.bd_sinie_x_rsin_det_matriz_danos mdet,\ncdp_ods.bd_sinie_x_rsin_matriz_danos  md\n--cdp_ods.SnsMst_SinPag_AprPagDet l\nwhere\n--ov.nro_solicitud_pago = sp.nro_solicitud_pago\n--and \nov.situacion='V'\n  and ov.id_mat_dano=mdet.id_mat_danos\n  and ov.codigo_oficina=mdet.codigo_oficina\n  and mdet.id_mat_danos=md.id_mat_dano\n  and mdet.codigo_oficina=md.codigo_oficina\n  \n  \n \n   union\n   Select \n   distinct  md.nro_siniestro as claim_num,\nmd.id_tercero,\nmd.patente,\nmdet.id_mat_danos,\nmdet.codigo_oficina,\noc.fecha_comprobante_conformidad recd_dt\nfrom \n cdp_ods.bd_sinie_x_rsin_oc_externa    oc,\ncdp_ods.bd_sinie_x_rsin_oc_repuestos   ocr,\ncdp_ods.bd_sinie_x_rsin_solicitudes_cotizacion sc,\n--select * from \n cdp_ods.bd_sinie_x_rsin_det_matriz_danos  mdet,\ncdp_ods.bd_sinie_x_rsin_solicitud_pago   sp,\ncdp_ods.bd_sinie_x_rsin_matriz_danos    md\nwhere\noc.nro_solicitud_pago is not null\nand oc.numero_oc=ocr.numero_oc  \n and oc.codigo_oficina=ocr.codigo_oficina\nand oc.numero_oc=sc.numero_oc\nand oc.codigo_oficina=sc.codigo_oficina\nand sc.codigo_oficina=mdet.codigo_oficina\n--and sc.numero_item=mdet.nro_item\nand sc.nro_item_mat_danos=mdet.nro_item\nand sc.id_mat_danos=mdet.id_mat_danos\nand mdet.tipo_detalle_rsd=2\nand mdet.rut_taller_reparac!=mdet.codigo_proveedor --oc_externa\nand sp.nro_solicitud_pago = oc.nro_solicitud_pago\nand md.id_mat_dano=mdet.id_mat_danos\nand md.codigo_oficina=mdet.codigo_oficina\n--and md.nro_siniestro = 15460451\n)\nsr\n\nleft outer join\n/***Insured loss item***/\n(select distinct l4.claim_num,p.per_int_sinies,loss_item_num,\nmd.id_mat_dano,\nmd.codigo_oficina ,\nmd.id_tercero,\nmd.patente\nfrom cdp_dwh.dim_loss_item_t l4\ninner join cdp_ods.bd_sinie_x_sin_perfil p\non  p.per_int_sinies = l4.claim_num \nand p.per_int_rutase = l4.loss_item_id \nand l4.src_sys_cd ='penta'\ninner join cdp_ods.bd_sinie_x_rsin_matriz_danos md on\np.per_int_sinies = md.nro_siniestro\nand md.id_tercero = 0\nand l4.loss_item_num=1\n)l1\non sr.claim_num = l1.claim_num \n--and sr.per_int_rutase = l1.loss_item_id \nand sr.id_tercero = l1.id_tercero\nand sr.id_mat_danos=l1.id_mat_dano\nand sr.codigo_oficina =l1.codigo_oficina\nand sr.patente = l1.patente\nand sr.id_tercero = 0\n\n--select * from cdp_dwh.dim_loss_item_t\n\n/***3rd party loss item**/\nleft outer join cdp_dwh.dim_loss_item_t l3\non sr.claim_num = l3.claim_num \nand sr.patente = l3.lic_plate_num\nand l3.src_sys_cd ='penta' \nand sr.id_tercero > 0\nand l3.loss_item_num >1\n\n\nleft outer join\n/***Insured Claimant number***/\n(select distinct l4.claim_num,p.per_int_sinies,claimant_num,\nmd.id_mat_dano,\nmd.codigo_oficina ,\nmd.id_tercero,\nmd.patente\nfrom cdp_dwh.dim_claimant_t l4\ninner join cdp_ods.bd_sinie_x_sin_perfil p\non  p.per_int_sinies = l4.claim_num \nand p.per_int_rutase = l4.claimant_id \nand l4.src_sys_cd ='penta'\ninner join cdp_ods.bd_sinie_x_rsin_matriz_danos md on\np.per_int_sinies = md.nro_siniestro\nand md.id_tercero = 0\nand l4.claimant_num = 1\n)c1\non c1.claim_num = sr.claim_num \n--and l2.per_int_rutase = l4.claimant_id \nand sr.id_tercero = 0\nand sr.id_tercero = c1.id_tercero\nand sr.id_mat_danos=c1.id_mat_dano\nand sr.codigo_oficina =c1.codigo_oficina\nand sr.patente = c1.patente\n\n/***3rd party claimant number**/\nleft outer join \n(select claim_num, split_part(claimant_id,'-',3) as patente ,claimant_num\n,row_number() over(partition by claim_num,split_part(claimant_id,'-',3) order by claimant_num asc) as row_num\nfrom \ncdp_dwh.dim_claimant_t \nwhere src_sys_cd ='penta' \n)c3\non sr.claim_num = c3.claim_num \nand sr.patente = c3.patente \nand sr.id_tercero > 0\nand c3.claimant_num >1\nand c3.row_num = 1\nleft outer join\n(SELECT mkt_ref_code_desc as curr_cd,ref_cd from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='currency_type' and src_sys_cd='penta')X\non 4=X.ref_cd\n\n\nunion\n\n--------------------------Payment---------------------\nselect distinct\ncast(driver.siniestro as varchar(35))claim_num,\ncast((CASE WHEN driver.codcob=1 THEN nvl(ci.claimant_num,0)\nWHEN driver.codcob=2 THEN  nvl(ct.claimant_num,3)\nELSE 0 END) AS INTEGER)  claimant_num,\ncast((CASE WHEN driver.codcob=1 THEN nvl(li.loss_item_num,0)\nWHEN driver.codcob=2 THEN  nvl(lt.loss_item_num,3)\nELSE 0 END) AS INTEGER)  loss_item_num,\ncast(x.curr_cd as varchar(10))curr_cd,\ncast(record_eff_dtm.FecBolFac as date) record_eff_dtm,\ncast('Payment' as varchar(20)) Type_ind,\ncast((CASE WHEN driver.codcob=1 then 'Insured'\nwhen driver.codcob=2 then 'Thirdparty' else null end) as varchar(20)) party_ind\nfrom (select distinct siniestro,FecBolFac,CodCob,CodMonPag  from cdp_ods.snsmst_sinpag_aprpagdet where siniestro<>0)driver  \nLEFT JOIN \n(SELECT DISTINCT b.codcob,A.claim_num,A.claimant_num FROM cdp_dwh.dim_claimant_t a\nINNER JOIN cdp_ods.snsmst_sinpag_aprpagdet b\nON A.claim_num=b.Siniestro \nand a.claimant_id=b.rutdest\nWHERE A.src_sys_cd='penta' and a.insured_ind='S' and b.codcob=1\n) ci\nON ci.claim_num=driver.Siniestro \nLEFT JOIN \n(SELECT DISTINCT b.codcob,A.claim_num,A.claimant_num FROM cdp_dwh.dim_claimant_t a\nINNER JOIN cdp_ods.snsmst_sinpag_aprpagdet b\nON A.claim_num=b.Siniestro \nand a.claimant_id=b.rutdest\nWHERE A.src_sys_cd='penta' and insured_ind='N' and b.codcob=2\n) ct\nON ct.claim_num=driver.Siniestro \nLEFT JOIN\n(SELECT DISTINCT b.codcob,A.claim_num,A.loss_item_num FROM cdp_dwh.dim_loss_item_t A\nINNER JOIN cdp_ods.snsmst_sinpag_aprpagdet b\nON A.claim_num=b.Siniestro\nand cast(nvl(a.loss_item_id,'0') as varchar(35))=cast(b.rutdest as varchar(35))\nWHERE A.src_sys_cd='penta' and insured_ind='S' and b.codcob=1\n)li\nON li.claim_num=driver.Siniestro\nLEFT JOIN\n(SELECT DISTINCT b.codcob,A.claim_num,A.loss_item_num FROM cdp_dwh.dim_loss_item_t A\nINNER JOIN cdp_ods.snsmst_sinpag_aprpagdet b\nON A.claim_num=b.Siniestro\nand cast(nvl(a.loss_item_id,'0') as varchar(35))=cast(b.rutdest as varchar(35))\nWHERE A.src_sys_cd='penta' and insured_ind='N' and b.codcob=2\n)lt\nON lt.claim_num=driver.Siniestro\nleft join \n(SELECT distinct mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')X\non driver.CodMonPag=X.ref_cd\nleft join \n(select distinct FecBolFac,Siniestro from cdp_ods.snsmst_sinpag_aprpagdet \nwhere CodCob = 1 \nunion\nselect distinct FecBolFac,Siniestro from cdp_ods.snsmst_sinpag_aprpagdet \nwhere CodCob=2 \n)record_eff_dtm\non record_eff_dtm.Siniestro=driver.Siniestro\n\nunion\n\n----------------Recovery-----------------\nselect distinct \ncast(driver.SAL_INT_SINIESTRO as varchar(35))claim_num,\ncast(1 AS INTEGER )claimant_num,\ncast(1 AS INTEGER )loss_item_num,\ncast(x.curr_cd as varchar(10))curr_cd,\ncast(driver.SAL_FEC_FECHA_INGRESO as DATE)record_eff_dtm,\ncast('Recovery' as varchar(20)) Type_ind,\ncast('Insured' as varchar(20)) party_ind\nfrom (select distinct SAL_INT_SINIESTRO,SAL_TIN_COD_MONEDA_MP,SAL_FEC_FECHA_INGRESO \nfrom cdp_ods.bd_sinie_x_cir_salvataje_recupero where SAL_INT_SINIESTRO<>0 and SAL_TIN_ESTADO <> 5)driver\nleft join\n(SELECT distinct mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')X\non DRIVER.SAL_TIN_COD_MONEDA_MP=X.ref_cd \n\nUNION\n---------------------Payment2----------------------\n\nselect distinct \ncast(driver.cpp_int_sinies as varchar(35))claim_num,\ncast((CASE WHEN driver.cpp_tin_tiplab=2 THEN 1\nWHEN driver.cpp_tin_tiplab=1 THEN 3\nELSE (cpp_tin_tiplab + 2) END) AS INTEGER)  claimant_num,\ncast((CASE WHEN driver.cpp_tin_tiplab=2 THEN 1\nWHEN driver.cpp_tin_tiplab=1 THEN 3\nELSE (cpp_tin_tiplab + 2) END) AS INTEGER)  loss_item_num,\ncast(nvl(x.curr_cd,'CLP') as varchar(10))curr_cd,\ncast(driver.cpp_fec_ingres as DATE)record_eff_dtm,\ncast('Payment_2' as varchar(20)) Type_ind,\ncast((CASE WHEN driver.cpp_tin_tiplab=2 then 'Insured'\nwhen driver.cpp_tin_tiplab=1 then 'Thirdparty' else null end) as varchar(20)) party_ind\nfrom \n(select distinct cpp_int_sinies,cpp_fec_ingres,cpp_tin_tiplab,cpp_tin_monpxp,cpp_dec_monpxp from cdp_ods.bd_sinie_x_sin_cabecera_perpro where \n(cpp_int_sinies not in (select distinct siniestro from cdp_ods.snsmst_sinpag_aprpagdet)) or \n(cpp_int_sinies in (select distinct siniestro from \n(select distinct sum(MtoBruto),siniestro,codcob from cdp_ods.snsmst_sinpag_aprpagdet group by siniestro,codcob having sum(MtoBruto)=0)))\n)driver\nleft join\n(SELECT distinct mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')X\non cast(DRIVER.cpp_tin_monpxp as int)=cast(X.ref_cd as int)\n\n)"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[1].dataAdapter.runtimeAttributes.attributes[14]",
        "name": "Pre-sql",
        "value": "DELETE FROM cdp_stg_dwh.stg_fact_loss_history_t_penta_driver;"
    }
]