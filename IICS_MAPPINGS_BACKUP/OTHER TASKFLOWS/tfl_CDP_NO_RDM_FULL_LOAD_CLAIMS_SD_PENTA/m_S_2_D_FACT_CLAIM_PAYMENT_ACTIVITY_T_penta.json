[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "/****** Payment *******/\n\nSELECT \nCAST(PENTA_PAYMENT.dim_claim_key AS INT),\nCAST(PENTA_PAYMENT.dim_claimant_key AS INT),\nCAST(PENTA_PAYMENT.dim_loss_item_key AS INT),\nCAST(PENTA_PAYMENT.dim_line_of_business_key AS INT),\nCAST(PENTA_PAYMENT.dim_claim_status_key AS INT),\nCAST(PENTA_PAYMENT.dim_claim_type_key AS INT),\nCAST(PENTA_PAYMENT.dim_claim_adjuster_key AS INT),\nCAST(PENTA_PAYMENT.dim_bdshp_key AS INT),\nCAST(PENTA_PAYMENT.dim_supplier_key AS INT),\nCAST(PENTA_PAYMENT.dim_claim_analyst_key AS INT),\nCAST(PENTA_PAYMENT.dim_insured_key AS INT),\nCAST(PENTA_PAYMENT.dim_party_key AS INT),\nCAST(PENTA_PAYMENT.dim_recov_type_key AS INT),\nCAST(PENTA_PAYMENT.dim_cov_key AS INT),\nCAST(PENTA_PAYMENT.dim_branch_office_key AS INT),\nCAST(PENTA_PAYMENT.sys_cd AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.activity_type_desc AS VARCHAR(80)),\nCAST(PENTA_PAYMENT.activity_subtype_cd AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.activity_subtype_desc AS VARCHAR(80)),\nCAST(PENTA_PAYMENT.payment_notes AS  VARCHAR(100)),\nCAST(PENTA_PAYMENT.ceded_payment_amt AS NUMERIC(25,10)),\nCAST(PENTA_PAYMENT.retained_payment_amt AS NUMERIC(25,10)),\n--PENTA_PAYMENT.ce_amt_per,\n--PENTA_PAYMENT.re_amt_per,\nCAST(PENTA_PAYMENT.PaymentTypeCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.PartyIdentifier AS INT),\nCAST(PENTA_PAYMENT.PaymentIdentifier AS VARCHAR(35)),\nCAST(PENTA_PAYMENT.ClaimNumber AS VARCHAR(35)) ,\nCAST(PENTA_PAYMENT.PaymentDate AS DATE),\nCAST(PENTA_PAYMENT.PaymentMethodCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.PaymentStatusCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.PaymentEntryDate AS DATE),\nCAST(PENTA_PAYMENT.InvoiceDate AS DATE),\nCAST(PENTA_PAYMENT.AccountingPostingDate AS DATE),\nCAST(PENTA_PAYMENT.PaymentModificationDate AS DATE),\nCAST(PENTA_PAYMENT.PaymentCancellationReasonCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.PaymentRejectionDescription AS VARCHAR(100)),\nCAST(PENTA_PAYMENT.IndemnityCode AS VARCHAR(10)),\n--PENTA_PAYMENT.IndemnityDescription,  --line 1270,commented on 28/09 since this column is not present in table (for CDPmigration)\nCAST(PENTA_PAYMENT.PaymentValidationIndicator AS CHAR(1)),\nCAST(PENTA_PAYMENT.PaymentValidationDate AS DATE),\nCAST(PENTA_PAYMENT.PaymentTransferAccountTypeCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.EstimatedDateofPayment AS DATE),\nCAST(PENTA_PAYMENT.PaymentDocumentTypeCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.AccountingCurrencyCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.AccountingCurrencyPaymentAmount AS NUMERIC(25,10)),\nCAST(PENTA_PAYMENT.PolicyCurrencyCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.PolicyCurrencyPaymentAmount AS NUMERIC(25,10)),\nCAST(PENTA_PAYMENT.PaymentCurrencyCode AS VARCHAR(10)),\nCAST(PENTA_PAYMENT.PaymentAmount AS NUMERIC(25,10)),\nLKP.MAX_SID\nFROM\n(\nSELECT \nNVL(CAST(PENTA_1.dim_claim_key AS INT) ,0) AS dim_claim_key,\nNVL(CAST(PENTA_1.dim_claimant_key AS INT) ,0)  AS dim_claimant_key,\nNVL(CAST(PENTA_1.dim_loss_item_key AS INT) ,0) AS dim_loss_item_key ,\nNVL(CAST(PENTA_1.dim_line_of_business_key AS INT) ,0) AS dim_line_of_business_key ,\nNVL(CAST(PENTA_1.dim_claim_status_key AS INT) ,0)AS dim_claim_status_key ,\nNVL(CAST(PENTA_1.dim_claim_type_key AS INT) ,0) AS dim_claim_type_key,\nNVL(CAST(PENTA_1.dim_claim_adjuster_key AS INT) ,0) dim_claim_adjuster_key ,\nNVL(CAST(PENTA_1.dim_bdshp_key AS INT) ,0) AS dim_bdshp_key ,\nNVL(CAST(PENTA_1.dim_supplier_key AS INT) ,0) AS dim_supplier_key ,\nNVL(CAST(PENTA_1.dim_claim_analyst_key AS INT) ,0) AS dim_claim_analyst_key ,\nNVL(CAST(PENTA_1.dim_insured_key AS INT) ,0) AS dim_insured_key ,\nNVL(CAST(PENTA_1.dim_party_key AS INT) ,0) AS dim_party_key ,\nNVL(CAST(PENTA_1.dim_recov_type_key AS INT) ,0) AS dim_recov_type_key ,\nNVL(CAST(PENTA_1.dim_cov_key AS INT) ,0) AS dim_cov_key ,\nNVL(CAST(PENTA_1.dim_branch_office_key AS INT) ,0) AS dim_branch_office_key ,\nPENTA_1.sys_cd ,\nPENTA_1.activity_type_desc ,\nPENTA_1.activity_subtype_cd ,\nPENTA_1.activity_subtype_desc ,\nPENTA_1.payment_notes ,\nPENTA_1.ceded_payment_amt ,\nPENTA_1.retained_payment_amt,\nPENTA_1.ce_amt_per,\nPENTA_1.re_amt_per,\nPENTA_1.PaymentTypeCode ,\nPENTA_1.PartyIdentifier ,\nPENTA_1.PaymentIdentifier,\nPENTA_1.ClaimNumber,\nPENTA_1.PaymentDate,\nPENTA_1.PaymentMethodCode ,\nPENTA_1.PaymentStatusCode ,\nPENTA_1.PaymentEntryDate,\nPENTA_1.InvoiceDate,\nPENTA_1.AccountingPostingDate,\nPENTA_1.PaymentModificationDate,\nPENTA_1.PaymentCancellationReasonCode ,\nPENTA_1.PaymentRejectionDescription,\nPENTA_1.IndemnityCode ,\nPENTA_1.IndemnityDescription,\nPENTA_1.PaymentValidationIndicator,\nPENTA_1.PaymentValidationDate,\nPENTA_1.PaymentTransferAccountTypeCode ,\nPENTA_1.EstimatedDateofPayment,\nPENTA_1.PaymentDocumentTypeCode ,\nPENTA_1.AccountingCurrencyCode ,\nPENTA_1.AccountingCurrencyPaymentAmount,\nPENTA_1.PolicyCurrencyCode ,\nPENTA_1.PolicyCurrencyPaymentAmount,\nPENTA_1.PaymentCurrencyCode ,\nPENTA_1.PaymentAmount,\n1 AS DUMMY,\nROW_NUMBER() OVER (PARTITION BY PENTA_1.ClaimNumber,PENTA_1.PaymentIdentifier ORDER BY PENTA_1.rec_crt_dtm DESC) RNK\nFROM\n(\nSELECT \nCLAIM.dim_claim_key AS dim_claim_key,\nCASE WHEN CLAIMANT_KEY_INSURED.dim_claimant_key IS NOT NULL THEN  CLAIMANT_KEY_INSURED.dim_claimant_key\nWHEN CLAIMANT_KEY_THIRD_PARTY.dim_claimant_key IS NOT NULL THEN  CLAIMANT_KEY_THIRD_PARTY.dim_claimant_key\nELSE NULL END AS dim_claimant_key,\nCASE WHEN LOSS_ITEM_KEY_INSURED.dim_loss_item_key IS NOT NULL THEN  LOSS_ITEM_KEY_INSURED.dim_loss_item_key\n--WHEN LOSS_ITEM_KEY_THIRD_PARTY.dim_loss_item_key IS NOT NULL THEN  LOSS_ITEM_KEY_THIRD_PARTY.dim_loss_item_key --DID 136\nELSE NULL END AS dim_loss_item_key,\nLOB.dim_lob_key AS dim_line_of_business_key,\nCASE WHEN CLAIM_STATUS_INSURED.dim_claim_status_key IS NOT NULL THEN  CLAIM_STATUS_INSURED.dim_claim_status_key\nWHEN CLAIM_STATUS_THIRD_PARTY.dim_claim_status_key IS NOT NULL THEN  CLAIM_STATUS_THIRD_PARTY.dim_claim_status_key\nELSE NULL END AS dim_claim_status_key,\nCLAIM_TYPE.dim_claim_type_key AS dim_claim_type_key,\nCASE WHEN CLAIM_ADJ_INSURED.dim_claim_adjuster_key IS NOT NULL THEN  CLAIM_ADJ_INSURED.dim_claim_adjuster_key\nWHEN CLAIM_ADJ_THIRD_PARTY.dim_claim_adjuster_key IS NOT NULL THEN  CLAIM_ADJ_THIRD_PARTY.dim_claim_adjuster_key\nELSE NULL END AS dim_claim_adjuster_key,\nBODYSHOP.dim_bdshp_key AS dim_bdshp_key,\nSUPPLIER.dim_parts_provdr_key AS dim_supplier_key,\nCLAIM_ANALYST.dim_claim_analyst_key AS dim_claim_analyst_key,\nINSURED.dim_insured_key AS dim_insured_key,\nPARTY.dim_other_party_key AS dim_party_key,\n'0' AS dim_recov_type_key,\nCOVERAGE.dim_cov_KEY, \nBRANCH_OFFICE.dim_branch_office_key AS dim_branch_office_key,\n'penta' AS sys_cd, \n'Payment' AS activity_type_desc,\n' ' AS activity_subtype_cd,\n' ' AS activity_subtype_desc,\nNULL AS payment_notes,\ncase \nwhen (ce_re_amt.retained_porcentaje is null and ce_re_amt.ceded_porcentaje is null) then 0 else ((SRC.MtoBruto * nvl(ce_re_amt.ceded_porcentaje,0))/100) END AS  ceded_payment_amt,\ncase \nwhen (ce_re_amt.retained_porcentaje is null and ce_re_amt.ceded_porcentaje is null) then 0 else ((SRC.MtoBruto * nvl(ce_re_amt.retained_porcentaje,0))/100)  END AS retained_payment_amt,\nce_re_amt.ceded_porcentaje as ce_amt_per,\nce_re_amt.retained_porcentaje as re_amt_per,\nCAST(SRC.CodTipPag AS VARCHAR(10))AS PaymentTypeCode,\nSRC.RutDest AS PartyIdentifier,\n(CAST(SRC.Folio AS VARCHAR(10))||CAST(SRC.secuen AS VARCHAR(5))) AS PaymentIdentifier, --- Modified as per Mapping sheet version 4.64\nSRC.Siniestro AS ClaimNumber,\nPAYMENT_DT.FecPago AS PaymentDate,  \n'6' AS PaymentMethodCode, ---- select ind_glosa from GrlMst..gen_indicador where ind_tipo in (850)\nCAST(SRC.CodEstPago AS VARCHAR(10)) AS PaymentStatusCode,\nAPRPAGRES.FecIngres AS PaymentEntryDate, \nSRC.FecBolFac AS InvoiceDate,\nCASE WHEN SRC.A\u00c3\u00b1oCon=0 AND SRC.MesCon=0 THEN NULL\nELSE CAST((SRC.A\u00c3\u00b1oCon||'-'||LPAD(SRC.MesCon,2,'0')||'-'||'01') AS VARCHAR(10)) END  AS AccountingPostingDate, --- NEED TO GET A\u00c3\u00b1oCon,MesCon from Driver \nSRC.FecTransac AS PaymentModificationDate ,\nNULL AS PaymentCancellationReasonCode,\nNULL AS PaymentRejectionDescription,\nCASE WHEN SRC.CodTipPag IN(13,14,15) THEN CAST(SRC.CodTipPag AS VARCHAR(10))\nELSE NULL END AS IndemnityCode,  --- CodTipPag  in (13,14,15) \nCASE WHEN SRC.CodTipPag=13 THEN 'Indemnizaci\u00c3\u00b3n Cliente' \nWHEN SRC.CodTipPag=14 THEN 'Indemnizaci\u00c3\u00b3n  Otro' \nWHEN SRC.CodTipPag=15 then 'Indemnizaci\u00c3\u00b3n  Tercero' \nELSE '' END AS IndemnityDescription,\nCASE WHEN SRC.CodEstPago = 20  THEN 'S'\nELSE 'N' END AS  PaymentValidationIndicator,\nBITACORAPAGO.FechaMov AS PaymentValidationDATE,\nCASE WHEN BITACORAPAGO.EstPago=90 THEN 'Transferencia'\nELSE NULL END AS PaymentTransferAccountTypeCode,\nNULL AS EstimatedDateofPayment,\n'6' AS PaymentDocumentTypeCode, --- Commented in DMS as always with check and to hardcode as 6\nNVL(CAST(STG.mkt_ref_code AS VARCHAR(10)),CAST(SRC.CodMonPag AS VARCHAR(10))) AS AccountingCurrencyCode,\nSRC.MtoBruto AS AccountingCurrencyPaymentAmount,\nCAST(LKP_POL_CUR_CD.pol_tin_moneda AS VARCHAR(10)) AS PolicyCurrencyCode,\nNULL AS PolicyCurrencyPaymentAmount,\nNVL(CAST(STG.mkt_ref_code AS VARCHAR(10)),CAST(SRC.CodMonPag AS VARCHAR(10))) AS PaymentCurrencyCode,\nSRC.MtoBruto AS PaymentAmount,\n--SRC.rec_crt_dtm\nSRC.fectransac AS rec_crt_dtm                                           \nFROM (select * from cdp_ods.snsmst_sinpag_aprpagdet ) SRC\nLEFT JOIN cdp_ods.snsmst_snswfl_bitacorapago BITACORAPAGO \nON SRC.Folio=BITACORAPAGO.Folio \nAND SRC.Secuen=BITACORAPAGO.SecuenMov\nAND SRC.CodEstPago = 20\n\n--------\nLEFT JOIN(SELECT DISTINCT APRPADET.Siniestro,SIN_PERFIL.per_int_sinies,APRPADET.RutDest,SIN_PERFIL.per_int_rutase,\nSIN_PERFIL.per_tin_tiposiniestro AS CLAIM_TYPE_per_tin_tiposiniestro,\nSIN_PERFIL.per_tin_ramo AS LOB_per_tin_ramo\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET \nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL \nON APRPADET.Siniestro=SIN_PERFIL.per_int_sinies\nAND APRPADET.RutDest=SIN_PERFIL.per_int_rutase\n) LKP_APRPADET_SIN_PERFIL\nON LKP_APRPADET_SIN_PERFIL.Siniestro=SRC.Siniestro\nAND SRC.RutDest=LKP_APRPADET_SIN_PERFIL.per_int_rutase\n\n------------\n\nLEFT JOIN\n(SELECT DISTINCT DANOS.nro_siniestro,SIN_TERCER.ter_int_sinies,APRPADET.RutDest,SIN_TERCER.ter_int_rut\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET \nINNER JOIN cdp_ods.bd_sinie_x_sin_tercer SIN_TERCER\nON APRPADET.RutDest=SIN_TERCER.ter_int_rut\nINNER JOIN cdp_ods.bd_sinie_x_rsin_matriz_danos DANOS\nON SIN_TERCER.ter_int_sinies=DANOS.nro_siniestro\nAND SIN_TERCER.ter_cha_patent=DANOS.patente\n)LKP_APRPADET_SIN_TERCER\nON LKP_APRPADET_SIN_TERCER.ter_int_sinies=SRC.siniestro\n\n---------\nLEFT JOIN (Select \nPOLIZA.pol_tin_moneda,SIN_PERFIL.per_int_sinies\nFROM cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nINNER JOIN cdp_ods.bd_produ_x_pro_poliza POLIZA \nON SIN_PERFIL.per_int_poliza=POLIZA.pol_int_poliza) LKP_POL_CUR_CD\nON LKP_POL_CUR_CD.per_int_sinies=SRC.Siniestro\nLEFT JOIN\n(SELECT MAX(APRPAGRES.fecingres) AS fecingres,APRPAGRES.Siniestro\nFROM cdp_ods.snsmst_sinpag_aprpagdet SRC\nINNER JOIN cdp_ods.snsmst_sinpag_aprpagres APRPAGRES \nON APRPAGRES.Siniestro=SRC.Siniestro\nGROUP BY APRPAGRES.Siniestro)APRPAGRES\nON APRPAGRES.Siniestro=SRC.Siniestro\n/*LEFT JOIN cdp_ods.snsmst_sinpag_aprpagres APRPAGRES \nON APRPAGRES.Siniestro=SRC.Siniestro*/\nLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='currency_type' AND src_sys_cd='penta' ) STG\nON STG.ref_cd=CAST(SRC.CodMonPag AS VARCHAR(20))\nLEFT JOIN(Select\nMAX(FecPago) AS FecPago ,Siniestro,Folio,A\u00c3\u00b1oCon,MesCon\nFROM cdp_ods.snsmst_sinpag_aprpagdet\nGROUP BY Siniestro,Folio,A\u00c3\u00b1oCon,MesCon) PAYMENT_DT\nON SRC.Siniestro=PAYMENT_DT.Siniestro\nAND SRC.Folio=PAYMENT_DT.Folio\nAND SRC.A\u00c3\u00b1oCon=PAYMENT_DT.A\u00c3\u00b1oCon\nAND SRC.MesCon=PAYMENT_DT.MesCon\nLEFT JOIN  cdp_dwh.dim_claim_t CLAIM\nON CLAIM.claim_num=CAST(SRC.Siniestro AS VARCHAR(35))\nAND CLAIM.src_sys_cd='penta'\nLEFT JOIN (SELECT DISTINCT A.claim_num,A.dim_claimant_key FROM cdp_dwh.dim_claimant_t A,\ncdp_ods.snsmst_sinpag_aprpagdet DRIVER, cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nwhere  A.claim_num=DRIVER.Siniestro \nand  DRIVER.Siniestro = SIN_PERFIL.per_int_sinies\nand A.src_sys_cd='penta'\nAND 1=A.claimant_num\n) CLAIMANT_KEY_INSURED\nON CLAIMANT_KEY_INSURED.claim_num= SRC.Siniestro\n\nLEFT JOIN (SELECT DISTINCT A.claim_num,A.dim_claimant_key FROM cdp_dwh.dim_claimant_t A,\ncdp_ods.snsmst_sinpag_aprpagdet DRIVER, cdp_ods.bd_sinie_x_sin_tercer SIN_TERCER\nWHERE A.claim_num=DRIVER.Siniestro\nAND  DRIVER.Siniestro  = SIN_TERCER.ter_int_sinies\nAND  A.src_sys_cd='penta'\nAND 3=A.claimant_num) CLAIMANT_KEY_THIRD_PARTY\nON CLAIMANT_KEY_THIRD_PARTY.claim_num = SRC.Siniestro\n\nLEFT JOIN (SELECT DISTINCT A.claim_num,A.dim_loss_item_key FROM cdp_dwh.dim_loss_item_t A\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil DRIVER\nON A.claim_num=DRIVER.per_int_sinies\nAnd  A.src_sys_cd='penta'\nAND DRIVER.per_int_rutase=A.loss_item_id) LOSS_ITEM_KEY_INSURED\nON SRC.siniestro=LOSS_ITEM_KEY_INSURED.claim_num\t\t--DID 136\n\nLEFT JOIN(\nSELECT LOB.dim_lob_key,B.Siniestro\nFROM\n(SELECT  DISTINCT\nAPRPADET.Siniestro,PRO_RAMOS.ram_tin_codigo\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  APRPADET.Siniestro=SIN_PERFIL.per_int_sinies\nINNER JOIN cdp_ods.prdcdg_pro_ramos PRO_RAMOS\nON SIN_PERFIL.per_tin_ramo=PRO_RAMOS.ram_tin_codigo)B\nINNER JOIN adp_dwh.cdp_dwh.dim_lob_t LOB\nON LOB.lob_cd=B.ram_tin_codigo\nAND LOB.src_sys_cd='penta'\n) LOB\nON LOB.Siniestro=SRC.Siniestro\nLEFT JOIN(\nSELECT DISTINCT CLAIM_TYPE.dim_claim_type_key,APRPADET.Siniestro\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  APRPADET.Siniestro=SIN_PERFIL.per_int_sinies\nINNER JOIN cdp_dwh.dim_claim_type_t CLAIM_TYPE\nON CLAIM_TYPE.claim_type_cd=CAST(SIN_PERFIL.per_tin_tiposiniestro AS VARCHAR(20))\nAND CLAIM_TYPE.src_sys_cd='penta'\n) CLAIM_TYPE\nON CLAIM_TYPE.Siniestro=SRC.Siniestro  \nLEFT JOIN cdp_dwh.dim_bdshp_t BODYSHOP\nON BODYSHOP.bdshp_id = SRC.RutDest \nAND BODYSHOP.src_sys_cd='penta'\n/*LEFT JOIN cdp_dwh.dim_insured_t INSURED  --Commented out as per MVP1 change in Insured dim and added new logic\nON INSURED.insured_id=SRC.RutDest \nAND INSURED.src_sys_cd='penta'*/\n/*LEFT JOIN(\nSELECT DISTINCT INSURED.dim_insured_key,APRPADET.Siniestro\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  APRPADET.Siniestro=SIN_PERFIL.per_int_sinies\nINNER JOIN cdp_dwh.dim_insured_t INSURED\nON cast((SIN_PERFIL.per_int_poliza||'-'||SIN_PERFIL.per_sma_item) as varchar(35)) =INSURED.insured_id\nAND INSURED.src_sys_cd='penta'\n) INSURED\nON INSURED.Siniestro=SRC.Siniestro*/  --Commented out as per MVP1 change in Insured dim and added new logic\nLEFT JOIN(\nSELECT DISTINCT INSURED.dim_insured_key,APRPADET.Siniestro,INSURED.insured_rut_num\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  APRPADET.Siniestro=SIN_PERFIL.per_int_sinies\nAND APRPADET.RutDest = SIN_PERFIL.per_int_rutase\nINNER JOIN cdp_dwh.dim_insured_t INSURED\nON cast((SIN_PERFIL.per_int_poliza||'-'||SIN_PERFIL.per_sma_item) as varchar(35)) =INSURED.insured_id\nAND SIN_PERFIL.per_int_rutase=INSURED.insured_rut_num\nAND INSURED.src_sys_cd='penta'\n) INSURED\nON INSURED.Siniestro=SRC.Siniestro\nAND INSURED.insured_rut_num=SRC.RutDest \nLEFT JOIN cdp_dwh.dim_parts_provdr_t SUPPLIER\nON SUPPLIER.provdr_id=SRC.RutDest\nAND SUPPLIER.src_sys_cd='penta'\n/*LEFT JOIN(\nSelect \n RutUsuario,a.Siniestro \nfrom cdp_ods.snsmst_sinpag_aprpagdet a\nwhere\na.Folio=(select max(pd.Folio) from cdp_ods.snsmst_sinpag_aprpagdet pd where pd.Siniestro=a.Siniestro) and\na.Secuen=(select max (pd.Secuen) from cdp_ods.snsmst_sinpag_aprpagdet pd where pd.Siniestro=a.Siniestro and pd.Folio=a.Folio) \n) CLAIM_ANALYST\nON CLAIM_ANALYST.Siniestro=SRC.Siniestro*/\nLEFT JOIN(\nSelect \n RutUsuario,a.Siniestro \nfrom cdp_ods.snsmst_sinpag_aprpagdet a\nwhere\na.Folio=(select max(pd.Folio) from cdp_ods.snsmst_sinpag_aprpagdet pd where pd.Siniestro=a.Siniestro) and\na.Secuen=(select max (pd.Secuen) from cdp_ods.snsmst_sinpag_aprpagdet pd where pd.Siniestro=a.Siniestro and pd.Folio=a.Folio) \n) CLM_ANALYST_RUTUSARIO\nON CLM_ANALYST_RUTUSARIO.Siniestro=SRC.Siniestro\nLEFT JOIN cdp_dwh.dim_claim_analyst_t CLAIM_ANALYST\nON CLAIM_ANALYST.claim_analyst_id=CLM_ANALYST_RUTUSARIO.RutUsuario\nAND CLAIM_ANALYST.src_sys_cd='penta'\nLEFT JOIN(\nSELECT DISTINCT COVERAGE.dim_cov_KEY,SRC.Siniestro,SRC.Folio,SRC.Secuen\nFROM cdp_ods.snsmst_sinpag_aprpagdet SRC\nINNER JOIN cdp_ods.snsmst_sinpag_aprpagcober APRPAGCOBER\nON  SRC.Folio=APRPAGCOBER.Folio\nAND SRC.Secuen=APRPAGCOBER.Secuen\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  SRC.Siniestro=SIN_PERFIL.per_int_sinies\nINNER JOIN cdp_dwh.dim_cov_type_t COVERAGE\nON COVERAGE.cov_cd=(CAST(SIN_PERFIL.per_tin_ramo AS VARCHAR(3))||'|'||CAST(APRPAGCOBER.codcober AS VARCHAR(3)))\nAND COVERAGE.src_sys_cd='penta') COVERAGE\nON COVERAGE.Siniestro=SRC.Siniestro\nAND COVERAGE.Folio=SRC.Folio\nAND COVERAGE.Secuen=SRC.Secuen\nLEFT JOIN\n(SELECT OTHR_PARTY.dim_other_party_key,A.Siniestro, A.Folio, A.Secuen\nFROM\n(SELECT DISTINCT \nSIN_TERCER.ter_int_rut,APRPADET.Siniestro, APRPADET.Folio,APRPADET.Secuen\nFROM  cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_tercer SIN_TERCER\nON APRPADET.Siniestro=SIN_TERCER.ter_int_sinies\nAND APRPADET.CodCob=2\nAND SIN_TERCER.ter_nro_correlativo = 1) A\nINNER JOIN cdp_dwh.dim_other_party_t OTHR_PARTY\nON OTHR_PARTY.party_rut_num=A.ter_int_rut\nAND  OTHR_PARTY.src_sys_cd='penta') PARTY\nON PARTY.Siniestro=SRC.Siniestro \nAnd PARTY.Folio = SRC.folio\nAnd PARTY.secuen = SRC.secuen\n--Added for DID-140 \nLEFT JOIN\n(\nSELECT CLAIM_STATUS.dim_claim_status_key,C.Siniestro\nFROM\n(SELECT SIN_ESTD.est_tin_codigo,B.Siniestro\nFROM\n(\nSELECT DISTINCT\nAPRPADET.Siniestro,SIN_PERFIL.dap_tin_estado\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  APRPADET.Siniestro=SIN_PERFIL.per_int_sinies ) B\nINNER JOIN cdp_ods.bd_sinie_x_sin_estadosiniestro SIN_ESTD\nON B.dap_tin_estado=SIN_ESTD.est_tin_codigo)C\nINNER JOIN cdp_dwh.dim_claim_status_t CLAIM_STATUS\nON CLAIM_STATUS.claim_status_cd=CAST(C.est_tin_codigo AS VARCHAR(6))\nAND CLAIM_STATUS.src_sys_cd='penta'\n) CLAIM_STATUS_INSURED\nON CLAIM_STATUS_INSURED.Siniestro=SRC.Siniestro\nLEFT JOIN\n(SELECT CLAIM_STATUS.dim_claim_status_key,C.Siniestro\nFROM\n(SELECT SIN_ESTD.est_tin_codigo,B.Siniestro\nFROM\n(\nSELECT DISTINCT\nAPRPADET.Siniestro,SIN_PERFIL.dat_tin_estado\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  APRPADET.Siniestro=SIN_PERFIL.per_int_sinies ) B\nINNER JOIN cdp_ods.bd_sinie_x_sin_estadosiniestro SIN_ESTD\nON B.dat_tin_estado=SIN_ESTD.est_tin_codigo)C\nINNER JOIN cdp_dwh.dim_claim_status_t CLAIM_STATUS\nON CLAIM_STATUS.claim_status_cd=CAST(C.est_tin_codigo AS VARCHAR(6))\nAND CLAIM_STATUS.src_sys_cd='penta'\n) CLAIM_STATUS_THIRD_PARTY\nON CLAIM_STATUS_THIRD_PARTY.Siniestro=SRC.Siniestro \nLEFT JOIN\n(SELECT A.Siniestro,CLAIM_ADJ.dim_claim_adjuster_key\nFROM\n(SELECT DISTINCT\nAPRPADET.Siniestro,PROPIOS.dap_int_rutliq\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_danos_propios PROPIOS\nON APRPADET.Siniestro=PROPIOS.dap_int_sinies)A\nINNER JOIN cdp_dwh.dim_claim_adjuster_t CLAIM_ADJ\nON CLAIM_ADJ.adjuster_id=A.dap_int_rutliq\nAND CLAIM_ADJ.src_sys_cd='penta') CLAIM_ADJ_INSURED\nON CLAIM_ADJ_INSURED.Siniestro=SRC.Siniestro\nLEFT JOIN\n(SELECT B.Siniestro,CLAIM_ADJ.dim_claim_adjuster_key\nFROM\n(SELECT DISTINCT\nAPRPADET.Siniestro,TERCERO.dat_int_rutabo\nFROM cdp_ods.snsmst_sinpag_aprpagdet APRPADET\nINNER JOIN cdp_ods.bd_sinie_x_sin_danos_tercero TERCERO\nON APRPADET.Siniestro=TERCERO.dat_int_sinies)B\nINNER JOIN cdp_dwh.dim_claim_adjuster_t CLAIM_ADJ\nON CLAIM_ADJ.adjuster_id=B.dat_int_rutabo\nAND CLAIM_ADJ.src_sys_cd='penta') CLAIM_ADJ_THIRD_PARTY\nON CLAIM_ADJ_THIRD_PARTY.Siniestro=SRC.Siniestro \nLEFT JOIN cdp_dwh.dim_branch_office_t BRANCH_OFFICE\nON BRANCH_OFFICE.branch_office_id=CAST(SRC.CodOfiPag AS VARCHAR(20))\t--DID-134\nAND BRANCH_OFFICE.src_sys_cd='penta' \nLEFT JOIN\n(\nSELECT\nBB.Folio,\nBB.Secuen,\nBB.Siniestro,\nBB.contrato,\nBB.retained_porcentaje,\nBB.ceded_porcentaje\nFROM\n(SELECT\nA.Folio,\nA.Secuen,\nA.Siniestro,\nA.contrato,\nA.retained_porcentaje,\nA.ceded_porcentaje,\nROW_NUMBER() OVER (PARTITION BY Siniestro,Folio,Secuen ORDER BY contrato DESC) ROW_NUM\nFROM\n(Select \nnvl(re_amt.Folio,ce_amt.Folio) AS Folio ,\nnvl(re_amt.Secuen,ce_amt.Secuen) AS Secuen,\nnvl(re_amt.Siniestro,ce_amt.Siniestro) AS Siniestro,\nnvl(re_amt.contrato,ce_amt.contrato) AS contrato,\nre_amt.porcentaje as retained_porcentaje,\nce_amt.porcentaje as ceded_porcentaje\nFROM\n(Select \n      Folio,\n    Secuen,\n                Siniestro,\n                CodCober,\n               contrato,\n                codtiporea,\n                --sum(porcentaje) as porcentaje\n                 round(sum(porcentaje),4) as porcentaje\n--into #Distribucion1\nfrom \n(\nselect   \n    --Retencion\n    Folio,\n    Secuen,\n    'R'                                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato           contrato,\n    'Retencion   '                                  tiporea,\n                --round(round((nullif(priret,0)/nullif(pritot,0)),4)*100,4)   porcentaje\n                 ((nullif(CAST(priret AS  DECIMAL(21,5)),0)/nullif(CAST(pritot AS DECIMAL(21,5)),0))*100)  porcentaje\n--into #Distribucion    \nfrom\n(select\n    a.Folio,\n    a.Secuen,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion\n--into #idDistribucion  \nfrom   \n(\nSelect\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n      \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem)a\n                where \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from (Select\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n    b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n     \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem) b \n                                                                                                                where\n                                                                                                                b.Folio  =a.Folio                and\n                                                                                                                b.Secuen             =b.Secuen\n                                                                                                                ) \n                                                                                                                )u1\n                                                                                                                where u1.priret  <>  0 \n                                                                                                                )d1\n                                                                                                                group by \n                Folio,\n      Secuen,\n                Siniestro,\n                CodCober,\n                contrato,\n                codtiporea\n    \n\n\n) re_amt \nFULL OUTER JOIN\n(\n--Detalle\nSelect \n      Folio,\n     Secuen,\n                Siniestro,\n                CodCober ,\n                contrato ,\n                codtiporea,\n               -- sum(porcentaje) as porcentaje\n              round(sum(porcentaje),4) as porcentaje\n--into #Distribucion1\nfrom \n(\nselect   \n    --Cesion QP\n    Folio,\n    Secuen,\n    'C'                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato AS contrato,    \n    'Cesion QP',\n                --round(round((nullif(pricqp,0)/nullif(pritot,0)),4)*100,4)   porcentaje\n                  ((nullif(CAST(pricqp AS  DECIMAL(21,5)),0)/nullif(CAST(pritot AS DECIMAL(21,5)),0))*100)  porcentaje\n--into #Distribucion    \nfrom\n(select\n    a.Folio,\n    a.Secuen,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion\n--into #idDistribucion  \nfrom   \n(\nSelect\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n      \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem)a\n                where \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from (Select\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n      \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem) b \n                                                                                                                where\n                                                                                                                b.Folio  =a.Folio                and\n                                                                                                                b.Secuen             =b.Secuen\n                                                                                                                ) \n                                                                                                                )u2\n                                                                                                                where u2.pricqp  <>  0 \n                                                                                                                \n                \n                UNION ALL\n               \n                select   \n    --Cesion Exc\n    Folio,\n    Secuen,\n    'C'                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato AS contrato,    \n    'Cesion Exc',\n               -- round(round((nullif(priexc,0)/nullif(pritot,0)),4)*100,4)   porcentaje\n                ((nullif(CAST(priexc AS  DECIMAL(21,5)),0)/nullif(CAST(pritot AS DECIMAL(21,5)),0))*100)  porcentaje\n--into #Distribucion    \nfrom\n(select\n    a.Folio,\n    a.Secuen,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion\n--into #idDistribucion  \nfrom   \n(\nSelect\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n      \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem)a\n                where \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from (Select\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n      \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem) b \n                                                                                                                where\n                                                                                                                b.Folio  =a.Folio                and\n                                                                                                                b.Secuen             =b.Secuen\n                                                                                                                ) \n                                                                                                                )u3\n                                                                                                                where u3.priexc  <>  0 \n                                                                                                                \n                \n                UNION ALL\n                \nselect   \n    --Cesion Fac\n    Folio,\n    Secuen,\n    'C'                                                                       codtiporea,\n   Siniestro,\n    CodCober,\n    coc_int_codigoContrato AS contrato,        \n    'Facultativa',\n               -- round(round((nullif(prifac,0)/nullif(pritot,0)),4)*100,4)   porcentaje\n                 ((nullif(CAST(prifac AS  DECIMAL(21,5)),0)/nullif(CAST(pritot AS DECIMAL(21,5)),0))*100)  porcentaje\n                  \n--into #Distribucion    \nfrom\n(select\n    a.Folio,\n    a.Secuen,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion\n--into #idDistribucion  \nfrom   \n(\nSelect\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n     and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n     \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem)a\n                where \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from (Select\n     a.Folio,\n     a.Secuen,      \n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n     isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n     round(sum(mov.dis_dec_primaRetencion),4)     priret,\n     round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n     round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n     round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n     round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n\n                  cdp_ods.SnsMst_SinPag_AprPagDet a,\n      cdp_ods.SnsMst_SinPag_AprPagCober b, \n      cdp_ods.bd_sinie_x_sin_perfil c,\n      cdp_ods.bd_produ_x_pro_poliza p,\n    cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n      \n       a.Folio=b.Folio\n      and a.Secuen=b.Secuen\n      and a.Siniestro=c.per_int_sinies\n      and c.per_int_poliza=p.pol_int_poliza\n      \n      and cc.coc_int_codigoRamo      =   c.per_tin_ramo     \n      and cc.coc_int_codigoCobertura =   b.CodCober                \n      and mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \n      and mc.cnt_tin_estadoContrato  =   2     \n                                and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \n      and to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')            \n      \n      and his.hid_int_nroPoliza               =   c.per_int_poliza   \n      and his.hid_int_nroItem                 =   c.per_sma_item      \n                  and his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)   \n                  and to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\n      and to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')     \n      and (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n      \n      and mov.dis_int_nroPoliza       =   c.per_int_poliza\n      and mov.dis_int_nroItem         =   c.per_sma_item\n      and mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\n      and mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n      \n\ngroup by \n     a.Folio,\n     a.Secuen,\n     a.Siniestro,\n     b.CodCober,\n     c.per_fec_sinies,\n     c.per_int_poliza,\n     c.per_sma_item,\n     p.pol_fec_vigdes,\n     p.pol_fec_vighas,\n     cc.coc_int_codigoContrato,\n     his.hid_int_idDistribucion,\n     mov.dis_int_nroPoliza,\n     mov.dis_int_nroItem) b \n                                                                                                                where\n                                                                                                                b.Folio  =a.Folio                and\n                                                                                                                b.Secuen             =b.Secuen\n                                                                                                                ) \n                                                                                                                )u4\n                                                                                                                where u4.prifac  <>  0 \n                                                                                                                )d2\n                                                                                                                group by \n                Folio,\n                Secuen,\n                Siniestro,\n                CodCober,\n                contrato,\n              codtiporea)ce_amt\n                                                                ON re_amt.Siniestro=ce_amt.Siniestro\n                                                                AND re_amt.Secuen=ce_amt.Secuen\n                                                                AND re_amt.contrato=ce_amt.contrato)A)BB\n                                                                WHERE BB.ROW_NUM=1\n    \n) ce_re_amt \nON ce_re_amt.Siniestro=SRC.Siniestro\nAND (CAST(SRC.Folio AS VARCHAR(10))||CAST(SRC.secuen AS VARCHAR(5)))=(CAST(ce_re_amt.Folio AS VARCHAR(10))||CAST(ce_re_amt.secuen AS VARCHAR(5)))\n) PENTA_1\n) PENTA_PAYMENT\nLEFT JOIN (SELECT 1 as DUMMY, max(fact_claim_payment_key) AS MAX_SID from cdp_dwh.fact_claim_payment_activity_t) LKP\nON LKP.DUMMY=PENTA_PAYMENT.DUMMY\nWHERE PENTA_PAYMENT.RNK=1\n\n\nUNION\n\n/********Recovery********/\n\nSELECT \nCAST(PENTA_RECOVERY.dim_claim_key AS INT),\nCAST(PENTA_RECOVERY.dim_claimant_key AS INT),\nCAST(PENTA_RECOVERY.dim_loss_item_key AS INT),\nCAST(PENTA_RECOVERY.dim_line_of_business_key AS INT),\nCAST(PENTA_RECOVERY.dim_claim_status_key AS INT),\nCAST(PENTA_RECOVERY.dim_claim_type_key AS INT),\nCAST(PENTA_RECOVERY.dim_claim_adjuster_key AS INT),\nCAST(PENTA_RECOVERY.dim_bdshp_key AS INT),\nCAST(PENTA_RECOVERY.dim_supplier_key AS INT),\nCAST(PENTA_RECOVERY.dim_claim_analyst_key AS INT),\nCAST(PENTA_RECOVERY.dim_insured_key AS INT),\nCAST(PENTA_RECOVERY.dim_party_key AS INT),\nCAST(PENTA_RECOVERY.dim_recov_type_key AS INT),\nCAST(PENTA_RECOVERY.dim_cov_key AS INT),\nCAST(PENTA_RECOVERY.dim_branch_office_key AS INT),\nCAST(PENTA_RECOVERY.sys_cd AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.activity_type_desc AS VARCHAR(80)),\nCAST(PENTA_RECOVERY.activity_subtype_cd AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.activity_subtype_desc AS VARCHAR(80)),\nCAST(PENTA_RECOVERY.payment_notes AS  VARCHAR(100)),\nCAST(PENTA_RECOVERY.ceded_payment_amt AS NUMERIC(25,10)),\nCAST(PENTA_RECOVERY.retained_payment_amt AS NUMERIC(25,10)),\nCAST(PENTA_RECOVERY.PaymentTypeCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.PartyIdentifier AS INT),\nCAST(PENTA_RECOVERY.PaymentIdentifier AS VARCHAR(35)),\nCAST(PENTA_RECOVERY.ClaimNumber AS VARCHAR(35)),\nCAST(PENTA_RECOVERY.PaymentDate AS DATE),\nCAST(PENTA_RECOVERY.PaymentMethodCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.PaymentStatusCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.PaymentEntryDate AS DATE),\nCAST(PENTA_RECOVERY.InvoiceDate AS DATE),\nCAST(PENTA_RECOVERY.AccountingPostingDate AS DATE),\nCAST(PENTA_RECOVERY.PaymentModificationDate AS DATE),\nCAST(PENTA_RECOVERY.PaymentCancellationReasonCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.PaymentRejectionDescription AS VARCHAR(100)),\nCAST(PENTA_RECOVERY.IndemnityCode AS VARCHAR(10)),\n--PENTA_RECOVERY.IndemnityDescription,\nCAST(PENTA_RECOVERY.PaymentValidationIndicator AS CHAR(1)),\nCAST(PENTA_RECOVERY.PaymentValidationDate AS DATE),\nCAST(PENTA_RECOVERY.PaymentTransferAccountTypeCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.EstimatedDateofPayment AS DATE),\nCAST(PENTA_RECOVERY.PaymentDocumentTypeCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.AccountingCurrencyCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.AccountingCurrencyPaymentAmount AS NUMERIC(25,10)),\nCAST(PENTA_RECOVERY.PolicyCurrencyCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.PolicyCurrencyPaymentAmount AS NUMERIC(25,10)),\nCAST(PENTA_RECOVERY.PaymentCurrencyCode AS VARCHAR(10)),\nCAST(PENTA_RECOVERY.PaymentAmount AS NUMERIC(25,10)),\nLKP.MAX_SID\nFROM\n(\nSELECT\nNVL(CAST(PENTA_2.dim_claim_key AS INT) ,0) AS dim_claim_key,\nNVL(CAST(PENTA_2.dim_claimant_key AS INT) ,0)  AS dim_claimant_key,\nNVL(CAST(PENTA_2.dim_loss_item_key AS INT) ,0) AS dim_loss_item_key ,\nNVL(CAST(PENTA_2.dim_line_of_business_key AS INT) ,0) AS dim_line_of_business_key ,\nNVL(CAST(PENTA_2.dim_claim_status_key AS INT) ,0)AS dim_claim_status_key ,\nNVL(CAST(PENTA_2.dim_claim_type_key AS INT) ,0) AS dim_claim_type_key,\n'0' AS dim_claim_adjuster_key,\n'0' AS dim_bdshp_key,\n'0' AS dim_supplier_key,\nNVL(CAST(PENTA_2.dim_claim_analyst_key AS INT) ,0) AS dim_claim_analyst_key ,\nNVL(CAST(PENTA_2.dim_insured_key AS INT) ,0) AS dim_insured_key ,\nNVL(CAST(PENTA_2.dim_party_key AS INT) ,0) AS dim_party_key ,\nNVL(CAST(PENTA_2.dim_recov_type_key AS INT) ,0) AS dim_recov_type_key ,\nNVL(CAST(PENTA_2.dim_cov_key AS INT) ,0) AS dim_cov_key,\nNVL(CAST(PENTA_2.dim_branch_office_key AS INT) ,0) AS dim_branch_office_key,\nCAST(PENTA_2.sys_cd AS VARCHAR(10)),\nCAST(PENTA_2.recovery_desc AS VARCHAR(80)) AS activity_type_desc,\n' ' AS activity_subtype_cd,\n' ' AS activity_subtype_desc,\nNULL AS payment_notes,\nceded_payment_amt ceded_payment_amt,\n--PENTA_2.recovery_amt*retained_amt.porcentaje_retained/100 AS retained_payment_amt,\nretained_payment_amt retained_payment_amt,\nCAST(PENTA_2.recovery_type_cd AS VARCHAR(10)) AS PaymentTypeCode,\nCAST(PartyIdentifier AS INT) AS PartyIdentifier,\nCAST(PENTA_2.recovery_payment_id AS VARCHAR(35)) AS PaymentIdentifier,\nCAST(PENTA_2.claim_num AS VARCHAR(35)) AS ClaimNumber,\nPENTA_2.recovery_dt AS PaymentDate,\nCAST(PENTA_2.recovery_method_cd AS VARCHAR(10)) AS PaymentMethodCode ,\nCAST(PENTA_2.recovery_status_cd AS VARCHAR(10)) AS PaymentStatusCode,\nPENTA_2.recovery_entry_dt AS PaymentEntryDate,\nNULL AS invoicedate,\nPENTA_2.accountingPostingDate AS AccountingPostingDate,\nPENTA_2.recovery_modification_dt as PaymentModificationDate,\nCAST(PENTA_2.recovery_cancellation_reason_cd AS VARCHAR(10)) AS PaymentCancellationReasonCode,\nCAST(PENTA_2.recovery_status_desc AS VARCHAR(100)) AS PaymentRejectionDescription,\nNULL AS IndemnityCode,\nNULL AS IndemnityDescription,\nCAST(PENTA_2.recovery_validation_ind AS CHAR(1)) AS PaymentValidationIndicator,\nPENTA_2.recovery_validation_dt AS PaymentValidationDate,\nCAST(PaymentTransferAccountTypeCode AS VARCHAR(10)) AS PaymentTransferAccountTypeCode,\nNULL AS EstimatedDateofPayment,\nCAST(PENTA_2.recovery_document_type_cd AS VARCHAR(10)) AS PaymentDocumentTypeCode,\nCAST(PENTA_2.accounting_currency_cd AS VARCHAR(10)) AS AccountingCurrencyCode,\nPENTA_2.accounting_currency_recovery_amt AS AccountingCurrencyPaymentAmount,\nCAST(PENTA_2.policy_currency_cd AS VARCHAR(10)) AS PolicyCurrencyCode,\nPENTA_2.policy_currency_recovery_amt AS PolicyCurrencyPaymentAmount,\nCAST(PENTA_2.recovery_amt_currency_cd AS VARCHAR(10)) AS PaymentCurrencyCode,\nPENTA_2.recovery_amt AS PaymentAmount,\n1 AS DUMMY,\nPENTA_2.porcentaje_retained,\nPENTA_2.porcentaje_ceded,\nROW_NUMBER() OVER (PARTITION BY PENTA_2.claim_num,PENTA_2.recovery_payment_id ORDER BY PENTA_2.rec_crt_dtm DESC) RNK\nFROM\n(select \n'penta' as sys_cd,\ndriver.SAL_INT_FOLIO_COMPROBANTE as recovery_payment_id,\ndriver.SAL_INT_SINIESTRO as claim_num,\nCLAIM.dim_claim_key AS dim_claim_key,\nCASE WHEN CLAIMANT_KEY_INSURED.dim_claimant_key IS NOT NULL THEN  CLAIMANT_KEY_INSURED.dim_claimant_key\nWHEN CLAIMANT_KEY_THIRD_PARTY.dim_claimant_key IS NOT NULL THEN  CLAIMANT_KEY_THIRD_PARTY.dim_claimant_key\nELSE NULL END AS dim_claimant_key,\nCASE WHEN LOSS_ITEM_KEY_INSURED.dim_loss_item_key IS NOT NULL THEN  LOSS_ITEM_KEY_INSURED.dim_loss_item_key\nWHEN LOSS_ITEM_KEY_THIRD_PARTY.dim_loss_item_key IS NOT NULL THEN  LOSS_ITEM_KEY_THIRD_PARTY.dim_loss_item_key\nELSE NULL END AS dim_loss_item_key,\nnull as dim_claim_analyst_key,\nLOB.dim_lob_key AS dim_line_of_business_key,\nCASE WHEN CLAIM_STATUS_INSURED.dim_claim_status_key IS NOT NULL THEN  CLAIM_STATUS_INSURED.dim_claim_status_key\nWHEN CLAIM_STATUS_THIRD_PARTY.dim_claim_status_key IS NOT NULL THEN  CLAIM_STATUS_THIRD_PARTY.dim_claim_status_key\nELSE NULL END AS dim_claim_status_key,\n/*CASE WHEN CLAIM_TYPE_INSURED.dim_claim_type_key IS NOT NULL THEN  CLAIM_TYPE_INSURED.dim_claim_type_key\nWHEN CLAIM_TYPE_THIRD_PARTY.dim_claim_type_key IS NOT NULL THEN  CLAIM_TYPE_THIRD_PARTY.dim_claim_type_key\nELSE NULL END AS dim_claim_type_key,*/\nCLAIM_TYPE.dim_claim_type_key, --- New Logic implemented as per mapping sheet version 55\nnull as dim_recovery_src_party_key,\nINSURED.dim_insured_key,\nRECOVERY.dim_recov_type_key, \nnull as dim_recovery_processing_office_key,\nnull as dim_party_key,\nBRANCH_OFFICE.dim_branch_office_key,\nCOVERAGE.dim_cov_key AS dim_cov_key,\ndriver.SAL_FEC_FECHA_INGRESO as recovery_entry_dt ,\nnull as recovery_modification_dt,\nnvl(ref_recovery.ref_cd,cast( propiedad.COD_CONCEPTO_GRUPAL as varchar(20))) as recovery_type_cd,\nrecuperosdst.FechaRec as recovery_dt,\nCASE WHEN driver.SAL_TIN_ESTADO <>5 THEN 'S' Else 'N' END  AS recovery_validation_ind,\nCASE WHEN driver.SAL_TIN_ESTADO <>5 THEN driver.SAL_FEC_FECHA_GEN_TICKET Else NULL END  AS recovery_validation_dt,\npropiedad.COD_CONCEPTO_GRUPAL as recovery_method_cd,\ndriver.SAL_TIN_ESTADO as recovery_status_cd,\ngen_indicador.ind_glosa as recovery_status_desc,\nnull as recovery_cancellation_reason_cd,\ndriver.SAL_TIN_CONCEPTO as recovery_document_type_cd,\n--driver.SAL_TIN_COD_MONEDA_MP as recovery_amt_currency_cd,\nCAST(Payment_Curr.mkt_ref_code AS VARCHAR(10)) AS recovery_amt_currency_cd,\ndriver.SAL_MON_MONTO_CIR_MP  as recovery_amt,\ndriver.SAL_TIN_COD_MONEDA_MO as policy_currency_cd,\nCASE WHEN driver.SAL_TIN_ESTADO <> 5 THEN driver.SAL_MON_MONTO_CIR_MO ELSE 0 END AS policy_currency_recovery_amt, --- Modified as per Mapping sheet version 4.64\ndriver.SAL_TIN_FORMA_PAGO AS PaymentTransferAccountTypeCode,\nCASE WHEN driver.SAL_SMA_ANOCONTABLE=0 AND driver.SAL_TIN_MESCONTABLE=0 THEN NULL\nELSE CAST((driver.SAL_SMA_ANOCONTABLE||'-'||LPAD(driver.SAL_TIN_MESCONTABLE,2,'0')||'-'||'01') AS VARCHAR(10)) END  AS accountingPostingDate,\ndriver.SAL_TIN_COD_MONEDA_MP as accounting_currency_cd,\ndriver.SAL_MON_MONTO_CIR_MP as accounting_currency_recovery_amt,\nPARTY_ID.SAL_INT_RUT AS PartyIdentifier,\nNVL((CASE propiedad.COD_CONCEPTO_GRUPAL WHEN  1 THEN 'Recuperos' \nWHEN 2 THEN 'Salvataje' \nWHEN 3 THEN  'Otros Ingresos' END ), 'RECUPEROS') as recovery_desc,\n--driver.SAL_MON_MONTO_CIR_MP*retained_amt.porcentaje_retained/100 as retained_payment_amt,\ncase \nwhen (retained_amt.porcentaje_retained is null and ceded_amt.porcentaje_ceded is null) then 0 else\ndriver.SAL_MON_MONTO_CIR_MP*retained_amt.porcentaje_retained/100 end as retained_payment_amt,\n--driver.SAL_MON_MONTO_CIR_MP*ceded_amt.porcentaje_ceded/100 as ceded_payment_amt,\ncase \nwhen (retained_amt.porcentaje_retained is null and ceded_amt.porcentaje_ceded is null) then 0 else\ndriver.SAL_MON_MONTO_CIR_MP*ceded_amt.porcentaje_ceded/100 end as ceded_payment_amt,\nretained_amt.porcentaje_retained,\nceded_amt.porcentaje_ceded,\ndriver.sal_fec_fecha_estado AS rec_crt_dtm\nfrom(select * from cdp_ods.bd_sinie_x_cir_salvataje_recupero where SAL_TIN_ESTADO<>5) driver\nleft outer join \n(Select distinct SAL_INT_SINIESTRO,\n--max(SAL_INT_FOLIO_COMPROBANTE) as MAX_FOLIO_COMPROBANTE\nSAL_INT_FOLIO_COMPROBANTE as MAX_FOLIO_COMPROBANTE\n from \ncdp_ods.bd_sinie_x_cir_salvataje_recupero  \n--group by 1\n) MAX_FOLIO\non  MAX_FOLIO.SAL_INT_SINIESTRO = driver.SAL_INT_SINIESTRO \nand driver.SAL_INT_FOLIO_COMPROBANTE = MAX_FOLIO.MAX_FOLIO_COMPROBANTE and driver.SAL_TIN_ESTADO <> 5 \n\nLEFT outer JOIN  cdp_dwh.dim_claim_t CLAIM\nON CLAIM.claim_num=CAST(MAX_FOLIO.SAL_INT_SINIESTRO AS VARCHAR(35))\nAND CLAIM.src_sys_cd='penta'\n\nleft outer join cdp_ods.bd_sinie_x_sin_perfil sin_perfil\non MAX_FOLIO.SAL_INT_SINIESTRO = driver.SAL_INT_SINIESTRO\nand driver.SAL_INT_FOLIO_COMPROBANTE = MAX_FOLIO.MAX_FOLIO_COMPROBANTE\nand driver.SAL_INT_SINIESTRO=sin_perfil.per_int_sinies and driver.SAL_TIN_ESTADO <> 5\n\nleft outer join cdp_dwh.dim_claimant_t CLAIMANT_KEY_INSURED\non CLAIMANT_KEY_INSURED.claim_num=driver.SAL_INT_SINIESTRO\nand CLAIMANT_KEY_INSURED.claimant_id=sin_perfil.per_int_rutase\nand CLAIMANT_KEY_INSURED.src_sys_cd='penta'\n\nleft outer join cdp_dwh.dim_loss_item_t LOSS_ITEM_KEY_INSURED\non LOSS_ITEM_KEY_INSURED.claim_num=driver.SAL_INT_SINIESTRO\nand LOSS_ITEM_KEY_INSURED.loss_item_id=sin_perfil.per_int_rutase\nand LOSS_ITEM_KEY_INSURED.src_sys_cd='penta'\n\n/*left outer join cdp_ods.bd_sinie_x_sin_tercer sin_tercer\non MAX_FOLIO.SAL_INT_SINIESTRO = driver.SAL_INT_SINIESTRO\nand driver.SAL_INT_FOLIO_COMPROBANTE = MAX_FOLIO.MAX_FOLIO_COMPROBANTE\nand driver.SAL_INT_SINIESTRO=sin_tercer.ter_int_sinies and driver.SAL_TIN_ESTADO <> 5\n\nleft outer join cdp_dwh.dim_claimant_t CLAIMANT_KEY_THIRD_PARTY\non CLAIMANT_KEY_THIRD_PARTY.claim_num=driver.SAL_INT_SINIESTRO\nand CLAIMANT_KEY_THIRD_PARTY.claimant_id=sin_tercer.ter_int_rut\nand CLAIMANT_KEY_THIRD_PARTY.src_sys_cd='penta'*/\nleft outer join\n(select claimant.claim_num,claimant.dim_claimant_key from \n(select distinct ter_int_sinies,ter_int_rut from cdp_ods.bd_sinie_x_sin_tercer) sin_tercer \ninner join cdp_dwh.dim_claimant_t claimant\non claimant.claim_num=sin_tercer.ter_int_sinies\nand claimant.claimant_id=sin_tercer.ter_int_rut\nand claimant.src_sys_cd='penta') CLAIMANT_KEY_THIRD_PARTY\non driver.SAL_INT_SINIESTRO=CLAIMANT_KEY_THIRD_PARTY.claim_num  \n\n/*left outer join cdp_dwh.dim_loss_item_t LOSS_ITEM_KEY_THIRD_PARTY\non LOSS_ITEM_KEY_THIRD_PARTY.claim_num=driver.SAL_INT_SINIESTRO\nand LOSS_ITEM_KEY_THIRD_PARTY.loss_item_id=sin_tercer.ter_int_rut\nand LOSS_ITEM_KEY_THIRD_PARTY.src_sys_cd='penta'*/\n\nleft outer join\n(select dim_loss_item_t.claim_num,dim_loss_item_t.dim_loss_item_key from cdp_ods.bd_sinie_x_sin_tercer sin_tercer \ninner join cdp_dwh.dim_loss_item_t dim_loss_item_t\non dim_loss_item_t.claim_num=sin_tercer.ter_int_sinies\nand dim_loss_item_t.loss_item_id=sin_tercer.ter_int_rut\nand dim_loss_item_t.src_sys_cd='penta') LOSS_ITEM_KEY_THIRD_PARTY\non driver.SAL_INT_SINIESTRO=LOSS_ITEM_KEY_THIRD_PARTY.claim_num  \n\nleft outer join cdp_ods.prdcdg_pro_ramos PRO_RAMOS\nON sin_perfil.per_tin_ramo=PRO_RAMOS.ram_tin_codigo\nleft outer join adp_dwh.cdp_dwh.dim_lob_t LOB\nON LOB.lob_cd=PRO_RAMOS.ram_tin_codigo\nAND LOB.src_sys_cd='penta'\n\nleft outer join cdp_ods.bd_sinie_x_sin_estadosiniestro estadosiniestro_dap\non sin_perfil.dap_tin_estado=estadosiniestro_dap.est_tin_codigo\n\nleft outer join cdp_dwh.dim_claim_status_t CLAIM_STATUS_INSURED\nON CLAIM_STATUS_INSURED.claim_status_cd=CAST(estadosiniestro_dap.est_tin_codigo AS VARCHAR(6))\nAND CLAIM_STATUS_INSURED.src_sys_cd='penta'\n\nleft outer join cdp_ods.bd_sinie_x_sin_estadosiniestro estadosiniestro_dat\non sin_perfil.dat_tin_estado=estadosiniestro_dat.est_tin_codigo\n\nleft outer join cdp_dwh.dim_claim_status_t CLAIM_STATUS_THIRD_PARTY\nON CLAIM_STATUS_THIRD_PARTY.claim_status_cd=CAST(estadosiniestro_dat.est_tin_codigo AS VARCHAR(6))\nAND CLAIM_STATUS_THIRD_PARTY.src_sys_cd='penta' \n\nLEFT JOIN\n(SELECT\nCLAIM_TYPE.dim_claim_type_key,SIN_PERFIL.per_tin_tiposiniestro,RECUPERO.SAL_INT_SINIESTRO\nFROM cdp_ods.bd_sinie_x_cir_salvataje_recupero RECUPERO\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON SIN_PERFIL.per_int_sinies = RECUPERO.SAL_INT_SINIESTRO\n--AND RECUPERO.SAL_INT_FOLIO_COMPROBANTE=\n--(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b where b.SAL_INT_SINIESTRO=RECUPERO.SAL_INT_SINIESTRO)\nINNER JOIN cdp_dwh.dim_claim_type_t CLAIM_TYPE\nON CLAIM_TYPE.claim_type_cd=CAST(per_tin_tiposiniestro AS VARCHAR(20)))CLAIM_TYPE\nON CLAIM_TYPE.SAL_INT_SINIESTRO=driver.SAL_INT_SINIESTRO   --- New Logic implemented as per mapping sheet version 55\n\n/*left outer join  --- Commented as new logic is implemented above based on Data mapping Sheet version 55\n\n(select ref_cd from cdp_stg_dwh.stg_tref_code_map_variant where src_sys_cd='penta' and ref_type_cd='claim_type') ref_claim_typ1\non cast(sin_perfil.dap_tin_estado as varchar(10))=ref_claim_typ1.ref_cd\n\nleft outer join cdp_dwh.dim_claim_type_t CLAIM_TYPE_INSURED\non CLAIM_TYPE_INSURED.claim_type_cd=ref_claim_typ1.ref_cd\nAND CLAIM_TYPE_INSURED.src_sys_cd='penta'\n\nleft outer join \n(select ref_cd from cdp_stg_dwh.stg_tref_code_map_variant where src_sys_cd='penta' and ref_type_cd='claim_type') ref_claim_typ2\non cast(sin_perfil.dat_tin_estado as varchar(10))=ref_claim_typ2.ref_cd\n\nleft outer join cdp_dwh.dim_claim_type_t CLAIM_TYPE_THIRD_PARTY\non CLAIM_TYPE_THIRD_PARTY.claim_type_cd=ref_claim_typ2.ref_cd\nAND CLAIM_TYPE_THIRD_PARTY.src_sys_cd='penta'*/\n\n/*left outer join cdp_dwh.dim_insured_t INSURED  --Commented out as per MVP1 change in Insured dim and added new logic\non  sin_perfil.per_int_rutase = INSURED.insured_id and INSURED.src_sys_cd='penta'*/\n\nleft outer join cdp_dwh.dim_insured_t INSURED\non  cast((driver.sal_int_poliza||'-'||driver.sal_int_item) as varchar(35)) =INSURED.insured_id \nand driver.sal_int_rut = INSURED.insured_rut_num\nand INSURED.src_sys_cd='penta'\n\n/*on  cast((sin_perfil.per_int_poliza||'-'||sin_perfil.per_sma_item) as varchar(35)) =INSURED.insured_id \nand INSURED.src_sys_cd='penta' */\n\n/*left outer join cdp_ods.bd_sinie_x_cir_concepto_propiedad propiedad\non MAX_FOLIO.SAL_INT_SINIESTRO = driver.SAL_INT_SINIESTRO\nand driver.SAL_INT_FOLIO_COMPROBANTE = MAX_FOLIO.MAX_FOLIO_COMPROBANTE\nand driver.SAL_TIN_ESTADO <> 5\nand propiedad.COD_TIN_CLASIFICA= driver.SAL_TIN_CLASIFICACION*/\n\nleft outer join \n(select ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where src_sys_cd='penta' and ref_type_cd='recovery_type') ref_recovery\non cast(driver.SAL_TIN_CLASIFICACION as varchar(20)) = ref_recovery.ref_cd\n\nLEFT OUTER JOIN(\nSELECT DISTINCT dim_recov_type_key,driver.SAL_TIN_CLASIFICACION\nFROM cdp_ods.bd_sinie_x_cir_salvataje_recupero driver\nINNER JOIN cdp_ods.bd_sinie_x_cir_concepto_propiedad propiedad\non propiedad.COD_TIN_CLASIFICA= driver.SAL_TIN_CLASIFICACION\nINNER JOIN cdp_dwh.dim_recov_type_t RECOVERY\nON RECOVERY.recov_type_cd=propiedad.COD_CONCEPTO_GRUPAL\nWHERE RECOVERY.src_sys_cd='penta') RECOVERY\nON RECOVERY.SAL_TIN_CLASIFICACION=driver.SAL_TIN_CLASIFICACION\n\nleft outer join  (select Siniestro,max(FechaRec) FechaRec from cdp_ods.bd_sinie_x_snsrec_recuperosdst group by 1) recuperosdst\non recuperosdst.Siniestro=driver.SAL_INT_SINIESTRO\n\nleft outer join cdp_ods.bd_sinie_x_cir_concepto_propiedad propiedad\non propiedad.COD_TIN_CLASIFICA= driver.SAL_TIN_CLASIFICACION\n\nleft outer join (select ind_indica,ind_glosa from cdp_ods.grlmst_gen_indicador where ind_tipo=851) gen_indicador\non gen_indicador.ind_indica=driver.SAL_TIN_ESTADO\n\n/*LEFT JOIN cdp_dwh.dim_cov_type_t COVERAGE\nON COVERAGE.cov_cd=CAST(driver.SAL_TIN_COBERTURA AS VARCHAR(20))\nand COVERAGE.src_sys_cd='penta' */  --- Added new logic below as per mapping sheet version 61\n\nLEFT JOIN(\nSELECT SRC.SAL_INT_SINIESTRO,COVERAGE.dim_cov_key \nFROM cdp_ods.bd_sinie_x_cir_salvataje_recupero SRC\nINNER JOIN cdp_ods.bd_sinie_x_sin_perfil SIN_PERFIL\nON  SRC.SAL_INT_SINIESTRO=SIN_PERFIL.per_int_sinies\nINNER JOIN cdp_dwh.dim_cov_type_t COVERAGE\nON COVERAGE.cov_cd=(CAST(SIN_PERFIL.per_tin_ramo AS VARCHAR(3))||'|'||CAST(SRC.SAL_TIN_COBERTURA AS VARCHAR(20)))\nAND COVERAGE.src_sys_cd='penta'\n)COVERAGE\nON COVERAGE.SAL_INT_SINIESTRO=driver.SAL_INT_SINIESTRO  --- Added new logic  as per mapping sheet version 61\n\nLEFT JOIN cdp_dwh.dim_branch_office_t BRANCH_OFFICE\nON BRANCH_OFFICE.branch_office_id=CAST(driver.SAL_TIN_OFICINA AS VARCHAR(20))\t\t--DID-134\nand BRANCH_OFFICE.src_sys_cd='penta'\n\nLEFT JOIN(\nSelect distinct SAL_INT_RUT,SAL_INT_SINIESTRO\nfrom cdp_ods.bd_sinie_x_cir_salvataje_recupero a\nwhere SAL_INT_RUT not in(select 1 from cdp_ods.rlsmst_usuarios b \nINNER JOIN cdp_ods.bd_sinie_x_cir_salvataje_recupero a\nON a.SAL_INT_RUT=b.Rut)) PARTY_ID\nON PARTY_ID.SAL_INT_SINIESTRO=driver.SAL_INT_SINIESTRO\n\n/******Payment_Currency_Code***********/\nLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='currency_type' AND src_sys_cd='penta' ) Payment_Curr\nON Payment_Curr.ref_cd=driver.SAL_TIN_COD_MONEDA_MP\n\n/******retained_amt***********/\nleft outer join\n(Select \n                SAL_INT_FOLIO_COMPROBANTE,\n                Siniestro,\n                CodCober,\n                contrato,\n                codtiporea,\n                payment_id,\n                round(sum(porcentaje),2) as porcentaje_retained\n--into #Distribucion1\nfrom(select   \n    --Retencion\n    SAL_INT_FOLIO_COMPROBANTE,\n    'R'                                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato           contrato,\n    'Retencion   '                                  tiporea,\n                (nullif(cast(priret as decimal(21,5)),0)/nullif(cast(pritot as decimal(21,5)),0))*100  porcentaje,\n                payment_id\n   -- round(round((priret/pritot),4)*100,4)   porcentaje\n--into #Distribucion    \nfrom\n    (select \n    a.SAL_INT_FOLIO_COMPROBANTE,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion,\n                payment_id\n--into #idDistribucion \nfrom (  \n                Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                SAL_INT_RUT payment_id\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and \nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) a\nwhere \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from(Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and \nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) b \n                                                                                  where\n                                                                                b.SAL_INT_FOLIO_COMPROBANTE          =a.SAL_INT_FOLIO_COMPROBANTE))\nwhere\n    priret  <>  0 )\ngroup by \n                SAL_INT_FOLIO_COMPROBANTE,\n                Siniestro,\n                CodCober,\n                contrato,\n                codtiporea  ,\npayment_id       \n) retained_amt \non driver.SAL_INT_SINIESTRO=retained_amt.Siniestro\nand driver.SAL_INT_RUT = retained_amt.payment_id\nand driver.SAL_INT_FOLIO_COMPROBANTE = retained_amt.SAL_INT_FOLIO_COMPROBANTE\n\n/********ceded percentage***************/\nleft outer join\n(              \n                Select \n                SAL_INT_FOLIO_COMPROBANTE,\n                Siniestro,\n                CodCober,\n                contrato,\n                codtiporea,\n                round(sum(porcentaje),2) as porcentaje_ceded,\n                payment_id\n--into #Distribucion1\nfrom(select   \n    --Cesion QP\n    SAL_INT_FOLIO_COMPROBANTE,\n    'C'                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato contrato,    \n    'Cesion QP',\n    --round(round((pricqp/pritot),4)*100,4) porcentaje\n                (nullif(cast(pricqp as decimal(21,5)),0)/nullif(cast(pritot as decimal(21,5)),0))*100 porcentaje,\n                payment_id\nfrom\n    (select \n    a.SAL_INT_FOLIO_COMPROBANTE,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion,\n                payment_id\n--into #idDistribucion \nfrom (  \n                Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                sa.SAL_INT_RUT payment_id\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and\nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) a\nwhere \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from(Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                sa.SAL_INT_RUT\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and \nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) b \n                                                                                  where\n                                                                                b.SAL_INT_FOLIO_COMPROBANTE          =a.SAL_INT_FOLIO_COMPROBANTE))\nwhere\n    pricqp  <>  0 \nUNION ALL\nselect   \n    --Cesion Exc\n    SAL_INT_FOLIO_COMPROBANTE,\n    'C'                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato contrato,    \n    'Cesion Exc',\n    (nullif(cast(priexc as decimal(21,5)),0)/nullif(cast(pritot as decimal(21,5)),0))*100 porcentaje,\n                payment_id\nfrom\n   (select \n    a.SAL_INT_FOLIO_COMPROBANTE,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion,\n                payment_id\n--into #idDistribucion \nfrom (  \n                Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                sa.SAL_INT_RUT payment_id\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and\nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) a\nwhere \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from(Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                sa.SAL_INT_RUT\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and \nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) b \n                                                                                  where\n                                                                                b.SAL_INT_FOLIO_COMPROBANTE          =a.SAL_INT_FOLIO_COMPROBANTE))\nwhere\n    priexc  <>  0 \nUNION ALL\nselect   \n    --Cesion Fac\n    SAL_INT_FOLIO_COMPROBANTE,\n    'C'                                                                       codtiporea,\n    Siniestro,\n    CodCober,\n    coc_int_codigoContrato contrato,        \n    'Facultativa',\n    (nullif(cast(prifac as decimal(21,5)),0)/nullif(cast(pritot as decimal(21,5)),0))*100 porcentaje,\n                payment_id\nfrom\n    (select \n    a.SAL_INT_FOLIO_COMPROBANTE,\n    a.Siniestro,\n    a.CodCober,\n    a.coc_int_codigoContrato ,\n    a.priret,\n    a.pritot,\n    a.pricqp,\n    a.priexc,\n    a.prifac,\n    a.hid_int_idDistribucion           as hid_int_idDistribucion,\n                payment_id\n--into #idDistribucion \nfrom (  \n                Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                sa.SAL_INT_RUT payment_id\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and \nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) a\nwhere \n                a.hid_int_idDistribucion=(select max(b.hid_int_idDistribucion) from(Select  \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO as Siniestro,\n    sa.SAL_TIN_COBERTURA as CodCober,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    min(isnull(cc.coc_int_codigoContrato,0))    as coc_int_codigoContrato, -- <--   1\n    isnull(his.hid_int_idDistribucion,0)   as hid_int_idDistribucion, --> 2\n    round(sum(mov.dis_dec_primaRetencion),4)     priret,\n    round(sum(case mov.dis_int_codigoClaseContrato when 2 then mov.dis_dec_primaCesion else 0 end),4) pricqp,\n    round(sum(case mov.dis_int_codigoClaseContrato when 3 then mov.dis_dec_primaCesion else 0 end),4) priexc,\n    round(sum(case mov.dis_tin_tipoDistribucion when 1 then mov.dis_dec_primaCesion else 0 end),4) prifac,\n    round(sum(mov.dis_dec_primaRetencion+dis_dec_primaCesion),4) pritot,\n                sa.SAL_INT_RUT\n--into UniversoSiniestro\nfrom \n     cdp_ods.bd_sinie_x_cir_salvataje_recupero  sa, \n                cdp_ods.bd_sinie_x_sin_perfil c,\n                cdp_ods.bd_produ_x_pro_poliza p,\n                cdp_ods.RsgDst_Sdr_CoberturasContrato cc,\n    cdp_ods.RsgDst_Sdr_MaestroContrato          mc,\n    cdp_ods.RsgDst_Sdr_HistoriaDistribucion  his ,\n    cdp_ods.RsgDst_Sdr_MovimientosDistribucion mov\nwhere \n--sa.SAL_INT_SINIESTRO =@ClaimNumber\n--and \n--sa.SAL_INT_FOLIO_COMPROBANTE=(Select max(b.SAL_INT_FOLIO_COMPROBANTE) from cdp_ods.bd_sinie_x_cir_salvataje_recupero b \n--where   b.SAL_INT_SINIESTRO=sa.SAL_INT_SINIESTRO and b.SAL_TIN_ESTADO <> 5)\n--and \nsa.SAL_INT_SINIESTRO=c.per_int_sinies\nand sa.SAL_TIN_ESTADO <> 5 \n\nand sa.SAL_INT_SINIESTRO=c.per_int_sinies\nand c.per_int_poliza=p.pol_int_poliza\n\nand cc.coc_int_codigoRamo      =   c.per_tin_ramo     \nand cc.coc_int_codigoCobertura =   sa.SAL_TIN_COBERTURA                \nand mc.cnt_int_codigoContrato  =   cc.coc_int_codigoContrato \nand mc.cnt_tin_estadoContrato  =   2                                                    \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') >=  to_char(mc.cnt_fec_inicioVigencia,'yyyy-mm-dd') \nand to_char(p.pol_fec_vigdes,'yyyy-mm-dd') <=  to_char(mc.cnt_fec_finVigencia,'yyyy-mm-dd')\n                \nand his.hid_int_nroPoliza               =   c.per_int_poliza   \nand his.hid_int_nroItem                 =   c.per_sma_item      \nand his.hid_int_codigoCobertura         =   isnull(cc.coc_int_codigoContrato,0)  -- <--   1\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  >=  to_char(his.hid_fec_fechaIniVigencia,'yyyy-mm-dd')\nand to_char(c.per_fec_sinies,'yyyy-mm-dd')  <=  to_char(his.hid_fec_fechaFinVigencia,'yyyy-mm-dd')\nand (his.hid_dec_primaTotal <>  0 or his.hid_dec_maTotal <>  0)\n                \nand mov.dis_int_nroPoliza       =   c.per_int_poliza\nand mov.dis_int_nroItem         =   c.per_sma_item\nand mov.dis_int_codigoCobertura =   isnull(cc.coc_int_codigoContrato,0)       -- <--   1\nand mov.dis_int_idDistribucion  <=  his.hid_int_idDistribucion                 -- <--   2\n\ngroup by \n    sa.SAL_INT_FOLIO_COMPROBANTE,\n    sa.SAL_INT_SINIESTRO,\n    sa.SAL_TIN_COBERTURA,\n    c.per_fec_sinies,\n    c.per_int_poliza,\n    c.per_sma_item,\n    p.pol_fec_vigdes,\n    p.pol_fec_vighas,\n    cc.coc_int_codigoContrato,\n    his.hid_int_idDistribucion,\n    mov.dis_int_nroPoliza,\n    mov.dis_int_nroItem,\n                sa.SAL_INT_RUT) b \n                                                                                  where\n                                                                                b.SAL_INT_FOLIO_COMPROBANTE          =a.SAL_INT_FOLIO_COMPROBANTE))\nwhere\n    prifac  <>  0 )\ngroup by \n                SAL_INT_FOLIO_COMPROBANTE,\n                Siniestro,\n                CodCober,\n                contrato,\n                codtiporea,  \npayment_id\n                ) ceded_amt\non driver.SAL_INT_SINIESTRO=ceded_amt.Siniestro\nand driver.SAL_INT_RUT = ceded_amt.payment_id\nand driver.SAL_INT_FOLIO_COMPROBANTE = ceded_amt.SAL_INT_FOLIO_COMPROBANTE\n)PENTA_2\n) PENTA_RECOVERY\nLEFT JOIN (SELECT 1 as DUMMY, max(fact_claim_payment_key) AS MAX_SID from cdp_dwh.fact_claim_payment_activity_t) LKP\nON LKP.DUMMY=PENTA_RECOVERY.DUMMY\nWHERE PENTA_RECOVERY.RNK=1"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "DELETE FROM cdp_dwh.fact_claim_payment_activity_t WHERE src_sys_cd='penta';"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[2].dataAdapter.runtimeAttributes.attributes[14]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.fact_claim_payment_activity_t where src_sys_cd='penta';\ncommit;"
    }
]