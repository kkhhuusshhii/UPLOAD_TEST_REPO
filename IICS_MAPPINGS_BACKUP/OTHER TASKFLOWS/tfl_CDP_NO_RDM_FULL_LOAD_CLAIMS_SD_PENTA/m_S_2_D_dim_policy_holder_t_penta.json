[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select    \npolicyholder_rut_num,\npolicyholder_id,\npolicyholder_name,\nsrc_sys_cd,\naddress_desc,\npostal_cd,\nregion_cd,\ncomuna_cd,\ncity_cd,\ncntry_cd,\nactv_rec_ind,\ncomuna_name,\nregion_name,\ncntry_desc,\ncity_name,\ngender_cd,\ngender_desc,\nbirth_dt,\nperson_type_cd,\nperson_type_desc,\nmax_sid \nFROM \n(select src.src_sys_cd,\nsrc.policyholder_rut_num,\nsrc.policyholder_id,\ntranslate(src.policyholder_name,'#','') as policyholder_name,\nsrc.address_desc,\nsrc.postal_cd,\nsrc.region_cd,\nsrc.comuna_cd,\nsrc.city_cd,\nsrc.cntry_cd,\nsrc.comuna_name,\nsrc.region_name,\nsrc.cntry_desc,\nsrc.city_name,\nsrc.actv_rec_ind,\nsrc.gender_cd,\nsrc.gender_desc,\nsrc.birth_dt,\nsrc.person_type_cd,\nsrc.person_type_desc,\nLKP_MAX_KEY.MAX_SID as max_sid,\nrow_number()over(partition by policyholder_id order by rec_dtm desc) as row_cnt \nfrom\n(select distinct\ncast('penta'  AS VARCHAR(10)) src_sys_cd,\ncast(pol_int_rutcon as VARCHAR(35)) policyholder_rut_num,\ncast(pol_int_poliza as VARCHAR(35)) policyholder_id,\ncast(nvl((pol_cha_nomcon||'@'),'') as varchar(255)) policyholder_name,\ncast((pol_cha_dircon||'@') as varchar(150)) address_desc,\ncast(null as varchar(10)) postal_cd,\ncast(pol_tin_region as varchar(10)) region_cd,\ncast(pol_sma_comuna as varchar(10)) comuna_cd,\ncast(null as varchar(10)) city_cd,\ncast(null as varchar(10)) cntry_cd,\n--cast(com_cha_nombre as varchar(35))  comuna_name,\n--cast(reg_cha_nombre as varchar(100)) region_name,\ncast (j.REF_DESC as varchar(35)) as comuna_name,\ncast (k.REF_DESC as varchar(100))AS region_name,\ncast(null as varchar(80)) cntry_desc,\ncast(null as varchar(35)) city_name,\ncast('Y'  as char(1)) actv_rec_ind ,\ncast(NULL as VARCHAR(10))as gender_cd,\ncast(NULL as VARCHAR(80))as gender_desc,\ncast(NULL as date)as birth_dt,\ncast(NULL as VARCHAR(10))as person_type_cd,\ncast(NULL as VARCHAR(80))as person_type_desc,\npol_fec_ingres as rec_dtm,\n1 as dummy\nfrom cdp_ods.bd_produ_x_pro_poliza pol\n/*left outer join \ncdp_ods.PrdCdg_pro_comuna com \non pol.pol_sma_comuna=com.com_cha_nombre\nleft outer join \ncdp_ods.PrdCdg_pro_region reg\non pol.pol_tin_region=reg.reg_cha_nombre */\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna'and src_sys_cd = 'penta') j\non cast(cast(pol.pol_sma_comuna as integer) as varchar(10))=j.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region'and src_sys_cd = 'penta') k\non cast(cast (pol.pol_tin_region as integer) as varchar(10))=k.REF_CD\n)src\nleft outer join\n(select 1 dummy,max(dim_policyholder_key) max_sid  from  cdp_dwh.dim_policyholder_t ) LKP_MAX_KEY\non src.dummy=LKP_MAX_KEY.dummy \n)where row_cnt = 1  and policyholder_id is not null"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.dim_policyholder_t where src_sys_cd='penta';"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[3].dataAdapter.runtimeAttributes.attributes[15]",
        "name": "Post-sql",
        "value": "update  cdp_dwh.dim_policyholder_t set  policyholder_name=trim('@' from policyholder_name) where src_sys_cd='penta';\n\ncommit;\n\nupdate  cdp_dwh.dim_policyholder_t set  address_desc=trim('@' from address_desc) where src_sys_cd='penta';\n\ncommit;\n\nupdate cdp_dwh.dim_claim_t\nset dim_policyholder_key = POLICY_HOLDER_KEY_UPD.dim_policyholder_key\nfrom \n  (\n    select max(dphd.dim_policyholder_key) as dim_policyholder_key,tpol.pol_int_poliza as policy_holder_id,cast(tper.per_int_poliza as integer) as policy_id_src,\n       cast(tper.per_int_poliza as varchar(35)) as policy_num_src, cast(tper.per_int_sinies as varchar(35)) as claim_num_src \n    from\n      cdp_dwh.dim_claim_t dclm\n      left outer join cdp_ods.bd_sinie_x_sin_perfil tper\n        on dclm.claim_num = tper.per_int_sinies\n      left outer join cdp_ods.bd_produ_x_pro_poliza tpol\n        on tper.per_int_poliza = tpol.pol_int_poliza\n      left outer join cdp_dwh.dim_policyholder_t dphd\n        on tpol.pol_int_poliza = dphd.policyholder_id\n        and dphd.src_sys_cd ='penta'\n    where dclm.src_sys_cd='penta'\n\t group by policy_holder_id,policy_id_src,policy_num_src,claim_num_src) POLICY_HOLDER_KEY_UPD JOIN\nCDP_DWH.DIM_CLAIM_T CLAIM\nON CLAIM.CLAIM_NUM = POLICY_HOLDER_KEY_UPD.claim_num_src\nAND CLAIM.policy_id = POLICY_HOLDER_KEY_UPD.policy_id_src\nAND CLAIM.policy_num = POLICY_HOLDER_KEY_UPD.policy_num_src\nAND src_sys_cd='penta'; /*Added as part of DID-229.*/\n\nCOMMIT;\n\n\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_broker_key = 0 WHERE  dim_broker_key is null and src_sys_cd='penta'; /*Added as part of DID-229.*/\nCOMMIT;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_prd_pln_hrchy_key = 0 WHERE  dim_prd_pln_hrchy_key is null and src_sys_cd='penta'; /*Added as part of DID-229.*/\nCOMMIT;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_policyholder_key = 0 WHERE  dim_policyholder_key is null and src_sys_cd='penta'; /*Added as part of DID-229.*/\nCOMMIT;"
    }
]