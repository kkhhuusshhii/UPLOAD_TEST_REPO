[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\nsrc_sys_cd,\ninsured_name,\ninsured_id,\ninsured_rut_num,\nactv_rec_ind,\ngender_cd,\ngender_desc,\nbirth_dt,\naddress_id,\naddress_desc,\npostal_cd,\nregion_cd,\nregion_name,\ncomuna_cd,\ncomuna_name,\ncity_cd,\ncity_name,\nmax_sid\nfrom \n (select src.src_sys_cd,\nsrc.insured_name,\nsrc.insured_id,\nsrc.insured_rut_num,\nsrc.actv_rec_ind,\nsrc.gender_cd,\nsrc.gender_desc,\nsrc.birth_dt,\nsrc.address_id,\nsrc.address_desc,\nsrc.postal_cd,\nsrc.region_cd,\nsrc.region_name,\nsrc.comuna_cd,\nsrc.comuna_name,\nsrc.city_cd,\nsrc.city_name,\nLKP_MAXSID.MAX_SID,\nrow_number()over(partition by src.insured_id order by rec_crt_dtm) as row_cnt,\nrow_number()over(order by insured_id) num  from(select\ncast('penta' as varchar(10)) as src_sys_cd,\n--cast(translate(pro_item.ite_cha_nomase,'\\\\','') as varchar(100)) as insured_name,\ncast(null as varchar(100)) as insured_name,\ncast(pro_item.ite_int_poliza||pro_item.ite_sma_item as bigint) as insured_id,\ncast(pro_item.ite_int_rutase as varchar(35)) as insured_rut_num,\ncast('Y' as varchar(1))  as actv_rec_ind,\ncast(null as  varchar(10))  as gender_cd,\ncast(null as varchar(80)) as gender_desc,\ncast(null as date) as birth_dt,\ncast(0 as integer)  as address_id,\ncast(translate(pro_item.ite_cha_dirase,'#','') as VARCHAR(80)) as address_desc,\ncast(null as VARCHAR(10)) as postal_cd,\ncast(pro_item.ite_tin_region as integer) as region_cd,\ncast(region.REF_DESC as varchar(35)) as region_name,\ncast(pro_item.ite_sma_comuna as integer) as comuna_cd,\ncast(communa.REF_DESC as varchar(100)) as comuna_name,\ncast(null as varchar(10)) as city_cd,\ncast(null as varchar(35)) as city_name, \npro_item.ite_fec_ingres as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n1 as dummy\nfrom cdp_ods.bd_produ_x_pro_item pro_item\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'penta') region \non cast(pro_item.ite_tin_region as integer)= region.ref_cd \nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='Communa' and src_sys_cd = 'penta') communa \non cast(pro_item.ite_sma_comuna as integer)=communa.ref_cd \n)src\nleft outer join\n(select 1 as dummy, max(dim_insured_key) as MAX_SID from cdp_dwh.dim_insured_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy)\nwhere row_cnt=1 and insured_id is not null and address_id is not null and 1=2"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT distinct dim_insured_key,insured_id,address_id,src_sys_cd FROM cdp_dwh.dim_insured_t where src_sys_cd='penta'"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "\ndelete from cdp_dwh.dim_insured_t where src_sys_cd='penta';\ncommit; \n\ninsert into cdp_dwh.dim_insured_t \n(src_sys_cd,\ninsured_name,\ninsured_id,\ninsured_rut_num,\nactv_rec_ind,\ngender_cd,\ngender_desc,\nbirth_dt,\naddress_id,\naddress_desc,\npostal_cd,\nregion_cd,\nregion_name,\ncomuna_cd,\ncomuna_name,\ncity_cd,\ncity_name,\ndim_insured_key,\netl_audit_id,                                                                                                                      \nrec_crt_dtm,\nrec_updt_dtm)\nselect aa1.src_sys_cd,\naa1.insured_name,\naa1.insured_id,\naa1.insured_rut_num,\naa1.actv_rec_ind,\naa1.gender_cd,\naa1.gender_desc,\naa1.birth_dt,\naa1.address_id,\naa1.address_desc,\naa1.postal_cd,\naa1.region_cd,\naa1.region_name,\naa1.comuna_cd,\naa1.comuna_name,\naa1.city_cd,\naa1.city_name,\naa1.max_sid+aa1.num dim_insured_key, \naa1.etl_audit_id,\nCURRENT_DATE as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm from \n(select \naa.src_sys_cd,\naa.insured_name,\naa.insured_id,\naa.insured_rut_num,\naa.actv_rec_ind,\naa.gender_cd,\naa.gender_desc,\naa.birth_dt,\naa.address_id,\naa.address_desc,\naa.postal_cd,\naa.region_cd,\naa.region_name,\naa.comuna_cd,\naa.comuna_name,\naa.city_cd,\naa.city_name,\naa.max_sid,\naa.num,\n1 dummy,\nca.etl_audit_id from \n(select\nsrc_sys_cd,\ninsured_name,\ninsured_id,\ninsured_rut_num,\nactv_rec_ind,\ngender_cd,\ngender_desc,\nbirth_dt,\naddress_id,\naddress_desc,\npostal_cd,\nregion_cd,\nregion_name,\ncomuna_cd,\ncomuna_name,\ncity_cd,\ncity_name,\nmax_sid,\n1 dummy,\nnum\nfrom \n (select src.src_sys_cd,\ntranslate(src.insured_name,'#','') as insured_name, --modified as part of DID_238\nsrc.insured_id,\nsrc.insured_rut_num,\nsrc.actv_rec_ind,\nsrc.gender_cd,\nsrc.gender_desc,\nsrc.birth_dt,\nsrc.address_id,\nsrc.address_desc,\nsrc.postal_cd,\nsrc.region_cd,\nsrc.region_name,\nsrc.comuna_cd,\nsrc.comuna_name,\nsrc.city_cd,\nsrc.city_name,\nLKP_MAXSID.MAX_SID,\nrow_number()over(partition by src.insured_id order by rec_crt_dtm) as row_cnt,\nrow_number()over(order by insured_id) num  from\n(select cast('penta' as varchar(10)) as src_sys_cd,\ncast(trim('##' from pro_item.ite_cha_nomase) as varchar(150)) as insured_name,                            \ncast((ite_int_poliza||'-'||ite_sma_item) as VARCHAR(35)) as insured_id,\ncast(pro_item.ite_int_rutase as varchar(35)) as insured_rut_num,\ncast('Y' as varchar(1))  as actv_rec_ind,\ncast(null as  varchar(10))  gender_cd,\ncast(null as varchar(80)) gender_desc,\ncast(null as date) birth_dt,\ncast(0 as integer)  address_id,\ncast(pro_item.ite_cha_dirase as VARCHAR(150)) address_desc,\ncast(null as VARCHAR(10)) postal_cd,\ncast(pro_item.ite_tin_region as integer)  region_cd,\ncast(region.REF_DESC as varchar(100)) AS region_name,\ncast(pro_item.ite_sma_comuna as integer) comuna_cd,\ncast(Communa.REF_DESC as varchar(100)) AS comuna_name,\ncast(null as varchar(10))  city_cd,\ncast(null as varchar(35))  city_name, \npro_item.ite_fec_ingres as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n1 as dummy\nfrom cdp_ods.bd_produ_x_pro_item pro_item\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region' and src_sys_cd = 'penta') region \non cast(pro_item.ite_tin_region as integer)= region.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna' and src_sys_cd = 'penta') Communa \non cast(pro_item.ite_sma_comuna as integer)=Communa.ref_cd)src\nleft outer join\n(select 1 as dummy, nvl(max(dim_insured_key),0) as MAX_SID from cdp_dwh.dim_insured_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy)\nwhere row_cnt=1 and insured_id is not null and address_id is not null) aa\nleft join \n  (\n  select distinct etl_audit_id, 1 as dummy from cdp_dwh.dim_claim_analyst_t where src_sys_cd='penta') ca \n  on AA.dummy =ca.dummy \n)aa1\n"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[4].dataAdapter.runtimeAttributes.attributes[14]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.dim_insured_t where src_sys_cd='penta';\ncommit;"
    }
]