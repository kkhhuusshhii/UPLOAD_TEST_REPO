[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select src_sys_cd,\ncurr_cd,\nvltn_dtm,\nlcl_curr_clsng_val,\ncurr_desc,\nuf_lcl_curr_clsng_val,\nusd_lcl_curr_clsng_val,\ncurr_conv_frequency_cd,\nactv_rec_ind,\nmax_sid from\n(select \nsrc.src_sys_cd,\nsrc.curr_cd,\nsrc.vltn_dtm,\ncast(src.lcl_curr_clsng_val  as NUMERIC(25,10)) lcl_curr_clsng_val,\nsrc.curr_desc,\ncast(src.uf_lcl_curr_clsng_val  as NUMERIC(25,10)) uf_lcl_curr_clsng_val,\ncast(src.usd_lcl_curr_clsng_val as NUMERIC(25,10)) usd_lcl_curr_clsng_val,\nsrc.curr_conv_frequency_cd,\n'Y' as actv_rec_ind,\nLKP_MAXSID.max_sid/*,\nROW_NUMBER()OVER(PARTITION BY src.src_sys_cd,src.curr_conv_frequency_cd,src.vltn_dtm order by src.vltn_dtm desc) rnk*/\nFROM \n(\nselect \ncast('penta' as varchar(10)) as src_sys_cd,\ncast(a.curr_cd as varchar(10)) curr_cd,\ncast('Daily' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(b.val_fec_fecha as timestamp)vltn_dtm,\ncast(b.val_dec_valor as numeric(21,8))lcl_curr_clsng_val,\nCAST(1 as NUMERIC(21,8))usd_lcl_curr_clsng_val,\ncast(b.val_dec_valor/NULLIF(c.val_dec_valor,0) AS NUMERIC(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.bd_gener_x_gen_val_moneda b\nleft join \n(SELECT mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')A\non b.val_tin_codigo=A.ref_cd\nleft join cdp_ods.bd_gener_x_gen_val_moneda c\non b.val_fec_fecha=c.val_fec_fecha \nand c.val_tin_codigo=3\nwhere b.val_tin_codigo=1\nUNION\nselect \ncast('penta' as varchar(10)) as src_sys_cd,\ncast(a.curr_cd as varchar(10)) curr_cd,\ncast('Daily' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(b.val_fec_fecha as timestamp)vltn_dtm,\ncast(b.val_dec_valor as numeric(21,8))lcl_curr_clsng_val,\ncast(b.val_dec_valor/NULLIF(c.val_dec_valor,0) AS NUMERIC(21,8)) usd_lcl_curr_clsng_val,\nCAST(1 as NUMERIC(21,8))uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.bd_gener_x_gen_val_moneda b\nleft join \n(SELECT mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')A\non b.val_tin_codigo=A.ref_cd\nleft join cdp_ods.bd_gener_x_gen_val_moneda c\non b.val_fec_fecha=c.val_fec_fecha \nand c.val_tin_codigo=1\nwhere b.val_tin_codigo=3\nUNION\nselect \ncast('penta' as varchar(10)) as src_sys_cd,\ncast(a.curr_cd as varchar(10)) curr_cd,\ncast('Daily' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(b.val_fec_fecha as timestamp)vltn_dtm,\ncast(b.val_dec_valor as numeric(21,8))lcl_curr_clsng_val,\ncast(b.val_dec_valor/NULLIF(c.val_dec_valor,0) AS NUMERIC(21,8)) usd_lcl_curr_clsng_val,\ncast(b.val_dec_valor/NULLIF(d.val_dec_valor,0) AS NUMERIC(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.bd_gener_x_gen_val_moneda b\nleft join \n(SELECT mkt_ref_code_desc as curr_cd,ref_cd from \ncdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')A\non b.val_tin_codigo=A.ref_cd\nleft join cdp_ods.bd_gener_x_gen_val_moneda c\non b.val_fec_fecha=c.val_fec_fecha \nand c.val_tin_codigo=1\nleft join cdp_ods.bd_gener_x_gen_val_moneda d\non b.val_fec_fecha=d.val_fec_fecha \nand d.val_tin_codigo=3\nwhere b.val_tin_codigo NOT IN (1,3)\n/***************************ADDED FOR CLP DID232********************/\nUNION\nselect distinct \ncast('penta' as varchar(10)) as src_sys_cd,\ncast('CLP' as varchar(10)) curr_cd,\ncast('Daily' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(b.val_fec_fecha as timestamp)vltn_dtm,\ncast(1 as numeric(21,8))lcl_curr_clsng_val,\ncast(CAST(1 AS NUMERIC(25,10))/CAST(NULLIF(c.val_dec_valor,0) AS NUMERIC(25,10)) AS NUMERIC(25,10)) usd_lcl_curr_clsng_val,\ncast(CAST(1 AS NUMERIC(25,10))/CAST(NULLIF(d.val_dec_valor,0) AS NUMERIC(25,10)) AS NUMERIC(25,10))uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.bd_gener_x_gen_val_moneda b\n--left join \n--(SELECT mkt_ref_code_desc as curr_cd,ref_cd from \n--cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='currency_type' and src_sys_cd='penta')A\n--on b.val_tin_codigo=A.ref_cd\njoin cdp_ods.bd_gener_x_gen_val_moneda c\non b.val_fec_fecha=c.val_fec_fecha \nand c.val_tin_codigo=1\njoin cdp_ods.bd_gener_x_gen_val_moneda d\non b.val_fec_fecha=d.val_fec_fecha \nand d.val_tin_codigo=3\nwhere b.val_tin_codigo in (1,3)\n/***************************ADDED FOR CLP DID232********************/\nUNION\nselect cast('penta' as varchar(10)) as src_sys_cd,\ncast('USD' as varchar(10)) curr_cd,\ncast('Monthly' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(p.mci_sma_anocon||'-'||p.mci_tin_mescon||'-01' as timestamp)vltn_dtm,\ncast(p.mci_dec_valor1 as numeric(21,8))lcl_curr_clsng_val,\ncast(1 as numeric(21,8)) usd_lcl_curr_clsng_val,\ncast(p.mci_dec_valor1/NULLIF(q.mci_dec_valor3,0) AS NUMERIC(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.prdcdg_pro_moncierr  p \nleft join cdp_ods.prdcdg_pro_moncierr  q \non p.mci_sma_anocon=q.mci_sma_anocon\nand p.mci_tin_mescon=q.mci_tin_mescon\nUNION\nselect \ncast('penta' as varchar(10)) as src_sys_cd,\ncast('CLF' as varchar(10)) curr_cd,\ncast('Monthly' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(p.mci_sma_anocon||'-'||p.mci_tin_mescon||'-01' as timestamp)vltn_dtm,\ncast(p.mci_dec_valor3 as numeric(21,8))lcl_curr_clsng_val,\ncast(p.mci_dec_valor3/NULLIF(q.mci_dec_valor1,0) AS NUMERIC(21,8)) usd_lcl_curr_clsng_val,\ncast(1 as numeric(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.prdcdg_pro_moncierr  p \nleft join cdp_ods.prdcdg_pro_moncierr  q \non p.mci_sma_anocon=q.mci_sma_anocon\nand p.mci_tin_mescon=q.mci_tin_mescon\nUNION \nselect\ncast('penta' as varchar(10)) as src_sys_cd,\ncast('UD' as varchar(10)) curr_cd,\ncast('Monthly' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(p.mci_sma_anocon||'-'||p.mci_tin_mescon||'-01' as timestamp)vltn_dtm,\ncast(p.mci_dec_valor2 as numeric(21,8))lcl_curr_clsng_val,\ncast(p.mci_dec_valor2/NULLIF(q.mci_dec_valor1,0) AS NUMERIC(21,8)) usd_lcl_curr_clsng_val,\ncast(p.mci_dec_valor2/NULLIF(r.mci_dec_valor3,0) AS NUMERIC(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.prdcdg_pro_moncierr  p \nleft join cdp_ods.prdcdg_pro_moncierr  q \non p.mci_sma_anocon=q.mci_sma_anocon\nand p.mci_tin_mescon=q.mci_tin_mescon \nleft join cdp_ods.prdcdg_pro_moncierr r \non p.mci_sma_anocon=r.mci_sma_anocon\nand p.mci_tin_mescon=r.mci_tin_mescon\nUNION \nselect\ncast('penta' as varchar(10)) as src_sys_cd,\ncast('EUR' as varchar(10)) curr_cd,\ncast('Monthly' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(p.mci_sma_anocon||'-'||p.mci_tin_mescon||'-01' as timestamp)vltn_dtm,\ncast(p.mci_dec_valor4 as numeric(21,8))lcl_curr_clsng_val,\ncast(p.mci_dec_valor4/NULLIF(q.mci_dec_valor1,0) AS NUMERIC(21,8)) usd_lcl_curr_clsng_val,\ncast(p.mci_dec_valor4/NULLIF(r.mci_dec_valor3,0) AS NUMERIC(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.prdcdg_pro_moncierr  p \nleft join cdp_ods.prdcdg_pro_moncierr  q \non p.mci_sma_anocon=q.mci_sma_anocon\nand p.mci_tin_mescon=q.mci_tin_mescon \nleft join cdp_ods.prdcdg_pro_moncierr r \non p.mci_sma_anocon=r.mci_sma_anocon\nand p.mci_tin_mescon=r.mci_tin_mescon\n/***************************ADDED FOR CLP DID232********************/\nUNION \nselect\ncast('penta' as varchar(10)) as src_sys_cd,\ncast('CLP' as varchar(10)) curr_cd,\ncast('Monthly' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(p.mci_sma_anocon||'-'||p.mci_tin_mescon||'-01' as timestamp)vltn_dtm,\ncast(/*p.mci_dec_valor4*/ 1 as numeric(21,8))lcl_curr_clsng_val,\ncast(CAST(1 AS NUMERIC(25,10))/CAST(NULLIF(q.mci_dec_valor1,0) AS NUMERIC(25,10)) AS NUMERIC(25,10)) usd_lcl_curr_clsng_val,\ncast(CAST(1 AS NUMERIC(25,10))/CAST(NULLIF(r.mci_dec_valor3,0) AS NUMERIC(25,10)) AS NUMERIC(25,10)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.prdcdg_pro_moncierr  p \nleft join cdp_ods.prdcdg_pro_moncierr  q \non p.mci_sma_anocon=q.mci_sma_anocon\nand p.mci_tin_mescon=q.mci_tin_mescon \nleft join cdp_ods.prdcdg_pro_moncierr r \non p.mci_sma_anocon=r.mci_sma_anocon\nand p.mci_tin_mescon=r.mci_tin_mescon\n/***************************ADDED FOR CLP DID232********************/\nUNION \nselect\ncast('penta' as varchar(10)) as src_sys_cd,\ncast('UTA' as varchar(10)) curr_cd,\ncast('Monthly' as varchar(10)) as curr_conv_frequency_cd,\ncast('RDM  money' as varchar(80)) as curr_desc,\ncast(p.mci_sma_anocon||'-'||p.mci_tin_mescon||'-01' as timestamp)vltn_dtm,\ncast(p.mci_dec_valor5 as numeric(21,8))lcl_curr_clsng_val,\ncast(p.mci_dec_valor5/NULLIF(q.mci_dec_valor1,0) AS NUMERIC(21,8)) usd_lcl_curr_clsng_val,\ncast(p.mci_dec_valor5/NULLIF(r.mci_dec_valor3,0) AS NUMERIC(21,8)) uf_lcl_curr_clsng_val,\n1 dummy\nfrom cdp_ods.prdcdg_pro_moncierr  p \nleft join cdp_ods.prdcdg_pro_moncierr  q \non p.mci_sma_anocon=q.mci_sma_anocon\nand p.mci_tin_mescon=q.mci_tin_mescon \nleft join cdp_ods.prdcdg_pro_moncierr r \non p.mci_sma_anocon=r.mci_sma_anocon\nand p.mci_tin_mescon=r.mci_tin_mescon\n)src \nleft outer join\n(select 1 as dummy, max(curr_conv_key) as MAX_SID from cdp_dwh.curr_conv_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy)"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT curr_conv_key, src_sys_cd,vltn_dtm,curr_conv_frequency_cd,curr_cd \nFROM cdp_dwh.curr_conv_t \nwhere src_sys_cd='penta';"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[1].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.curr_conv_t where src_sys_cd='penta';"
    }
]