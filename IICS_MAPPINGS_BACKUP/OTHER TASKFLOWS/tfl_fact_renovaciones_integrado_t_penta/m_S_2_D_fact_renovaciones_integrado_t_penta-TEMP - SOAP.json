[
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "select \ncast(nvl((MAX_SID+num),0) AS INTEGER) as fact_renovaciones_integrado_key,\nCAST(src_sys_cd AS VARCHAR(10)),\ncast(policy_item_id AS VARCHAR(35)),\nCAST(policy_num AS VARCHAR(35)),\nCAST(policy_exp_dt AS DATE),\nCAST(policy_status_desc AS VARCHAR(80)),\nCAST(facultativo_ind AS CHAR(1)),\nCAST(coins_type_cd AS VARCHAR(10)),\n--CAST(curr_cd AS VARCHAR(10)),\nCASE when trim(curr_cd)=1  then 'USD'\nwhen trim(curr_cd)=2  then 'UD' \nwhen trim(curr_cd)=3  then 'CLF'\nwhen trim(curr_cd)=4  then 'CLP'\nwhen trim(curr_cd)=5  then 'UDA'\nwhen trim(curr_cd)=7  then 'EUR' end curr_cd,\nCAST(facult_prem_amt AS NUMERIC(25,10)),\nCAST(broker_comm_amt AS NUMERIC(25,10)),\nNVL(CAST(dim_policy_key AS INT) ,0) AS dim_policy_key,\nNVL(CAST(dim_lob_key AS INT) ,0) AS dim_lob_key,\nNVL(CAST(dim_broker_key AS INT) ,0) AS dim_broker_key,\nNVL(CAST(dim_branch_office_key AS INT) ,0) AS dim_branch_office_key,\nNVL(CAST(dim_policyholder_key AS INT) ,0) AS dim_policyholder_key,\nNVL(CAST(policyholder_rut_num AS INT) ,0) AS policyholder_rut_num,\nNVL(CAST(dim_prd_pln_hrchy_key AS INT) ,0) AS dim_prd_pln_hrchy_key,\nNVL(CAST(dim_insured_key AS INT) ,0) AS dim_insured_key,\nNVL(CAST(insured_rut_num AS INT) ,0) AS insured_rut_num,\nCAST(rec_crt_dtm AS DATE),\nCAST(rec_updt_dtm AS DATE),\nCAST(actv_rec_ind AS CHAR(1)),\nCAST(etl_audit_id AS INTEGER),\nCAST(policy_item_num AS INTEGER),\nCAST(policy_issue_dt AS DATE),\nCAST(policy_eff_dt AS DATE),\ncast(acc_year as varchar(4)),\ncast(acc_month as varchar(2)),\ncast(agreement as INTEGER),\nflota,\nvalid_ind as valid_ind,\ndocument_type as document_type,\nitem_renovated_ind as item_renovated_ind,\nsales_type as sales_type,\ncycle_number as cycle_number,\ncycle_state as cycle_state,\nrenovation_type as renovation_type,\nitem_type as item_type,\nLob_mkt_ref_code as Lob_mkt_ref_code,\nPATENTE as PATENTE,\nCAST(gwp_amt AS NUMERIC(25,10)),\nCAST(affects_direct_premium_amt AS NUMERIC(25,10)),\nCAST(exempt_direct_premium_amt AS NUMERIC(25,10)),\nCAST(new_direct_premium_amt AS NUMERIC(25,10)),\nCAST(renewal_direct_premium_amt AS NUMERIC(25,10)),\nCAST(endorsement_direct_premium_amt AS NUMERIC(25,10)),\nmv_id,\nmv_reason_cd,\nmv_reason_desc  \nfrom (SELECT \nLKP_MAXSID.MAX_SID AS MAX_SID,\nrow_number()over( order by policy_item_id ) as num,\nsrc.* \nFROM (\nselect distinct \n'penta 'src_sys_cd,\ntrunc(cast(src.POLIZA as varchar))||'-'||trunc(cast(src.ITEM as varchar)) as policy_item_id,\ntrunc(poliza) as policy_num,\nto_date(src.TERMINO_VIGENCIA,'DD-MM-YYYY') as policy_exp_dt,\nnull as policy_status_desc,\nnull as facultativo_ind,\nnull coins_type_cd,\ntrunc(cast(src.CODIGO_MONEDA as varchar)) as curr_cd,\n0 as facult_prem_amt,\n0 as broker_comm_amt,\nNULL AS dim_policy_key,\nNVL(l.dim_lob_key,0) AS dim_lob_key,\n0 AS dim_broker_key,\n0 AS dim_branch_office_key,\n0 AS dim_policyholder_key,\nsrc.rut_contratante AS policyholder_rut_num,\n0 AS dim_prd_pln_hrchy_key,\n0 AS dim_insured_key,\nsrc.rut_asegurado AS insured_rut_num,\nsysdate as rec_crt_dtm,\nsysdate as rec_updt_dtm,\n'Y' as actv_rec_ind,\n2 as etl_audit_id,\ntrunc(cast(src.ITEM as varchar)) as policy_item_num,\nnull as policy_issue_dt,\nto_date(src.INICIO_VIGENCIA,'DD-MM-YYYY') as policy_eff_dt,\ncast(SUBSTRING(src.MES_CONTABLE,1,4) as varchar) as acc_year,\nCAST(SUBSTRING(src.MES_CONTABLE,5,6) AS VARCHAR(2)) as acc_month,\nnull as agreement,\nnull as flota,\nnull as valid_ind,\n'Propuesta' as document_type,\n'NO' as item_renovated_ind,\n'Venta Nueva' as sales_type,\nnull as cycle_number,\nnull as cycle_state,\nnull as renovation_type,\nnull as item_type,\nnull as Lob_mkt_ref_code,\nnull as PATENTE,\nsrc.prima_directa_mo as gwp_amt,\nsrc.prima_directa_mo as affects_direct_premium_amt,\n0 as exempt_direct_premium_amt,\nsrc.prima_directa_mo as new_direct_premium_amt,\n0 as renewal_direct_premium_amt,\n0 as endorsement_direct_premium_amt,\n1 as mv_id,\nnull as mv_reason_cd,\nnull as mv_reason_desc,\n1 as DUMMY\nfrom\n(SELECT * FROM cdp_stg_dwh.stg_InformeVentas WHERE trim(codigo_ramo)='24') src\nleft outer join\ncdp_ods.bd_produ_x_pro_prodmes pr on \ntrunc(src.POLIZA) = pr.pro_int_poliza\nAND trunc(src.ITEM) = pr.pro_sma_item\n/*-----------------------------------dim_insured_key---------------------------------------------------*/\nleft outer join cdp_dwh.dim_insured_t i\non cast((pr.pro_int_poliza||'-'||pr.pro_sma_item) as varchar(35)) =i.insured_id and i.src_sys_cd='penta'\n--cast((pr.pro_int_poliza||'-'||pr.pro_sma_item) as varchar(35)) =i.insured_id and i.src_sys_cd='penta'\n/*----------------------------------dim_policyholder_key------------------------------------------------*/\nleft outer join cdp_dwh.dim_policyholder_t h\non h.policyholder_id=pr.pro_int_poliza and h.src_sys_cd='penta'\n/*----------------------------------dim_policy_key------------------------------------------------------*/\nLEFT OUTER join cdp_dwh.dim_policy_t po \non pr.pro_int_poliza = po.policy_id and po.src_sys_cd='penta'\n/*----------------------------------dim_prd_pln_hrchy_key-----------------------------------------------*/\nleft outer join\ncdp_dwh.dim_prd_pln_hrchy_t pph on pr.pro_sma_subramo=pph.prd_cd\nand pr.pro_int_ProdPlan=pph.pln_cd and pr.pro_tin_ramo=pph.lob_cd and pph.src_sys_cd='penta'\n/*----------------------------------dim_branch_office_key-----------------------------------------------*/\nLeft outer join cdp_dwh.dim_branch_office_t bo \n  on pr.pro_tin_oficin = bo.branch_office_id \n  and bo.src_sys_cd = 'penta'\n/*----------------------------------dim_lob_key----------------------------------------------------------*/\nLEFT OUTER join cdp_dwh.dim_lob_t l\non trim(src.codigo_ramo) = l.lob_cd and l.src_sys_cd='penta'\n/*----------------------------------dim_broker_key-------------------------------------------------------*/\nLEFT OUTER join cdp_ods.bd_produ_x_pro_poliza  p \n--on t.ite_int_poliza = p.pol_int_poliza -- Changed as per CDP 460\non pr.pro_int_poliza = p.pol_int_poliza\nleft outer join\n( \nSELECT broker.dim_broker_key,p.pol_int_poliza as pol_int_poliza   from cdp_ods.bd_produ_x_pro_poliza p \ninner join cdp_ods.AgtMst_GrlAgt_Agentes a on a.Agt_Rut = p.pol_int_rutcor \nleft join cdp_dwh.dim_broker_t broker ON (a.Agt_Rut || a.Agt_DigVer) = broker.broker_rut_num and src_sys_cd in ( 'axis', 'penta')\n )dim_broker\nON p.pol_int_poliza=dim_broker.pol_int_poliza \n)SRC\nleft outer join\n(select 1 as dummy, max(fact_renovaciones_integrado_key) as MAX_SID from cdp_dwh.fact_renovaciones_integrado_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy\n)"
    }
]