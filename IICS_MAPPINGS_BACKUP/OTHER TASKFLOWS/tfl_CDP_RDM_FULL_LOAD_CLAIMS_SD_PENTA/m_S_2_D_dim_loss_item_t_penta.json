[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "SELECT  \n(SRC1.MAX_SID+SRC1.num) as dim_loss_item_key,\nSRC1.loss_item_type_cd,\nSRC1.exposure_type_cd,\nnvl(SRC1.claim_number,0) as claim_number,\nnvl(SRC1.loss_item_number,0) as loss_item_number ,\nSRC1.insured_item_indicator,\nSRC1.src_sys_cd,\nSRC1.LICENSE_PLATE_NUMBER,\nSRC1.exposure_type_desc,\nSRC1.rec_crt_dtm,\nSRC1.rec_updt_dtm,\nSRC1.actv_rec_ind,\nSRC1.audit_id,\nSRC1.loss_item_type_desc,\nSRC1.vin_num,\nSRC1.vehicle_type_cd,\nSRC1.vehicle_type_desc,\nSRC1.vehicle_make,\nSRC1.vehicle_model,\nSRC1.vehicle_year,\nSRC1.veh_class_cd,\nSRC1.vechicle_class_desc,\nSRC1.loss_item_id\nFROM \n (select\nrow_number()over(partition by src.claim_number,loss_item_number order by claim_number) as rnk,\nrow_number() over (order by claim_number) num, \n1 as dummy,\nCAST(round(SRC.loss_item_type_cd) AS VARCHAR(10)) AS loss_item_type_cd,\nCAST(round(SRC.exposure_type_cd) AS VARCHAR(10)) AS exposure_type_cd,\nCAST(SRC.claim_number AS INTEGER) AS claim_number,\nCAST(SRC.loss_item_number AS INTEGER) AS loss_item_number ,\nCAST(SRC.insured_item_indicator AS CHAR(1)) AS insured_item_indicator,\nCAST(SRC.src_sys_cd AS VARCHAR(10)) AS src_sys_cd,\nCAST(SRC.LICENSE_PLATE_NUMBER AS VARCHAR(35)) AS LICENSE_PLATE_NUMBER,\nCAST(SRC.exposure_type_desc AS VARCHAR(80)) AS exposure_type_desc,\nCURRENT_DATE as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n'Y' as actv_rec_ind,\nba.etl_audit_id as audit_id,\nCAST(SRC.loss_item_type_desc AS VARCHAR(4800)) AS loss_item_type_desc,\nCAST(SRC.vin_num AS VARCHAR(35)) AS vin_num,\nCAST(SRC.vehicle_type_cd AS VARCHAR(10)) AS vehicle_type_cd,\nCAST(SRC.vehicle_type_desc AS VARCHAR(80)) AS vehicle_type_desc,\nCAST(SRC.vehicle_make AS VARCHAR(35)) AS vehicle_make,\nCAST(SRC.vehicle_model AS VARCHAR(35)) AS vehicle_model,\nCAST(SRC.vehicle_year AS CHAR(4)) AS vehicle_year,\nCAST(SRC.veh_class_cd AS VARCHAR(10)) AS veh_class_cd,\nCAST(SRC.vechicle_class_desc AS VARCHAR(80)) AS vechicle_class_desc,\nCAST(SRC.loss_item_id AS VARCHAR(35)) AS loss_item_id,\nCAST(nvl(LKP_MAX_KEY.max_sid,0) AS INTEGER) as MAX_SID\nFROM(SELECT\nPENTA_SRC.claim_number,\nPENTA_SRC.loss_item_number,\nPENTA_SRC.loss_item_id,\nPENTA_SRC.insured_item_indicator,\nPENTA_SRC.LICENSE_PLATE_NUMBER,\nPENTA_SRC.VEHICLE_YEAR,\nPENTA_SRC.exposure_type_cd,\nPENTA_SRC.exposure_type_desc,\nPENTA_SRC.loss_item_type_cd,\nPENTA_SRC.loss_item_type_desc,\nPENTA_SRC.src_sys_cd,\nPENTA_SRC.VEHICLE_MAKE,\nPENTA_SRC.VEHICLE_MODEL,\nPENTA_SRC.vehicle_type_desc,\nPENTA_SRC.vehicle_type_cd,\nPENTA_SRC.vin_num,\nPENTA_SRC.veh_class_cd,\nPENTA_SRC.vechicle_class_desc,\nPENTA_SRC.rec_crt_dtm,\nPENTA_SRC.dummy\nFROM\n(SELECT\nUNION_1.claim_number,\nUNION_1.loss_item_number,\nUNION_1.loss_item_id,\nUNION_1.insured_item_indicator,\nUNION_1.LICENSE_PLATE_NUMBER,\nUNION_1.VEHICLE_YEAR,\nUNION_1.exposure_type_cd,\nUNION_1.exposure_type_desc,\nUNION_1.loss_item_type_cd,\nUNION_1.loss_item_type_desc,\nUNION_1.src_sys_cd,\nUNION_1.VEHICLE_MAKE,\nUNION_1.VEHICLE_MODEL,\nUNION_1.vehicle_type_desc,\nUNION_1.vehicle_type_cd,\nUNION_1.vin_num,\nUNION_1.veh_class_cd,\nUNION_1.vechicle_class_desc,\nUNION_1.rec_crt_dtm,\nUNION_1.dummy,\nROW_NUMBER() OVER (PARTITION BY UNION_1.claim_number,UNION_1.loss_item_number ORDER BY UNION_1.rec_crt_dtm) AS RNK\nFROM\n(SELECT\nSUB_2.claim_number,\nSUB_2.loss_item_number,\nSUB_2.loss_item_id,\nSUB_2.insured_item_indicator,\nSUB_2.LICENSE_PLATE_NUMBER,\nSUB_2.VEHICLE_YEAR,\nSUB_2.exposure_type_cd,\nSUB_2.exposure_type_desc,\nSUB_2.loss_item_type_cd,\nSUB_2.loss_item_type_desc,\nSUB_2.src_sys_cd,\nSUB_2.VEHICLE_MAKE,\nSUB_2.VEHICLE_MODEL,\nSUB_2.vehicle_type_desc,\nSUB_2.vehicle_type_cd,\nSUB_2.vin_num,\nSUB_2.veh_class_cd,\nSUB_2.vechicle_class_desc,\nSUB_2.rec_crt_dtm,\nSUB_2.dummy\nFROM\n(SELECT\nPENTA_1.claim_number,\nPENTA_1.loss_item_number,\nPENTA_1.loss_item_id,\nPENTA_1.insured_item_indicator,\nPENTA_1.LICENSE_PLATE_NUMBER,\nPENTA_1.VEHICLE_YEAR,\nPENTA_1.exposure_type_cd,\nPENTA_1.exposure_type_desc,\nPENTA_1.loss_item_type_cd,\nPENTA_1.loss_item_type_desc,\nPENTA_1.src_sys_cd,\nPENTA_1.VEHICLE_MAKE,\nPENTA_1.VEHICLE_MODEL,\nPENTA_1.vehicle_type_desc,\nPENTA_1.vehicle_type_cd,\nPENTA_1.vin_num,\nPENTA_1.veh_class_cd,\nPENTA_1.vechicle_class_desc,\nPENTA_1.rec_crt_dtm,\nPENTA_1.dummy,\nROW_NUMBER() OVER (PARTITION BY PENTA_1.claim_number,PENTA_1.loss_item_number ORDER BY PENTA_1.rec_crt_dtm) AS RNK_2\nFROM\n(\nSelect\ndistinct \ncast (b.per_int_sinies as integer) as claim_number,\ncast(1 as integer) as loss_item_number,\ncast (b.per_int_rutase as VARCHAR(35)) as loss_item_id,\ncast ('S' as char(1)) insured_item_indicator,\ncast (c.veh_cha_paten as varchar(35)) as LICENSE_PLATE_NUMBER,\ncast(c.veh_sma_anofac as char(4)) AS VEHICLE_YEAR,\ncast(null as varchar(10)) exposure_type_cd,\ncast(null as varchar(80)) as exposure_type_desc,\ncast(null as varchar(10)) as loss_item_type_cd,\ncast(null as varchar(4800)) as loss_item_type_desc,\ncast('penta' as varchar(10)) src_sys_cd,\ncast(NVL(f.mkt_ref_code_desc,f.REF_DESC) as varchar(35))AS VEHICLE_MAKE,\ncast (NVL(g.mkt_ref_code_desc,g.REF_DESC) as varchar(35))AS VEHICLE_MODEL,\ncast (NVL(h.mkt_ref_code_desc,h.REF_DESC) as varchar(80))AS vehicle_type_desc,\ncast(NVL(h.mkt_ref_code,cast(aa.tve_tin_codigo as varchar(10))) as varchar(10))AS vehicle_type_cd,\ncast(null AS VARCHAR(35))as vin_num,\ncast(null AS VARCHAR(10))as veh_class_cd,                        \ncast(null AS VARCHAR(80)) as vechicle_class_desc,\nb.per_int_sinies as rec_crt_dtm,\n--b.per_fec_denunc as rec_crt_dtm,              \n1 dummy\nfrom cdp_ods.bd_sinie_x_sin_perfil b\n/*inner join cdp_ods.bd_sinie_x_sin_danos_propios a \non b.per_int_sinies=a.dap_int_sinies*/--updated as per DMS v.83\nLEFT outer join cdp_ods.bd_produ_x_pro_vehiculo c\nON b.per_int_poliza =c.veh_int_poliza  \nAND b.per_sma_item =c.veh_sma_item \nleft outer join cdp_ods.prdcdg_pro_tipovehi aa\non c.veh_tin_tipveh =aa.tve_tin_codigo \nLEFT outer join cdp_ods.prdcdg_pro_marcaveh d                                                                                              \nON c.veh_tin_marca =d.mar_tin_codigo \nLEFT outer join(SELECT REF_CD, REF_DESC, mkt_ref_code_desc FROM cdp_stg_dwh.stg_tref_code_map_variant WHERE ref_type_cd = 'veh_make'\nAND src_sys_cd = 'penta') f\nON d.mar_tin_codigo =f.REF_CD\nLEFT outer join cdp_ods.prdcdg_pro_modelo e\nON  c.veh_tin_marca =e.mod_tin_codmar \nand c.veh_tin_modelo =e.mod_sma_codmod \nand c.veh_tin_tipveh=e.mod_tin_tipveh ---- added to avoid random pick\nLEFT outer join\n(SELECT REF_CD, REF_DESC, mkt_ref_code_desc FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd = 'veh_model'\nAND src_sys_cd = 'penta') g\nON trim(e.mod_tin_tipveh)||'|'||trim(e.mod_tin_codmar)||'|'||trim(e.mod_sma_codmod) =trim(g.REF_CD)\nleft outer join \n(SELECT REF_CD, REF_DESC,mkt_ref_code, mkt_ref_code_desc FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd = 'veh_type'\nAND src_sys_cd = 'penta')h\non aa.tve_tin_codigo=h.REF_CD\n) AS PENTA_1 where PENTA_1.loss_item_number is not null\n) AS SUB_2\nWHERE SUB_2.RNK_2=1 \n\nUNION\n\nSELECT\nSUB_2.claim_number,\nSUB_2.LOSS_ITEM_NBR,\nSUB_2.loss_item_id,\nSUB_2.insured_item_indicator,\nSUB_2.LICENSE_PLATE_NUMBER,\nSUB_2.VEHICLE_YEAR,\nSUB_2.exposure_type_cd,\nSUB_2.exposure_type_desc,\nSUB_2.loss_item_type_cd,\nSUB_2.loss_item_type_desc,\nSUB_2.src_sys_cd,\nSUB_2.VEHICLE_MAKE,\nSUB_2.VEHICLE_MODEL,\nSUB_2.vehicle_type_desc,\nSUB_2.vehicle_type_cd,\nSUB_2.vin_num,\nSUB_2.veh_class_cd,\nSUB_2.vechicle_class_desc,\nSUB_2.rec_crt_dtm,\nSUB_2.dummy\nFROM\n(\nSELECT\nPENTA_2.claim_number,\nPENTA_2.LOSS_ITEM_NBR,\nPENTA_2.loss_item_id,\nPENTA_2.insured_item_indicator,\nPENTA_2.LICENSE_PLATE_NUMBER,\nPENTA_2.VEHICLE_YEAR,\nPENTA_2.exposure_type_cd,\nPENTA_2.exposure_type_desc,\nPENTA_2.loss_item_type_cd,\nPENTA_2.loss_item_type_desc,\nPENTA_2.src_sys_cd,\nPENTA_2.VEHICLE_MAKE,\nPENTA_2.VEHICLE_MODEL,\nPENTA_2.vehicle_type_desc,\nPENTA_2.vehicle_type_cd,\nPENTA_2.vin_num,\nPENTA_2.veh_class_cd,\nPENTA_2.vechicle_class_desc,\nPENTA_2.rec_crt_dtm,\nPENTA_2.dummy,\nROW_NUMBER() OVER (PARTITION BY PENTA_2.claim_number,PENTA_2.LOSS_ITEM_NBR ORDER BY PENTA_2.rec_crt_dtm ) AS RNK_1\nFROM\n(\nSELECT\nMain2.claim_number,\ncast((Main2.num_loss + 2) as integer) as LOSS_ITEM_NBR,\nMain2.loss_item_id,\nMain2.insured_item_indicator,\nMain2.LICENSE_PLATE_NUMBER,\nMain2.VEHICLE_YEAR,\nMain2.exposure_type_cd,\nMain2.exposure_type_desc,\nMain2.loss_item_type_cd,\nMain2.loss_item_type_desc,\nMain2.src_sys_cd,\nMain2.VEHICLE_MAKE,\nMain2.VEHICLE_MODEL,\nMain2.vehicle_type_desc,\nMain2.vehicle_type_cd,\nMain2.vin_num,\nMain2.veh_class_cd,\nMain2.vechicle_class_desc,\nMain2.rec_crt_dtm,\nMain2.dummy\nfrom\n(\nSELECT\nMain.claim_number,\nMain.loss_item_id,\nMain.insured_item_indicator,\nMain.LICENSE_PLATE_NUMBER,\nMain.VEHICLE_YEAR,\nMain.exposure_type_cd,\nMain.exposure_type_desc,\nMain.loss_item_type_cd,\nMain.loss_item_type_desc,\nMain.src_sys_cd,\nMain.VEHICLE_MAKE,\nMain.VEHICLE_MODEL,\nMain.vehicle_type_desc,\nMain.vehicle_type_cd,\nMain.vin_num,\nMain.veh_class_cd,\nMain.vechicle_class_desc,\nMain.rec_crt_dtm,\nMain.dummy,\nROW_NUMBER() OVER (PARTITION BY Main.claim_number ORDER BY Main.ter_nro_correlativo) AS num_loss\nFROM\n(Select \ndistinct cast (o.ter_int_sinies as integer) as claim_number,\n--cast (loss_itm_nbr.LOSS_ITEM_NBR as integer) as LOSS_ITEM_NBR ,\ncast ((o.ter_int_sinies || '-' || o.ter_nro_correlativo) as VARCHAR(35)) as  loss_item_id,\ncast('N' as char(1)) insured_item_indicator,\ncast(o.ter_cha_patent as varchar(35)) as LICENSE_PLATE_NUMBER,\ncast(o.ter_sma_ano as char(4)) AS VEHICLE_YEAR,\ncast(null as varchar(10)) exposure_type_cd,\ncast(null as varchar(80)) as exposure_type_desc,\ncast(null as varchar(10)) as loss_item_type_cd,\ncast(null as varchar(2000)) as loss_item_type_desc,\ncast('penta' as varchar(10)) src_sys_cd,\ncast (NVL(w.mkt_ref_code_desc,w.REF_DESC) as varchar(35))AS VEHICLE_MAKE,\ncast(NVL(x.mkt_ref_code_desc,x.REF_DESC) as varchar(35))AS VEHICLE_MODEL,\ncast(NVL(z.mkt_ref_code_desc,z.REF_DESC) as varchar(80)) AS vehicle_type_desc,\ncast(NVL(z.mkt_ref_code,cast(r.tve_tin_codigo as varchar(10))) as varchar(10))AS vehicle_type_cd,\ncast(null AS VARCHAR(35))as vin_num,\ncast(null AS VARCHAR(10))as veh_class_cd,                        \ncast(null AS VARCHAR(80)) as vechicle_class_desc,\no.ter_int_sinies as rec_crt_dtm,\no.ter_nro_correlativo as ter_nro_correlativo,\n1 dummy\nfrom cdp_ods.bd_sinie_x_sin_tercer o\n/*inner join  cdp_ods.bd_sinie_x_sin_danos_tercero t\non o.ter_int_sinies=t.dat_int_sinies*/----updated as per DMS v.83\n/*left join (select    \n count(*)+2 AS LOSS_ITEM_NBR,ter_int_sinies\nfrom\ncdp_ods.bd_sinie_x_sin_tercer group by ter_int_sinies) loss_itm_nbr \non t.dat_int_sinies = loss_itm_nbr.ter_int_sinies*/\nleft outer join cdp_ods.prdcdg_pro_marcaveh m\non o.ter_sma_marveh=m.mar_tin_codigo\nleft join cdp_ods.prdcdg_pro_modelo p\non o.ter_tin_tipoveh=p.mod_tin_tipveh and\no.ter_sma_marveh=p.mod_tin_codmar and\no.ter_sma_modveh=p.mod_sma_codmod ---- added to avoid random pick\nleft join cdp_ods.prdcdg_pro_tipovehi r\non o.ter_tin_tipoveh=r.tve_tin_codigo\nLEFT outer join(SELECT REF_CD, REF_DESC, mkt_ref_code_desc FROM cdp_stg_dwh.stg_tref_code_map_variant WHERE ref_type_cd = 'veh_make' \nAND src_sys_cd = 'penta') w\non m.mar_tin_codigo=w.ref_cd \nLEFT JOIN \n(SELECT REF_CD, REF_DESC, mkt_ref_code_desc,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant WHERE ref_type_cd = 'veh_model'\nAND src_sys_cd = 'penta') x\nON trim(o.ter_tin_tipoveh)||'|'||trim(o.ter_sma_marveh)||'|'||trim(p.mod_sma_codmod) =trim(x.REF_CD) \nleft join (SELECT REF_CD, REF_DESC,mkt_ref_code, mkt_ref_code_desc FROM cdp_stg_dwh.stg_tref_code_map_variant WHERE ref_type_cd = 'veh_type' and src_sys_cd = 'penta') z\non r.tve_tin_codigo=z.ref_cd)Main\n)Main2\n)PENTA_2 \n) SUB_2\nWHERE SUB_2.RNK_1=1 and SUB_2.LOSS_ITEM_NBR is not null) UNION_1 ) PENTA_SRC\nWHERE PENTA_SRC.RNK=1\n) SRC\nleft outer join\n(select 1 dummy,max(dim_loss_item_key) max_sid  from  cdp_dwh.dim_loss_item_t) LKP_MAX_KEY\non SRC.dummy=LKP_MAX_KEY.dummy\nleft join \n  (\n  select distinct etl_audit_id,1 as dummy from cdp_dwh.dim_branch_office_t where src_sys_cd='penta' ) ba \n  on src.dummy =ba.dummy \n) SRC1\nwhere rnk=1"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[1].dataAdapter.runtimeAttributes.attributes[14]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.dim_loss_item_t where src_sys_cd='penta';\ncommit;"
    }
]