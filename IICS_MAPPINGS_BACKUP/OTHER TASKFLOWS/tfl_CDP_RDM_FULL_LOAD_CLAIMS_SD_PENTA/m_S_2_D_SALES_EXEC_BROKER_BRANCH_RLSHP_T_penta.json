[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select \n(nvl(LKP_MAX_KEY.max_sid,0)+src.rnm) rlshp_key,\nsrc_sys_cd,\nbroker_branch_rlshp_id,\nsales_exec_rlshp_id,\nsales_exec_name,\nsales_exec_rut_num,\nsales_exec_id,\ndim_branch_office_key,\ndim_broker_key,\netl_audit.etl_audit_id,\nactv_rec_ind,\nltst_rec_ind,\nrec_crt_dtm ,\nrec_exp_dtm\n from(\nselect \nsrc_sys_cd,\nbroker_branch_rlshp_id,\nsales_exec_rlshp_id,\nsales_exec_name,\nsales_exec_rut_num,\nsales_exec_id,\ndim_branch_office_key,\ndim_broker_key,\nactv_rec_ind,\nltst_rec_ind,\nrec_crt_dtm ,\nrec_exp_dtm,\ndummy,\nrow_number() over(order by broker_branch_rlshp_id) rnm from\n(select \n'penta' src_sys_cd,\na.Agt_CdgOficina||'-'||a.Agt_RutAgente broker_branch_rlshp_id,\n0 sales_exec_rlshp_id,\nb.Agt_NombreEjecutivo sales_exec_name,\nb.Agt_RutEjecutivo sales_exec_rut_num,\nnull sales_exec_id,\nnvl(dim_branch.dim_branch_office_key,0) dim_branch_office_key,\nnvl(Agentes.dim_broker_key,0) dim_broker_key,\n'Y' actv_rec_ind,\n'Y' ltst_rec_ind,\ncurrent_date as rec_crt_dtm ,\ncast('9999-12-31 23:59:59' as timestamp) as rec_exp_dtm,\n1 dummy,\nrow_number()over(partition by a.Agt_CdgOficina||'-'||a.Agt_RutAgente order by a.agt_fecha_modifica desc) rnk \nfrom cdp_ods.agtmst_grlagt_nub a\nleft outer join\ncdp_ods.agtmst_grlagt_ejcnegocio b\n on a.Agt_RutEjecutivo = b.Agt_RutEjecutivo\n left outer join\n (select dim_branch_office_key, branch_office_cd from cdp_dwh.dim_branch_office_t \n where src_sys_cd='penta') dim_branch\n on a.Agt_CdgOficina=dim_branch.branch_office_cd\n left outer join \n (select distinct ag.Agt_Rut,ag.Agt_DigVer,nub.Agt_CdgOficina||'-'||nub.Agt_RutAgente branch_id,dim_broker_key from cdp_ods.agtmst_grlagt_nub nub\n inner join\n cdp_ods.agtmst_grlagt_agentes Ag\n on Ag.Agt_Rut = nub.Agt_RutAgente\n  inner join\n cdp_dwh.dim_broker_t broker\n on broker.broker_id=Ag.Agt_Rut||Ag.Agt_DigVer\n ) Agentes\n on Agentes.branch_id=a.Agt_CdgOficina||'-'||a.Agt_RutAgente\n) main_part\n where rnk=1) src\n left outer join \n(select 1 dummy,max(rlshp_key) max_sid  from  cdp_dwh.sales_exec_broker_branch_rlshp_t) LKP_MAX_KEY\non LKP_MAX_KEY.dummy=src.dummy\nleft join \n  (select distinct etl_audit_id,1 as dummy from cdp_dwh.dim_insured_t where src_sys_cd ='penta') etl_audit \n  on src.dummy =etl_audit.dummy\nwhere 1=2"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.sales_exec_broker_branch_rlshp_t where src_sys_cd='penta';\ncommit;\n\ninsert into cdp_dwh.sales_exec_broker_branch_rlshp_t\n(rlshp_key,\nsrc_sys_cd,\nbroker_branch_rlshp_id,\nsales_exec_rlshp_id,\nsales_exec_name,\nsales_exec_rut_num,\nsales_exec_id,\ndim_branch_office_key,\ndim_broker_key,\netl_audit_id,\nactv_rec_ind,\nltst_rec_ind,\nrec_eff_dtm ,\nrec_exp_dtm) \n\nselect \n(nvl(LKP_MAX_KEY.max_sid,0)+src.rnm) rlshp_key,\nsrc_sys_cd,\nbroker_branch_rlshp_id,\nsales_exec_rlshp_id,\nsales_exec_name,\nsales_exec_rut_num,\nsales_exec_id,\ndim_branch_office_key,\ndim_broker_key,\netl_audit.etl_audit_id,\nactv_rec_ind,\nltst_rec_ind,\nrec_crt_dtm ,\nrec_exp_dtm\n from(\nselect \nsrc_sys_cd,\nbroker_branch_rlshp_id,\nsales_exec_rlshp_id,\nsales_exec_name,\nsales_exec_rut_num,\nsales_exec_id,\ndim_branch_office_key,\ndim_broker_key,\nactv_rec_ind,\nltst_rec_ind,\nrec_crt_dtm ,\nrec_exp_dtm,\ndummy,\nrow_number() over(order by broker_branch_rlshp_id) rnm from\n(select \n'penta' src_sys_cd,\na.Agt_CdgOficina||'-'||a.Agt_RutAgente broker_branch_rlshp_id,\n0 sales_exec_rlshp_id,\nb.Agt_NombreEjecutivo sales_exec_name,\nb.Agt_RutEjecutivo sales_exec_rut_num,\nnull sales_exec_id,\nnvl(dim_branch.dim_branch_office_key,0) dim_branch_office_key,\nnvl(Agentes.dim_broker_key,0) dim_broker_key,\n'Y' actv_rec_ind,\n'Y' ltst_rec_ind,\ncurrent_date as rec_crt_dtm ,\ncast('9999-12-31 23:59:59' as timestamp) as rec_exp_dtm,\n1 dummy,\nrow_number()over(partition by a.Agt_CdgOficina||'-'||a.Agt_RutAgente order by a.agt_fecha_modifica desc) rnk \nfrom cdp_ods.agtmst_grlagt_nub a\nleft outer join\ncdp_ods.agtmst_grlagt_ejcnegocio b\n on a.Agt_RutEjecutivo = b.Agt_RutEjecutivo\n left outer join\n (select distinct dim_branch_office_key, branch_office_id from cdp_dwh.dim_branch_office_t \n where src_sys_cd='penta') dim_branch\n on a.Agt_CdgOficina=dim_branch.branch_office_id\n left outer join \n (select distinct ag.Agt_Rut,ag.Agt_DigVer,nub.Agt_CdgOficina||'-'||nub.Agt_RutAgente branch_id,dim_broker_key from cdp_ods.agtmst_grlagt_nub nub\n inner join\n cdp_ods.agtmst_grlagt_agentes Ag\n on Ag.Agt_Rut = nub.Agt_RutAgente\n  inner join\n cdp_dwh.dim_broker_t broker\n on upper(broker.broker_id)=upper(Ag.Agt_Rut||Ag.Agt_DigVer)\n ) Agentes\n on Agentes.branch_id=a.Agt_CdgOficina||'-'||a.Agt_RutAgente\n) main_part\n where rnk=1) src\n left outer join \n(select 1 dummy,max(rlshp_key) max_sid  from  cdp_dwh.sales_exec_broker_branch_rlshp_t) LKP_MAX_KEY\non LKP_MAX_KEY.dummy=src.dummy\nleft join \n  (select distinct etl_audit_id,1 as dummy from cdp_dwh.dim_insured_t where src_sys_cd ='penta') etl_audit \n  on src.dummy =etl_audit.dummy"
    }
]