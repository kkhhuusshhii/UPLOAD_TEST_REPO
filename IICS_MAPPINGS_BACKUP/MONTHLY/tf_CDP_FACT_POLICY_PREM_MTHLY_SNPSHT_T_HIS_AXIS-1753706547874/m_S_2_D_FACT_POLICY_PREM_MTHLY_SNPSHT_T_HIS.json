[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\nSRC1.src_sys_cd,  \nSRC1.policy_item_id,\nSRC1.mv_id,\nSRC1.prem_amt,\nSRC1.curr_cd,\nSRC1.receipt_type_cd,\nSRC1.receipt_type_desc,\nSRC1.cov_cd,\nSRC1.receipt_issue_dt,\nSRC1.receipt_exp_dt,\nSRC1.receipt_num,\nSRC1.mv_reason_cd,\nSRC1.mv_reason_desc,\nSRC1.mv_eff_dt,\nSRC1.mv_exp_dt,\nSRC1.actv_rec_ind,\nSRC1.dim_insured_key,\nSRC1.dim_policyholder_key,\nSRC1.dim_policy_key,\nSRC1.dim_risk_key,\nSRC1.dim_cov_key,\nSRC1.dim_prd_pln_hrchy_key,\nSRC1.dim_branch_office_key,\nSRC1.dim_lob_key,\nSRC1.dim_broker_key,\nSRC1.dim_fecu_lob_key,\nSRC1.receipt_status_cd,\nSRC1.receipt_status_desc,\nSRC1.policy_num,\nSRC1.policy_eff_dt,\nSRC1.policy_exp_dt,\nSRC1.policy_issue_dt,\nSRC1.policy_status_cd,\nSRC1.policy_status_desc,\nSRC1.policy_item_num,\nSRC1.receipt_mv_id,\nSRC1.receipt_mv_dt,\nSRC1.mv_dt,\nSRC1.receipt_eff_dt,\nSRC1.accountability_yr,\nSRC1.net_direct_prem_amt,\nSRC1.direct_tax_amt,\nSRC1.direct_comm_amt,\nSRC1.gross_comm_retention_pct,\nSRC1.gross_comm_retained_amt,\nSRC1.prem_rate_amt,\nSRC1.net_accrued_prem_amt,\nSRC1.accrued_fee_amt,\nSRC1.gross_prem_participate_amt,\nSRC1.net_prem_participate_amt,\nSRC1.tax_participate_amt,\nSRC1.gross_comm_participate_amt,\nSRC1.affects_prem_participate_amt,\nSRC1.exempt_prem_participate_amt,\nSRC1.affects_prem_direct_amt,\nSRC1.exempt_prem_direct_amt,\nSRC1.comm_pct,\nSRC1.insured_amt,\nSRC1.pct_of_our_participation,\nSRC1.accountability_mth,\nCAST(SRC1.usgaap_period AS INTEGER) AS usgaap_period,\nLKP.MAX_SID\nfrom\n(\nselect\nSRC.src_sys_cd,  \nSRC.policy_item_id,\nSRC.mv_id,\nSRC.prem_amt,\nSRC.curr_cd,\nSRC.receipt_type_cd,\nSRC.receipt_type_desc,\nSRC.cov_cd,\nSRC.receipt_issue_dt,\nSRC.receipt_exp_dt,\nSRC.receipt_num,\nnvl(SRC.mv_reason_cd,' ') as mv_reason_cd,\nSRC.mv_reason_desc,\nSRC.mv_eff_dt,\nSRC.mv_exp_dt,\nSRC.actv_rec_ind,\nnvl(SRC.dim_insured_key,0) as dim_insured_key,\nnvl(SRC.dim_policyholder_key,0) as dim_policyholder_key,\nnvl(SRC.dim_policy_key,0) as dim_policy_key,\nnvl(SRC.dim_risk_key,0) as dim_risk_key,\nnvl(SRC.dim_cov_key,0) as dim_cov_key,\nnvl(SRC.dim_prd_pln_hrchy_key,0) as dim_prd_pln_hrchy_key,\nnvl(SRC.dim_branch_office_key,0) as dim_branch_office_key,\nnvl(SRC.dim_lob_key,0) as dim_lob_key,\nnvl(SRC.dim_broker_key,0) as dim_broker_key,\nnvl(dim_fecu_lob_key,0)as dim_fecu_lob_key,\nSRC.receipt_status_cd,\nSRC.receipt_status_desc,\nSRC.policy_num,\nSRC.policy_eff_dt,\nSRC.policy_exp_dt,\nSRC.policy_issue_dt,\nSRC.policy_status_cd,\nSRC.policy_status_desc,\nSRC.policy_item_num,\nSRC.receipt_mv_id,\nSRC.receipt_mv_dt,\nSRC.mv_dt,\nSRC.receipt_eff_dt,\nSRC.accountability_yr,\nSRC.net_direct_prem_amt,\nSRC.direct_tax_amt,\nSRC.direct_comm_amt,\nSRC.gross_comm_retention_pct,\nSRC.gross_comm_retained_amt,\nSRC.prem_rate_amt,\nSRC.net_accrued_prem_amt,\nSRC.accrued_fee_amt,\nSRC.gross_prem_participate_amt,\nSRC.net_prem_participate_amt,\nSRC.tax_participate_amt,\nSRC.gross_comm_participate_amt,\nSRC.affects_prem_participate_amt,\nSRC.exempt_prem_participate_amt,\nSRC.affects_prem_direct_amt,\nSRC.exempt_prem_direct_amt,\nSRC.comm_pct,\nSRC.insured_amt,\nSRC.pct_of_our_participation,\nSRC.accountability_mth,\ncase\nwhen\n\tSRC.accountability_yr||SRC.accountability_mth > to_char (SRC.policy_eff_dt, 'YYYYMM') then SRC.accountability_yr||SRC.accountability_mth\nelse\n\tto_char (SRC.policy_eff_dt, 'YYYYMM') end usgaap_period\n/*ROW_NUMBER()OVER(PARTITION BY SRC.src_sys_cd,SRC.policy_item_id,SRC.cov_cd,SRC.mv_id,SRC.receipt_num,\nSRC.accountability_yr,SRC.accountability_mth ORDER BY SRC.mv_dt DESC, SRC.receipt_issue_dt DESC) RNK*/\nfrom\n(\nselect \ncast('axis' as varchar(10)) src_sys_cd,  \ncast(cast(cuadre02.sseguro as integer) as varchar(35)) as policy_item_id,\ncast(nvl(CAST(cuadre02.nmovimi AS INTEGER),0) as integer) as mv_id,\ncast(cuadre02.prima_total as numeric(25,10)) as prem_amt,\ncast(cuadre02.cmonseg as varchar(10)) as curr_cd,\ncast(cast(recibos.CTIPREC as integer) as varchar(10)) as receipt_type_cd,\ncast(receipt_type.REF_DESC as varchar(80)) as receipt_type_desc,\ncast(cast(cuadre02.cgarant as integer) as varchar(10)) as cov_cd,\ncast(recibos.FEMISIO as date) as receipt_issue_dt,\ncast(recibos.FVENCIM as date) as receipt_exp_dt,\ncast(cast(cuadre02.NRECIBO as integer) as varchar(35)) as receipt_num,\ncast(cast(cuadre02.cmotmov as integer) as varchar(10)) as mv_reason_cd,\ncast(movement.REF_DESC as varchar(80)) as mv_reason_desc,\ncast(cuadre02.FEFECTO as date) as mv_eff_dt,\ncast(cuadre02.ftermino as date) as mv_exp_dt,\n'Y' as actv_rec_ind,\ncast(INSURED.dim_insured_key as integer) as dim_insured_key,\ncast(dim_policyholder.dim_policyholder_key as integer) as dim_policyholder_key,\ncast(dim_policy.dim_policy_key as integer) as dim_policy_key,\ncast(dim_policy_risk.dim_risk_key as integer) as dim_risk_key,\ncast(dim_cov_type.dim_cov_key as integer) as dim_cov_key,\ncast(dim_prd_pln.dim_prd_pln_hrchy_key as integer) as dim_prd_pln_hrchy_key,\ncast(dim_branch_office.dim_branch_office_key as integer) as dim_branch_office_key,\ncast(dim_lob.dim_lob_key as integer) as dim_lob_key,\ncast(dim_broker.dim_broker_key as integer) as dim_broker_key,\ncast(dim_fecu_lob.dim_lob_key as integer) dim_fecu_lob_key, \ncast(cuadre02.cdestado as varchar(10)) as receipt_status_cd,\n--cast(receipt_status.REF_DESC as varchar(80)) as receipt_status_desc,\ncast(case when cast(cuadre02.cdestado as varchar(10)) = 'P' then 'pendiente'\n        when cast(cuadre02.cdestado as varchar(10)) = 'A' then 'anulado'\n        when cast(cuadre02.cdestado as varchar(10)) = 'C' then 'cobrado'\n        end as varchar(80)) as receipt_status_desc,\ncast(cast(cuadre02.npoliza as integer) as varchar(35)) as policy_num,\ncast(seguros.FEFECTO as date) as policy_eff_dt,\n--cast(seguros.FVENCIM as date) as policy_exp_dt,\ncast(decode(seguros.CDURACI,3, seguros.FVENCIM, seguros.FCARPRO) as date)  as policy_exp_dt, \ncast(seguros.FEMISIO as date) as policy_issue_dt,\ncast(cast(seguros.csituac as integer) as varchar(10)) as policy_status_cd,\ncast(policy_status.REF_DESC as varchar(80)) as policy_status_desc,\ncast(cast(seguros.ncertif as integer) as varchar(35)) AS policy_item_num,\ncast(m3.smovrec as integer) as receipt_mv_id,\ncast(m3.fmovini as date ) as receipt_mv_dt,\ncast(cuadre02.FEFECTO as date) as mv_dt,\ncast(recibos.fefecto as date) as receipt_eff_dt,\n--cast(cuadre02.FCONTA as date) as accountability_dt,\n--cast(extract(year from cuadre02.FCONTA) as char(4)) as accountability_yr,\ncast(to_char(cuadre02.FCONTA,'yyyy') as char(4)) as accountability_yr,\ncast(cuadre02.prima_tarifa as numeric(25,10)) as net_direct_prem_amt,\ncast(cuadre02.impuesto as numeric(25,10)) as direct_tax_amt,\ncast(cuadre02.comision as numeric(25,10)) as direct_comm_amt,\ncast(cuadre02.poirpf as numeric(11,2)) as gross_comm_retention_pct,\ncast(cuadre02.irpf as numeric(25,10)) as gross_comm_retained_amt,\ncast(cuadre02.liquido as numeric(25,10)) as prem_rate_amt,\ncast(cuadre02.prima_deven as numeric(25,10)) as net_accrued_prem_amt,\ncast(cuadre02.com_deven as numeric(25,10)) as accrued_fee_amt,\ncast(cuadre02.ipribru_part as numeric(25,10)) as gross_prem_participate_amt,\ncast(cuadre02.iprinet_part as numeric(25,10)) as net_prem_participate_amt,\ncast(cuadre02.iimpto_part as numeric(25,10)) as tax_participate_amt,\ncast(cuadre02.icombru_part as numeric(25,10)) as gross_comm_participate_amt,\ncast(cuadre02.ipriafe_part as numeric(25,10)) as affects_prem_participate_amt,\ncast(cuadre02.ipriexe_part as numeric(25,10)) as exempt_prem_participate_amt,\ncast(cuadre02.ipriafe_dir as numeric(25,10)) as affects_prem_direct_amt,\ncast(cuadre02.ipriexe_dir as numeric(25,10)) as exempt_prem_direct_amt,\ncast(cuadre02.pcomisi as numeric(11,2)) as comm_pct,\ncast(cuadre02.icapital as numeric(25,10)) as insured_amt,\ncast(cuadre02.pparcoa as numeric(11,2)) as pct_of_our_participation,\n--cast(extract(month from cuadre02.FCONTA) as char(2)) as accountability_mth\ncast(to_char(cuadre02.FCONTA,'mm') as char(2)) as accountability_mth\nfrom cdp_ods.sisaxis_his_cuadre02 cuadre02\nleft outer join cdp_ods.sisaxis_seguros seguros \non cuadre02.sseguro = seguros.sseguro \n--and cuadre02.ncertif = seguros.ncertif \n--and cuadre02.npoliza = seguros.npoliza  \n--and seguros.ncertif >0\nleft outer join \n(select nmovimi,sseguro,NRECIBO,smovrec,\nROW_NUMBER()OVER(PARTITION BY nmovimi,sseguro,NRECIBO ORDER BY smovrec DESC) RNK \nfrom cdp_ods.SISAXIS_MOVREC2MOVSEG) m2  \nON m2.nmovimi=nvl(CAST(cuadre02.nmovimi AS INTEGER),0) and m2.sseguro = cuadre02.sseguro \nand m2.NRECIBO=cuadre02.NRECIBO \nand m2.RNK=1\nleft outer join cdp_ods.sisaxis_movrecibo m3 \nON m3.smovrec=m2.smovrec\nleft outer join cdp_ods.sisaxis_recibos recibos \nON  recibos.nrecibo=m3.nrecibo\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='receipt_type_cd'and src_sys_cd = 'axis') receipt_type\non cast(cast(recibos.CTIPREC as integer) as varchar(10))=receipt_type.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='movement_cd'and src_sys_cd = 'axis') movement\non cast(cast(cuadre02.cmotmov as integer) as varchar(10))=movement.REF_CD\nleft outer join (select dim_policy_key,policy_id,policy_num,ROW_NUMBER()OVER(PARTITION BY policy_num ORDER BY policy_id DESC) RNK \n from cdp_dwh.dim_policy_t where src_sys_cd='axis') dim_policy\non cast(cast(cuadre02.npoliza as integer) as varchar (35))=dim_policy.policy_num\nand dim_policy.RNK=1\nleft outer join (select sperson,cdomici,sseguro from cdp_ods.sisaxis_tomadores) tomadores\non dim_policy.policy_id=cast(tomadores.sseguro as integer)\nleft outer join (select dim_policyholder_key,policyholder_id from cdp_dwh.dim_policyholder_t where src_sys_cd='axis') dim_policyholder\non cast(cast(tomadores.sperson as integer)||'-'||nvl(cast(tomadores.cdomici as integer)) as varchar(35))=dim_policyholder.policyholder_id \nleft outer join (\nselect sub.dim_risk_key,sub.policy_item_id,sub.mv_id from (\nselect dim_risk_key,policy_item_id,mv_id,\nROW_NUMBER()OVER(PARTITION BY policy_item_id ORDER BY mv_id DESC) RNK \nfrom cdp_dwh.dim_policy_risk_t where src_sys_cd='axis') sub\nwhere sub.RNK=1) dim_policy_risk\non cast(cast(cuadre02.sseguro as integer) as varchar(35))=dim_policy_risk.policy_item_id\nand cast(cuadre02.nmovimi as integer)>=dim_policy_risk.mv_id\nleft outer join (select dim_cov_key,cov_cd from cdp_dwh.dim_cov_type_t where src_sys_cd='axis') dim_cov_type\non cast(cast(cuadre02.cgarant as integer) as varchar(20))=dim_cov_type.cov_cd\nleft outer join (select dim_prd_pln_hrchy_key,lob_cd,prd_cd,pln_cd from cdp_dwh.dim_prd_pln_hrchy_t where src_sys_cd='axis') dim_prd_pln\non cast(cast(seguros.sproduc as integer) as varchar(10))=dim_prd_pln.prd_cd\nand cast(cast(seguros.cactivi as integer) as varchar(10))=dim_prd_pln.pln_cd\nand cast(cast(seguros.cramo as integer) as varchar(10))=dim_prd_pln.lob_cd\nleft outer join (select dim_branch_office_key, branch_office_cd from cdp_dwh.dim_branch_office_t where src_sys_cd='axis') dim_branch_office\nON LTRIM(RIGHT(cuadre02.cagente,3),0)=LTRIM(dim_branch_office.branch_office_cd,0)\nleft outer join (select dim_lob_key,lob_cd from cdp_dwh.dim_lob_t where src_sys_cd='axis') dim_lob\non cast(cast(seguros.cramo as integer) as varchar(10))=dim_lob.lob_cd\nleft outer join \n(select distinct broker.dim_broker_key,broker_branch.rlshp_src_id from    (\n(select rlshp_src_id ,entity_rut_num from cdp_dwh.broker_branch_rlshp_t where src_sys_cd='axis' and entity_type_cd = 4) broker_branch\ninner join (select dim_broker_key,broker_id from cdp_dwh.dim_broker_t \nwhere src_sys_cd='axis'\n) broker\non broker_branch.entity_rut_num=broker.broker_id   ) ) dim_broker\non cuadre02.cagente=dim_broker.rlshp_src_id\nleft outer join (select dim_lob_key,lob_cd from cdp_dwh.dim_lob_t where src_sys_cd='fecu') dim_fecu_lob\non cast(cast(cuadre02.cramdgs as integer) as varchar(10))=dim_fecu_lob.lob_cd\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='receipt_status_cd'and src_sys_cd = 'axis') receipt_status\non cast(cuadre02.cdestado as varchar(10))=receipt_status.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='policy_status_cd'and src_sys_cd = 'axis') policy_status\non cast(cast(seguros.csituac as integer) as varchar(10))=policy_status.REF_CD\nLEFT JOIN\n (SELECT distinct A.sseguro,A.nmovimi,INSURED.dim_insured_key  FROM\n (select \n tmp2.sseguro,\n  tmp2.nmovimi,\n tmp2.sperson,\n tmp2.cdomici\n from \n ( select \n tmp1.sseguro, \n tmp1.nriesgo, \n tase.nmovima, \n tase.sperson, \n tase.cdomici, \n tmp1.nmovimi,\n row_number() over(\n partition by \n tmp1.sseguro, \n tmp1.nriesgo,\n tmp1.nmovimi\n order by \n tase.norden desc\n ) as row_ind \n from ( select \n tmov.sseguro, \n tmov.nmovimi, \n trie.nriesgo, \n trie.sperson, \n trie.cdomici, \n row_number() over(\n partition by \n tmov.sseguro, \n tmov.nmovimi \n order by \n trie.nmovima desc\n ) as row_ind \n from \n ( select distinct \n sseguro \n from \n cdp_ods.sisaxis_seguros \n where \n ncertif > 0 \n ) tseg \n inner join cdp_ods.sisaxis_movseguro tmov \n on tseg.sseguro = tmov.sseguro \ninner join cdp_ods.sisaxis_riesgos trie --\n on tmov.sseguro = trie.sseguro \n and tmov.nmovimi >= trie.nmovima\n ) tmp1 \ninner join cdp_ods.sisaxis_asegurados tase \n on tmp1.sseguro = tase.sseguro \n and tmp1.nriesgo = tase.nriesgo \n and tmp1.nmovimi >= tase.nmovima\n and (tmp1.nmovimi < tase.nmovimb\n or tase.nmovimb is null )\n where \n tmp1.row_ind = 1 \n ) tmp2\n where \n tmp2.row_ind = 1\n group by \n  tmp2.sseguro,\n  tmp2.nmovimi,\n tmp2.sperson,\n tmp2.cdomici\n order by\n  tmp2.sseguro,\n  tmp2.nmovimi,\n tmp2.sperson,\n tmp2.cdomici) A\n INNER JOIN cdp_dwh.dim_insured_t INSURED  \nON INSURED.insured_id=CAST(A.sperson AS INTEGER)\nAND INSURED.address_id=CAST(nvl(CAST(A.cdomici AS INTEGER),0) AS INTEGER) \nAND INSURED.src_sys_cd='axis')INSURED\nON INSURED.sseguro=cuadre02.sseguro\nAND INSURED.nmovimi=cuadre02.nmovimi\n) SRC ) SRC1\nLEFT JOIN (SELECT 1 as DUMMY, max(fact_policy_prem_mthly_snpsht_key ) AS MAX_SID from cdp_dwh.fact_policy_prem_mthly_snpsht_t) LKP\nON LKP.DUMMY=1\n/*where SRC1.RNK=1 and \nSRC1.policy_item_id is not null and SRC1.mv_id is not null \nand SRC1.cov_cd is not null and SRC1.receipt_num is not null and SRC1.policy_num is not null\nand SRC1.accountability_yr is not null and SRC1.accountability_mth is not null*/"
    }
]