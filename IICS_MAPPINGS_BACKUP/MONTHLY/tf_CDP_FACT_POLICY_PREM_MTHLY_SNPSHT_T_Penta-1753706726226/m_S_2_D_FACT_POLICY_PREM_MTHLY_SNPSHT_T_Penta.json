[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select \ns.src_sys_cd,\ns.policy_item_id,\ns.mv_id,\ns.prem_amt,\ns.curr_cd,\ns.receipt_type_cd,\ns.receipt_type_desc,\ns.cov_cd,\ns.receipt_issue_dt,\ns.receipt_exp_dt,\ns.receipt_num,\ns.mv_reason_cd,\ns.mv_reason_desc,\ns.mv_eff_dt,\ns.mv_exp_dt,\ns.actv_rec_ind,\ns.dim_insured_key,\ns.dim_policyholder_key,\ns.dim_policy_key,\ns.dim_risk_key,\ns.dim_cov_key,\ns.dim_prd_pln_hrchy_key,\ns.dim_branch_office_key,\ns.dim_lob_key,\ns.dim_fecu_lob_key,\ns.dim_broker_key,\ns.receipt_status_cd,\ns.receipt_status_desc,\ns.policy_num,\ns.policy_eff_dt,\ns.policy_exp_dt,\ns.policy_issue_dt,\ns.policy_status_cd,\ns.policy_status_desc,\ns.policy_item_num,\ns.receipt_mv_id,\ns.receipt_mv_dt,\ns.mv_dt,\ns.receipt_eff_dt,\n--s.accountability_dt,\ns.net_direct_prem_amt,\ns.direct_tax_amt,\ns.direct_comm_amt,\ns.gross_comm_retention_pct,\ns.gross_comm_retained_amt,\ns.prem_rate_amt,\ns.net_accrued_prem_amt,\ns.accrued_fee_amt,\ns.gross_prem_participate_amt,\ns.net_prem_participate_amt,\ns.tax_participate_amt,\ns.gross_comm_participate_amt,\ns.affects_prem_participate_amt,\ns.exempt_prem_participate_amt,\ns.affects_prem_direct_amt,\ns.exempt_prem_direct_amt,\ns.comm_pct,\ns.insured_amt,\ns.pct_of_our_participation,\ns.accountability_yr,\ns.accountability_mth,\nCAST(s.usgaap_period AS INTEGER) AS usgaap_period,\ns.max_sid \nfrom\n(select \nsrc.src_sys_cd,\nsrc.policy_item_id,\nsrc.mv_id,\nsrc.prem_amt,\nsrc.curr_cd,\nsrc.receipt_type_cd,\nsrc.receipt_type_desc,\nsrc.cov_cd,\nsrc.receipt_issue_dt,\nsrc.receipt_exp_dt,\nsrc.receipt_num,\nsrc.mv_reason_cd,\nsrc.mv_reason_desc,\nsrc.mv_eff_dt,\nsrc.mv_exp_dt,\nsrc.actv_rec_ind,\nsrc.dim_insured_key,\nsrc.dim_policyholder_key,\nsrc.dim_policy_key,\nsrc.dim_risk_key,\nsrc.dim_cov_key,\nsrc.dim_prd_pln_hrchy_key,\nsrc.dim_branch_office_key,\nsrc.dim_lob_key,\nsrc.dim_fecu_lob_key,\nsrc.dim_broker_key,\nsrc.receipt_status_cd,\nsrc.receipt_status_desc,\nsrc.policy_num,\nsrc.policy_eff_dt,\nsrc.policy_exp_dt,\nsrc.policy_issue_dt,\nsrc.policy_status_cd,\nsrc.policy_status_desc,\nsrc.policy_item_num,\nsrc.receipt_mv_id,\nsrc.receipt_mv_dt,\nsrc.mv_dt,\nsrc.receipt_eff_dt,\n--src.accountability_dt,\nsrc.net_direct_prem_amt,\nsrc.direct_tax_amt,\nsrc.direct_comm_amt,\nsrc.gross_comm_retention_pct,\nsrc.gross_comm_retained_amt,\nsrc.prem_rate_amt,\nsrc.net_accrued_prem_amt,\nsrc.accrued_fee_amt,\nsrc.gross_prem_participate_amt,\nsrc.net_prem_participate_amt,\nsrc.tax_participate_amt,\nsrc.gross_comm_participate_amt,\nsrc.affects_prem_participate_amt,\nsrc.exempt_prem_participate_amt,\nsrc.affects_prem_direct_amt,\nsrc.exempt_prem_direct_amt,\nsrc.comm_pct,\nsrc.insured_amt,\nsrc.pct_of_our_participation,\nsrc.accountability_yr,\nsrc.accountability_mth,\ncase\nwhen\n\tsrc.accountability_yr||src.accountability_mth > to_char (src.policy_eff_dt, 'YYYYMM') then src.accountability_yr||src.accountability_mth\nelse\n\tto_char (src.policy_eff_dt, 'YYYYMM') end usgaap_period,\nLKP_MAXSID.MAX_SID as max_sid\n--ROW_NUMBER()OVER(PARTITION BY SRC.src_sys_cd,SRC.policy_item_id,SRC.cov_cd,SRC.mv_id,SRC.receipt_num ORDER BY SRC.mv_dt DESC, SRC.receipt_issue_dt DESC) RNK \nfrom \n(select \n'penta'as src_sys_cd,\n--cast(c.NMOVIMI as varchar(35))policy_item_id,\ncast(p.pol_int_poliza||'-'||nvl(b.ite_sma_item,'0') as varchar(35)) policy_item_id, --as per mapping sheet 2.10\ncast(c.NMOVIMI as int)mv_id,\ncast(c.PRIMA_TOTAL as numeric (25,10))prem_amt,\ncast(c.cmonseg as varchar(10)) curr_cd,\ncast('0' as varchar(10))receipt_type_cd,\ncast('0' as varchar(80))receipt_type_desc,\ncast(cast(c.CGARANT as int) as varchar(10))cov_cd,\ncast(c.FEMISION as date)receipt_issue_dt,\ncast(c.FTERMINO as date)receipt_exp_dt,\ncast(cast(c.NRECIBO as int) as varchar(35))receipt_num,\ncast(nvl(cast(c.CMOTMOV as int),'0') as varchar(10))mv_reason_cd,\ncast(c.TMOTMOV as varchar(80))mv_reason_desc,\ncast(c.FEFECTO as date)mv_eff_dt,\ncast(c.FTERMINO as date)mv_exp_dt,\n'Y' as actv_rec_ind,\ncast(nvl(d.dim_insured_key,0) as int) dim_insured_key,\ncast(nvl(e.dim_policyholder_key,0) as int) dim_policyholder_key,\ncast(nvl(f.dim_policy_key,0) as int) dim_policy_key,\ncast(0 as int) dim_risk_key,\ncast(0 as int) dim_cov_key,\n--cast(0 as int) dim_prd_pln_hrchy_key,\ncast(nvl(k.dim_prd_pln_hrchy_key,0) as int) dim_prd_pln_hrchy_key, --- as per 2.10 DMS\ncast(nvl(i.dim_branch_office_key,0) as int) dim_branch_office_key,\ncast(nvl(j.dim_lob_key,0) as int) dim_lob_key,\ncast(nvl(h.dim_lob_key,0) as int) dim_fecu_lob_key,\ncast(nvl(g.dim_broker_key,0) as int) dim_broker_key,\ncast('0' as varchar(10))receipt_status_cd,\ncast('0' as varchar(80))receipt_status_desc,\ncast(cast(c.NPOLIZA as int) as varchar(35)) policy_num,\ncast(c.FEFECTO as date)policy_eff_dt,\ncast(b.ite_fec_vighas as date)policy_exp_dt,\ncast(c.FEMISION as date)policy_issue_dt,\ncast('0' as varchar(10))policy_status_cd,\ncast('0' as varchar(80))policy_status_desc,\ncast(cast(c.Ncertif as int)as varchar(35))policy_item_num, \ncast(0 as int)receipt_mv_id,\ncast(c.festado as date)receipt_mv_dt,\ncast(c.festado as date)mv_dt,\ncast(c.festado as date)receipt_eff_dt,\n--cast(cast(cast(periodo_contable as varchar(6))|| cast('01' as varchar(2)) as varchar(10)) as date) accountability_dt,\ncast(substring(periodo_contable,1,4) as char(4))as accountability_yr,\ncast(substring(periodo_contable,5,2) as char(2)) as accountability_mth, --- as per 2.10 DMS\ncast(c.PRIMA_TARIFA as numeric(25,10)) net_direct_prem_amt,\ncast(c.impuesto as numeric(25,10)) direct_tax_amt,\ncast(c.COMISION as numeric(25,10)) direct_comm_amt,\ncast(c.poirpf as numeric(11,2)) gross_comm_retention_pct,\ncast(c.IRPF as numeric(25,10)) gross_comm_retained_amt,\ncast(c.liquido as numeric(25,10)) prem_rate_amt,\ncast(c.PRIMA_DEVEN as numeric(25,10)) net_accrued_prem_amt,\ncast(c.com_deven as numeric(25,10)) accrued_fee_amt,\ncast(c.IPRIBRU_PART as numeric(25,10)) gross_prem_participate_amt,\ncast(c.IPRINET_PART as numeric(25,10)) net_prem_participate_amt,\ncast(c.iimpto_part as numeric(25,10)) tax_participate_amt,\ncast(c.ICOMBRU_PART as numeric(25,10)) gross_comm_participate_amt,\ncast(c.ipriafe_part as numeric(25,10)) affects_prem_participate_amt,\ncast(c.IPRIEXE_PART as numeric(25,10)) exempt_prem_participate_amt,\ncast(c.ipriafe_dir as numeric(25,10)) affects_prem_direct_amt,\ncast(c.IPRIEXE_DIR as numeric(25,10)) exempt_prem_direct_amt,\ncast(c.PCOMISI as numeric(11,2)) comm_pct,\ncast(c.ICAPITAL as numeric(25,10)) insured_amt,\ncast(c.PPARCOA as numeric(11,2)) pct_of_our_participation,\n1 as dummy \nfrom  cdp_ods.sisfin11_cuadre02_penta c \nleft join cdp_ods.bd_produ_x_pro_poliza p\non cast(c.npoliza as int)=cast(p.pol_int_poliza as int)\nleft join cdp_ods.bd_produ_x_pro_item b \non cast(c.npoliza as int)=cast(b.ite_int_poliza as int) \nand cast(c.ncertif as int)=cast(b.ite_sma_item as int) \nleft join (select distinct Agt_Rut, Agt_DigVer from cdp_ods.AgtMst_GrlAgt_Agentes) ag \non cast(p.pol_int_rutcor as int) = cast(ag.Agt_Rut as int)\nleft join (select pro_int_poliza,pro_sma_item,pro_int_endoso,pro_sma_subramo,\npro_int_ProdPlan,pro_tin_ramo,pro_sma_tipo,\nROW_NUMBER()OVER(PARTITION BY pro_int_poliza,pro_sma_item,pro_int_endoso ORDER BY pro_sma_tipo DESC) rnk \nfrom cdp_ods.bd_produ_x_pro_prodmes) m\non cast(c.npoliza as int)=cast(m.pro_int_poliza as int) \nand cast(c.ncertif as int)=cast(m.pro_sma_item as int) \nand cast(c.nsuppol as int)=cast(m.pro_int_endoso as int)\nand rnk=1 \nleft join \n(select insured_id,dim_insured_key from cdp_dwh.dim_insured_t where src_sys_cd='penta')d\non d.insured_id=cast(cast(c.Npoliza as int)||'-'||cast(c.Ncertif as int) as varchar(35))\nleft join \n(select dim_policyholder_key,policyholder_id from cdp_dwh.dim_policyholder_t where src_sys_cd='penta')e\non e.policyholder_id=cast(cast(c.Npoliza as int) as varchar(35))\nleft join \n(select dim_policy_key,policy_id from cdp_dwh.dim_policy_t where src_sys_cd='penta')f\non f.policy_id=cast(c.Npoliza as integer)\nleft join \n(select dim_broker_key,broker_rut_num from cdp_dwh.dim_broker_t ---where src_sys_cd='penta'\n)g\non g.broker_rut_num=cast(cast(isnull(c.rutcorredor,p.pol_int_rutcor) as int)||isnull(c.dvrutcorredor,ag.Agt_DigVer) as varchar(35)) \nleft join \n(select dim_lob_key,lob_cd from cdp_dwh.dim_lob_t where src_sys_cd='fecu')h\non h.lob_cd=cast(cast(c.CRAMDGS as int) as varchar(10))\nleft join \n(select branch_office_id,dim_branch_office_key from cdp_dwh.dim_branch_office_t where src_sys_cd='axis')i\non c.cdelega=i.branch_office_id \nleft join \n(select dim_lob_key,lob_cd from cdp_dwh.dim_lob_t where src_sys_cd='penta')j\non j.lob_cd=cast(b.ite_sma_ramo as varchar(10))\nleft join \n(select dim_prd_pln_hrchy_key,prd_cd,pln_cd,lob_cd from cdp_dwh.dim_prd_pln_hrchy_t where src_sys_cd='penta')k\non cast(m.pro_sma_subramo as int)=cast(k.prd_cd as int) \nand cast(m.pro_int_ProdPlan as int)=cast(k.pln_cd as int) \nand cast(m.pro_tin_ramo as int)=cast(k.lob_cd as int)\n\nUNION ALL\n\nselect \n'penta'as src_sys_cd,\n--cast(c.NMOVIMI as varchar(35))policy_item_id,\ncast(p.pol_int_poliza||'-'||nvl(b.ite_sma_item,'0') as varchar(35)) policy_item_id, --as per mapping sheet 2.10\ncast(c.NMOVIMI as int)mv_id,\ncast(c.PRIMA_TOTAL as numeric (25,10))prem_amt,\ncast(c.cmonseg as varchar(10)) curr_cd,\ncast('0' as varchar(10))receipt_type_cd,\ncast('0' as varchar(80))receipt_type_desc,\ncast(cast(c.CGARANT as int) as varchar(10))cov_cd,\ncast(c.FEMISION as date)receipt_issue_dt,\ncast(c.FTERMINO as date)receipt_exp_dt,\ncast(cast(c.NRECIBO as int) as varchar(35))receipt_num,\ncast(nvl(cast(c.CMOTMOV as int),'0') as varchar(10))mv_reason_cd,\ncast(c.TMOTMOV as varchar(80))mv_reason_desc,\ncast(c.FEFECTO as date)mv_eff_dt,\ncast(c.FTERMINO as date)mv_exp_dt,\n'Y' as actv_rec_ind,\ncast(nvl(d.dim_insured_key,0) as int) dim_insured_key,\ncast(nvl(e.dim_policyholder_key,0) as int) dim_policyholder_key,\ncast(nvl(f.dim_policy_key,0) as int) dim_policy_key,\ncast(0 as int) dim_risk_key,\ncast(0 as int) dim_cov_key,\n--cast(0 as int) dim_prd_pln_hrchy_key,\ncast(nvl(k.dim_prd_pln_hrchy_key,0) as int) dim_prd_pln_hrchy_key, --- as per 2.10 DMS\ncast(nvl(i.dim_branch_office_key,0) as int) dim_branch_office_key,\ncast(nvl(j.dim_lob_key,0) as int) dim_lob_key,\ncast(nvl(h.dim_lob_key,0) as int) dim_fecu_lob_key,\ncast(nvl(g.dim_broker_key,0) as int) dim_broker_key,\ncast('0' as varchar(10))receipt_status_cd,\ncast('0' as varchar(80))receipt_status_desc,\ncast(cast(c.NPOLIZA as int) as varchar(35)) policy_num,\ncast(c.FEFECTO as date)policy_eff_dt,\ncast(b.ite_fec_vighas as date)policy_exp_dt,\ncast(c.FEMISION as date)policy_issue_dt,\ncast('0' as varchar(10))policy_status_cd,\ncast('0' as varchar(80))policy_status_desc,\ncast(cast(c.Ncertif as int)as varchar(35))policy_item_num, \ncast(0 as int)receipt_mv_id,\ncast(c.festado as date)receipt_mv_dt,\ncast(c.festado as date)mv_dt,\ncast(c.festado as date)receipt_eff_dt,\n--cast(cast(cast(periodo_contable as varchar(6))|| cast('01' as varchar(2)) as varchar(10)) as date) accountability_dt,\ncast(substring(periodo_contable,1,4) as char(4))as accountability_yr,\ncast(substring(periodo_contable,5,2) as char(2)) as accountability_mth, --- as per 2.10 DMS\ncast(c.PRIMA_TARIFA as numeric(25,10)) net_direct_prem_amt,\ncast(c.impuesto as numeric(25,10)) direct_tax_amt,\ncast(c.COMISION as numeric(25,10)) direct_comm_amt,\ncast(c.poirpf as numeric(11,2)) gross_comm_retention_pct,\ncast(c.IRPF as numeric(25,10)) gross_comm_retained_amt,\ncast(c.liquido as numeric(25,10)) prem_rate_amt,\ncast(c.PRIMA_DEVEN as numeric(25,10)) net_accrued_prem_amt,\ncast(c.com_deven as numeric(25,10)) accrued_fee_amt,\ncast(c.IPRIBRU_PART as numeric(25,10)) gross_prem_participate_amt,\ncast(c.IPRINET_PART as numeric(25,10)) net_prem_participate_amt,\ncast(c.iimpto_part as numeric(25,10)) tax_participate_amt,\ncast(c.ICOMBRU_PART as numeric(25,10)) gross_comm_participate_amt,\ncast(c.ipriafe_part as numeric(25,10)) affects_prem_participate_amt,\ncast(c.IPRIEXE_PART as numeric(25,10)) exempt_prem_participate_amt,\ncast(c.ipriafe_dir as numeric(25,10)) affects_prem_direct_amt,\ncast(c.IPRIEXE_DIR as numeric(25,10)) exempt_prem_direct_amt,\ncast(c.PCOMISI as numeric(11,2)) comm_pct,\ncast(c.ICAPITAL as numeric(25,10)) insured_amt,\ncast(c.PPARCOA as numeric(11,2)) pct_of_our_participation,\n1 as dummy \nfrom  cdp_ods.sisfin11_cuadre02_penta_hist c \nleft join cdp_ods.bd_produ_x_pro_poliza p\non cast(c.npoliza as int)=cast(p.pol_int_poliza as int)\nleft join cdp_ods.bd_produ_x_pro_item b \non cast(c.npoliza as int)=cast(b.ite_int_poliza as int) \nand cast(c.ncertif as int)=cast(b.ite_sma_item as int) \nleft join (select distinct Agt_Rut, Agt_DigVer from cdp_ods.AgtMst_GrlAgt_Agentes) ag\non cast(p.pol_int_rutcor as int) = cast(ag.Agt_Rut as int)\nleft join (select pro_int_poliza,pro_sma_item,pro_int_endoso,pro_sma_subramo,\npro_int_ProdPlan,pro_tin_ramo,pro_sma_tipo,\nROW_NUMBER()OVER(PARTITION BY pro_int_poliza,pro_sma_item,pro_int_endoso ORDER BY pro_sma_tipo DESC) rnk \nfrom cdp_ods.bd_produ_x_pro_prodmes) m\non cast(c.npoliza as int)=cast(m.pro_int_poliza as int) \nand cast(c.ncertif as int)=cast(m.pro_sma_item as int) \nand cast(c.nsuppol as int)=cast(m.pro_int_endoso as int)\nand rnk=1  \nleft join \n(select insured_id,dim_insured_key from cdp_dwh.dim_insured_t where src_sys_cd='penta')d\non d.insured_id=cast(cast(c.Npoliza as int)||'-'||cast(c.Ncertif as int) as varchar(35))\nleft join \n(select dim_policyholder_key,policyholder_id from cdp_dwh.dim_policyholder_t where src_sys_cd='penta')e\non e.policyholder_id=cast(cast(c.Npoliza as int) as varchar(35))\nleft join \n(select dim_policy_key,policy_id from cdp_dwh.dim_policy_t where src_sys_cd='penta')f\non f.policy_id=cast(c.Npoliza as integer)\nleft join \n(select dim_broker_key,broker_rut_num from cdp_dwh.dim_broker_t ---where src_sys_cd='penta'\n)g\non\ng.broker_rut_num=cast(cast(isnull(CAST(c.rutcorredor AS INTEGER),p.pol_int_rutcor) as int)||isnull(c.dvrutcorredor,ag.Agt_DigVer) as varchar(35)) \nleft join \n(select dim_lob_key,lob_cd from cdp_dwh.dim_lob_t where src_sys_cd='fecu')h\non h.lob_cd=cast(cast(c.CRAMDGS as int) as varchar(10))\nleft join \n(select branch_office_id,dim_branch_office_key from cdp_dwh.dim_branch_office_t where src_sys_cd='axis')i\non c.cdelega=i.branch_office_id \nleft join \n(select dim_lob_key,lob_cd from cdp_dwh.dim_lob_t where src_sys_cd='penta')j\non j.lob_cd=cast(b.ite_sma_ramo as varchar(10))\nleft join \n(select dim_prd_pln_hrchy_key,prd_cd,pln_cd,lob_cd from cdp_dwh.dim_prd_pln_hrchy_t where src_sys_cd='penta')k\non cast(m.pro_sma_subramo as int)=cast(k.prd_cd as int) \nand cast(m.pro_int_ProdPlan as int)=cast(k.pln_cd as int) \nand cast(m.pro_tin_ramo as int)=cast(k.lob_cd as int)\n\n)src\nleft outer join\n(select 1 as dummy, max(fact_policy_prem_mthly_snpsht_key) as MAX_SID from cdp_dwh.fact_policy_prem_mthly_snpsht_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy\n)s \n/*where s.RNK=1 and s.policy_item_id is not null and s.mv_id is not null \nand s.cov_cd is not null and s.receipt_num is not null and s.policy_num is not null*/"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[9]",
        "name": "Pre-sql",
        "value": "delete from cdp_dwh.fact_policy_prem_mthly_snpsht_t where src_sys_cd='penta'"
    }
]