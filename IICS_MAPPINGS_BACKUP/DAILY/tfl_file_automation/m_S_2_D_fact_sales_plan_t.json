[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\nbranch_office_name,\nbroker_rut_num,\nbroker_name,\nsales_exec_rut,\nsales_exec_name,\npln_yr,\npln_mth,\nprem_amt,\ncurr_cd,\nramo_pln_desc,\nrec_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\nLKP_MAX_KEY.max_sid from(\nselect \nbranch_office_name,\nbroker_rut_num,\nbroker_name,\ncase when (sales_exec_rut is null or sales_exec_rut='') then '0' else sales_exec_rut end sales_exec_rut,\nsales_exec_name,\npln_yr,\npln_mth,\nprem_amt,\ncurr_cd,\nramo_pln_desc,\nCURRENT_DATE as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n'Y' as actv_rec_ind,\n1 as dummy from(\nselect \nbranch_office_name,\nbroker_rut_num,\nbroker_name,\nsales_exec_rut,\nsales_exec_name,\npln_yr,\npln_mth,\nprem_amt,\ncurr_cd,\nramo_pln_desc,\nrow_number() over(partition by branch_office_name,broker_rut_num,sales_exec_rut,pln_yr,pln_mth,ramo_pln_desc order by branch_office_name) rnm\nfrom(select distinct \ncast(trim(sucursal_comercial) as varchar(50)) branch_office_name, \ncast(trim(rut_corredor) as varchar(50)) broker_rut_num,\ncast(corredor as varchar(100)) broker_name,\ncast(trim(rut_ejecutivo) as varchar(35)) sales_exec_rut ,\ncast(ejecutivo as varchar(100)) sales_exec_name ,\ncast(trim(agno) as varchar(4)) pln_yr,\ncast(month_no as varchar(2)) pln_mth,\ncast(replace((case when pre_amt='' then null else pre_amt end) ,',','.') as numeric(25,10)) prem_amt,\ncast(moneda as varchar(10)) curr_cd,\ncast(trim(ramo_plan) as varchar(50)) ramo_pln_desc\nfrom \n(select sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'01' month_no,enero pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'02' month_no,febrero pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'03' month_no,marzo pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'04' month_no,abril pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'05' month_no,mayo pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'06' month_no,junio pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'07' month_no,julio pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'08' month_no,agosto pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'09' month_no,septiembre pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'10' month_no,octubre pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'11' month_no,noviembre pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\nunion\nselect sucursal_comercial,rut_corredor,corredor,rut_ejecutivo,ejecutivo,agno,'12' month_no,diciembre pre_amt,moneda,ramo_plan\n from cdp_stg_dwh.stg_plan\n)\n))\nwhere rnm=1) src\nleft outer join\n(select 1 dummy,max(fact_pln_key) max_sid  from  cdp_dwh.fact_sales_pln_t) LKP_MAX_KEY\non src.dummy=LKP_MAX_KEY.dummy"
    }
]