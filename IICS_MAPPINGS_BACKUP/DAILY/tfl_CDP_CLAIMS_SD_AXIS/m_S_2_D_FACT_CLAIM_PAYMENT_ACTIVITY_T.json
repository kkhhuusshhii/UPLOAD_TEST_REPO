[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "SELECT \n\tCAST(SRC_1.dim_claim_key AS INT),\n\tCAST(SRC_1.dim_claimant_key AS INT),\n\tCAST(SRC_1.dim_loss_item_key AS INT),\n\tCAST(SRC_1.dim_line_of_business_key AS INT),\n\tCAST(SRC_1.dim_claim_status_key AS INT),\n\tCAST(SRC_1.dim_claim_type_key AS INT),\n\tCAST(SRC_1.dim_claim_adjuster_key AS INT),\n\tCAST(SRC_1.dim_bdshp_key AS INT),\n\tCAST(SRC_1.dim_parts_provdr_key AS INT),\n\tCAST(SRC_1.dim_claim_analyst_key AS INT),\n\tCAST(SRC_1.dim_insured_key AS INT),\n\tCAST(SRC_1.dim_party_key AS INT),\n\tCAST(SRC_1.dim_recov_type_key AS INT),\n\tCAST(SRC_1.dim_cov_key AS INT),\n\tCAST(SRC_1.dim_branch_office_key AS INT),\n\tCAST(SRC_1.sys_cd AS VARCHAR(10)),\n\tCAST(SRC_1.activity_type_desc AS VARCHAR(80)),\n\tCAST(SRC_1.activity_subtype_cd AS VARCHAR(10)),\n\tCAST(SRC_1.activity_subtype_desc AS VARCHAR(80)),\n\tCAST(SRC_1.payment_notes AS  VARCHAR(100)),\n\tCAST(SRC_1.ceded_payment_amt AS NUMERIC(25,10)),\n\tCAST(SRC_1.retained_payment_amt AS NUMERIC(25,10)),\n\tCAST(SRC_1.PaymentTypeCode AS VARCHAR(10)),\n\tCAST(SRC_1.PartyIdentifier AS INT),\n\tCAST(SRC_1.PaymentIdentifier AS VARCHAR(35)),\n\tCAST(SRC_1.ClaimNumber AS VARCHAR(35)),\n\tCAST(SRC_1.PaymentDate AS DATE),\n\tCAST(SRC_1.PaymentMethodCode AS VARCHAR(10)),\n\tCAST(SRC_1.PaymentStatusCode AS VARCHAR(10)),\n\tCAST(SRC_1.PaymentEntryDate AS DATE),\n\tCAST(SRC_1.InvoiceDate AS DATE),\n\tCAST(SRC_1.AccountingPostingDate AS DATE),\n\tCAST(SRC_1.PaymentModificationDate AS DATE),\n\tCAST(SRC_1.PaymentCancellationReasonCode AS VARCHAR(10)),\n\tCAST(SRC_1.PaymentRejectionDescription AS VARCHAR(100)),\n\tCAST(SRC_1.IndemnityCode AS VARCHAR(10)),\n\tSRC_1.IndemnityDescription,\n\tCAST(SRC_1.PaymentValidationIndicator AS CHAR(1)),\n\tCAST(SRC_1.PaymentValidationDate AS DATE),\n\tCAST(SRC_1.PaymentTransferAccountTypeCode AS VARCHAR(10)),\n\tCAST(SRC_1.EstimatedDateofPayment AS DATE),\n\tCAST(SRC_1.PaymentDocumentTypeCode AS VARCHAR(10)),\n\tCAST(SRC_1.AccountingCurrencyCode AS VARCHAR(10)),\n\tCAST(SRC_1.AccountingCurrencyPaymentAmount AS NUMERIC(25,10)),\n\tCAST(SRC_1.PolicyCurrencyCode AS VARCHAR(10)),\n\tCAST(SRC_1.PolicyCurrencyPaymentAmount AS NUMERIC(25,10)),\n\tCAST(SRC_1.PaymentCurrencyCode AS VARCHAR(10)),\n\tCAST(SRC_1.PaymentAmount AS NUMERIC(25,10)),\n\tLKP.MAX_SID\n\tFROM\n\t(\n\tSELECT \n\tNVL(SRC_AXIS.dim_claim_key,0) AS dim_claim_key,\n\tNVL(SRC_AXIS.dim_claimant_key,0) AS dim_claimant_key,\n\tNVL(SRC_AXIS.dim_loss_item_key,0) AS dim_loss_item_key ,\n\tNVL(SRC_AXIS.dim_line_of_business_key,0) AS dim_line_of_business_key,\n\tNVL(SRC_AXIS.dim_claim_status_key,0) AS dim_claim_status_key,\n\tNVL(SRC_AXIS.dim_claim_type_key,0) AS dim_claim_type_key,\n\tNVL(SRC_AXIS.dim_claim_adjuster_key,0) AS dim_claim_adjuster_key,\n\tNVL(SRC_AXIS.dim_bdshp_key,0) AS dim_bdshp_key,\n\tNVL(SRC_AXIS.dim_parts_provdr_key,0) AS dim_parts_provdr_key,\n\tNVL(SRC_AXIS.dim_claim_analyst_key,0) AS dim_claim_analyst_key,\n\tNVL(SRC_AXIS.dim_insured_key,0) AS dim_insured_key,\n\tNVL(SRC_AXIS.dim_party_key,0) AS dim_party_key,\n\tNVL(SRC_AXIS.dim_recov_type_key,0) AS dim_recov_type_key,\n\tNVL(SRC_AXIS.dim_cov_key,0) AS dim_cov_key,\n\tNVL(SRC_AXIS.dim_branch_office_key,0) AS dim_branch_office_key,\n\tCAST(SRC_AXIS.sys_cd AS VARCHAR(10)),\n\tCAST(SRC_AXIS.activity_type_desc AS VARCHAR(80)),\n\tCAST(SRC_AXIS.activity_subtype_cd AS VARCHAR(10)),\n\tCAST(SRC_AXIS.activity_subtype_desc AS VARCHAR(80)),\n\tCAST(SRC_AXIS.payment_notes AS  VARCHAR(100)),\n\tCAST(SRC_AXIS.ceded_payment_amt AS NUMERIC(25,10)),\n\t--CAST(SRC_AXIS.retained_payment_amt AS NUMERIC(25,10)),\n\tcase when cast(sign(SRC_AXIS.PaymentAmount) AS NUMERIC(25,10)) = -1*cast(sign(SRC_AXIS.retained_payment_amt)AS NUMERIC(25,10)) then -1*cast(SRC_AXIS.retained_payment_amt AS NUMERIC(25,10)) else cast(SRC_AXIS.retained_payment_amt AS NUMERIC(25,10)) end, \n\tCAST(SRC_AXIS.PaymentTypeCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.PartyIdentifier AS INT),\n\tCAST(SRC_AXIS.PaymentIdentifier AS VARCHAR(35)),\n\tCAST(SRC_AXIS.ClaimNumber AS VARCHAR(35)),\n\tSRC_AXIS.PaymentDate,\n\tCAST(SRC_AXIS.PaymentMethodCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.PaymentStatusCode AS VARCHAR(10)),\n\tSRC_AXIS.PaymentEntryDate,\n\tSRC_AXIS.InvoiceDate,\n\tSRC_AXIS.AccountingPostingDate,\n\tSRC_AXIS.PaymentModificationDate,\n\tCAST(SRC_AXIS.PaymentCancellationReasonCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.PaymentRejectionDescription AS VARCHAR(100)),\n\tCAST(SRC_AXIS.IndemnityCode AS VARCHAR(10)),\n\tSRC_AXIS.IndemnityDescription,\n\tCAST(SRC_AXIS.PaymentValidationIndicator AS CHAR(1)),\n\tSRC_AXIS.PaymentValidationDate,\n\tCAST(SRC_AXIS.PaymentTransferAccountTypeCode AS VARCHAR(10)),\n\tSRC_AXIS.EstimatedDateofPayment,\n\tCAST(SRC_AXIS.PaymentDocumentTypeCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.AccountingCurrencyCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.AccountingCurrencyPaymentAmount AS NUMERIC(25,10)),\n\tCAST(SRC_AXIS.PolicyCurrencyCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.PolicyCurrencyPaymentAmount AS NUMERIC(25,10)),\n\tCAST(SRC_AXIS.PaymentCurrencyCode AS VARCHAR(10)),\n\tCAST(SRC_AXIS.PaymentAmount AS NUMERIC(25,10)),\n\t1 AS DUMMY\n\tFROM\n\t(SELECT \n\tCLAIM.dim_claim_key,\n\tCLAIMANT.dim_claimant_key,\n\tLOSS_ITEM.dim_loss_item_key,\n\tLOB.dim_lob_key AS dim_line_of_business_key, \n\tCLAIM_STATUS.dim_claim_status_key AS dim_claim_status_key, \n\tCLAIM_TYPE.dim_claim_type_key AS dim_claim_type_key, \n\tCLAIM_ADJ.dim_claim_adjuster_key,\n\tBDSHP.dim_bdshp_key,\n\tPARTS_PROVIDER.dim_parts_provdr_key,\n\tCLAIM_ANALYST.dim_claim_analyst_key,\n\tINSURED.dim_insured_key,\n\tPARTY.dim_other_party_key AS dim_party_key,  \n\tRECOVERY.dim_recov_type_key AS dim_recov_type_key,\n\tCOVERAGE.dim_cov_key AS dim_cov_key,\n\tBRANCH_OFFICE.dim_branch_office_key AS dim_branch_office_key,\n\t'axis' as sys_cd,\n\tCASE WHEN SRC.CTIPPAG IN (2,3) THEN 'Payment'\n\tWHEN SRC.CTIPPAG IN (7,8) THEN 'Recovery'\n\tELSE 'Other income'\n\tEND AS activity_type_desc,\n\tCAST(CAST(SRC.CTIPPAG AS INT) AS VARCHAR(10)) AS activity_subtype_cd,\n\tDETVALORES.TATRIBU AS activity_subtype_desc,\n\tCASE WHEN SRC.CTIPPAG IN (2,3) THEN SRC.TRECHAZO\n\tWHEN SRC.CTIPPAG IN (7,8) THEN SRC.TOBSERVAREC\n\tELSE NULL\n\tEND AS payment_notes,\n\tNVL(CAST(SRC_PAYMENT_AMT.CEDED_AMOUNT AS NUMERIC(25,10)),0) AS ceded_payment_amt,\n\tNVL(CAST(SRC_PAYMENT_AMT.RETAINED_AMOUNT AS NUMERIC(25,10)),0) AS retained_payment_amt,\n\tNVL(CAST(STG.mkt_ref_code AS VARCHAR(10)),CAST(CAST(SRC.CCONPAG AS INT) AS VARCHAR(10))) AS PaymentTypeCode,\n\tSRC.SPERSON AS PartyIdentifier,\n\tCAST(CAST(SRC.SIDEPAG AS INT) AS VARCHAR(35)) AS PaymentIdentifier,\n\tSRC.NSINIES AS ClaimNumber,\n\tSRC.FORDPAG AS PaymentDate,\n\tNVL(CAST(STG1.mkt_ref_code AS VARCHAR(10)),CAST(CAST(SRC.CFORPAG AS INT)AS VARCHAR(10))) AS PaymentMethodCode,\n\tNVL(CAST(STG2.mkt_ref_code AS VARCHAR(10)),CAST(CAST(SRC.CESTPAG AS INT) AS VARCHAR(10))) AS PaymentStatusCode,\n\tSRC.FENTRAD AS PaymentEntryDate,\n\tSRC.FFACREF AS InvoiceDate,\n\tSRC.FCONTAB AS AccountingPostingDate,\n\tSRC.FMODIFI AS PaymentModificationDate,\n\tNVL(CAST(STG3.mkt_ref_code AS VARCHAR(10)),CAST(SRC.CCONANU AS VARCHAR(10))) AS PaymentCancellationReasonCode,\n\tSRC.TRECHAZO AS PaymentRejectionDescription,\n\tNVL(CAST(STG4.mkt_ref_code AS VARCHAR(10)),CAST(CAST(SRC.CCONINDEM AS INT) AS VARCHAR(10))) AS IndemnityCode,\n\tDETVALORES.TATRIBU AS IndemnityDescription,\n\tCASE WHEN SRC.CESTVAL=1 THEN 'S'\n\tWHEN SRC.CESTVAL=0 THEN 'N'\n\tELSE NULL END AS PaymentValidationIndicator,\n\tSRC.FESTVAL AS PaymentValidationDate,\n\tNVL(CAST(STG5.mkt_ref_code AS VARCHAR(10)),CAST(CAST(SRC.CMEDPAG AS INT) AS VARCHAR(10))) AS PaymentTransferAccountTypeCode,\n\tSRC.FPROBPAG AS EstimatedDateofPayment,\n\tNVL(CAST(STG6.mkt_ref_code AS VARCHAR(10)),CAST(CAST(SRC.CTIPDOC AS INT) AS VARCHAR(10))) AS PaymentDocumentTypeCode,\n\tCAST(SRC.CMONCON AS VARCHAR(10)) AS AccountingCurrencyCode,\n\tCASE WHEN SRC.CTIPPAG IN (3,8,9) THEN CAST((SRC.ISINRETCON * -1) AS NUMERIC(25,10))\n\tELSE CAST(SRC.ISINRETCON AS NUMERIC(25,10)) END AS AccountingCurrencyPaymentAmount,\n\tCAST(SRC.CMONSEG AS VARCHAR(10)) AS PolicyCurrencyCode,\n\tCASE WHEN SRC.CTIPPAG IN (3,8,9) THEN CAST((SRC.ISINRET * -1) AS NUMERIC(25,10))\n\tELSE CAST(SRC.ISINRET AS NUMERIC(25,10)) END AS PolicyCurrencyPaymentAmount,\n\tCAST(SRC.CMONPAG AS VARCHAR(10)) AS PaymentCurrencyCode,\n\tCASE WHEN SRC.CTIPPAG IN (3,8,9) THEN CAST((SRC.ISINRETPAG * -1) AS NUMERIC(25,10))\n\tELSE CAST(SRC.ISINRETPAG AS NUMERIC(25,10)) END AS PaymentAmount,\n\tROW_NUMBER() OVER (PARTITION BY sys_cd,ClaimNumber,PaymentIdentifier ORDER BY SRC.rec_crt_dtm DESC) RNK\n\tFROM cdp_stg_dwh.sisaxis_pagosinitrami SRC\n\tLEFT JOIN cdp_ods.sisaxis_detvalores DETVALORES\n\tON DETVALORES.CATRIBU = SRC.CTIPPAG \n\tAND DETVALORES.cvalor=2  \n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='payment_type') STG\n\tON STG.ref_cd=CAST(CAST(SRC.CCONPAG AS INT) AS VARCHAR(20))\n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='payment_method') STG1\n\tON STG1.ref_cd=CAST(CAST(SRC.CFORPAG AS INT) AS VARCHAR(20))\n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='payment_status') STG2\n\tON STG2.ref_cd=CAST(CAST(SRC.CESTPAG AS INT) AS VARCHAR(20))\n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='payment_cancel_reason') STG3\n\tON STG3.ref_cd=cast(CAST((case when SRC.CCONANU='' then null else SRC.CCONANU end ) AS INT) as varchar(20))\n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='indemnity_code') STG4\n\tON STG4.ref_cd=CAST(CAST(SRC.CCONINDEM AS INT) AS VARCHAR(20))\n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='account_type') STG5\n\tON STG5.ref_cd=CAST(CAST(SRC.CMEDPAG AS INT) AS VARCHAR(20))\n\tLEFT JOIN (SELECT ref_cd,mkt_ref_code FROM cdp_stg_dwh.stg_tref_code_map_variant  WHERE ref_type_cd='document_type') STG6\n\tON STG6.ref_cd=CAST(CAST(SRC.CTIPDOC AS INT) AS VARCHAR(20))\n\tLEFT JOIN  cdp_dwh.dim_claim_t CLAIM\n\tON CLAIM.claim_id=SRC.NSINIES\n\tAND CLAIM.src_sys_cd='axis'\n\tLEFT JOIN cdp_dwh.dim_claimant_t CLAIMANT\n\n\tON CLAIMANT.claim_num=SRC.NSINIES\n\tAND CLAIMANT.src_sys_cd='axis'       --Added for DID-135\n\tAND CLAIMANT.claimant_num=SRC.ntramit\n\n\tLEFT JOIN cdp_dwh.dim_loss_item_t LOSS_ITEM \n\tON  LOSS_ITEM.claim_num=SRC.NSINIES\n\t--AND LOSS_ITEM.loss_item_id=CAST(CAST(SRC.SPERSON AS INT) AS VARCHAR(35)) -- Commented as Per CDP-990\n\tAND LOSS_ITEM.loss_item_num=CAST(SRC.ntramit AS INT)                     \n\tAND LOSS_ITEM.src_sys_cd='axis'\n\tLEFT JOIN cdp_ods.sisaxis_siniestros SINIESTROS\n\tON  SRC.NSINIES = SINIESTROS.NSINIES\n\tLEFT JOIN cdp_dwh.dim_lob_t LOB\n\tON CAST(CAST(SINIESTROS.CRAMO AS INT) AS VARCHAR(20))=LOB.lob_cd\n\tAND LOB.src_sys_cd='axis'\n\t/* LEFT JOIN cdp_dwh.dim_claim_status_t CLAIM_STATUS\n\tON CAST(CAST(SINIESTROS.CESTSIN AS INT) AS VARCHAR(20))=CLAIM_STATUS.claim_status_cd\n\tAND CLAIM_STATUS.src_sys_cd='axis' */\n\tLEFT JOIN\n\t(SELECT CLAIM_STATUS1.CESTADO,CLAIM_STATUS1.FMOVIMI,CLAIM_STATUS1.NSINIES,CLAIM_STATUS1.fordpag,dim_status_key.dim_claim_status_key from\n\t(select CESTADO,FMOVIMI,NSINIES,fordpag from \n        (SELECT DISTINCT CESTADO,FMOVIMI,P.NSINIES,sr.fordpag, \n\tROW_NUMBER() OVER(PARTITION BY P.NSINIES,sr.fordpag ORDER BY FMOVIMI DESC) AS ROW_NUM\n\tFROM cdp_ods.sisaxis_movsiniestro P,cdp_ods.sisaxis_pagosinitrami SR\n\tWHERE P.NSINIES = SR.NSINIES\n\tand cast(FMOVIMI as date) <= cast(SR.FORDPAG as date) ) AB\n\twhere  ROW_NUM =1) CLAIM_STATUS1\n\tleft join\n\tcdp_dwh.dim_claim_status_t dim_status_key\n\ton CAST(CAST(CLAIM_STATUS1.CESTADO AS INT) AS VARCHAR(20)) = dim_status_key.claim_status_cd\n\tAND dim_status_key.src_sys_cd='axis') CLAIM_STATUS\nON CLAIM_STATUS.NSINIES = SRC.NSINIES\nAND CLAIM_STATUS.fordpag = SRC.FORDPAG  --As part of DID_221\n\tLEFT JOIN cdp_dwh.dim_claim_type_t CLAIM_TYPE\n\tON CAST(CAST(SINIESTROS.CCAUSIN AS INT) AS VARCHAR(20))=CLAIM_TYPE.claim_type_cd\n\tAND CLAIM_TYPE.src_sys_cd='axis' \n\tLEFT JOIN cdp_dwh.dim_claim_adjuster_t CLAIM_ADJ\n\tON CLAIM_ADJ.adjuster_id=CAST(SRC.SPERSON AS INT)\n\tand SRC.ctipdes = '4'\n\tAND CLAIM_ADJ.src_sys_cd='axis'\n\t--LEFT JOIN cdp_dwh.dim_bdshp_t BDSHP\n\t--ON BDSHP.bdshp_id=CAST(SRC.SPERSON AS INT)\n\t--AND BDSHP.src_sys_cd='axis'\n\t--and SRC.ctipdes = '3'\n\n\tLEFT JOIN\n\t(SELECT DISTINCT BDSHP2.dim_bdshp_key,BDSHP2.bdshp_id,p.nsinies, p.ntramit,p.SIDEPAG,p.ctipdes,D.CACTPRO,\n\tROW_NUMBER() OVER(PARTITION BY BDSHP2.bdshp_id,p.ctipdes,p.nsinies, p.ntramit,p.SIDEPAG ORDER BY BDSHP2.dim_bdshp_key DESC) AS ROW_NUM\n\tFROM cdp_stg_dwh.sisaxis_pagosinitrami P\n\tINNER JOIN cdp_dwh.dim_bdshp_t BDSHP2\n\tON BDSHP2.bdshp_id=CAST(P.SPERSON AS INT)\n\tAND BDSHP2.src_sys_cd='axis'\n\tand P.ctipdes = '3'\n\tINNER JOIN CDP_ODS.SISAXIS_DESTINATRAMI D\n\tON p.nsinies = d.nsinies AND p.ntramit = d.ntramit AND p.sperson = d.sperson --and D.ctipdes = '3'   ------Commented as per CDP-920\n\tand d.CACTPRO = 90\n\t  ) BDSHP\n\t\t  ON BDSHP.bdshp_id=CAST(SRC.SPERSON AS INT)\n\t\t  AND BDSHP.CACTPRO = 90\n\t\t  and BDSHP.row_num = 1\n\t\t  and SRC.ctipdes = BDSHP.ctipdes\n\t\t  and SRC.nsinies = BDSHP.nsinies\n\t\t  and SRC.SIDEPAG = BDSHP.SIDEPAG\n\t\t  and SRC.ntramit = BDSHP.ntramit\n\t\t  \n\n\t--LEFT JOIN cdp_dwh.dim_parts_provdr_t PARTS_PROVIDER\n\t--ON PARTS_PROVIDER.provdr_id=CAST(SRC.SPERSON AS INT)\n\t--AND PARTS_PROVIDER.src_sys_cd='axis'\n\t--and SRC.ctipdes = '17'\n\n\tLEFT JOIN\n\t(SELECT DISTINCT PARTS_PROVIDER2.dim_parts_provdr_key,PARTS_PROVIDER2.provdr_id,p.ctipdes,p.nsinies, p.ntramit,p.SIDEPAG,D.CACTPRO,\n\tROW_NUMBER() OVER(PARTITION BY PARTS_PROVIDER2.provdr_id,p.ctipdes,p.nsinies, p.ntramit,p.SIDEPAG ORDER BY PARTS_PROVIDER2.dim_parts_provdr_key DESC) AS ROW_NUM\n\tFROM cdp_stg_dwh.sisaxis_pagosinitrami P\n\tINNER JOIN cdp_dwh.dim_parts_provdr_t PARTS_PROVIDER2\n\tON PARTS_PROVIDER2.provdr_id=CAST(P.SPERSON AS INT)\n\tAND PARTS_PROVIDER2.src_sys_cd='axis'\n\tand P.ctipdes = '3'\n\n\tINNER JOIN CDP_ODS.SISAXIS_DESTINATRAMI D\n\tON P.nsinies = D.nsinies AND P.ntramit = D.ntramit AND P.sperson = D.sperson and D.ctipdes = '3'\n\tand D.CACTPRO in (338,340)\n\t  ) PARTS_PROVIDER\n\t\t  ON PARTS_PROVIDER.provdr_id=CAST(SRC.SPERSON AS INT)\n\t\t  and PARTS_PROVIDER.CACTPRO in (338,340)\n\t\t   and PARTS_PROVIDER.row_num = 1\n\t\t   and SRC.ctipdes = PARTS_PROVIDER.ctipdes\n\t\t  and SRC.nsinies = PARTS_PROVIDER.nsinies\n\t\t  and SRC.ntramit = PARTS_PROVIDER.ntramit\n\t\t  and SRC.SIDEPAG = PARTS_PROVIDER.SIDEPAG\n\n\tLEFT JOIN cdp_dwh.dim_claim_analyst_t CLAIM_ANALYST\n\tON CLAIM_ANALYST.claim_analyst_id=CAST(SRC.SPERSON AS INT)\n\tAND CLAIM_ANALYST.src_sys_cd='axis'\n\tLEFT JOIN cdp_dwh.dim_insured_t INSURED\n\tON INSURED.insured_id=CAST(SRC.SPERSON AS INT)\n\tAND INSURED.address_id =1 AND INSURED.src_sys_cd='axis' \n\tand SRC.ctipdes = '1'\n\tLEFT JOIN cdp_dwh.dim_other_party_t PARTY\n\tON PARTY.party_id=CAST(SRC.SPERSON AS INT)\n\tand SRC.ctipdes in ('0','2','5','6','7','8','9','10','16','17')\n\tAND PARTY.src_sys_cd='axis'\n\t--AND SRC.ntramit <> 1 --Added for DID-140\n\tLEFT JOIN cdp_dwh.dim_recov_type_t RECOVERY\n\tON RECOVERY.recov_type_cd=CAST(CAST(CCONPAG AS INT) AS VARCHAR(20)) \n\tAND RECOVERY.src_sys_cd='axis'\n\tLEFT JOIN \n\t(select distinct dim_cov_key, cov_cd,p.sidepag\n\tfrom  cdp_ods.sisaxis_pagogarantrami g \n\tinner join cdp_stg_dwh.sisaxis_pagosinitrami p\n\ton p.sidepag = g.sidepag\n\tinner join cdp_dwh.dim_cov_type_t COVERAGE1\n\tON COVERAGE1.cov_cd=CAST(CAST(g.cgarant AS INT) AS VARCHAR(20))\n\t)COVERAGE ON COVERAGE.sidepag = SRC.sidepag\n\tLEFT JOIN cdp_dwh.dim_branch_office_t BRANCH_OFFICE\n\tON BRANCH_OFFICE.branch_office_cd= CAST(CAST ((CASE WHEN SRC.CSUCURSAL = '' THEN NULL ELSE SRC.CSUCURSAL END)AS INTEGER) AS VARCHAR(20))\n\tAND BRANCH_OFFICE.src_sys_cd='axis'\t\t--DID-134\n\tLEFT JOIN\n\t(\n\tSELECT \n\tCAST((monto * (100 - porc_participacion_cedido - porc_retencion -  porc_ret_shortfall1 -  porc_ret_shortfall2 -  porc_ret_shortfall3) / 100) AS NUMERIC(25,10)) CEDED_AMOUNT ,\n\tCAST((monto * (PORC_RETENCION +  PORC_RET_SHORTFALL1 +  PORC_RET_SHORTFALL2 +  PORC_RET_SHORTFALL3)  / 100 ) AS NUMERIC(25,10)) RETAINED_AMOUNT,\n\tCAST((monto * (porc_participacion_cedido / 100)) AS NUMERIC(25,10)) COINSURANCE_AMOUNT,\n\tsiniestro,\n\timplicado,\n\tpago,\n\tmonto\n\tFROM\n\t(SELECT \n\tsiniestro,\n\timplicado,\n\tcob_basica,\n\tpago,\n\tcmonpag,\n\tctippag,\n\tpoliza,\n\titem,\n\tsseguro,\n\tmovimiento,\n\tmonto,\n\tporc_participacion_cedido,\n\tporc_cp_cedido ,\n\tporc_exc1_cedido,\n\tporc_exc2_cedido,\n\tporc_facul_cedido,\n\tporc_retencion,\n\tmax(porc_ret_shortfall1) porc_ret_shortfall1,\n\tmax(porc_ret_shortfall2) porc_ret_shortfall2,\n\tmax(porc_ret_shortfall3) porc_ret_shortfall3\n\tFROM\n\t(\n\tSELECT \n\tx.nsinies siniestro,\n\t\t   x.ntramit  implicado,\n\t\t   x.cob_basica,\n\t\t   x.sidepag pago,\n\t\t   x.cmonpag,\n\t\t   x.ctippag,\n\t\t   x.npoliza poliza,\n\t\t   x.ncertif item,\n\t\t   x.sseguro,\n\t\t   x.nmovimi movimiento,\n\t\t   x.isinretpag monto,\n\t\t   x.pparcoa porc_participacion_cedido\n\t\t   ,Sum(Round(((100-x.pparcoa)*(case when c.ctramo=1 then c.pcesion else 0 end)*(case when c.ctramo=1 then(100-c.pcuopar) else 0 end))/10000,5)) porc_cp_cedido ,\n\t\t   Sum(Round(((100-x.pparcoa)*(case when c.ctramo=2 then c.pcesion else 0 end))/100,5)) porc_exc1_cedido,\n\t\t   Sum(Round(((100-x.pparcoa)*(case when c.ctramo=3 then c.pcesion else 0 end ))/100,5)) porc_exc2_cedido,\n\t\t   Sum(Round(((100-x.pparcoa)*(case when c.ctramo in (4,5) then c.pcesion else 0 end))/100,5)) porc_facul_cedido\n\t\t   ,\n\t\t  --Sum(Round(((((100-x.pparcoa)*((case when c.ctramo in (0,16,17,18) then c.pcesion else 0 end)/100))+  (case when c.ctramo=1 then c.pcesion * c.pcuopar else 0 end))/10000),5)) porc_retencion,\n\t\t  -- Sum(Round(((((100-x.pparcoa)*((case when c.ctramo in (0,16,17,18) then c.pcesion else 0 end)/100))+  (case when c.ctramo=1 then c.pcesion * c.pcuopar else 0 end))/10000),5)) porc_retencion,\n\t\t  --This is first half+second half--Sum(Round((((100-x.pparcoa)*(case when c.ctramo in (0,16,17,18) then c.pcesion else 0 end )/100) + ((case when c.ctramo=1 then c.pcesion * c.pcuopar else 0 end)/10000)),5)) porc_retencion,\n\t\t  --This is first and then two sums\n\t\t   Sum(Round((100-x.pparcoa)*(((case when c.ctramo in (0,16,17,18) then c.pcesion else 0 end )/100) + ((case when c.ctramo=1 then c.pcesion * c.pcuopar else 0 end)/10000)),5)) porc_retencion,\n\t\t   \n\t\t   \n\t\t   Nvl(Sum(Round(((100-x.pparcoa)*Decode(c.ctramo,1,1,0)*c.pcesion*u.pcesion)/10000,5)),0) porc_ret_shortfall1,\n\t\t   Nvl(Sum(Round(((100-x.pparcoa)*Decode(c.ctramo,2,1,0)*c.pcesion*u.pcesion)/10000,5)),0) porc_ret_shortfall2,\n\t\t   Nvl(Sum(Round(((100-x.pparcoa)*Decode(c.ctramo,3,1,0)*c.pcesion*u.pcesion)/10000,5)),0) porc_ret_shortfall3\n\t\t\t\n\t\t -- ,x.pparcoa,c.ctramo,c.pcesion,c.pcuopar\n\n\n\t  FROM CDP_ODS.SISAXIS_garancontra g \n\t  inner join CDP_ODS.SISAXIS_cesionesrea c\n\t\t   on g.scontra  = c.scontra\n\t\t   inner join\n\n\t(\n\tSELECT s.npoliza,\n\t\t\t\t   s.ncertif,\n\t\t\t\t   i.sseguro,\n\t\t\t\t   p.nsinies,\n\t\t\t\t   p.ntramit,\n\t\t\t\t   p.sidepag,\n\t\t\t\t   p.cmonpag,\n\t\t\t\t   p.isinretpag,\n\t\t\t\t   p.ctippag,\n\t\t\t\t   case when s.ctipcoa=1 then s.pparcoa else 0 end pparcoa,\n\t\t\t\t   CASE WHEN g.cgarant IN (9999,9998) THEN\n\t\t\t\t   Nvl(a1.cgarant,a2.cgarant,0)\n\t\t\t\t\t\t\t\t\tELSE g.CGARANT END cob_basica\n\t\t\t\t\t\t\t\t\t,nvl(n.nmovimi,1) nmovimi \n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t   FROM CDP_ODS.SISAXIS_seguros s\n\t\t\t\t   INNER JOIN CDP_ODS.SISAXIS_siniestros i\n\t\t\t\t   ON S.SSEGURO = I.SSEGURO\n\t\t\t\t   INNER JOIN CDP_ODS.SISAXIS_pagosinitrami p\n\t\t\t\t   ON i.nsinies = p.nsinies\n\t\t\t\t   INNER JOIN CDP_ODS.SISAXIS_pagogarantrami g\n\t\t\t\t   ON p.sidepag = g.sidepag\n\t\t\t\t   LEFT JOIN\n\t(\n\tSELECT DISTINCT res.cgarant,res.nsinies,res.ntramit,\n\trow_number() over(partition by res.nsinies,res.ntramit order by res.cgarant asc) as row_num\n\tFROM CDP_ODS.SISAXIS_reservasinitrami res\n\tWHERE --res.nsinies  = p.nsinies\n\t-- AND res.ntramit  = p.ntramit\n\tres.fresfin IS NULL\n\tAND res.cgarant NOT IN (9999,9998)\n\tAND EXISTS (SELECT 'X'FROM CDP_ODS.SISAXIS_reservasinitrami res1\n\tWHERE res1.ntramit = res.ntramit\n\tAND res1.nsinies = res.nsinies\n\tAND res1.fresfin is null\n\tAND res1.cgarant in (9999,9998))) a1\n\tON a1.nsinies =p.nsinies\n\tand a1.ntramit =p.ntramit\n\tand a1.row_num = '1'\n\n\tleft join\n\n\n\t(SELECT gar.cgarant,tra.ntramit as ntramit,tra.nsinies as nsinies  \n\t,row_number() over(partition by sin.nsinies,tra.ntramit order by gar.cgarant asc) as row_num\n\tFROM \n\tcdp_ods.SISAXIS_garanprotramit gar, \n\t cdp_ods.SISAXIS_garanseg cob, \n\tcdp_ods.SISAXIS_seguros seg,\n\tcdp_ods.SISAXIS_tramitacionsini tra, \n\tcdp_ods.SISAXIS_siniestros sin\n\t\t\t\t\t\t\t\t\t\t\tWHERE gar.ctramit = tra.ctramit\n\t\t\t\t\t\t\t\t\t\t\t  AND gar.cactivi = seg.cactivi\n\t\t\t\t\t\t\t\t\t\t\t  AND gar.sproduc = seg.sproduc\n\t\t\t\t\t\t\t\t\t\t\t  AND gar.cgarant = cob.cgarant\n\t\t\t\t\t\t\t\t\t\t\t  AND cob.nmovimi = sin.nmovimi\n\t\t\t\t\t\t\t\t\t\t\t  AND cob.nriesgo = sin.nriesgo\n\t\t\t\t\t\t\t\t\t\t\t  AND cob.sseguro = sin.sseguro\n\t\t\t\t\t\t\t\t\t\t\t  AND seg.sseguro = sin.sseguro\n\t\t\t\t\t\t\t\t\t\t\t  --AND tra.ntramit = p.ntramit\n\t\t\t\t\t\t\t\t\t\t\t  AND tra.nsinies = sin.nsinies\n\t\t\t\t\t\t\t\t\t\t\t  --and sin.nsinies = '1000652'\n\t\t\t\t\t\t\t\t\t\t\t  --AND sin.nsinies =  p.nsinies\n\t\t\t\t\t\t\t\t\t\t\t ) a2 \n\t\t\t\t\t\t\t\t\t\t\t  on a2.ntramit=p.ntramit\n\t\t\t\t\t\t\t\t\t\t\t  and a2.nsinies=p.nsinies\n\t\t\t\t\t\t\t\t\t\t\t  and a2.row_num = 1\n\t\t\t\t\t\t\t\t\t\t\t  \n\n\tleft join\n\t(SELECT Nvl(Max(nmovigen),1) as nmovimi,i.sseguro,i.nsinies\n\t\t\t\t   from cdp_ods.SISAXIS_cesionesrea c\n\t\t\t\t   inner join cdp_ods.SISAXIS_siniestros i\n\t\t\t\t\ton cast(c.fcontab as date) <= cast(i.fsinies as date)\n\t\t\t\t\t   AND c.sseguro  = i.sseguro\n\t\t\t\t\t   AND c.cgenera IN (3,4,9,40) group by i.sseguro,i.nsinies ) n\n\t\t\t  on i.sseguro = n.sseguro\n\t\t\t  and i.nsinies = n.nsinies\n\n\t)X\n\ton\n\tg.cgarant  = x.cob_basica\n\t\t AND g.nmovimi  = x.nmovimi\n\t\t AND g.sseguro  = x.sseguro\n\t\t AND c.cgenera IN (3,4,9,40)\n\t\t AND c.nmovigen = x.nmovimi\n\t\t AND c.sseguro  = x.sseguro\n\n\tleft join\n\n\tCDP_ODS.SISAXIS_cuadroces u\n\tON u.ctramo   = c.ctramo\n\tAND u.scontra  = c.scontra\n\tAND u.nversio  = c.nversio\n\tAND u.ccompani = 1\n\n\n\t   GROUP BY x.npoliza,\n\t\t\t\tx.ncertif,\n\t\t\t\tx.sseguro,\n\t\t\t\tx.nsinies,\n\t\t\t\tx.ntramit,\n\t\t\t\tx.sidepag,\n\t\t\t\tx.cmonpag,\n\t\t\t\tx.ctippag,\n\t\t\t\tx.cob_basica,\n\t\t\t\tx.nmovimi,\n\t\t\t\tx.isinretpag,\n\t\t\t\tx.pparcoa\n\t)z\n\n\t   GROUP BY siniestro,\n\timplicado,\n\tcob_basica,\n\tpago,\n\tcmonpag,\n\tctippag,\n\tpoliza,\n\titem,\n\tsseguro,\n\tmovimiento,\n\tmonto,\n\tporc_participacion_cedido,\n\tporc_cp_cedido ,\n\tporc_exc1_cedido,\n\tporc_exc2_cedido,\n\tporc_facul_cedido,\n\tporc_retencion\n\t) SRC1\n\t) SRC_PAYMENT_AMT\n\tON SRC_PAYMENT_AMT.siniestro=SRC.NSINIES \n\tAND SRC_PAYMENT_AMT.pago=SRC.SIDEPAG\n\t) AS SRC_AXIS\n\tWHERE SRC_AXIS.RNK=1\n\t)SRC_1\n\tLEFT JOIN (SELECT 1 as DUMMY, max(fact_claim_payment_key) AS MAX_SID from cdp_dwh.fact_claim_payment_activity_t) LKP\n\tON LKP.DUMMY=SRC_1.DUMMY"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT\nSTG.fact_claim_payment_key,\nSTG.src_sys_cd,\nSTG.claim_num,\nSTG.payment_id\nFROM  cdp_dwh.fact_claim_payment_activity_t STG\nWHERE STG.src_sys_cd='axis'"
    }
]