[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\nsrc_sys_cd,\nclaim_id,\nclaim_num,\ncat_event_cd,\ncat_event_name,\ncat_event_type_desc,\ncause_of_loss_cd,\ncause_of_loss_desc,\nclaim_status_cd,\ndim_claim_status_key,\nclaim_type_cd,\ndim_claim_type_key,\nincident_comuna_cd,\nincident_comuna_name,\nincident_region_code,\ndim_region_key,\nfnol_channel_cd,\nfnol_channel_desc,\nfnol_dt,\nincident_dt,\nline_of_business_cd,\ndim_lob_key, --Added as part of BA-2,CDP-226 change\nbranch_office_cd,\ndim_branch_office_key,\npolicy_num,\npolicy_id,\ninsured_item_num,\ninsured_item_id,\nactv_rec_ind,\n--src_rec_crt_dtm,\t\t\t   /*Commented as part of sprint 3 on 18/2/2019*/\nsrc_sys_entry_dt,            /*Added as part of sprint 3 on 18/2/2019*/\nagreement,\nMAX_SID\nfrom\n(\nselect \nsrc.src_sys_cd,\nsrc.claim_id,\nsrc.claim_num,\nsrc.cat_event_cd,\nsrc.cat_event_name,\nsrc.cat_event_type_desc,\nsrc.cause_of_loss_cd,\nsrc.cause_of_loss_desc,\nsrc.claim_status_cd,\nsrc.dim_claim_status_key,\nsrc.claim_type_cd,\nsrc.dim_claim_type_key,\ncast(src.incident_comuna_cd as varchar(10)) as incident_comuna_cd ,\ncast(src.incident_comuna_name as varchar(100)) as incident_comuna_name,\ncast(src.incident_region_code as varchar(10)) as incident_region_code,\nsrc.dim_region_key,\nsrc.fnol_channel_cd,\nsrc.fnol_channel_desc,\nsrc.fnol_dt,\nsrc.incident_dt,\nsrc.line_of_business_cd,\nsrc.dim_lob_key, --Added as part of BA-2,CDP-226 change\nsrc.branch_office_cd,\nsrc.dim_branch_office_key,\nsrc.policy_num,\nsrc.policy_id,\nsrc.insured_item_num,\nsrc.insured_item_id,\n'Y' as actv_rec_ind,\nsrc.rec_crt_dtm as src_rec_crt_dtm,\nsrc.src_sys_entry_dt AS src_sys_entry_dt,           /*Added as part of sprint 3 on 18/2/2019*/\nLKP_MAXSID.MAX_SID,\nsrc.agreement,\nrow_number() over (partition by src.claim_id order by src.rec_crt_dtm desc) as row_cnt\nfrom\n(\nselect \ndistinct\ncast('axis' as varchar(10)) as src_sys_cd,\ncast(siniestros.NSINIES as integer) as claim_id,\ncast(siniestros.NSINIES as varchar(35)) as claim_num,\ncast(NVL(NVL(cat_event.mkt_ref_code,siniestros.CCATAST),'') as varchar(10)) as cat_event_cd,\ncast(NVL(NVL(cat_event.mkt_ref_code_desc,cat_event.ref_desc),'') as varchar(200)) as cat_event_name,\ncast('' as varchar(80)) as cat_event_type_desc,\ncast(NVL(cause_of_loss.mkt_ref_code,cast(CAST(siniestros.cramo AS INT)||CAST(siniestros.ccausin AS INT)||CAST(siniestros.cmotsin AS INT) as varchar(20))) as varchar(20)) as cause_of_loss_cd,\ncast(NVL(NVL(cause_of_loss.mkt_ref_code_desc,cause_of_loss.ref_desc),'') as varchar(80)) as cause_of_loss_desc,\ncast(NVL(NVL(claim_status.mkt_ref_code,CAST(cast(siniestros.CESTSIN as INT)AS varchar(10))),'') as varchar(10)) as claim_status_cd,\ncast(dim_claim_status.dim_claim_status_key as integer) as dim_claim_status_key,\n--cast(NVL(NVL(claim_type.mkt_ref_code,CAST(cast(siniestros.CCAUSIN as INT)AS varchar(10))),'') as varchar(10)) as claim_type_cd, --Commented as part of BA-2, CDP-227 change\nCAST(cast(siniestros.CCAUSIN as INT) AS varchar(10)) as claim_type_cd,\ncast(dim_claim_type.dim_claim_type_key as integer) as dim_claim_type_key,\n--cast(NVL(NVL(incident_comun.mkt_ref_code,CAST(cast(localizatrami_comuna.CPOBLAC as INT) AS varchar(10))),'') as varchar(10)) as incident_comuna_cd, --Commented as part of BA-2,CDP-223 change\ncase when (length(siniestros.tntfref)=0  and cast(localizatrami_comuna.CPOBLAC as INT) =0) then null\nwhen (length(siniestros.tntfref)=0 and cast(localizatrami_comuna.CPOBLAC as INT) > 0) then cast(NVL(NVL(incident_comun.mkt_ref_code,CAST(cast(localizatrami_comuna.CPOBLAC as INT) AS varchar(10))),'') as varchar(10))\nwhen length(siniestros.tntfref)>0 then null end as incident_comuna_cd,\n--cast(NVL(NVL(incident_comun.mkt_ref_code_desc,incident_comun.ref_desc),'') as varchar(100)) as incident_comuna_name, --Commented as part of BA-2,CDP-223 change\ncase when (length(siniestros.tntfref)=0  and cast(localizatrami_comuna.CPOBLAC as INT) =0) then null\nwhen (length(siniestros.tntfref)=0 and cast(localizatrami_comuna.CPOBLAC as INT) > 0) then cast(NVL(NVL(incident_comun.mkt_ref_code_desc,incident_comun.ref_desc),'') as varchar(100))\nwhen length(siniestros.tntfref)>0 then null end as incident_comuna_name,\n--cast(NVL(NVL(region.mkt_ref_code,cast(cast(localizatrami_comuna.CPROVIN as int) as varchar(10))),'') as varchar(10)) as incident_region_code, --Commented as part of BA-2,CDP-223 change\ncase when (length(siniestros.tntfref)=0  and cast(localizatrami_comuna.CPOBLAC as INT) =0) then null\nwhen (length(siniestros.tntfref)=0 and cast(localizatrami_comuna.CPOBLAC as INT) > 0) then cast(NVL(NVL(region.mkt_ref_code,cast(cast(localizatrami_comuna.CPROVIN as int) as varchar(10))),'') as varchar(10))\nwhen length(siniestros.tntfref)>0 then null end as incident_region_code,\ncast(dim_region.dim_region_key as integer) as dim_region_key,\ncast(NVL(NVL(comm_channel.mkt_ref_code,cast(CAST(siniestros.CNTFVIA AS INT) as varchar(10))),'') AS VARCHAR(10)) as fnol_channel_cd,\ncast(NVL(NVL(comm_channel.mkt_ref_code_desc,comm_channel.ref_desc),'') as varchar(80)) as fnol_channel_desc,\nsiniestros.FNOTIFI as fnol_dt,\nsiniestros.FSINIES as incident_dt,\ncast(cast(siniestros.CRAMO as int) as varchar(10)) as line_of_business_cd,\ncast(dim_lob.dim_lob_key as integer) as dim_lob_key, --Added as part of BA-2,CDP-226 change\ncast(NVL(NVL(branch_office.mkt_ref_code,right( '00000000' + cast( substring(siniestros.CTRAINT,2) as varchar), 8)),'') as varchar(10)) as branch_office_cd,\ncast(dim_branch_office.dim_branch_office_key as integer) as dim_branch_office_key,\ncast(cast(seguros.NPOLIZA as int) as varchar(35)) as policy_num,\ncast(siniestros.SSEGURO as integer) as policy_id,\ncast(seguros.NCERTIF as integer) as insured_item_num,\ncast(seguros.NCERTIF as integer) as insured_item_id,\nsiniestros.rec_crt_dtm,\nsiniestros.FENTRAD as src_sys_entry_dt,  /*Added as part of sprint 3 on 18/2/2019*/\nCASE WHEN seguros.NCERTIF>0 THEN seguros.CAGRSEG\nELSE NULL END  AS agreement, /*Modified as part of CISD-16754*/\n1 as dummy\nfrom \ncdp_stg_dwh.sisaxis_siniestros siniestros\nleft join cdp_ods.sisaxis_seguros seguros\non siniestros.SSEGURO = seguros.SSEGURO \t\t\nleft join \n(select ref_cd,mkt_ref_code,ref_desc,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='cat_event' and src_sys_cd = 'axis')cat_event\non siniestros.CCATAST=cat_event.ref_cd\nleft join \n(select ref_cd,mkt_ref_code,ref_desc,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='cause_of_loss' and src_sys_cd = 'axis')cause_of_loss\non cast(CAST(siniestros.cramo AS INT)||CAST(siniestros.ccausin AS INT)||CAST(siniestros.cmotsin AS INT) as varchar(20))=cause_of_loss.ref_cd\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='claim_status' and src_sys_cd = 'axis') claim_status\non  CAST(cast(siniestros.CESTSIN as INT)AS varchar(20)) = claim_status.ref_cd\nleft join \n(select dim_claim_status_key,claim_status_cd from cdp_dwh.dim_claim_status_t where src_sys_cd='axis') dim_claim_status\non  CAST(cast(siniestros.CESTSIN as INT)AS varchar(10)) = dim_claim_status.claim_status_cd\n/*left join  --Commented as part of BA-2,CDP-227 change\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='claim_type' and src_sys_cd = 'axis') claim_type\non  CAST(cast(siniestros.CCAUSIN as INT) AS varchar(20)) = claim_type.ref_cd*/\nleft join \n(select dim_claim_type_key,claim_type_cd from cdp_dwh.dim_claim_type_t where src_sys_cd='axis') dim_claim_type\non CAST(cast(siniestros.CCAUSIN as INT)AS varchar(20)) = dim_claim_type.claim_type_cd\nleft join\n(select NSINIES,CPOBLAC,CPROVIN from cdp_ods.sisaxis_localizatrami where ntramit=0) localizatrami_comuna\non siniestros.NSINIES=localizatrami_comuna.NSINIES\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna' and src_sys_cd = 'axis') incident_comun\non CAST(cast(localizatrami_comuna.CPOBLAC as INT) AS varchar(20))=incident_comun.ref_cd\nleft join \n(select ref_cd,mkt_ref_code from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region' and src_sys_cd = 'axis') region\non cast(cast(localizatrami_comuna.CPROVIN as int) as varchar(20))=region.ref_cd\nleft join cdp_dwh.dim_region_t dim_region\non NVL(region.mkt_ref_code,cast(cast(localizatrami_comuna.CPROVIN as int) as varchar(20))) = dim_region.region_cd\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comm_channel' and src_sys_cd = 'axis') comm_channel\non cast(CAST(siniestros.CNTFVIA AS INT) as varchar(20))=comm_channel.ref_cd\nleft join \n(select ref_cd,mkt_ref_code from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='branch_office' and src_sys_cd = 'axis') branch_office\non right( '00000000' + cast( substring(siniestros.CTRAINT,2) as varchar), 8)=branch_office.ref_cd\nleft join \n(select dim_branch_office_key,branch_office_cd from cdp_dwh.dim_branch_office_t where src_sys_cd='axis') dim_branch_office\non NVL(branch_office.mkt_ref_code,right( '00000000' + cast( substring(siniestros.CTRAINT,2) as varchar), 8)) = dim_branch_office.branch_office_cd\nleft join \n(select dim_lob_key,lob_cd from  cdp_dwh.dim_lob_t where src_sys_cd='axis') dim_lob --Added as part of BA-2,CDP-226 change\non dim_lob.lob_cd=cast(cast(siniestros.CRAMO as int) as varchar(10))\n/*left join  --Commented as part of CISD-16754\n(select distinct policy_num,dim_broker_key,dim_prd_pln_hrchy_key,dim_policyholder_key,agreement \nfrom cdp_dwh.fact_policy_prem_comm_summary_t\nwhere src_sys_cd='axis' ) fact_sales\non seguros.NPOLIZA=cast(fact_sales.policy_num as INTEGER)*/ \n) src\nleft join\n(select 1 as dummy, max(dim_claim_key) as MAX_SID from cdp_dwh.dim_claim_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy\n) where row_cnt = 1"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "select src.dim_claim_key,src.src_sys_cd,src.claim_id from cdp_dwh.dim_claim_t src where src.src_sys_cd='axis'"
    }
]