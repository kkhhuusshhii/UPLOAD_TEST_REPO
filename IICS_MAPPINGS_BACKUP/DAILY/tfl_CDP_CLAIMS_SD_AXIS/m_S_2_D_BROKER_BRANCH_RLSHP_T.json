[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\nrlshp_src_id,\nentity_type_cd,\nentity_type_desc,\nactv_rlshp_ind,\nrlshp_end_dt,\nentity_name,\nentity_rut_num,\nentity_id,\ncontact_name,\ncontact_email,\ncontact_phone,\nbranch_office_src_cd,\nlast_modified_dt,\nsrc_sys_cd,\nrec_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\nMAX_SID\nfrom\n(\nselect\ndistinct \nsrc.rlshp_src_id,\nsrc.entity_type_cd,\nsrc.entity_type_desc,\nsrc.actv_rlshp_ind,\nsrc.rlshp_end_dt,\ntranslate(src.entity_name,'#','') as entity_name,\nsrc.entity_rut_num,\nsrc.entity_id,\nsrc.contact_name,\nsrc.contact_email,\nsrc.contact_phone,\nsrc.branch_office_src_cd,\nsrc.last_modified_dt,\nsrc.src_sys_cd,\nsrc.rec_crt_dtm,\nsrc.rec_updt_dtm,\n--src.etl_audit_id,\n'Y' as actv_rec_ind,\nLKP_MAXSID.MAX_SID,\nrow_number() over (partition by src.rlshp_src_id order by order_num asc ,src.last_modified_dt desc) as row_cnt\nfrom\n(\nselect\ndistinct \ncast (a.CAGENTE as varchar(10)) as rlshp_src_id,\n--cast(cast(a.CTIPAGE as integer) as varchar(10)) as entity_type_cd,\ncast(NVL(cast(RD.mkt_ref_code as integer),cast(a.ctipage as integer) ) as varchar(10)) as entity_type_cd,\n--cast(c.TTIPAGE as varchar(80)) as entity_type_desc, \n cast(NVL(RD.mkt_ref_code_desc,RD.ref_desc)as varchar(80)) as entity_type_desc,\ncast(cast (a.CACTIVO as integer) as char(1)) as actv_rlshp_ind,\ncast(a.FBAJAGE as date) as rlshp_end_dt,\ncast(rtrim(b.TBUSCAR,'#') as varchar(100)) as entity_name,\ncast(b.NNUMNIF as varchar(35)) as entity_rut_num,\ncast(cast(b.SPERSON as integer) as varchar(50)) as entity_id,\ncast(null as varchar(100)) as contact_name,\ncast(null as varchar(100)) as contact_email, \ncast(null as varchar(35)) as  contact_phone,\ncast(ltrim(right(a.CAGENTE,3),'0') as varchar(50)) as branch_office_src_cd,  -- fixed after uat issue\nb.FMODIFY as last_modified_dt,\ncast('axis' as varchar(10)) as src_sys_cd,\ncurrent_date as rec_crt_dtm,\ncurrent_date as rec_updt_dtm,\ncast('1' as integer) as order_num,\n1 as dummy\nfrom  cdp_stg_dwh.sisaxis_agentes a\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='entity_type_cd' and src_sys_cd = 'axis')RD\non trim(RD.ref_cd)=trim(cast(cast(a.CTIPAGE as integer) as varchar(10)))\ninner join\ncdp_ods.SISAXIS_PERSONAS b\non cast(a.sperson as integer)=cast(b.sperson as integer)\n\n\nunion\n\nselect\ndistinct \ncast (a.CAGENTE as varchar(10)) as rlshp_src_id,\n--cast(cast(a.CTIPAGE as integer) as varchar(10)) as entity_type_cd,\ncast(NVL(cast(RD.mkt_ref_code as integer),cast(a.ctipage as integer) ) as varchar(10)) as entity_type_cd,\n--cast(c.TTIPAGE as varchar(80)) as entity_type_desc, \n cast(NVL(RD.mkt_ref_code_desc,RD.ref_desc)as varchar(80)) as entity_type_desc,\ncast(cast (a.CACTIVO as integer) as char(1)) as actv_rlshp_ind,\ncast(a.FBAJAGE as date) as rlshp_end_dt,\ncast(rtrim(b.TBUSCAR,'#') as varchar(100)) as entity_name,\ncast(b.NNUMNIF as varchar(35)) as entity_rut_num,\ncast(cast(b.SPERSON as integer) as varchar(50)) as entity_id,\ncast(null as varchar(100)) as contact_name,\ncast(null as varchar(100)) as contact_email, \ncast(null as varchar(35)) as  contact_phone,\ncast(ltrim(right(a.CAGENTE,3),'0') as varchar(50)) as branch_office_src_cd, -- fixed after uat issue\nb.FMODIFY as last_modified_dt,\ncast('axis' as varchar(10)) as src_sys_cd,\ncurrent_date as rec_crt_dtm,\ncurrent_date as rec_updt_dtm,\ncast('2' as integer) as order_num,\n1 as dummy\nfrom  cdp_stg_dwh.SISAXIS_PERSONAS b \n\ninner join\ncdp_ods.sisaxis_agentes a\non cast(a.sperson as integer)=cast(b.sperson as integer)\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='entity_type_cd' and src_sys_cd = 'axis')RD\non trim(RD.ref_cd)=trim(cast(cast(a.CTIPAGE as integer) as varchar(10)))\n\n) src\nleft join\n(select 1 as dummy, max(broker_branch_rlshp_key) as MAX_SID from cdp_dwh.broker_branch_rlshp_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy\n) where row_cnt = 1"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "select \nsrc.broker_branch_rlshp_key,\nsrc.rlshp_src_id,\nsrc.src_sys_cd\nfrom cdp_dwh.broker_branch_rlshp_t src\nwhere src.src_sys_cd='axis'"
    }
]