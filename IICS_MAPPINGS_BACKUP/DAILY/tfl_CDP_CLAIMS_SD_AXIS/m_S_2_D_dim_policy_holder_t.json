[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\nsrc_sys_cd,\npolicyholder_rut_num,\npolicyholder_id,\n--policyholder_name,\nreplace(policyholder_name,'\"\"','\"') policyholder_name,\n--address_desc,\ncase \nwhen regexp_count(address_desc,'\"')=2  then replace(address_desc,'\"\"','\"')\nwhen regexp_count(address_desc,'\"')=4  then replace(address_desc,'\"\"','\"') \nwhen regexp_count(address_desc,'\"')=4  then replace(address_desc,'\"\"\"\"','\"\"') \nwhen regexp_count(address_desc,'\"')=8  then replace(address_desc,'\"\"\"\"','\"\"')\nwhen regexp_count(address_desc,'\"')=8  then replace(address_desc,'\"\"\"\"\"\"\"\"','\"\"\"\"') \nwhen regexp_count(address_desc,'\"')=16 then replace(address_desc,'\"\"\"\"\"\"\"\"','\"\"\"\"')\nwhen regexp_count(address_desc,'\"')=16 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"')  \nwhen regexp_count(address_desc,'\"')=32 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"')\nwhen regexp_count(address_desc,'\"')=32 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"')\nwhen regexp_count(address_desc,'\"')=64 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"')\nwhen regexp_count(address_desc,'\"')=64 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"') else address_desc end address_desc,\npostal_cd,\nregion_cd,\ncomuna_cd,\ncity_cd,\ncntry_cd,\ncomuna_name,\nregion_name,\ncntry_desc,\ncity_name,\nactv_rec_ind,\ngender_cd,\ngender_desc,\nbirth_dt,\nperson_type_cd,\nperson_type_desc,\nmax_sid\nfrom (\nselect \nsrc.src_sys_cd,\nsrc.policyholder_rut_num,\nsrc.policyholder_id,\n--src.policyholder_name,\ncase when strpos(src.policyholder_name,'\"')=1 then substring(substring(src.policyholder_name,1,length(src.policyholder_name)-1),2) else src.policyholder_name end policyholder_name,\n--src.address_desc,\ncase when strpos(src.address_desc,'\"')=1 then substring(substring(src.address_desc,1,length(src.address_desc)-1),2)||'##' else src.address_desc||'##' end address_desc,\nsrc.postal_cd,\nsrc.region_cd,\nsrc.comuna_cd,\nsrc.city_cd,\nsrc.cntry_cd,\nsrc.comuna_name,\nsrc.region_name,\nsrc.cntry_desc,\nsrc.city_name,\nsrc.actv_rec_ind,\nsrc.gender_cd,\nsrc.gender_desc,\nsrc.birth_dt,\nsrc.person_type_cd,\nsrc.person_type_desc,\nLKP_MAX_KEY.max_sid,\nrow_number()over(partition by src.policyholder_id order by src.last_modified_dt desc ) as row_cnt \nfrom (\nselect distinct\ncast('axis' as varchar(10)) as src_sys_cd,\ncast(a.NNUMNIF as varchar(35)) as policyholder_rut_num,\n--cast(cast(b.SPERSON as integer)||'-'||cast(b.CDOMICI as integer) as varchar(35)) as policyholder_id,\ncast(cast(b.SPERSON as integer)||'-'||cast(nvl(b.CDOMICI,0) as integer) as varchar(35)) as policyholder_id,\n--cast(trim('##' from a.TBUSCAR) as varchar(100)) as policyholder_name,\n--cast(translate(a.TBUSCAR,'#','') as varchar(100)) as policyholder_name,\ncast(a.TBUSCAR as varchar(255)) as policyholder_name,\ncast(e.TDOMICI as varchar(150)) as address_desc,\ncast(e.CPOSTAL as varchar(10)) as postal_cd,\ncast(cast(e.CPROVIN as integer) as varchar(10)) as region_cd,\ncast(cast(e.CPOBLAC as integer) as varchar(10)) AS comuna_cd,\ncast(cast(e.CCIUDAD as integer)  as varchar(10)) as city_cd,\ncast(cast(e.CPAIS as integer) as varchar(10)) as cntry_cd,\ncast (j.REF_DESC as varchar(35)) as comuna_name,\ncast (k.REF_DESC as varchar(100))AS region_name,\ncast (l.REF_DESC as varchar(80))AS cntry_desc,\ncast (m.REF_DESC as varchar(35))AS city_name,\n'Y' as actv_rec_ind,\na.fmodify as last_modified_dt,  \ncast(a.CSEXPER as VARCHAR(10))as gender_cd,\ncast(n.REF_DESC as VARCHAR(80))as gender_desc,\ncast(a.FNACIMI as date)as birth_dt,\ncast(a.CPERTIP as VARCHAR(10))as person_type_cd,\ncast(o.REF_DESC as VARCHAR(80))as person_type_desc,\n1 as dummy\nfrom cdp_stg_dwh.SISAXIS_TOMADORES b\ninner join cdp_ods.SISAXIS_seguros d\non d.sseguro=b.sseguro\nand d.NCERTIF>0 /**Modified FOR CDP-2304**/\nleft join cdp_ods.SISAXIS_PERSONAS a\non b.SPERSON=a.SPERSON\nleft join cdp_ods.SISAXIS_DIRECCIONES e\non e.sperson=b.sperson\nand e.CDOMICI=b.CDOMICI\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna'and src_sys_cd = 'axis') j\non cast(cast(e.cpoblac as integer) as varchar(10))=j.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region'and src_sys_cd = 'axis') k\non cast(cast (e.cprovin as integer) as varchar(10))=k.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='country'and src_sys_cd = 'axis') l\non cast(cast (e.CPAIS as integer) as varchar(10))=l.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='city_cd'and src_sys_cd = 'axis') m\non cast(cast (e.CCIUDAD as integer) as varchar(10))=m.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='gender_cd'and src_sys_cd = 'axis') n\non cast(cast (a.CSEXPER as integer) as varchar(10))=n.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='person_type_cd'and src_sys_cd = 'axis') o\non cast(cast (a.CPERTIP as integer) as varchar(10))=o.REF_CD\n\n\nunion\n\nselect distinct\ncast('axis' as varchar(10)) as src_sys_cd,\ncast(a.NNUMNIF as varchar(35)) as policyholder_rut_num,\n--cast(cast(b.SPERSON as integer)||'-'||cast(b.CDOMICI as integer) as varchar(35)) as policyholder_id,\ncast(cast(b.SPERSON as integer)||'-'||cast(nvl(b.CDOMICI,0) as integer) as varchar(35)) as policyholder_id,\n--cast(trim('##' from a.TBUSCAR) as varchar(100)) as policyholder_name,\n--cast(translate(a.TBUSCAR,'#','') as varchar(100)) as policyholder_name,\ncast(a.TBUSCAR as varchar(255)) as policyholder_name,\ncast(e.TDOMICI as varchar(150)) as address_desc,\ncast(e.CPOSTAL as varchar(10)) as postal_cd,\ncast(cast(e.CPROVIN as integer) as varchar(10)) as region_cd,\ncast(cast(e.CPOBLAC as integer) as varchar(10)) AS comuna_cd,\ncast(cast(e.CCIUDAD as integer)  as varchar(10)) as city_cd,\ncast(cast(e.CPAIS as integer) as varchar(10)) as cntry_cd,\ncast (j.REF_DESC as varchar(35)) as comuna_name,\ncast (k.REF_DESC as varchar(100))AS region_name,\ncast (l.REF_DESC as varchar(80))AS cntry_desc,\ncast (m.REF_DESC as varchar(35))AS city_name,\n'Y' as actv_rec_ind,\na.fmodify as last_modified_dt,\ncast(a.CSEXPER as VARCHAR(10))as gender_cd,\ncast(n.REF_DESC as VARCHAR(80))as gender_desc,\ncast(a.FNACIMI as date)as birth_dt,\ncast(a.CPERTIP as VARCHAR(10))as person_type_cd,\ncast(o.REF_DESC as VARCHAR(80))as person_type_desc,\n1 as dummy\nfrom cdp_ods.SISAXIS_TOMADORES b\ninner join cdp_ods.SISAXIS_seguros d\non d.sseguro=b.sseguro\nand d.NCERTIF>0 /**Modified FOR CDP-2304**/\ninner join cdp_stg_dwh.SISAXIS_PERSONAS a\non b.SPERSON=a.SPERSON\nleft join cdp_ods.SISAXIS_DIRECCIONES e\non e.sperson=b.sperson\nand e.CDOMICI=b.CDOMICI\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna'and src_sys_cd = 'axis') j\non cast(cast(e.cpoblac as integer) as varchar(10))=j.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region'and src_sys_cd = 'axis') k\non cast(cast (e.cprovin as integer) as varchar(10))=k.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='country'and src_sys_cd = 'axis') l\non cast(cast (e.CPAIS as integer) as varchar(10))=l.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='city_cd'and src_sys_cd = 'axis') m\non cast(cast (e.CCIUDAD as integer) as varchar(10))=m.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='gender_cd'and src_sys_cd = 'axis') n\non cast(cast (a.CSEXPER as integer) as varchar(10))=n.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='person_type_cd'and src_sys_cd = 'axis') o\non cast(cast (a.CPERTIP as integer) as varchar(10))=o.REF_CD\n\nunion\n\nselect distinct\ncast('axis' as varchar(10)) as src_sys_cd,\ncast(a.NNUMNIF as varchar(35)) as policyholder_rut_num,\n--cast(cast(b.SPERSON as integer)||'-'||cast(b.CDOMICI as integer) as varchar(35)) as policyholder_id,\ncast(cast(b.SPERSON as integer)||'-'||cast(nvl(b.CDOMICI,0) as integer) as varchar(35)) as policyholder_id,\n---cast(trim('##' from a.TBUSCAR) as varchar(100)) as policyholder_name,\n--cast(translate(a.TBUSCAR,'#','') as varchar(100)) as policyholder_name,\ncast(a.TBUSCAR as varchar(255)) as policyholder_name,\ncast(e.TDOMICI as varchar(150)) as address_desc,\ncast(e.CPOSTAL as varchar(10)) as postal_cd,\ncast(cast(e.CPROVIN as integer) as varchar(10)) as region_cd,\ncast(cast(e.CPOBLAC as integer) as varchar(10)) AS comuna_cd,\ncast(cast(e.CCIUDAD as integer)  as varchar(10)) as city_cd,\ncast(cast(e.CPAIS as integer) as varchar(10)) as cntry_cd,\ncast (j.REF_DESC as varchar(35)) as comuna_name,\ncast (k.REF_DESC as varchar(100))AS region_name,\ncast (l.REF_DESC as varchar(80))AS cntry_desc,\ncast (m.REF_DESC as varchar(35))AS city_name,\n'Y' as actv_rec_ind,\na.fmodify as last_modified_dt,\ncast(a.CSEXPER as VARCHAR(10))as gender_cd,\ncast(n.REF_DESC as VARCHAR(80))as gender_desc,\ncast(a.FNACIMI as date)as birth_dt,\ncast(a.CPERTIP as VARCHAR(10))as person_type_cd,\ncast(o.REF_DESC as VARCHAR(80))as person_type_desc,\n1 as dummy\nfrom cdp_ods.SISAXIS_TOMADORES b\ninner join cdp_ods.SISAXIS_seguros d\non d.sseguro=b.sseguro\nand d.NCERTIF>0  /**Modified FOR CDP-2304**/\ninner join cdp_stg_dwh.SISAXIS_DIRECCIONES e\non e.sperson=b.sperson\nand e.CDOMICI=b.CDOMICI\nleft join cdp_ods.SISAXIS_PERSONAS a\non b.SPERSON=a.SPERSON\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna'and src_sys_cd = 'axis') j\non cast(cast(e.cpoblac as integer) as varchar(10))=j.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region'and src_sys_cd = 'axis') k\non cast(cast (e.cprovin as integer) as varchar(10))=k.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='country'and src_sys_cd = 'axis') l\non cast(cast (e.CPAIS as integer) as varchar(10))=l.REF_CD\nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='city_cd'and src_sys_cd = 'axis') m\non cast(cast (e.CCIUDAD as integer) as varchar(10))=m.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='gender_cd'and src_sys_cd = 'axis') n\non cast(cast (a.CSEXPER as integer) as varchar(10))=n.REF_CD \nleft outer join \n(SELECT REF_CD, REF_DESC FROM cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='person_type_cd'and src_sys_cd = 'axis') o\non cast(cast (a.CPERTIP as integer) as varchar(10))=o.REF_CD\n) src\nleft outer join \n(select 1 dummy,max(dim_policyholder_key) max_sid  from  cdp_dwh.dim_policyholder_t) LKP_MAX_KEY\non src.dummy=LKP_MAX_KEY.dummy) where row_cnt = 1 and policyholder_id is not null"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT dim_policyholder_key,policyholder_id,src_sys_cd FROM cdp_dwh.dim_policyholder_t where src_sys_cd='axis'"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[10]",
        "name": "Post-sql",
        "value": "update  cdp_dwh.dim_policyholder_t set  policyholder_name=trim('##' from policyholder_name) where src_sys_cd='axis';\nupdate  cdp_dwh.dim_policyholder_t set  address_desc=trim('##' from address_desc) where src_sys_cd='axis';"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[4].dataAdapter.runtimeAttributes.attributes[15]",
        "name": "Post-sql",
        "value": "update  cdp_dwh.dim_policyholder_t set  policyholder_name=translate(policyholder_name,'#','') where src_sys_cd='axis';\n\ncommit;\n\nupdate  cdp_dwh.dim_policyholder_t set  policyholder_name=translate(policyholder_name,'|',' ') where src_sys_cd='axis';\n\ncommit;\n\nupdate  cdp_dwh.dim_policyholder_t set  address_desc=translate(address_desc,'|',' ') where src_sys_cd='axis';\n\ncommit;\n\nupdate cdp_dwh.dim_claim_t\nset    dim_policyholder_key = POL_HOLD.dim_policyholder_key\nfrom   cdp_ods.sisaxis_seguros seg1  join cdp_dwh.dim_claim_t claim\non  seg1.npoliza = claim.policy_num  join cdp_ods.sisaxis_tomadores TOMA   \non TOMA.sseguro = seg1.sseguro  join cdp_dwh.dim_policyholder_t POL_HOLD \non cast( cast( TOMA.SPERSON as integer )|| '-' ||cast( nvl( TOMA.CDOMICI, 0 ) as integer ) as varchar(35) ) = POL_HOLD.policyholder_id     \nand POL_HOLD.src_sys_cd = 'axis'\nand claim.src_sys_cd='axis'\nand seg1.ncertif = 0; /*Added as part of DID-229.*/\n\ncommit;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_broker_key = 0 WHERE  dim_broker_key is null and src_sys_cd='axis'; /*Added as part of DID-229.*/\n\nCOMMIT;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_prd_pln_hrchy_key = 0 WHERE  dim_prd_pln_hrchy_key is null and src_sys_cd='axis'; /*Added as part of DID-229.*/\n\nCOMMIT;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_policyholder_key = 0 WHERE  dim_policyholder_key is null and src_sys_cd='axis'; /*Added as part of DID-229.*/\nCOMMIT;"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[5].dataAdapter.runtimeAttributes.attributes[15]",
        "name": "Post-sql",
        "value": "update cdp_dwh.dim_claim_t\nset    dim_policyholder_key = POL_HOLD.dim_policyholder_key\nfrom   cdp_ods.sisaxis_seguros seg1  join cdp_dwh.dim_claim_t claim\non  seg1.npoliza = claim.policy_num  join cdp_ods.sisaxis_tomadores TOMA   \non TOMA.sseguro = seg1.sseguro  join cdp_dwh.dim_policyholder_t POL_HOLD \non cast( cast( TOMA.SPERSON as integer )|| '-' ||cast( nvl( TOMA.CDOMICI, 0 ) as integer ) as varchar(35) ) = POL_HOLD.policyholder_id     \nand POL_HOLD.src_sys_cd = 'axis'\nand claim.src_sys_cd='axis'\nand seg1.ncertif = 0; /*Added as part of DID-229.*/\n\ncommit;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_broker_key = 0 WHERE  dim_broker_key is null and src_sys_cd='axis'; /*Added as part of DID-229.*/\n\nCOMMIT;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_prd_pln_hrchy_key = 0 WHERE  dim_prd_pln_hrchy_key is null and src_sys_cd='axis'; /*Added as part of DID-229.*/\n\nCOMMIT;\n\nUPDATE cdp_dwh.DIM_CLAIM_T set  dim_policyholder_key = 0 WHERE  dim_policyholder_key is null and src_sys_cd='axis'; /*Added as part of DID-229.*/\nCOMMIT;"
    }
]