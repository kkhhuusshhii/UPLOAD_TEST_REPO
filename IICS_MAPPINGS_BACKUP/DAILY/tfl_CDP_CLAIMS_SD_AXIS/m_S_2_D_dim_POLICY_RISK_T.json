[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select \npolicy_item_id,\naddress_desc,\ncomuna_cd,\ncomuna_name,\nregion_cd,\nregion_name,\nrisk_type_cd,\nrisk_type_desc,\noccupation_cd,\noccupation_desc,\ngender_cd,\ngender_desc,\nbirth_dt,\nveh_usage_type_cd,\nveh_usage_type_desc,\nveh_usage_subtype_cd,\nveh_usage_subtype_desc,\nveh_make,\nveh_model,\nveh_yr,\nveh_color,\nregistration_num,\nregistration_type_cd,\nveh_registration_type_desc,\nvin_num,\nengine_num,\nmv_id,\nrisk_id,\nveh_type_cd,\nveh_type_desc,\npostal_cd,\nperson_at_risk_name,\nperson_at_risk_rut_num,\ncity_cd,\ncity_name,\nperson_at_risk_qty,\ninsured_material_use_type_cd,\ninsured_material_type_desc,\napartment_num,\nstreet_num,\nsrc_sys_cd,\nrec_crt_dtm,\nrec_updt_dtm,\nfgisx, \nfgisy, \nfgisz,\nactv_rec_ind,\nMAX_SID,\ntrespue\nfrom\n(\nselect\ndistinct \nsrc.policy_item_id,\nreplace(src.address_desc,chr(10),'') as address_desc,\ncast(cast(src.comuna_cd as integer) as varchar(10)),\nsrc.comuna_name,\ncast(cast(src.region_cd as integer) as varchar(10)),\nsrc.region_name,\nsrc.risk_type_cd,\nsrc.risk_type_desc,\nsrc.occupation_cd,\nsrc.occupation_desc,\nsrc.gender_cd,\nsrc.gender_desc,\nsrc.birth_dt,\nsrc.veh_usage_type_cd,\nsrc.veh_usage_type_desc,\nsrc.veh_usage_subtype_cd,\nsrc.veh_usage_subtype_desc,\nsrc.veh_make,\nsrc.veh_model,\nsrc.veh_yr,\nsrc.veh_color,\nsrc.registration_num,\nsrc.registration_type_cd,\nsrc.veh_registration_type_desc,\nsrc.vin_num,\nsrc.engine_num,\nsrc.mv_id,\nsrc.risk_id,\nsrc.veh_type_cd,\nsrc.veh_type_desc,\nsrc.postal_cd,\nsrc.person_at_risk_name,\nsrc.person_at_risk_rut_num,\ncast(cast(src.city_cd as integer) as varchar(35)),\nsrc.city_name,\nsrc.person_at_risk_qty,\nsrc.insured_material_use_type_cd,\nsrc.insured_material_type_desc,\nsrc.apartment_num,\nsrc.street_num,\nsrc.src_sys_cd,\nsrc.rec_crt_dtm,\nsrc.rec_updt_dtm,\nsrc.fgisx, \nsrc.fgisy, \nsrc.fgisz,\n--src.etl_audit_id,\n'Y' as actv_rec_ind,\nLKP_MAXSID.MAX_SID,\nrow_number() over (partition by src.policy_item_id,src.risk_id order by order_num asc ,src.rec_crt_dtm desc) as row_cnt,\nzone.trespue\nfrom\n(\nselect \ndistinct \ncast (cast (r.sseguro as integer) as varchar(35)) as policy_item_id,\n\ncase when cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.tdomici \n--when cast(r.cobjase as integer)=5 then d.tdomici \n--when cast(r.cobjase as integer)='1' then bb.tdomici\nwhen cast(r.cobjase as integer)=5 then NULL -- CDP-179\nwhen cast(r.cobjase as integer)='1' and r.sperson is not null and r.cdomici > 0 then bb.tdomici -- CDP-179\nend as address_desc, -- changed after system testing defect uat defect\n\n--case when cast(r.cobjase as integer)='1' then bb.cpoblac\n case when cast(r.cobjase as integer)='1'  and r.sperson is not null and r.cdomici > 0 then bb.cpoblac -- CDP-179\nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.cpoblac \n--when  cast(r.cobjase as integer)=5 then au.cpoblac \nwhen  cast(r.cobjase as integer)=5 then NULL -- CDP-179\nelse null end as comuna_cd,\n\ncase when cast(r.cobjase as integer)='1' then cast(RD8.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then cast(RD7.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD9.mkt_ref_code_desc,RD9.ref_desc)as varchar(80)) \nelse null -- CDP-179\nend as comuna_name,\n\n--case when cast(r.cobjase as integer)='1' then bb.cprovin \n case when cast(r.cobjase as integer)='1' and r.sperson is not null and r.cdomici > 0 then bb.cprovin -- CDP 179\nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.cprovin \n--when  cast(r.cobjase as integer)=5 then au.cprovin \nwhen  cast(r.cobjase as integer)=5 then NULL -- CDP -179\nelse null end as region_cd,\n\ncase when cast(r.cobjase as integer)='1' then cast(RD11.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then cast(RD10.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD12.mkt_ref_code_desc,RD12.ref_desc)as varchar(80)) \nelse null\nend as region_name, -- CDP -179\n\ncast(cast (r.cobjase as integer) as varchar(10)) as risk_type_cd,\n--cast(NVL(RD.mkt_ref_code_desc,RD.ref_desc)as varchar(80)) as risk_type_desc,\ncast(RD.ref_desc as varchar(80)) as risk_type_desc,\ntrim(cast(r.CAGRRIE as varchar(10))) as occupation_cd,\ncast(RD1.ref_desc as varchar(80)) as occupation_desc,\ncast(cast(p.CSEXPER as integer) as varchar(10)) as gender_cd,\ncast(RD2.ref_desc as varchar(80)) as gender_desc,\ncast(p.FNACIMI as date) as birth_dt,\ncast(au.CUSO as varchar(10))as veh_usage_type_cd,\ncast(RD3.ref_desc as varchar(80)) as veh_usage_type_desc,\ncast(au.CSUBUSO as varchar(10))as veh_usage_subtype_cd,\ncast(RD4.ref_desc as varchar(80)) as veh_usage_subtype_desc,\n-------------------------------------\n\ncast(av.cmarca as varchar(35)) as veh_make,\ncast(cast(av.SMODELO as integer) as varchar(35)) as veh_model,\ncast(cast(au.NANOFAB as integer) as char(4)) as veh_yr,\ncast(cast(au.CCOLOR as integer) as varchar(35)) as veh_color,\ncast(au.CMATRIC as varchar(35)) as registration_num,\ncast(cast(au.CTIPMAT as integer) as varchar(10)) as registration_type_cd,\ncast(RD5.ref_desc as varchar(80)) as veh_registration_type_desc,\ncast(au.nbastid as VARCHAR(150)) as vin_num, --NINSPEC --nbastid -- CDP -179  \ncast(trim(au.NMOTOR) as varchar(35)) as engine_num, -- fixed after uat defect\ncast(r.NMOVIMA as integer) as mv_id,\ncast(r.nriesgo as integer) as risk_id,\ncast(av.CTIPVEH as varchar(10)) as veh_type_cd,\ncast(RD6.ref_desc as varchar(80)) as veh_type_desc,\n\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then bb.cpostal  -- CDP-179\nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.cpostal \nwhen  cast(r.cobjase as integer)=5 then NULL -- CDP -179\n--then au.cpostal \nelse null end as postal_cd, -- changed on Feb 26\ncast(cast(r.sperson as integer) as varchar(100)) as person_at_risk_name,\ncast(p.nnumnif as varchar(100)) as person_at_risk_rut_num,\n\n\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then  bb.CCIUDAD -- CDP-179 \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.CCIUDAD \nwhen  cast(r.cobjase as integer)=5 then null -- CDP 179\nelse null end as city_cd,  -- changed on Feb 26\n--cast(NVL(RD13.mkt_ref_code_desc,RD13.ref_desc)as varchar(80)) as city_name,\ncase when cast(r.cobjase as integer)=1 then cast(RD14.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then cast(RD13.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD12.mkt_ref_code_desc,RD12.ref_desc)as varchar(80)) \nelse null\nend as city_name, -- changed on Feb 26\n--cast(r.NASEGUR as smallint) as person_at_risk_qty,\ncase when r.NASEGUR is null and r.sperson is not null then 1\nwhen r.NASEGUR is null then 0\nelse r.NASEGUR end as person_at_risk_qty,\ncast(NULL as varchar(10)) as insured_material_use_type_cd,\ncast(NULL as varchar(255)) as insured_material_type_desc,\ncast(NULL as varchar(10)) as apartment_num,\ncast(NULL as varchar(10)) as street_num,\ncast('axis' as varchar(10)) as src_sys_cd,\ncurrent_date as rec_crt_dtm,\ncurrent_date as rec_updt_dtm,\ncast(1 as integer) as order_num,\naa.fgisx, \naa.fgisy, \naa.fgisz,\n1 as dummy\n\n\nfrom cdp_stg_dwh.sisaxis_riesgos r -- change to stg schema later\ninner join\ncdp_ods.sisaxis_seguros s\non r.sseguro=s.sseguro\nand s.ncertif>0\n\nleft join cdp_ods.sisaxis_autriesgos au \non au.nriesgo = r.nriesgo\nand au.sseguro=r.sseguro\nand au.nmovimi=r.nmovima -- CDP 172\n\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson\n\nleft join cdp_ods.sisaxis_autversiones av \non av.cversion = au.cversion\n\nleft join cdp_ods.SISAXIS_direcciones d \non d.sperson = p.sperson  \nand r.cdomici = d.cdomici \n\nleft join \n\n(select st.tdomici,r.sseguro,r.nriesgo,st.cpoblac,st.cprovin,st.cpostal,st.CCIUDAD, --changed on Feb 26\nst.fgisx, \nst.fgisy, \nst.fgisz\nfrom \ncdp_ods.SISAXIS_riesgos r \ninner join cdp_ods.SISAXIS_SEGUROS se \non se.sseguro=r.sseguro\nleft join cdp_ods.SISAXIS_sitriesgo st \non st.nriesgo = r.nriesgo and r.sseguro =  st.sseguro\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson  \nwhere ncertif > 0) aa\non cast(r.sseguro as integer)=cast(aa.sseguro as integer) -- cobjase is 2 or 3\nand cast(r.nriesgo as integer)=cast(aa.nriesgo as integer)\n\nleft join \n\n(select distinct d.cpoblac,d.cprovin,r.sseguro,r.nriesgo,d.cpostal,d.CCIUDAD,d.TDOMICI --changed on Feb 26\nfrom \ncdp_ods.SISAXIS_riesgos r \ninner join cdp_ods.SISAXIS_SEGUROS se \non se.sseguro=r.sseguro\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson\nleft join cdp_ods.SISAXIS_direcciones d on \nd.sperson = r.sperson and d.cdomici = r.cdomici\nwhere ncertif > 0)bb -- cobjase is 1 \non cast(bb.sseguro as integer)=cast(r.sseguro as integer) -- cobjase is 1 \nand cast(bb.nriesgo as integer)=cast(r.nriesgo as integer)\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='insuredobject_cd' and src_sys_cd = 'axis')RD\non trim(RD.ref_cd)=trim(cast(cast(r.cobjase as integer) as varchar(10)))\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='occupation_type_cd' and src_sys_cd = 'axis')RD1\non trim(RD1.ref_cd)=trim(cast(r.CAGRRIE as varchar(60)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='gender_cd' and src_sys_cd = 'axis')RD2\non trim(RD2.ref_cd)=trim(cast(cast(p.CSEXPER as integer) as varchar(10)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='vehicle_usage_type_cd' and src_sys_cd = 'axis')RD3\non trim(RD3.ref_cd)=trim(cast(au.CUSO  as varchar(10))) -- changed on march 4\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='vehicle_sub_usage_type_cd' and src_sys_cd = 'axis')RD4\non trim(RD4.ref_cd)=trim(cast(au.CSUBUSO  as varchar(10))) --CSUBUSO changed on march 4\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='registration_type_cd' and src_sys_cd ='axis')RD5\n--on trim(RD5.ref_cd)=trim(cast(au.CTIPMAT as varchar(10)))\non trim(cast(cast(au.CTIPMAT as integer) as varchar(10)))=trim(RD5.ref_cd) -- fixed after UAT issue\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='veh_type' and src_sys_cd = 'axis')RD6\non trim(RD6.ref_cd)=trim(cast(av.CTIPVEH  as varchar(10)))\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD7\non trim(RD7.ref_cd)=trim(cast(cast(aa.cpoblac as integer) as varchar(20))) -- cobjase is 2 0r 3\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD8\non trim(RD8.ref_cd)=trim(cast(cast(bb.cpoblac as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0 -- cobjase is 1\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD9\non trim(RD9.ref_cd)=trim(cast(cast(au.cpoblac as integer) as varchar(20)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD10\non trim(RD10.ref_cd)=trim(cast(cast(aa.cprovin as integer) as varchar(20))) -- cobjase is 2 or 3\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD11\non trim(RD11.ref_cd)=trim(cast(cast(bb.cprovin as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD12\non trim(RD12.ref_cd)=trim(cast(cast(au.cprovin as integer) as varchar(20)))\nleft join\n\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='city_cd' and src_sys_cd = 'axis')RD13\non trim(RD13.ref_cd)=trim(cast(cast(aa.cciudad as integer) as varchar(20))) -- cobjase is 2 or 3 -- changed on Feb 26\nleft join\n\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='city_cd' and src_sys_cd = 'axis')RD14\non trim(RD14.ref_cd)=trim(cast(cast(bb.cciudad as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1 -- Changed on Feb 26\n\n----------------------------------------------------------------------------------------------------\n\nunion\n\nselect \ndistinct \ncast (cast (r.sseguro as integer) as varchar(35)) as policy_item_id,\n\ncase when cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.tdomici \n--when cast(r.cobjase as integer)=5 then d.tdomici \n--when cast(r.cobjase as integer)='1' then bb.tdomici \nwhen cast(r.cobjase as integer)=5 then NULL -- CDP-179\nwhen cast(r.cobjase as integer)='1' and r.sperson is not null and r.cdomici > 0 then bb.tdomici -- CDP-179\nend as address_desc, -- changed after system testing defect uat defect\n\ncase --when cast(r.cobjase as integer)='1' then bb.cpoblac \nwhen cast(r.cobjase as integer)='1'  and r.sperson is not null and r.cdomici > 0 then bb.cpoblac -- CDP-179\nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.cpoblac \n--when  cast(r.cobjase as integer)=5 then au.cpoblac \nwhen  cast(r.cobjase as integer)=5 then NULL -- CDP-179\nelse null end as comuna_cd,\n\ncase when cast(r.cobjase as integer)='1' then cast(RD8.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then cast(RD7.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD9.mkt_ref_code_desc,RD9.ref_desc)as varchar(80)) \nelse null --CDP 179\nend as comuna_name,\n\n--case when cast(r.cobjase as integer)='1' then bb.cprovin  \n case when cast(r.cobjase as integer)='1' and r.sperson is not null and r.cdomici > 0 then bb.cprovin -- CDP-179\nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.cprovin \n--when  cast(r.cobjase as integer)=5 then au.cprovin\nwhen  cast(r.cobjase as integer)=5 then NULL --CDP-179 \nelse null end as region_cd,\n\ncase when cast(r.cobjase as integer)='1' then cast(RD11.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then cast(RD10.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD12.mkt_ref_code_desc,RD12.ref_desc)as varchar(80)) \nelse null -- CDP-179\nend as region_name, \n\ncast(cast (r.cobjase as integer) as varchar(10)) as risk_type_cd,\n--cast(NVL(RD.mkt_ref_code_desc,RD.ref_desc)as varchar(80)) as risk_type_desc,\ncast(RD.ref_desc as varchar(80)) as risk_type_desc,\ntrim(cast(r.CAGRRIE as varchar(10))) as occupation_cd,\ncast(RD1.ref_desc as varchar(80)) as occupation_desc,\ncast(cast(p.CSEXPER as integer) as varchar(10)) as gender_cd,\ncast(RD2.ref_desc as varchar(80)) as gender_desc,\ncast(p.FNACIMI as date) as birth_dt,\ncast(au.CUSO as varchar(10))as veh_usage_type_cd,\ncast(RD3.ref_desc as varchar(80)) as veh_usage_type_desc,\ncast(au.CSUBUSO as varchar(10))as veh_usage_subtype_cd,\ncast(RD4.ref_desc as varchar(80)) as veh_usage_subtype_desc,\n\n\ncast(av.cmarca as varchar(35)) as veh_make,\ncast(cast(av.SMODELO as integer) as varchar(35)) as veh_model,\ncast(cast(au.NANOFAB as integer) as char(4)) as veh_yr,\ncast(cast(au.CCOLOR as integer) as varchar(35)) as veh_color,\ncast(au.CMATRIC as varchar(35)) as registration_num,\ncast(cast(au.CTIPMAT as integer) as varchar(10)) as registration_type_cd,\ncast(RD5.ref_desc as varchar(80)) as veh_registration_type_desc,\ncast(au.nbastid as VARCHAR(150)) as vin_num, --NINSPEC --nbastid -- CDP-179\ncast(trim(au.NMOTOR) as varchar(35)) as engine_num, -- fixed after uat defect\ncast(r.NMOVIMA as integer) as mv_id,\ncast(r.nriesgo as integer) as risk_id,\ncast(av.CTIPVEH as varchar(10)) as veh_type_cd,\ncast(RD6.ref_desc as varchar(80)) as veh_type_desc,\n\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then bb.cpostal  --CDP-179\nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.cpostal \nwhen  cast(r.cobjase as integer)=5 then NULL --CDP-179\n--au.cpostal \nelse null end as postal_cd, -- changed on Feb 26\ncast(cast(r.sperson as integer) as varchar(100)) as person_at_risk_name,\ncast(p.nnumnif as varchar(100)) as person_at_risk_rut_num,\n\n--cast(cast(d.cciudad as integer) as varchar(10)) as city_cd,\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then  bb.CCIUDAD -- CDP-179 \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.CCIUDAD \nwhen  cast(r.cobjase as integer)=5 then null --CDP-179\nelse null end as city_cd, --changed on Feb 26\n--cast(NVL(RD13.mkt_ref_code_desc,RD13.ref_desc)as varchar(80)) as city_name,\ncase when cast(r.cobjase as integer)=1 then cast(RD14.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then cast(RD13.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD12.mkt_ref_code_desc,RD12.ref_desc)as varchar(80)) \nelse null\nend as city_name, --changed on Feb 26\n--cast(r.NASEGUR as smallint) as person_at_risk_qty,\ncase when r.NASEGUR is null and r.sperson is not null then 1\nwhen r.NASEGUR is null then 0\nelse r.NASEGUR end as person_at_risk_qty,\ncast(NULL as varchar(10)) as insured_material_use_type_cd,\ncast(NULL as varchar(255)) as insured_material_type_desc,\ncast(NULL as varchar(10)) as apartment_num,\ncast(NULL as varchar(10)) as street_num,\ncast('axis' as varchar(10)) as src_sys_cd,\ncurrent_date as rec_crt_dtm,\ncurrent_date as rec_updt_dtm,\ncast(2 as integer) as order_num,\naa.fgisx, \naa.fgisy, \naa.fgisz,\n1 as dummy\n\nfrom   cdp_stg_dwh.sisaxis_personas p \n\ninner join \n\ncdp_ods.sisaxis_riesgos r \non p.sperson = r.sperson\n\ninner join\ncdp_ods.sisaxis_seguros s\non r.sseguro=s.sseguro\nand s.ncertif>0\n\nleft join cdp_ods.sisaxis_autriesgos au \non au.nriesgo = r.nriesgo\nand au.sseguro=r.sseguro\nand au.nmovimi=r.nmovima -- CDP 172\n\nleft join cdp_ods.sisaxis_autversiones av \non av.cversion = au.cversion\n\nleft join cdp_ods.SISAXIS_direcciones d \non d.sperson = p.sperson  \nand r.cdomici = d.cdomici \n\nleft join \n\n(select st.tdomici,r.sseguro,r.nriesgo,st.cpoblac,st.cprovin,st.cpostal,st.CCIUDAD, --changed on Feb 26\nst.fgisx, \nst.fgisy, \nst.fgisz\nfrom \ncdp_ods.SISAXIS_riesgos r \ninner join cdp_ods.SISAXIS_SEGUROS se \non se.sseguro=r.sseguro\nleft join cdp_ods.SISAXIS_sitriesgo st \non st.nriesgo = r.nriesgo and r.sseguro =  st.sseguro\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson  \nwhere ncertif > 0) aa\non cast(r.sseguro as integer)=cast(aa.sseguro as integer) -- cobjase is 2 or 3\nand cast(r.sseguro as integer)=cast(aa.nriesgo as integer)\n\nleft join \n\n(select distinct d.cpoblac,d.cprovin,r.sseguro,r.nriesgo,d.cpostal,d.CCIUDAD,d.TDOMICI --changed on Feb 26\nfrom \ncdp_ods.SISAXIS_riesgos r \ninner join cdp_ods.SISAXIS_SEGUROS se \non se.sseguro=r.sseguro\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson\nleft join cdp_ods.SISAXIS_direcciones d on \nd.sperson = r.sperson and d.cdomici = r.cdomici\nwhere ncertif > 0)bb -- cobjase is 1 \non cast(bb.sseguro as integer)=cast(r.sseguro as integer) -- cobjase is 1 \nand cast(bb.sseguro as integer)=cast(r.nriesgo as integer)\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='insuredobject_cd' and src_sys_cd = 'axis')RD\non trim(RD.ref_cd)=trim(cast(cast(r.cobjase as integer) as varchar(10)))\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='occupation_type_cd' and src_sys_cd = 'axis')RD1\non trim(RD1.ref_cd)=trim(cast(r.CAGRRIE as varchar(60)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='gender_cd' and src_sys_cd = 'axis')RD2\non trim(RD2.ref_cd)=trim(cast(cast(p.CSEXPER as integer) as varchar(10)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='vehicle_usage_type_cd' and src_sys_cd = 'axis')RD3\non trim(RD3.ref_cd)=trim(cast(au.CUSO  as varchar(10))) -- changed on march 4\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='vehicle_sub_usage_type_cd' and src_sys_cd = 'axis')RD4\non trim(RD4.ref_cd)=trim(cast(au.CSUBUSO  as varchar(10))) -- CSUBUSO changed on march 4\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='registration_type_cd' and src_sys_cd ='axis')RD5\n--on trim(RD5.ref_cd)=trim(cast(au.CTIPMAT as varchar(10)))\non trim(cast(cast(au.CTIPMAT as integer) as varchar(10)))=trim(RD5.ref_cd)\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='veh_type' and src_sys_cd = 'axis')RD6\non trim(RD6.ref_cd)=trim(cast(av.CTIPVEH  as varchar(10)))\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD7\non trim(RD7.ref_cd)=trim(cast(cast(aa.cpoblac as integer) as varchar(20))) -- cobjase is 2 0r 3\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD8\non trim(RD8.ref_cd)=trim(cast(cast(bb.cpoblac as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD9\non trim(RD9.ref_cd)=trim(cast(cast(au.cpoblac as integer) as varchar(20)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD10\non trim(RD10.ref_cd)=trim(cast(cast(aa.cprovin as integer) as varchar(20))) -- cobjase is 2 or 3\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD11\non trim(RD11.ref_cd)=trim(cast(cast(bb.cprovin as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD12\non trim(RD12.ref_cd)=trim(cast(cast(au.cprovin as integer) as varchar(20)))\nleft join\n\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='city_cd' and src_sys_cd = 'axis')RD13\non trim(RD13.ref_cd)=trim(cast(cast(aa.cciudad as integer) as varchar(20))) -- cobjase is 2 or 3 -- changed on Feb 26\nleft join\n\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='city_cd' and src_sys_cd = 'axis')RD14\non trim(RD14.ref_cd)=trim(cast(cast(bb.cciudad as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1 -- Changed on Feb 26\n\n------------------------------------------\n\nunion\n\nselect \ndistinct \ncast (cast (r.sseguro as integer) as varchar(35)) as policy_item_id,\n\ncase when cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.tdomici \nwhen cast(r.cobjase as integer)=5 then NULL --CDP-179 \nwhen cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then bb.tdomici --CDP 179\nend as address_desc, -- changed after sytem testing defect uat defect\n\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then bb.cpoblac --CDP 179 \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.cpoblac \nwhen  cast(r.cobjase as integer)=5 then NULL --CDP-179 \nelse null end as comuna_cd,\n\ncase when cast(r.cobjase as integer)='1' then cast(RD8.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then cast(RD7.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD9.mkt_ref_code_desc,RD9.ref_desc)as varchar(80)) \nelse null -- CDP 179\nend as comuna_name,\n\ncase when cast(r.cobjase as integer)='1' and r.sperson is not null and r.cdomici > 0 then bb.cprovin --CDP-179\nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then aa.cprovin \nwhen  cast(r.cobjase as integer)=5 then NULL --CDP-179 \nelse null end as region_cd,\n\ncase when cast(r.cobjase as integer)='1' then cast(RD11.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)='2' or cast(r.cobjase as integer)='3' then cast(RD10.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD12.mkt_ref_code_desc,RD12.ref_desc)as varchar(80)) \nelse null -- CDP 179\nend as region_name, \n\ncast(cast (r.cobjase as integer) as varchar(10)) as risk_type_cd,\n--cast(NVL(RD.mkt_ref_code_desc,RD.ref_desc)as varchar(80)) as risk_type_desc,\ncast(RD.ref_desc as varchar(80)) as risk_type_desc,\ntrim(cast(r.CAGRRIE as varchar(10))) as occupation_cd,\ncast(RD1.ref_desc as varchar(80)) as occupation_desc,\ncast(cast(p.CSEXPER as integer) as varchar(10)) as gender_cd,\ncast(RD2.ref_desc as varchar(80)) as gender_desc,\ncast(p.FNACIMI as date) as birth_dt,\ncast(au.CUSO as varchar(10))as veh_usage_type_cd,\ncast(RD3.ref_desc as varchar(80)) as veh_usage_type_desc,\ncast(au.CSUBUSO as varchar(10))as veh_usage_subtype_cd,\ncast(RD4.ref_desc as varchar(80)) as veh_usage_subtype_desc,\ncast(av.cmarca as varchar(35)) as veh_make,\ncast(cast(av.SMODELO as integer) as varchar(35)) as veh_model,\ncast(cast(au.NANOFAB as integer) as char(4)) as veh_yr,\ncast(cast(au.CCOLOR as integer) as varchar(35)) as veh_color,\ncast(au.CMATRIC as varchar(35)) as registration_num,\ncast(cast(au.CTIPMAT as integer) as varchar(10)) as registration_type_cd,\ncast(RD5.ref_desc as varchar(80)) as veh_registration_type_desc,\ncast(au.nbastid as VARCHAR(150)) as vin_num, --CDP 179\ncast(trim(au.NMOTOR) as varchar(35)) as engine_num, -- fixed after uat defect\ncast(r.NMOVIMA as integer) as mv_id,\ncast(r.nriesgo as integer) as risk_id,\ncast(av.CTIPVEH as varchar(10)) as veh_type_cd,\ncast(RD6.ref_desc as varchar(80)) as veh_type_desc,\n--d.cpostal as postal_cd,\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then bb.cpostal --CDP-179  \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.cpostal \nwhen  cast(r.cobjase as integer)=5 then NULL --CDP-179\nelse null end as postal_cd, -- changed on feb 26\ncast(cast(r.sperson as integer) as varchar(100)) as person_at_risk_name,\ncast(p.nnumnif as varchar(100)) as person_at_risk_rut_num,\n\n--cast(cast(d.cciudad as integer) as varchar(10)) as city_cd,\ncase when cast(r.cobjase as integer)=1 and r.sperson is not null and r.cdomici > 0 then bb.CCIUDAD -- CDP-179 \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then aa.CCIUDAD \nwhen  cast(r.cobjase as integer)=5 then null -- CDP -179\nelse null end as city_cd,\n--cast(NVL(RD13.mkt_ref_code_desc,RD13.ref_desc)as varchar(80)) as city_name,\ncase when cast(r.cobjase as integer)=1 then cast(RD14.ref_desc as varchar(80)) \nwhen cast(r.cobjase as integer)=2 or cast(r.cobjase as integer)=3 then cast(RD13.ref_desc as varchar(80))\n--when cast(r.cobjase as integer)=5 then cast(NVL(RD12.mkt_ref_code_desc,RD12.ref_desc)as varchar(80)) \nelse null\nend as city_name, -- changed on Feb 26\n--cast(r.NASEGUR as smallint) as person_at_risk_qty,\ncase when r.NASEGUR is null and r.sperson is not null then 1\nwhen r.NASEGUR is null then 0\nelse r.NASEGUR end as person_at_risk_qty,\ncast(NULL as varchar(10)) as insured_material_use_type_cd,\ncast(NULL as varchar(255)) as insured_material_type_desc,\ncast(NULL as varchar(10)) as apartment_num,\ncast(NULL as varchar(10)) as street_num,\ncast('axis' as varchar(10)) as src_sys_cd,\ncurrent_date as rec_crt_dtm,\ncurrent_date as rec_updt_dtm,\ncast(3 as integer) as order_num,\naa.fgisx, \naa.fgisy, \naa.fgisz,\n1 as dummy\nfrom  \n\ncdp_stg_dwh.SISAXIS_direcciones d \n\nleft join cdp_ods.sisaxis_personas p \n--on p.sperson = r.sperson \non d.sperson = p.sperson \n\ninner join cdp_ods.sisaxis_riesgos r -- need to change as inner join \non r.cdomici = d.cdomici \nand p.sperson = r.sperson\ninner join\ncdp_ods.sisaxis_seguros s\non r.sseguro=s.sseguro\nand s.ncertif>0\nleft join cdp_ods.sisaxis_autriesgos au \non au.nriesgo = r.nriesgo\nand au.sseguro=r.sseguro\nand au.nmovimi=r.nmovima -- CDP 172\n\n/*left join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson*/\n\nleft join cdp_ods.sisaxis_autversiones av \non av.cversion = au.cversion\n\n/*left join cdp_ods.SISAXIS_direcciones d \non d.sperson = p.sperson  \nand r.cdomici = d.cdomici */\nleft join \n(select st.tdomici,r.sseguro,r.nriesgo,st.cpoblac,st.cprovin,st.cpostal,st.CCIUDAD, --changed on Feb 26\nst.fgisx, \nst.fgisy, \nst.fgisz\nfrom \ncdp_ods.SISAXIS_riesgos r \ninner join cdp_ods.SISAXIS_SEGUROS se \non se.sseguro=r.sseguro\nleft join cdp_ods.SISAXIS_sitriesgo st \non st.nriesgo = r.nriesgo and r.sseguro =  st.sseguro\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson  \nwhere ncertif > 0) aa\non cast(r.sseguro as integer)=cast(aa.sseguro as integer) -- cobjase is 2 or 3\nand cast (r.nriesgo as integer)=cast(aa.sseguro as integer)\n\nleft join \n\n(select distinct d.cpoblac,d.cprovin,r.sseguro,r.nriesgo,d.cpostal,d.CCIUDAD,d.tdomici --changed on Feb 26\nfrom \ncdp_ods.SISAXIS_riesgos r \ninner join cdp_ods.SISAXIS_SEGUROS se \non se.sseguro=r.sseguro\nleft join cdp_ods.sisaxis_personas p \non p.sperson = r.sperson\nleft join cdp_ods.SISAXIS_direcciones d on \nd.sperson = r.sperson and d.cdomici = r.cdomici\nwhere ncertif > 0)bb -- cobjase is 1 \non cast(bb.sseguro as integer)=cast(r.sseguro as integer) -- cobjase is 1 \nand cast (r.nriesgo as integer)=cast(bb.sseguro as integer)\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='insuredobject_cd' and src_sys_cd = 'axis')RD\non trim(RD.ref_cd)=trim(cast(cast(r.cobjase as integer) as varchar(10)))\n\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='occupation_type_cd' and src_sys_cd = 'axis')RD1\non trim(RD1.ref_cd)=trim(cast(r.CAGRRIE as varchar(60)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='gender_cd' and src_sys_cd = 'axis')RD2\non trim(RD2.ref_cd)=trim(cast(cast(p.CSEXPER as integer) as varchar(10)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='vehicle_usage_type_cd' and src_sys_cd = 'axis')RD3\non trim(RD3.ref_cd)=trim(cast(au.CUSO  as varchar(10))) -- changed on March 4\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='vehicle_sub_usage_type_cd' and src_sys_cd = 'axis')RD4\non trim(RD4.ref_cd)=trim(cast(au.CSUBUSO  as varchar(10))) -- CSUBUSO changed on March 4\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='registration_type_cd' and src_sys_cd ='axis')RD5\n--on trim(RD5.ref_cd)=trim(cast(au.CTIPMAT as varchar(10)))\non trim(cast(cast(au.CTIPMAT as integer) as varchar(10)))=trim(RD5.ref_cd)\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='veh_type' and src_sys_cd = 'axis')RD6\non trim(RD6.ref_cd)=trim(cast(av.CTIPVEH  as varchar(10)))\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD7\non trim(RD7.ref_cd)=trim(cast(cast(aa.cpoblac as integer) as varchar(20))) -- cobjase is 2 0r 3\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD8\non trim(RD8.ref_cd)=trim(cast(cast(bb.cpoblac as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='comuna' and src_sys_cd = 'axis')RD9\non trim(RD9.ref_cd)=trim(cast(cast(au.cpoblac as integer) as varchar(20)))\nleft join \n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD10\non trim(RD10.ref_cd)=trim(cast(cast(aa.cprovin as integer) as varchar(20))) -- cobjase is 2 or 3\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD11\non trim(RD11.ref_cd)=trim(cast(cast(bb.cprovin as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1\nleft join\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='region' and src_sys_cd = 'axis')RD12\non trim(RD12.ref_cd)=trim(cast(cast(au.cprovin as integer) as varchar(20)))\nleft join\n\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='city_cd' and src_sys_cd = 'axis')RD13\non trim(RD13.ref_cd)=trim(cast(cast(aa.cciudad as integer) as varchar(20))) -- cobjase is 2 or 3 -- changed on Feb 26\nleft join\n\n(select ref_cd,ref_desc,mkt_ref_code,mkt_ref_code_desc from cdp_stg_dwh.stg_tref_code_map_variant \nwhere ref_type_cd='city_cd' and src_sys_cd = 'axis')RD14\non trim(RD14.ref_cd)=trim(cast(cast(bb.cciudad as integer) as varchar(20))) \nand r.sperson is not null and r.cdomici > 0-- cobjase is 1 -- Changed on Feb 26\n) src\n------------------------\nleft  join \n(select ps.sseguro, decode(ctippre, 3, cast(crespue as varchar), 1, decode(crespue, 0, 'Urbano', 1, 'Rural'),\n(Case When trespue is null\nThen (Select r.trespue from cdp_ods.sisaxis_respuestas r\nWhere r.cpregun = 2465 and r.crespue = ps.crespue) else ps.trespue end )) trespue\nfrom cdp_ods.sisaxis_codipregun cod, cdp_ods.sisaxis_pregunseg ps\nWhere cod.cpregun = ps.cpregun and ps.cpregun = 2465 and ps.nmovimi in (Select max(ps1.nmovimi)\nFrom cdp_ods.sisaxis_pregunseg ps1 Where ps1.sseguro = ps.sseguro and ps1.cpregun = ps.cpregun)\n\nUNION\n\nselect sseguro, trespue1 as trespue from\n(\nselect ps.sseguro,ps.nmovimi, ps.nriesgo, cod.ctippre, ps.crespue, ps.trespue,\ndecode(cod.ctippre, 3, cast(ps.crespue as varchar),\n(Case When ps.trespue is null Then (Select r.trespue from cdp_ods.sisaxis_respuestas r Where r.cpregun = 2004 and r.crespue = ps.crespue) else ps.trespue end )) trespue1\nfrom\ncdp_ods.sisaxis_riesgos rie,\ncdp_ods.sisaxis_codipregun cod,\ncdp_ods.sisaxis_pregunseg ps\nWhere cod.cpregun = ps.cpregun\nand ps.cpregun = 2004\nand rie.sseguro = ps.sseguro\nand rie.nriesgo = ps.nriesgo\nand rie.nriesgo = (Select max(nriesgo) From cdp_ods.sisaxis_riesgos rie2 Where rie2.sseguro = ps.sseguro)\nand ps.nmovimi in (Select max(ps1.nmovimi) From cdp_ods.sisaxis_pregunseg ps1\nWhere ps1.sseguro = ps.sseguro and ps1.nriesgo = ps.nriesgo and ps1.cpregun = ps.cpregun)\n--and ps.sseguro in (905436683, 902946001, 903758920)\norder by ps.sseguro\n))  Zone\nOn src.policy_item_id = zone.sseguro\nleft join\n(select 1 as dummy, max(dim_risk_key) as MAX_SID from cdp_dwh.dim_policy_risk_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy\n) where row_cnt = 1"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "select \nsrc.dim_risk_key,\nsrc.policy_item_id,\nsrc.risk_id,\nsrc.src_sys_cd\nfrom cdp_dwh.dim_policy_risk_t src\nwhere src.src_sys_cd='axis'"
    }
]