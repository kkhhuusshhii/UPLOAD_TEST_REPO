[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select\n-- fact_veh_repair_detail_key,\nveh_repair_activity_id,\ndim_loss_item_key,\ndim_part_key,\npart_qty,\npart_cost_amt,\nlabor_cost_amt,\ndim_bdshp_key,\ndim_claim_key,\ndim_parts_provdr_key,\ndim_claimant_key,\npaint_cost_amt,\nimp_part_ind,\nship_cost_amt,\ntax_charges_amt,\ndim_spareparts_analyst_key,\npart_rcvd_dt,\nclaim_num,\nclaimant_num,\nloss_item_num,\npaint_ind,\nassembly_needed_ind,\nassembly_cost_amt,\ndiscount_pct,\nsvc_maint_cd,\nsvc_discount_cd,\ndim_claim_adjuster_key,\npart_cd,\npart_group_cd,\ndmg_magn_cd,\ndim_claim_type_key,\nsrc_sys_cd,\ndim_branch_office_key,\norder_num,\nadj_num,\nbdshp_loc_cd,\nbdshp_loc_name,\nrecord_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\n--etl_audit_id,\ncost_amt_curr_cd,\nmax_sid\nfrom(\nselect \nsrc.src_sys_cd,\nnvl(src.claim_num,' ') claim_num,\nnvl(src.claimant_num,0) claimant_num,\nnvl(src.loss_item_num,0) loss_item_num,\nsrc.veh_repair_activity_id,\nnvl(src.order_num,' ') order_num,\nnvl(src.adj_num,' ') adj_num,\nsrc.part_group_cd,\nsrc.assembly_cost_amt,\nsrc.assembly_needed_ind,\nnvl(src.dim_branch_office_key,0) dim_branch_office_key,\nsrc.dmg_magn_cd,\nnvl(src.dim_bdshp_key,0) dim_bdshp_key,\nnvl(src.bdshp_loc_cd,' ') bdshp_loc_cd,\nsrc.bdshp_loc_name,\nnvl(src.dim_claim_key,0) dim_claim_key,\nnvl(src.dim_spareparts_analyst_key,0) dim_spareparts_analyst_key,\nnvl(src.dim_claimant_key,0) dim_claimant_key,\nnvl(src.dim_claim_adjuster_key,0) dim_claim_adjuster_key,\nnvl(src.dim_loss_item_key,0) dim_loss_item_key,\nnvl(src.dim_part_key,0) dim_part_key,\nnvl(src.dim_parts_provdr_key,0) dim_parts_provdr_key,\nsrc.discount_pct,\nsrc.imp_part_ind,\nsrc.item_num,\nsrc.labor_hours_qty,\nsrc.labor_cost_amt,\n--src.labor_unit_charge_amt,\nsrc.paint_cost_amt,\nsrc.paint_ind,\n--src.paint_type_cd,\n--src.part_discount_applied_ind,\n--src.part_discount_percentage_amt,\nnvl(src.part_cd,' ') part_cd,\n--src.part_receipt_dt,\nsrc.part_rcvd_dt,\nsrc.part_cost_amt,\nsrc.part_qty,\n--src.parts_total_charges_amt,\n--src.qty_unit_cd,\n--src.service_discount_cd,\nsrc.svc_maint_cd,\nsrc.ship_cost_amt,\nsrc.tax_charges_amt, \nsvc_discount_cd,\nnvl(dim_claim_type_key,0) dim_claim_type_key,\nrecord_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\n--etl_audit_id,\ncost_amt_curr_cd,\nLKP_MAXSID.max_sid,\nROW_NUMBER()OVER(PARTITION BY /*src.src_sys_cd,*/src.claim_num,src.claimant_num,src.loss_item_num,src.veh_repair_activity_id \norder by src.rec_crt_dtm desc) rnk,\nrow_number()over(order by src.claim_num) as fact_veh_repair_detail_key\nFROM(select distinct cast('axis' as varchar(10)) src_sys_cd,\ncast(a.audl_auor_nu_siniestro as varchar(35)) claim_num,\ncast(b.AUOR_NU_IMPLICADO as integer) claimant_num,\ncast(b.AUOR_NU_IMPLICADO as integer) loss_item_num,\ncast(cast(a.AUDL_AUOR_CD_SUCURSAL as varchar(10)) ||'-'||cast(a.AUDL_AUOR_NU_SINIESTRO as integer) ||'-'||cast(a.AUDL_AUOR_NU_AJUSTE as integer) ||'-'||cast(a.AUDL_AUOR_NU_ORDEN as integer) ||'-'||a.AUDL_AUAA_TP_DETALLE||'-'||cast(a.AUDL_AUAA_CD_CONCEPTO as integer)as varchar(100)) veh_repair_activity_id,\ncast(cast(a.audl_auor_nu_orden as int) as varchar(35)) order_num,\ncast(cast(a.audl_auor_nu_ajuste as int) as varchar(35))  adj_num,\n--cast(a.AUDL_AUAA_TP_DETALLE as varchar(10)) part_group_cd,--updated is in the below line\ncast(nvl(part_grp_cd.mkt_ref_code,a.AUDL_AUAA_TP_DETALLE) as varchar(20)) part_group_cd,\ncast(a1.Assembly_Cost_Amount as numeric(25,10)) assembly_cost_amt,\ncast((case when a.AUDL_AUAA_TP_DANO in (1,7) then 'S' else 'N' end)as char(1)) assembly_needed_ind,\n--cast((nvl(c.mkt_ref_code,c.ref_cd))as integer) dim_branch_office_key,\ncast(branch_key.dim_branch_office_key as integer) dim_branch_office_key,\ncast(cast(a.audl_auaa_tp_dano as int) as varchar(10)) dmg_magn_cd,\ncast(d.dim_bdshp_key as integer) dim_bdshp_key,\ncast(null as varchar(10)) bdshp_loc_cd,\ncast(e.tdomici as varchar(100)) bdshp_loc_name,\ncast(f.dim_claim_key as integer) dim_claim_key,\ncast(n.dim_claim_Analyst_key as integer) dim_spareparts_analyst_key,\ncast(g.dim_claimant_key as integer) dim_claimant_key,\ncast(q.dim_claim_adjuster_key as integer) dim_claim_adjuster_key, \ncast(h.dim_loss_item_key as integer) dim_loss_item_key,\ncast(i.dim_part_key as integer) dim_part_key,\ncast(j.dim_parts_provdr_key as integer) dim_parts_provdr_key,\ncast(a.AUDL_AUAA_PO_DESCUENTO as numeric(11,2)) discount_pct,\ncast((case when a.audl_auaa_tp_repuesto=1 then 'S' else 'N' end) as char(1)) imp_part_ind,\nnull item_num,\nnull labor_hours_qty,\ncast(a1.Labor_Total_Charges_Amount as numeric(25,10)) labor_cost_amt,\nnull labor_unit_charge_amt,\ncast(a1.Paint_Cost_Amount as numeric(25,10)) paint_cost_amt,\ncast((case when a.AUDL_AUAA_MONTO_PINTURA>0 then 'S' else 'N' end) as char(1)) paint_ind,\nnull paint_type_cd,\nnull part_discount_applied_ind,\nnull part_discount_percentage_amt,\ncast(cast(a.audl_auaa_cd_concepto as int) as varchar(10)) part_cd,\nnull part_receipt_dt,\ncast(Part_recvd.fecha_entrega_repuesto_re as varchar(10)) part_rcvd_dt,\ncast(a.AUDL_AUAA_MT_CONCEPTO as numeric(25,10)) part_cost_amt,\ncast(a.AUDL_AUAA_NU_CANTIDAD as integer) part_qty,\ncast(a.AUDL_AUAA_MT_TOTAL as varchar(10)) parts_total_charges_amt,\nnull qty_unit_cd,\ncast('' as varchar(10))  service_discount_cd,\ncast(null as varchar(10)) svc_maint_cd,\ncast(a.AUDL_AUAA_MT_FLETE as numeric(25,10)) ship_cost_amt,\ncast(0 as numeric(25,10)) tax_charges_amt,\ncast('' as varchar(10)) as svc_discount_cd,\ncast(r.dim_claim_type_key as integer) as dim_claim_type_key,\ncast('CLP' as varchar(10)) as cost_amt_curr_cd,\nCURRENT_DATE AS record_crt_dtm,\nCURRENT_DATE AS rec_updt_dtm,\n'Y' AS actv_rec_ind,\n0 AS etl_audit_id,\n1 dummy,\ncast(a.audl_fe_despacho as timestamp) rec_crt_dtm \n from\n/**For running in chunks****/\n/**(select * from cdp_ods.sissiniestro_autt_detalle_ordenes ***/\n/*where cast(audl_auor_nu_siniestro as varchar(15)) between '1500000' and '1700000')a */\ncdp_stg_dwh.sissiniestro_autt_detalle_ordenes a\nleft outer join\n(SELECT distinct \n cast('axis' as varchar(10)) src_sys_cd,\n   a11.audl_auor_nu_siniestro claim_num,\n           a11.audl_auor_nu_orden,\n            a11.audl_auor_nu_ajuste,\n            a11.AUDL_AUAA_TP_DETALLE,\n            a11.audl_auaa_cd_concepto, \n            a11.audl_auaa_tp_dano,\n            a11.AUDL_AUOR_CD_SUCURSAL,\n            a11.AUDL_AUAA_CD_PROVEEDOR,\n            a11.AUDL_AUAA_PO_DESCUENTO,\n            a11.audl_auaa_tp_repuesto,\n            a11.AUDL_AUAA_MONTO_PINTURA,\n            a11.AUDL_AUAA_MT_CONCEPTO,\n            a11.AUDL_AUAA_NU_CANTIDAD,\n            a11.AUDL_AUAA_MT_TOTAL,\n            a11.AUDL_AUAA_MT_FLETE,\n            a11.AUDL_AUAA_TP_PROVEEDOR,\n    DECODE ( a11.audl_auaa_tp_dano,\n                     1 ,  0,\n                    7 , 0,\n                   a11.audl_auaa_mt_concepto \n                  ) Labor_Total_Charges_Amount\n         , a11.audl_auaa_monto_pintura   Paint_Cost_Amount \n         , DECODE (a11.audl_auaa_tp_dano,\n                   1, a11.audl_auaa_mt_concepto,\n                   7, a11.audl_auaa_mt_concepto,\n                   0   )     \n                   Assembly_Cost_Amount\n    FROM\n    /**For running in chunks**********/\n    /*(select * from cdp_ods.sissiniestro_autt_detalle_ordenes*/\n    /* where cast(audl_auor_nu_siniestro as varchar(15)) between '1500000' and '1700000') a11  */\n    cdp_stg_dwh.sissiniestro_autt_detalle_ordenes a11\n                inner join\n         cdp_ods.sissiniestro_autt_repuestos_siniestros b1\n                                on a11.audl_auaa_cd_concepto = b1.ausr_nu_repuesto\n                                AND b1.ausr_auma_cd_marca = '999' AND a11.audl_auaa_tp_detalle = '1'\n                                 --and a11.audl_auor_nu_siniestro in(1006050,1008499)\n                                inner join\n                                cdp_ods.sissiniestro_autt_detalle_ajuste aju\n                                on a11.audl_auor_nu_ajuste = aju.auaa_auaj_nu_ajuste\n     AND a11.audl_auor_nu_orden = aju.auaa_nro_orden\n     and aju.auaa_item_anulado = 0\n     and aju.auaa_tp_detalle = a11.audl_auaa_tp_detalle \n     ) a1 \non a.audl_auor_nu_siniestro=a1.claim_num \nand a.audl_auor_nu_orden=a1.audl_auor_nu_orden\nand a.AUDL_AUOR_CD_SUCURSAL=a1.AUDL_AUOR_CD_SUCURSAL\nand a.audl_auor_nu_ajuste=a1.audl_auor_nu_ajuste\nand a.audl_auaa_tp_detalle=a1.audl_auaa_tp_detalle\nand a.audl_auaa_cd_concepto=a1.audl_auaa_cd_concepto\n     left outer join\n     cdp_ods.sissiniestro_autt_ordenes_reparacion b\n     on a.audl_auor_nu_siniestro=b.AUOR_SISI_NU_SINIESTRO \n     AND a.audl_auor_nu_orden = b.AUOR_NU_ORDEN_REPARACION \n     AND a.audl_auor_nu_ajuste= b.auor_auad_nu_ajuste\n     left outer join cdp_stg_dwh.stg_tref_code_map_variant c\n     on right( '00000000' + cast( substring(a.AUDL_AUOR_CD_SUCURSAL,2) as varchar), 8)=c.ref_cd and c.src_sys_cd='axis' and c.ref_type_cd='branch_office'\n     left outer join cdp_stg_dwh.stg_tref_code_map_variant part_grp_cd\n     on a.AUDL_AUAA_TP_DETALLE=part_grp_cd.ref_cd and part_grp_cd.src_sys_cd='axis' and part_grp_cd.ref_type_cd='autopart_group'\n     left outer join cdp_dwh.dim_branch_office_t branch_key\n     on branch_key.branch_office_cd=nvl(c.mkt_ref_code,right( '00000000' + cast( substring(a.AUDL_AUOR_CD_SUCURSAL,2) as varchar), 8)) and branch_key.src_sys_cd='axis'  /*added this condition as part of CISD-16317 */\n     left outer join\n     cdp_dwh.dim_bdshp_t d \n     on cast(a.AUDL_AUAA_CD_PROVEEDOR as int)=d.bdshp_id and cast(a.AUDL_AUAA_TP_PROVEEDOR as int)=90\n     left outer join\n     cdp_ods.sisaxis_direcciones e\n     on e.sperson = a.AUDL_AUAA_CD_PROVEEDOR and cast(a.AUDL_AUAA_TP_PROVEEDOR as int)=90\n     left outer join\n     cdp_dwh.dim_claim_t f\n     on f.claim_num=a.audl_auor_nu_siniestro and f.src_sys_cd='axis'\n     left outer join\n      cdp_dwh.dim_claimant_t g\n     on a.audl_auor_nu_siniestro=g.claim_num and cast(b.AUOR_NU_IMPLICADO as int)=g.claimant_num and g.src_sys_cd='axis'\n     left outer join\n     cdp_dwh.dim_loss_item_t h\n     on cast(h.claim_num as varchar(42))=a.audl_auor_nu_siniestro and h.loss_item_num=cast(b.AUOR_NU_IMPLICADO as int) and h.src_sys_cd='axis'\n     left outer join\n     cdp_dwh.dim_spare_parts_t i\n     on cast( cast(a.audl_auaa_cd_concepto as integer) as varchar(10))=i.part_cd and i.src_sys_cd='axis'\n     left outer join\n     cdp_dwh.dim_parts_provdr_t j\n    on cast(cast(a.AUDL_AUAA_CD_PROVEEDOR as integer) as varchar(10)) = j.provdr_id and cast(a.AUDL_AUAA_TP_PROVEEDOR as int)=340     \n     /*left outer join\n     cdp_stg_dwh.sisaxis_ORDEN_COMPRA_REPUESTOS k\n     a.AUDL_AUOR_NU_SINIESTRO = k.NSINIES and \n   a.AUDL_AUAA_NU_ORDEN    = k.NUORDEN and\n  a.AUDL_AUOR_NU_AJUSTE     =   k.NUAJUSTE */ --sisaxis_ORDEN_COMPRA_REPUESTOS table not available,325\n  left outer join \n  cdp_ods.sisaxis_usuarios l \n  on b.AUOR_CD_ANALISTA = l.CUSUARI\n  left outer join\n  cdp_ods.sisaxis_personas m\n  on l.SPERSON  = m.sperson\n   left outer join cdp_dwh.dim_claim_analyst_t n\non cast(m.sperson as int)=n.claim_analyst_id and n.analyst_profile_desc='Spare Parts Analyst' and n.src_sys_cd='axis'\nleft outer join \ncdp_ods.sissiniestro_autt_ajuste_danos o\non a.audl_auor_nu_siniestro = o.AUAJ_SISI_NU_SINIESTRO\nand a.AUDL_AUOR_NU_AJUSTE = o.AUAJ_NU_AJUSTE\n  and   cast(o.AUAJ_CAPS_TP_PROVEEDOR as int) IN (332,333)\nleft outer join\ncdp_ods.sisaxis_personas p\non o.AUAJ_CAPS_CD_PROVEEDOR = p.sperson\n  left outer join\ncdp_dwh.dim_claim_adjuster_t q\n  on cast(p.SPERSON as int)=q.adjuster_id  and q.src_sys_cd='axis'\n  /*left outer join \n  cdp_dwh.dim_claim_type_t r\n  on f.claim_type_cd=r.claim_type_cd and r.src_sys_cd='axis'*/\n    left outer join\n  (select s.NSINIES,typ.dim_claim_type_key  from cdp_ods.sisaxis_siniestros s\n   inner join (select dim_claim_type_key,claim_type_cd from cdp_dwh.dim_claim_type_t where src_sys_cd='axis')typ\n   on cast(cast(s.CCAUSIN as int) as varchar(20))=typ.claim_type_cd) r\n  on a.audl_auor_nu_siniestro = r.NSINIES\n  left outer join\n  (select max(h.fecha_entrega) fecha_entrega_repuesto_re,a.audl_auor_nu_siniestro--,a.audl_auor_nu_ajuste ,a.audl_auaa_tp_detalle,\n  --a.audl_auaa_cd_concepto,a.audl_auor_nu_orden\n  from cdp_ods.sissiniestro_autt_detalle_ordenes a,  cdp_ods.sissiniestro_sin_guia_history h , cdp_ods.sissiniestro_sin_autoriza_ordenes AUTO \n    where a.audl_auor_nu_siniestro  = h.nsinies\n        AND a.audl_auor_nu_ajuste     = h.nu_ajuste\n        AND a.audl_auaa_cd_concepto = h.auaa_cd_concepto\n        AND h.auaa_tp_detalle = 3\n        AND h.nu_guia = auto.nu_guia\n       and a.audl_auor_nu_siniestro = AUTO.nsinies\n       AND a.audl_auor_nu_orden = AUTO.orden_reparacion\n       group by a.audl_auor_nu_siniestro--,a.audl_auor_nu_ajuste ,a.audl_auaa_tp_detalle,  a.audl_auaa_cd_concepto,a.audl_auor_nu_orden\n\t   ) Part_recvd\n       on a.audl_auor_nu_siniestro=Part_recvd.audl_auor_nu_siniestro\n       /*and a.audl_auor_nu_ajuste=Part_recvd.audl_auor_nu_ajuste \n       and a.audl_auaa_cd_concepto=Part_recvd.audl_auaa_cd_concepto\n       and a.audl_auaa_tp_detalle=Part_recvd.audl_auaa_tp_detalle\n        and a.audl_auor_nu_orden=Part_recvd.audl_auor_nu_orden*/  -- Commented on Jan 4th based on Scotts Defect DID-68 \n  ) src\n  left outer join\n(select 1 as dummy, max(fact_veh_repair_detail_key) as MAX_SID from cdp_dwh.fact_veh_repair_activity_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy)\nwhere rnk=1 \nand src_sys_cd is not null\nand claim_num is not null \nand claimant_num is not null \nand loss_item_num is not null \nand veh_repair_activity_id is not null"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT fact_veh_repair_detail_key,\nsrc_sys_cd,\nclaim_num,\nclaimant_num,\nloss_item_num,\nveh_repair_activity_id\nFROM cdp_dwh.fact_veh_repair_activity_t where src_sys_cd='axis'"
    }
]