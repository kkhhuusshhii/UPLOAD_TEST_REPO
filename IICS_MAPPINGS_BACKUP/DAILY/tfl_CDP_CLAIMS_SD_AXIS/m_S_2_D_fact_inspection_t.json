[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "SELECT\nCAST('axis' as CHARACTER VARYING(10)) AS src_sys_cd,\nCAST(SRC.llave_ciclo_insp AS CHARACTER VARYING(50)) AS  inspec_cycle_key,\nCAST(SRC.llave_ciclo AS CHARACTER VARYING(50)) AS  cycle_key,\nCAST(SRC.numero_ciclo AS INTEGER) AS cycle_number,\nCAST(SRC.numero_inspeccion AS INTEGER) AS  inspection_number,\nCAST(SRC.sseguro AS INTEGER) AS policy_item_id,\nCAST(SRC.numero_externo AS CHARACTER VARYING(500)) AS external_number,\nCAST(SRC.empresa_inspeccion AS CHARACTER VARYING(500)) AS  inspection_firm,\nCAST(SRC.patente AS CHARACTER VARYING(500)) AS licenseplate,\nCAST(TRIM(SRC.nombre_contacto) AS CHARACTER VARYING(500)) AS  contact_name,\nCAST(SRC.comuna_contacto AS INTEGER) AS  contact_comuna,\nCAST(SRC.celular_contacto AS CHARACTER VARYING(500)) AS  contact_cellphone,\nCAST(SRC.mail_contacto AS CHARACTER VARYING(500)) AS contact_mail,\nCAST(SRC.mail_asegurado AS CHARACTER VARYING(500)) AS  insured_mail,\nCAST(SRC.telefono_contacto AS CHARACTER VARYING(1000))  contact_phone,\nCAST(SRC.tipo_inspeccion AS CHARACTER VARYING(500))  inspection_type,\nCAST(TRIM(SRC.codigo_corredor) AS CHARACTER VARYING(500))  broker_code,\nCAST(SRC.corredor AS CHARACTER VARYING(2000))  broker,\nCAST(SRC.codigo_version_vehiculo AS CHARACTER VARYING(500)) as   vehicle_version_code,\nCAST(SRC.anho_vehiculo AS INTEGER) AS  vehicle_year,\nCAST(SRC.origen AS CHARACTER VARYING(500)) AS   vehicle_source,\nCAST(SRC.scoring AS CHARACTER VARYING(500)) AS   scoring,\nCAST(SRC.ultima_tarea AS CHARACTER VARYING(500)) AS   last_task,\nCAST(SRC.subestado_ultima_tarea AS CHARACTER VARYING(500)) AS   last_task_substate,\nCAST(SRC.fecha_inicio_ultima_tarea AS TIMESTAMP WITHOUT TIME ZONE ) AS   last_task_begin_date,\nCAST(SRC.fecha_fin_ingreso AS TIMESTAMP WITHOUT TIME ZONE ) AS   admission_end_date,\nCAST(SRC.fecha_inicio_inspector_asignado AS TIMESTAMP WITHOUT TIME ZONE ) AS  assigned_inspector_begin_date,\nCAST(SRC.fecha_fin_inspeccion_recepcionada AS TIMESTAMP WITHOUT TIME ZONE ) AS  inspection_receipted_end_date,\nCAST(SRC.periodo_fin_inspeccion_recepcionada AS CHARACTER VARYING(500)) AS  inspection_receipted_end_period,\nCAST(SRC.fecha_inicio_primera_coordinacion AS TIMESTAMP WITHOUT TIME ZONE ) AS   first_coordination_begin_date,\nCAST(SRC.coordinador AS CHARACTER VARYING(2000)) AS  coordinator,\nCAST(SRC.tiempo_coordinacion AS NUMERIC(38,18)) AS   coordination_time,\nCAST(SRC.tiempo_inspeccion AS NUMERIC(38,18)) AS   inspection_time,\nCAST(SRC.tiempo_total AS NUMERIC(38,18)) AS   total_time,\nCAST(SRC.tramos_dias_tiempo_total  AS CHARACTER VARYING(500)) AS  days_stretch_total_time,\nCAST(SRC.tiempo_primera_coordinacion AS NUMERIC(38,18)) AS  first_coordination_time,\nCAST(SRC.tramos_dias_primera_coordinacion  AS CHARACTER VARYING(500)) AS  days_stretch_first_coordination,\nCAST(SRC.usuario_asig_ultima_tarea  AS CHARACTER VARYING(2000)) AS  last_task_assigned_user,\nCAST(SRC.km AS DOUBLE PRECISION) AS km,\nCAST(SRC.obs_scoring  AS CHARACTER VARYING(200)) AS  scoring_obs,\nCAST(SRC.propuesta  AS CHARACTER VARYING(500)) AS  proposal,\nCAST(SRC.asegurado_corregido  AS CHARACTER VARYING(500)) AS  insured_corrected_name,\nCAST(SRC.rut_asegurado_corregido  AS CHARACTER VARYING(500)) AS  insured_corrected_rut,\nCAST(SRC.contratante  AS CHARACTER VARYING(500)) AS  policyholder_name,    \nCAST(SRC.rut_contratante  AS CHARACTER VARYING(500)) AS  policyholder_rut,\nCAST(TRIM(SRC.ultima_observacion)  AS CHARACTER VARYING(12000)) AS  last_observation,\nCAST(SRC.inspector  AS CHARACTER VARYING(1500)) AS  inspector_name,\nCAST(SRC.cantidad_documentos AS BIGINT) AS   document_quantity,\nCAST(TRIM(SRC.direccion_contacto)  AS CHARACTER VARYING(5000)) AS  contact_address,\nCAST(SRC.autoinspeccion AS CHARACTER VARYING(500)) AS  autoinspection,\nCAST(SRC.autoinspeccion_final  AS CHARACTER VARYING(500)) AS  final_autoinspection,\nCAST(SRC.codigo_ejecutivo  AS CHARACTER VARYING(500)) AS  executive_code,\nCAST(SRC.ejecutivo  AS CHARACTER VARYING(500)) AS  executive_name,\nCAST(SRC.rut_ejecutivo  AS CHARACTER VARYING(500)) AS  executive_rut,\nCAST(SRC.cod_sucursal AS INTEGER )AS branch_code,\nCAST(SRC.sucursal AS CHARACTER VARYING(500)) AS branch_name,\nCAST(SRC.chasis AS CHARACTER VARYING(500)) AS chassis_id,\nCAST(SRC.motor AS CHARACTER VARYING(500)) AS motor_id,\nCAST(SRC.codigo_marca AS CHARACTER VARYING(500)) AS vehicle_brand_code,\nCAST(SRC.tmarca AS CHARACTER VARYING(500)) AS  vehicle_brand_name,\nCAST(SRC.codigo_modelo AS INTEGER) AS  vehicle_model_code,\nCAST(SRC.tmodelo AS CHARACTER VARYING(500))  vehicle_model_name,\nCURRENT_DATE as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\nLKP_MAXSID.MAX_SID,\nCAST('Y' AS CHARACTER VARYING (1)) AS actv_rec_ind\n\nFROM \n(\nselect \ns01.llave_ciclo_insp,\ns01.llave_ciclo,\ns01.sciclo as Numero_ciclo,\ns01.Numero_inspeccion,\ns01.sseguro,\ns01.Numero_externo,\ns01.Empresa_inspeccion,\n--Patente ins.\ns01.Patente,\ns01.Nombre_contacto,\ncast(s01.codigo_comuna_contacto as int) as Comuna_contacto,\ns01.Celular_contacto,\ns01.Mail_contacto,\ns01.Mail_asegurado,\ns01.Telefono_contacto,\ns01.Tipo_inspeccion,\ns01.Codigo_corredor,\ns01.Corredor,\ns01.Codigo_version_vehiculo,\ns01.anho_vehiculo,\ns01.torigen_inspeccion as Origen,\ns01.Scoring,\ns16.Ultima_tarea,\n--Estado ultima tarea\ns16.Subestado_ultima_tarea,\ns16.Fecha_inicio_ultima_tarea,\ns03.fecha_fin_ingreso,\ns04.fecha_inicio_inspector_asignado,\ns05.fecha_fin_inspeccion_recepcionada,\ns05.periodo_fin_inspeccion_recepcionada,\ns06.fecha_inicio_primera_coordinacion,\ns12.coordinador,\n--s04.fecha_inicio_inspector_asignado   - s03.fecha_fin_ingreso               as Tiempo_coordinacion_cdp, -- HH:MM:SS Format\n--s05.fecha_fin_inspeccion_recepcionada - s04.fecha_inicio_inspector_asignado as Tiempo_inspeccion_cdp,   -- HH:MM:SS Format\n--s05.fecha_fin_inspeccion_recepcionada - s03.fecha_fin_ingreso               as Tiempo_total_cdp,        -- HH:MM:SS Format\n\n(DATEDIFF(second, s03.fecha_fin_ingreso ,s04.fecha_inicio_inspector_asignado)                 * 0.000011574073962718) as Tiempo_coordinacion,\n(DATEDIFF(second, s04.fecha_inicio_inspector_asignado ,s05.fecha_fin_inspeccion_recepcionada) * 0.000011574073962718) as Tiempo_inspeccion,\n(DATEDIFF(second, s03.fecha_fin_ingreso  ,s05.fecha_fin_inspeccion_recepcionada)              * 0.000011574073962718) as Tiempo_total,\n\nCASE WHEN Tiempo_total >  7.333333333333333 THEN 'x > 21'\n     WHEN Tiempo_total >  3.333333333333333 THEN '10 < X <= 21'\n     WHEN Tiempo_total >  1.666666666666667 THEN '5 < X <= 10'\n     WHEN Tiempo_total <= 1.666666666666667 THEN 'X <= 5'\n     ELSE null END as Tramos_dias_tiempo_total,\n     \n--s06.fecha_inicio_primera_coordinacion - s03.fecha_fin_ingreso               as Tiempo_primera_coordinacion_cdp, -- HH:MM:SS Format\n(DATEDIFF(second, s03.fecha_fin_ingreso  ,s06.fecha_inicio_primera_coordinacion)              * 0.000011574073962718) as Tiempo_primera_coordinacion,\n\nCASE WHEN Tiempo_primera_coordinacion <= 0.33333333333333331 THEN 'X <= 24'\n     WHEN Tiempo_primera_coordinacion >  0.33333333333333331 THEN '24 < x <= 48'\n     WHEN Tiempo_primera_coordinacion <= 0.66666666666666663 THEN '24 < X <= 48'\n     ELSE 'X > 48' END as Tramos_dias_primera_coordinacion,\n     \ns16.usuario_asign_ult_tarea as Usuario_asig_ultima_tarea,\ns01.Km,\ns01.Obs_scoring,\ns01.Propuesta,\nTRANSLATE(TRIM(s01.Nombre_Asegurado),'\\r\\n', ' ') as asegurado_corregido, \ns01.Rut_Asegurado as rut_asegurado_corregido,\nTRANSLATE(TRIM(s01.Contratante),'\\r\\n', ' ') AS Contratante,\ns01.Rut_contratante,\ns17.Ultima_observacion,\ns10.Inspector,\ndoc.cantidad_documentos,\ns01.Direccion_contacto,\ns01.Autoinspeccion,\ns01.Autoinspeccion_final,\ns01.codigo_ejecutivo, --Rut ejecutivo\n--Ejecutivo\n               ej.Ejecutivo,\n               ej.Rut_ejecutivo,\n\ncast(s01.cod_sucursal as int) as cod_sucursal,\nsuc.branch_office_name as sucursal,\ns01.chasis,\ns01.motor,\ns01.codigo_marca, --Marca\nvhmk.tmarca,\ncast(s01.codigo_modelo as int) as Codigo_Modelo, --Modelo\nvhmd.tmodelo\n\nfrom\n(\nwith a as(  select \n        cast(csistema as int) || '-' || cast(sciclo as int) || '-' ||   cast(nu_inspeccion as int) as llave_ciclo_insp,\n        cast(csistema as int) || '-' || cast(sciclo as int) llave_ciclo,\t\t\n        cast(sciclo as int) as sciclo,\t\t\n        csistema \tsistema, \t\n        cast(nu_inspeccion as int) numero_inspeccion,\t\t\n        nu_externo\tnumero_externo,\t\n        case when nu_externo is null                Then 'Liberty'\t\t\n             when substring(nu_externo,1,3) = 'RAC' then 'RAC'\t\t\n             when substring(nu_externo,1,3) = 'AUX' then 'AUXILIA'                  \t\t\n             when substring(nu_externo,1,3) = 'MOK' then 'MOK' \n\t\t\t when nu_externo like 'LET%'            then 'LET' -- ADDITION 2024-04-30   \n             when length(nu_externo) = 6            Then 'LET'\t\t\n             when length(nu_externo) = 7            Then 'BSP'\t\t\n             Else 'Otro'\t\t\n             End empresa_inspeccion,\t\t\n        ins.cpatente\tpatente, \t\n        ins.cmarca\t\tcodigo_marca, \n        ins.smodelo\t\tcodigo_modelo, \n        initcap(ins.tnomcon) nombre_contacto, \t\t\n        initcap(ins.tdircon) direccion_contacto,\t\t\n        ins.ccomcon \t\tcodigo_comuna_contacto, \n     --ApplyMap('Comunas',CCOMCON) \t\t\n        ins.ttelcon\t\ttelefono_contacto, \n        ins.tcelcon \t\tcelular_contacto, \n        ins.tmailcon\t\tmail_contacto,\n        ins.tmailaseg\tmail_asegurado,\t\n        ins.ctipinsp\t\tcodigo_tipo_inspeccion, \n        (Select tatribu\t\t\n           From cdp_ods.sisaxis_detvalores\t\t\n          Where cvalor = 1119\t\t\n            and catribu = ins.ctipinsp) tipo_inspeccion,\t\t\n \t\t\n        initcap(ins.tnom_asegurado) asegurado_inspeccion,\t\t\n        ins.trut_asegurado   rut_asegurado_inspeccion,\t\t\n        ins.ssolicit\t\tpropuesta_inspeccion,\n        ins.tobservaciones   observacion_inspeccion, \t\t\n       ins.cagente          codigo_corredor, \t\t\n        (Select initcap(substring(tbuscar,1,length(tbuscar)-2))\t\t\n           From cdp_ods.sisaxis_personas per,\t\t\n                cdp_ods.sisaxis_agentes age\t\t\n          where per.sperson = age.sperson\t\t\n            and age.cagente = ins.cagente) corredor,\t\t\n     \t\t\n     --ApplyMap('Corredores',CAGENTE,Null()) as Corredor,\t\t\n        ins.cversion codigo_version_vehiculo, \t\t\n        ins.ano              anho_vehiculo, \t\t\n        initcap(ins.tdireccion_riesgo) direccion_riesgo, \t\t\n        ins.corigen codigo_origen_inspeccion,\t\t\n        decode(ins.corigen, null, 'Desconocido',\t\t\n        (SELECT tatribu \t\t\n           FROM cdp_ods.sisaxis_detvalores \t\t\n          where cvalor=8006372\t\t\n            and catribu = ins.corigen)) torigen_inspeccion,\t\t\n     --ApplyMap('Origenes',CORIGEN) as Origen,\t\t\n       auio_in_scoring_lbs  scoring,\t\t\n       auio_obs_scoring   obs_scoring,\t\t\n       cast(auio_nu_kilometraje as DOUBLE PRECISION)  Km,\t\t\n       auio_num_prop  propuesta,\t\t\n       cast((Select distinct aut.sseguro\t\t\n         From cdp_ods.sisaxis_autriesgos aut\t\t\n        Where aut.NINSPEC = ins.nu_inspeccion\t\t\n        order by aut.sseguro\t\t\n        limit 1) as int)  sseguro,\t\t\n        Case when AUIO_NU_AUTO_INSPEC is null Then ''\t\t\n            When AUIO_NU_AUTO_INSPEC=1 Then 'Inspecci\u00c3\u00b3n Tradicional'\t\t\n            When AUIO_NU_AUTO_INSPEC=2 Then 'Auto Inspecci\u00c3\u00b3n'\t\t\n            When AUIO_NU_AUTO_INSPEC=3 Then 'Inspecci\u00c3\u00b3n en sucursal'\t\t\n            When AUIO_NU_AUTO_INSPEC=4 Then 'Inspecci\u00c3\u00b3n Remota'\t\t\n            Else ''  \t\t\n        End Autoinspeccion_final,\t\t\n        case when POSITION('AUTOINSPECCION' in upper(TDIRCON)) > 0 Then\t\t\n                  'Si'\t\t\n        Else 'No' End Autoinspeccion ,\t\t\n        auio_nu_serial_carroceria chasis,\t\t\n        auio_nu_serial_motor       motor,\t\t\n        auio_nu_placa             patente_origen\t\t\n  \t\t\n From cdp_ods.sissiniestro_autt_inspeccion_riesgo autt, \t\t\n      cdp_ods.sisaxis_INS_INSPECCION ins\t\t\nWhere autt.auio_nu_inspeccion (+) = ins.nu_inspeccion\t\t\n  and ins.csistema in (2,28)  )\t\t\n        \t\t\n  Select a.* ,seg.cagente codigo_ejecutivo,right(seg.cagente,3) cod_sucursal,\t\t\n         cast(seg.npoliza as int) poliza, \t\t\n         cast(seg.ncertif as int) ncertif,\t\t\n         seg.npropm,\t\t\n         (Select distinct nnumnif\t\t\n            From cdp_ods.sisaxis_personas per,\t\t\n                 cdp_ods.sisaxis_asegurados ase \t\t\n           Where per.sperson = ase.sperson \t\t\n             and ase.sseguro = seg.sseguro\t\t\n             and ase.nriesgo = 1\t\t\n             and ase.nmovimb is null\t\t\n            Order by ase.norden\t\t\n            limit 1) rut_asegurado,\t\t\n          (Select distinct substring(per.tbuscar,1,length(tbuscar)-2)\t\t\n            From cdp_ods.sisaxis_personas per,\t\t\n                 cdp_ods.sisaxis_asegurados ase \t\t\n           Where per.sperson = ase.sperson \t\t\n             and ase.sseguro = seg.sseguro\t\t\n             and ase.nriesgo = 1\t\t\n             and ase.nmovimb is null\t\t\n            Order by ase.norden\t\t\n            limit 1) nombre_asegurado,\t\t\n          (Select nnumnif\t\t\n                 From cdp_ods.sisaxis_personas per,\t\t\n                      cdp_ods.sisaxis_tomadores  tom\t\t\n                Where per.sperson = tom.sperson\t\t\n                  and tom.sseguro = seg.sseguro)  rut_contratante,\t\t\n          (Select substring(per.tbuscar,1,length(tbuscar)-2)\t\t\n                 From cdp_ods.sisaxis_personas per,\t\t\n                      cdp_ods.sisaxis_tomadores  tom\t\t\n                Where per.sperson = tom.sperson\t\t\n                  and tom.sseguro = seg.sseguro) contratante,\t\t\n          to_char(mov.fcontab, 'dd-mm-yyyy') fcontab,\t\t\n          extract (Year from mov.fcontab) ano_contable,\t\t\n          extract (month from mov.fcontab) mes_contable,\t\t\n          extract (day from mov.fcontab) dia_contable,\t\t\n          to_char(date_trunc('month',mov.fcontab),'MON-YYYY') as periodo_contable\t\t\n\t\t\n    from (\nselect * from (\nselect *,\nrow_number()over \n(partition by sseguro,nmovimi order by rec_crt_dtm desc,seq_id desc,op desc)inner_rnk from \ncdp_stg_dwh.sisaxis_movseguro Where cmotmov = 100\n)\nwhere inner_rnk=1) mov,\t\t\n         cdp_ods.sisaxis_seguros seg,\t\t\n         a\t\t\n   Where mov.sseguro (+) = seg.sseguro\t\t\n     and seg.sseguro (+) = a.sseguro\t\t\n--and llave_ciclo = '2-653717'\n) s01\nLEFT JOIN \n(\n        select cvalpar as numero_inspeccion, count(*) as cantidad_documentos\n        from  cdp_ods.gedox_dgxpargedox\n        Where cparcat in ('INSPECCION','FOTOS','INFORME_INSPECC','INFORME_TERMO')\n        Group by cvalpar\n) doc on (doc.numero_inspeccion = s01.Numero_inspeccion)\nLEFT JOIN\n(\n        Select  cast(m.csistema as int) || '-' || cast(m.sciclo as int) llave_ciclo,\t\t\t\t\t\t\n                m.SCICLO as numero_ciclo,\t\t\t\t\t\t\n\t        m.csistema as sistema,\t\t\t\t\t\n\t        m.ftermino as fecha_fin_ingreso,\t\t\t\t\t\t\t\t\t\n                m.cusumod as codigo_usuario_mod_inspeccion_recepcionada\t\t\t\t\t\t\t\t\t\t\n  From (select sciclo, csistema, ftermino, cusumod, cestado\t\t\t\t\t\t\n        from cdp_ods.sisaxis_cmi_movpropuesta m\t\t\t\t\t\t\n       where (m.sciclo,m.csistema) in (Select p.sciclo,p.csistema\t\t\t\t\t\t\n                                         From cdp_ods.sisaxis_cmi_propuesta p\t\t\t\t\t\t\n                                        Where p.csistema in (2,28))\t\t\t\t\t\t\n        and m.ctipo='E'\t\t\t\t\t\t\n        and to_char(m.fefecto,'YYYYMM')>='20210101') m\t\t\t\t\t\t\n Where (m.csistema,m.cestado) in (Select est.csistema, est.ccodigo\t\t\t\t\t\t\n                                    From cdp_ods.sisaxis_cmi_estados est\t\t\t\t\t\t\n                                   Where initcap(est.tdescripcion) in ('Ingreso', 'Ingreso Vp'))\n) s03 on (s03.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN (\n         Select cast(m.csistema as int) || '-' || cast(m.sciclo as int) llave_ciclo,\t\n                cast(m.sciclo as int) as numero_ciclo,\t\n\t        m.csistema as sistema,\n\t        Min(m.fefecto) as fecha_inicio_inspector_asignado\n         From (select sciclo, csistema, fefecto, cestado\t\n               from   cdp_ods.sisaxis_cmi_movpropuesta\t\n               where  (sciclo,csistema) in (select  p.sciclo,p.csistema\t\n                                            from  cdp_ods.sisaxis_cmi_propuesta p\t\n                                            where  p.csistema in (2,28))\t\n               and ctipo='E'\t\n               and to_char(fefecto,'YYYYMM')>='20210101') m\t\n         Where (m.csistema,m.cestado) in (Select est.csistema, est.ccodigo\t\n                                          From cdp_ods.sisaxis_cmi_estados est\t\n                                          Where initcap(est.tdescripcion) in ('Inspector Asignado', 'Inspector Asignado Vp'))\t\ngroup by m.sciclo, m.csistema\n) s04 on (s04.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN (\n        Select  cast(m.csistema as int) || '-' || cast(m.sciclo as int) llave_ciclo,          \n                m.sciclo as numero_ciclo,   \n                m.csistema as sistema,   \n                m.ftermino as fecha_fin_inspeccion_recepcionada,   \n                m.cusumod as codigo_usuario_mod_inspeccion_recepcionada,          \n                (Select substring(tbuscar,1,length(tbuscar)-2)             \n                        From cdp_ods.sisaxis_personas per,                 \n                        cdp_ods.sisaxis_usuarios usu            \n                 Where per.sperson = usu.sperson              \n                 and usu.cusuari = m.cusumod) usuario_mod_ins_recepcionada,          \n                 to_char(date_trunc('month',m.ftermino),'YYYYMM') as periodo_fin_inspeccion_recepcionada,   \n                cast(date_trunc('week', m.ftermino) as date) + 5  as semana_fin_inspeccion_recepcionada      \n        From (Select sciclo, csistema, max(nmovimi) nmovimi       \n                From cdp_ods.sisaxis_cmi_movpropuesta          \n                Where (sciclo,csistema) in (select  p.sciclo,p.csistema                                         \n                                            from  cdp_ods.sisaxis_cmi_propuesta p                                        \n                                            where  p.csistema in (2,28))           \n                                            and ctipo='E'           \n                                            and to_char(fefecto,'YYYYMM')>='20210101'\n                                            and (csistema,cestado) in (Select est.csistema, est.ccodigo                                     \n                                                                        From cdp_ods.sisaxis_cmi_estados est                                    \n                                                                        Where initcap(est.tdescripcion) in ('Inspecci\u00c3\u00b3n Realizada', \n                                                                                                            'Inspecci\u00c3\u00b3n Realizada Vp'))\n              Group by sciclo, csistema) c,\n              cdp_ods.sisaxis_cmi_movpropuesta  m\n      \n        Where c.csistema = m.csistema\n        and c.sciclo   = m.sciclo\n        and c.nmovimi = m.nmovimi\n) s05 on (s05.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN (\nSelect cast(m.csistema as int) || '-' || cast(m.sciclo as int) llave_ciclo,\n       c.sciclo as numero_ciclo,\n       c.csistema as sistema,\n       c.snmovimi snmovimi_primera_coordinacion,\n       c.cestado as codigo_primera_coordinacion,\n       (select tdescripcion\n          from cdp_ods.sisaxis_cmi_estados est\n         where est.csistema = c.csistema \n           and est.ccodigo  = c.cestado) as estado_primera_coordinacion,\n       (c.fefecto) as fecha_inicio_primera_coordinacion,\n       c.ftermino as fecha_fin_primera_coordinacion,\n       c.cusumod as cod_usuario_mod_primera_coordinacion,\n      (Select substring(per.tbuscar,1,length(per.tbuscar)-2)\n            From cdp_ods.sisaxis_personas per,\n                 cdp_ods.sisaxis_usuarios usu\n            Where per.sperson = usu.sperson \n              and usu.cusuari = c.cusumod) usuario_mod_primera_coordinacion,\n       c.cusuasig as codigo_usuario_asig_primera_coordinacion,\n      (Select substring(per.tbuscar,1,length(per.tbuscar)-2)\n            From cdp_ods.sisaxis_personas per,\n                 cdp_ods.sisaxis_usuarios usu\n            Where per.sperson = usu.sperson \n              and usu.cusuari = c.cusuasig ) usuario_asig_primera_coordinacion\n\n  From (select sciclo, csistema, min(snmovimi) snmovimi\n          from cdp_ods.sisaxis_cmi_movpropuesta\n         where (sciclo,csistema) in (select  p.sciclo,p.csistema\n                                       from  cdp_ods.sisaxis_cmi_propuesta p\n                                      where  p.csistema in (2,28))\n          and ctipo='E'\n          and to_char(fefecto,'YYYYMM')>='20210101'\n          and (csistema, cestado) in (Select est.csistema, est.ccodigo\n                                         From cdp_ods.sisaxis_cmi_estados est\n                                        Where initcap(est.tdescripcion) in ('Pendiente Inspecci\u00c3\u00b3n','Pendiente Inspecci\u00c3\u00b3n Vp','Inspector Asignado',\n                                              'Inspector Asignado Vp','Devolucion Solicitud','Devolucion Solicitud Vp'))\n        Group by sciclo, csistema) m, \n        cdp_ods.sisaxis_cmi_movpropuesta c \n Where m.sciclo = c.sciclo\n   and m.csistema = c.csistema\n   and m.snmovimi =  c.snmovimi\n) s06 on (s06.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN (\nSelect cast(c.csistema as int) || '-' || cast(c.sciclo as int) llave_ciclo,\n       cast(c.sciclo as int) sciclo,\n       c.csistema,\n       c.ftermino as fecha_coordinacion,\n       c.cusumod cod_usuario_coordinador,\n       initcap(substring(tbuscar,1,length(tbuscar)-2)) coordinador\nFrom cdp_ods.sisaxis_personas per,\n     cdp_ods.sisaxis_usuarios usu,\n     (select sciclo, csistema, max(ftermino) ftermino, min(snmovimi) snmovimi\n        from cdp_ods.sisaxis_cmi_movpropuesta m\n       where (m.sciclo,m.csistema) in (Select p.sciclo,p.csistema\n                                         From cdp_ods.sisaxis_cmi_propuesta p\n                                        Where p.csistema in (2,28))\n        and m.ctipo='E'\n        and to_char(m.fefecto,'YYYYMM')>='20210101'\n        and ((m.cestado in (2,9) and m.csistema in (2,28))\n         or (m.cestado in (6,9) and m.csistema = 27)\n         OR (m.cestado = 8 and m.csistema = 27))\n        Group By \n            m.sciclo, m.csistema) m,\n      cdp_ods.sisaxis_cmi_movpropuesta c\nWhere per.sperson = usu.sperson\n  and usu.cusuari = c.cusumod \n  and m.sciclo = c.sciclo\n  and m.csistema = c.csistema\n  and m.snmovimi = c.snmovimi\n) s12 on (s12.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN (\n\nselect\ncast(c.csistema as int) || '-' || cast(c.sciclo as int) llave_ciclo,\n       cast(c.sciclo as int) sciclo,\n       c.csistema,    c.cestado,\n       cast(c.csistema as int) || '-' || cast(c.cestado as int) cod_ultima_tarea,      \n       est.tdescripcion as ultima_tarea,\n       cast(c.csistema as int) || '-' || cast(c.cestado as int) as cod_estado_ult_tarea, \n       cast(c.csistema as int) || '-' || c.csubestado as cod_subestado_ult_tarea,     \n       sub.tdescripcion as subestado_ultima_tarea,\n       c.fefecto as fecha_inicio_ultima_tarea,\n       c.ftermino as fecha_ultima_tarea,\n       c.cusumod cod_usuario_mod_ultima_tarea,\n       c.cusuasig cod_usuario_asig_ultima_tarea,\n       initcap(substring(per.tbuscar,1,length(per.tbuscar)-2)) as usuario_asign_ult_tarea\nfrom (\n         select  sciclo, csistema, max(snmovimi) snmovimi\n          from  cdp_ods.sisaxis_cmi_movpropuesta \n         where  (sciclo,csistema) in (select  p.sciclo,p.csistema\n                                      from  cdp_ods.sisaxis_cmi_propuesta p\n                                     where  p.csistema in (2,27,28))\n           and ctipo='E'\n           and to_char(fefecto,'YYYYMM')>= '20210101'        \n         -- and sciclo in  ( 558659, 558664)\n          Group by sciclo, csistema\n) m\nLEFT JOIN cdp_ods.sisaxis_cmi_movpropuesta c on (m.sciclo = c.sciclo and m.csistema = c.csistema and m.snmovimi = c.snmovimi)\nLEFT JOIN cdp_ods.sisaxis_cmi_estados est on (est.csistema = c.csistema and est.ccodigo = c.cestado)\nLEFT JOIN cdp_ods.sisaxis_cmi_subestados sub on (sub.csistema = c.csistema and sub.csubest  = c.csubestado)\nLEFT JOIN cdp_ods.sisaxis_usuarios usu on (usu.cusuari = nvl(c.cusuasig,c.cusumod))\nLEFT JOIN cdp_ods.sisaxis_personas per on (per.sperson = usu.sperson)\n   \n) s16 on (s16.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN (\n--select mov.csistema,\n--cast(mov.sciclo as int)sciclo,\n--cast(mov.csistema as int) || '-' || cast(mov.sciclo as int) llave_ciclo, \n--observacion ultima_observacion\n--from cdp_ods.sisaxis_cmi_detalle_mov mov\n--Where mov.csistema in (2,28)\n--and mov.snmovimi in (Select max(snmovimi) \n--From  cdp_ods.sisaxis_cmi_detalle_mov mov1\n--Where mov1.sciclo = mov.sciclo \n--and mov1.csistema = mov.csistema\n--and mov1.csistema in (2,28))\n\t\t\t\t\t\t  \nselect mov.*,cast(mov.sciclo as int)sciclo,\ncast(mov.csistema as int) || '-' || cast(mov.sciclo as int) llave_ciclo, \nobservacion ultima_observacion\nfrom cdp_ods.sisaxis_cmi_detalle_mov mov\nleft join \n( Select sciclo, csistema, max(snmovimi) as snmovimi, max(nro_uni_det_mov) as nro_uni_det_mov\nFrom  cdp_ods.sisaxis_cmi_detalle_mov mov1\ngroup by sciclo, csistema\n) z on (z.sciclo = mov.sciclo and z.csistema = mov.csistema and z.csistema in (2,28))\nWhere mov.csistema in (2,28) \nand mov.snmovimi = z.snmovimi \nand mov.nro_uni_det_mov = z.nro_uni_det_mov\t\t\t\t  \n\t\t\t\t\t\t  \n) s17 on (s01.llave_ciclo = s17.llave_ciclo)\n\nLEFT JOIN (\nSelect cast(c.csistema as int) || '-' || cast(c.sciclo as int) llave_ciclo,\n       cast(c.sciclo as int) sciclo,\n       c.csistema,\n       c.cusuasig cod_usuario_inspector,\n       initcap(substring(tbuscar,1,length(tbuscar)-2)) Inspector\nFrom cdp_ods.sisaxis_personas per,\n     cdp_ods.sisaxis_usuarios usu,\n     (select sciclo, csistema, max(snmovimi) snmovimi\n        from cdp_ods.sisaxis_cmi_movpropuesta m\n       where (m.sciclo,m.csistema) in (Select p.sciclo,p.csistema\n                                         From cdp_ods.sisaxis_cmi_propuesta p\n                                        Where p.csistema in (2,28))\n        and m.ctipo='E'\n        and to_char(m.fefecto,'YYYYMM')>='20210101'\n        and cestado = 4\n      Group by \n            sciclo, csistema) m,\n      cdp_ods.sisaxis_cmi_movpropuesta  c\nWHERE per.sperson = usu.sperson\n  and usu.cusuari = c.cusuasig\n  and m.sciclo = c.sciclo\n  and m.csistema = c.csistema\n  and m.snmovimi = c.snmovimi\n) s10 on (s10.llave_ciclo = s01.llave_ciclo)\n\nLEFT JOIN \n(\n        select c.codigo_corredor, \n               c.corredor,\n               c.codigo_ejecutivo,\n               c.rutcorredor,\n               ltrim(p2.tnombre||' '||p2.tapelli) as Ejecutivo,\n               p2.NNUMNIF  Rut_ejecutivo\n        from (\n                select a.cagente as codigo_corredor,\n                decode(nvl(p.tnombre,'*'),'*',p.tapelli,p.tapelli||', '||p.tnombre) as Corredor, \n                e.cod_eje as codigo_ejecutivo,\n                p.nnumnif as Rutcorredor\n                from    cdp_ods.sisaxis_agentes a,cdp_ods.sisaxis_personas p,         \n                (select r.cod_corr, cod_eje, decode(estado,'V','true','false') activo          \n                        from     cdp_ods.sisaxis_rel_corr_eje r          \n                        where    cod_rel =(select max(cod_rel) \n                from cdp_ods.sisaxis_rel_corr_eje where cod_corr=r.cod_corr)) e \n                where   a.ctipage=4 \n                and     a.sperson=p.sperson \n                and     a.cagente=e.cod_corr(+)\n                --and cagente = '03358032'\n                ) c\n        LEFT JOIN cdp_ods.sisaxis_agentes  a2 on (c.codigo_ejecutivo = a2.cagente and a2.ctipage=5)\n        LEFT JOIN cdp_ods.sisaxis_personas p2 on (a2.sperson=p2.sperson)\n) ej on (ej.codigo_corredor = s01.codigo_ejecutivo)\n\n\nLEFT JOIN cdp_dwh_v.dim_branch_office_v suc on (suc.src_sys_cd = 'axis' and suc.branch_office_cd = cast(s01.cod_sucursal as int))\nLEFT JOIN cdp_dwh_v.cdp_reference_data_v cmn on (cmn.src_sys_cd = 'axis' and ref_type_cd = 'comuna' and cmn.ref_cd = cast(s01.cod_sucursal as int))\nLEFT JOIN cdp_ods.sisaxis_autmarcas vhmk  on (vhmk.cmarca = s01.codigo_marca)\nLEFT JOIN cdp_ods.sisaxis_autmodelos vhmd on (vhmd.smodelo = s01.codigo_modelo and vhmd.cmarca = s01.codigo_marca)\n\n\n--where s01.llave_ciclo in ('2-558664','2-558689','2-558664','2-558663','2-558659','2-558650')\norder by s01.llave_ciclo\n) SRC\nleft outer join\n(select 1 as dummy, \nmax(fact_inspection_key) as MAX_SID \nfrom cdp_dwh.fact_inspection_t) LKP_MAXSID\non 1=1;"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT distinct fact_inspection_key,inspec_cycle_key,cycle_key,src_sys_cd,rec_crt_dtm FROM cdp_dwh.fact_inspection_t where src_sys_cd='axis'"
    }
]