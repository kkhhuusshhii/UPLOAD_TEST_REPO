[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select distinct \nsrc_sys_cd,\n--insured_name,\nreplace(insured_name,'\"\"','\"') insured_name,\ninsured_id,\ninsured_rut_num,\nactv_rec_ind,\ngender_cd,\ngender_desc,\nbirth_dt,\naddress_id,\n--address_desc,\ncase \nwhen regexp_count(address_desc,'\"')=2  then replace(address_desc,'\"\"','\"')\nwhen regexp_count(address_desc,'\"')=4  then replace(address_desc,'\"\"','\"') \nwhen regexp_count(address_desc,'\"')=4  then replace(address_desc,'\"\"\"\"','\"\"') \nwhen regexp_count(address_desc,'\"')=8  then replace(address_desc,'\"\"\"\"','\"\"')\nwhen regexp_count(address_desc,'\"')=8  then replace(address_desc,'\"\"\"\"\"\"\"\"','\"\"\"\"') \nwhen regexp_count(address_desc,'\"')=16 then replace(address_desc,'\"\"\"\"\"\"\"\"','\"\"\"\"')\nwhen regexp_count(address_desc,'\"')=16 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"')  \nwhen regexp_count(address_desc,'\"')=32 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"')\nwhen regexp_count(address_desc,'\"')=32 then replace(address_desc,'\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"','\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"') else address_desc end address_desc,\npostal_cd,\nregion_cd,\nregion_name,\ncomuna_cd,\ncomuna_name,\ncity_cd,\ncity_name,\nmax_sid\nfrom \n (select \nsrc.src_sys_cd,\n--src.insured_name,\ncase when strpos(src.insured_name,'\"')=1 then substring(substring(src.insured_name,1,length(src.insured_name)-1),2) else src.insured_name end insured_name,\nsrc.insured_id,\nsrc.insured_rut_num,\nsrc.actv_rec_ind,\nsrc.gender_cd,\nsrc.gender_desc,\nsrc.birth_dt,\nsrc.address_id,\n--src.address_desc,\ncase when strpos(src.address_desc,'\"')=1 then substring(substring(src.address_desc,1,length(src.address_desc)-1),2)||'##' else src.address_desc||'##' end address_desc,\nsrc.postal_cd,\nsrc.region_cd,\nsrc.region_name,\nsrc.comuna_cd,\nsrc.comuna_name,\nsrc.city_cd,\nsrc.city_name,\nsrc.rec_crt_dtm,\nsrc.rec_updt_dtm,\nLKP_MAXSID.MAX_SID ,\nrow_number()over(partition by src.insured_id,address_id order by rec_crt_dtm desc ) as row_cnt from \n (\nselect distinct \ncast('axis' as varchar(10)) as src_sys_cd,\n--cast(trim('##' from personas.TBUSCAR) as varchar(100)) as insured_name,\ncast(personas.TBUSCAR as varchar(150)) as insured_name,\ncast(cast(asegurados.sperson as integer) as varchar(35)) as insured_id,\ncast(personas.NNUMNIF as varchar(35)) as insured_rut_num,\ncast('Y' as char(1)) as actv_rec_ind,\ncast(cast(personas.CSEXPER as integer) as varchar(10)) as gender_cd,\ncast(gender.REF_DESC as varchar(80))AS gender_desc,\ncast(personas.FNACIMI as date) birth_dt,\n--cast(nvl(asegurados.cdomici,0) as integer) as address_id,\ncast(nvl(CAST(asegurados.cdomici AS INTEGER),0) as integer) as address_id,\ncast(direcciones.tdomici as VARCHAR(150)) address_desc,\ncast(direcciones.CPOSTAL as VARCHAR(10)) postal_cd,\ncast(direcciones.CPROVIN as integer) as region_cd,\ncast(region.REF_DESC as varchar(100))AS region_name,\ncast(direcciones.CPOBLAC as integer) as comuna_cd,\ncast(Communa.REF_DESC as varchar(100))AS comuna_name,\ncast(direcciones.CCIUDAD as integer) as city_cd,\ncast(City.REF_DESC as varchar(35))AS city_name,\nasegurados.rec_crt_dtm as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n1 as dummy\nfrom \n(select distinct cast(SPERSON as integer), cast(CDOMICI as integer),rec_crt_dtm from cdp_stg_dwh.sisaxis_asegurados) asegurados\nleft join cdp_ods.sisaxis_personas personas \non cast(personas.sperson as integer) = asegurados.sperson\nleft join cdp_ods.sisaxis_direcciones direcciones \non asegurados.sperson = direcciones.sperson \nand asegurados.cdomici = direcciones.cdomici\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='gender_cd' and src_sys_cd = 'axis')gender\non cast(personas.CSEXPER as integer)=gender.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region' and src_sys_cd = 'axis') region \non cast(DIRECCIONES.CPROVIN as integer)=region.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna' and src_sys_cd = 'axis') Communa \non cast(DIRECCIONES.CPOBLAC as integer)=Communa.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='city_cd' and src_sys_cd = 'axis') City\non cast(DIRECCIONES.CCIUDAD as integer)= City.ref_cd  \n\nunion\nselect distinct \ncast('axis' as varchar(10)) as src_sys_cd,\n--cast(trim('##' from personas.TBUSCAR) as varchar(100)) as insured_name,\ncast(personas.TBUSCAR as varchar(150)) as insured_name,\ncast(cast(asegurados.sperson as integer) as varchar(35)) as insured_id,\ncast(personas.NNUMNIF as varchar(35)) as insured_rut_num,\ncast('Y' as char(1)) as actv_rec_ind,\ncast(cast(personas.CSEXPER as integer) as varchar(10)) as gender_cd,\ncast(gender.REF_DESC as varchar(80))AS gender_desc,\ncast(personas.FNACIMI as date) birth_dt,\n--cast(nvl(asegurados.cdomici,0) as integer) as address_id,\ncast(nvl(CAST(asegurados.cdomici AS INTEGER),0) as integer) as address_id,\ncast(direcciones.tdomici as VARCHAR(150)) address_desc,\ncast(direcciones.CPOSTAL as VARCHAR(10)) postal_cd,\ncast(direcciones.CPROVIN as integer) as region_cd,\ncast(region.REF_DESC as varchar(100))AS region_name,\ncast(direcciones.CPOBLAC as integer) as comuna_cd,\ncast(Communa.REF_DESC as varchar(100))AS comuna_name,\ncast(direcciones.CCIUDAD as integer) as city_cd,\ncast(City.REF_DESC as varchar(35))AS city_name,\npersonas.rec_crt_dtm as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n1 as dummy\nfrom \n(select distinct sperson,TBUSCAR,CSEXPER,FNACIMI,NNUMNIF,rec_crt_dtm from cdp_stg_dwh.sisaxis_personas\n--where sperson not in(1336944)\n) personas\ninner join\ncdp_ods.sisaxis_asegurados asegurados\non cast(personas.sperson as integer) = asegurados.sperson\nleft outer join cdp_ods.sisaxis_direcciones direcciones \non asegurados.sperson = direcciones.sperson \nand asegurados.cdomici = direcciones.cdomici\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='gender_cd' and src_sys_cd = 'axis')gender\non cast(personas.CSEXPER as integer)=gender.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region' and src_sys_cd = 'axis') region \non cast(DIRECCIONES.CPROVIN as integer)=region.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna' and src_sys_cd = 'axis') Communa \non cast(DIRECCIONES.CPOBLAC as integer)=Communa.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='city_cd' and src_sys_cd = 'axis') City\non cast(DIRECCIONES.CCIUDAD as integer)= City.ref_cd \n\nunion\n\n\nselect distinct \ncast('axis' as varchar(10)) as src_sys_cd,\n--cast(trim('##' from personas.TBUSCAR) as varchar(100)) as insured_name,\ncast(personas.TBUSCAR as varchar(150)) as insured_name,\ncast(cast(asegurados.sperson as integer) as varchar(35)) as insured_id,\ncast(personas.NNUMNIF as varchar(35)) as insured_rut_num,\ncast('Y' as char(1)) as actv_rec_ind,\ncast(cast(personas.CSEXPER as integer) as varchar(10)) as gender_cd,\ncast(gender.REF_DESC as varchar(80))AS gender_desc,\ncast(personas.FNACIMI as date) birth_dt,\n--cast(nvl(asegurados.cdomici,0) as integer) as address_id,\ncast(nvl(CAST(asegurados.cdomici AS INTEGER),0) as integer) as address_id,\ncast(direcciones.tdomici as VARCHAR(150)) address_desc,\ncast(direcciones.CPOSTAL as VARCHAR(10)) postal_cd,\ncast(direcciones.CPROVIN as integer) as region_cd,\ncast(region.REF_DESC as varchar(100))AS region_name,\ncast(direcciones.CPOBLAC as integer) as comuna_cd,\ncast(Communa.REF_DESC as varchar(100))AS comuna_name,\ncast(direcciones.CCIUDAD as integer) as city_cd,\ncast(City.REF_DESC as varchar(35))AS city_name,\ndirecciones.rec_crt_dtm as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n1 as dummy\nfrom \n(select distinct sperson,cdomici,tdomici,CPOSTAL,CPROVIN,CPOBLAC,CCIUDAD,rec_crt_dtm from cdp_stg_dwh.sisaxis_direcciones) direcciones\ninner join\ncdp_ods.sisaxis_asegurados asegurados\non asegurados.sperson = direcciones.sperson \nand asegurados.cdomici = direcciones.cdomici \nleft join cdp_ods.sisaxis_personas personas \non cast(personas.sperson as integer) = asegurados.sperson\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='gender_cd' and src_sys_cd = 'axis')gender\non cast(personas.CSEXPER as integer)=gender.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='region' and src_sys_cd = 'axis') region \non cast(DIRECCIONES.CPROVIN as integer)=region.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='comuna' and src_sys_cd = 'axis') Communa \non cast(DIRECCIONES.CPOBLAC as integer)=Communa.ref_cd\nleft join (select distinct ref_cd,ref_desc from cdp_stg_dwh.stg_tref_code_map_variant where ref_type_cd='city_cd' and src_sys_cd = 'axis') City\non cast(DIRECCIONES.CCIUDAD as integer)= City.ref_cd\n)src\nleft outer join\n(select 1 as dummy, max(dim_insured_key) as MAX_SID from cdp_dwh.dim_insured_t) LKP_MAXSID\non src.dummy = LKP_MAXSID.dummy)\nwhere row_cnt=1 and insured_id is not null and address_id is not null"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT distinct dim_insured_key,insured_id,address_id,src_sys_cd FROM cdp_dwh.dim_insured_t where src_sys_cd='axis'"
    },
    {
        "type": "pre/post-sql",
        "path": "content.transformations[0].dataAdapter.runtimeAttributes.attributes[10]",
        "name": "Post-sql",
        "value": "update  cdp_dwh.dim_insured_t set  insured_name=translate(insured_name,'#','') where src_sys_cd='axis';\n\nupdate  cdp_dwh.dim_insured_t set  address_desc=trim('##' from address_desc) where src_sys_cd='axis';\n\ncommit;"
    }
]