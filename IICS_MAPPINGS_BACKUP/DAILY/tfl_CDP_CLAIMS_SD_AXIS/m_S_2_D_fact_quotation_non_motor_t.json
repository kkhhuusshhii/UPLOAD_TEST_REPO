[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "SELECT DISTINCT SSEGURO,\npolicy_web,\nssolicit,\ncramo,\nsproduc,\na_nombre_sucursal,\nrut_asegurado,\nfalta,\ncagente,\ncusuari,\ncrfaage,\ncactivi,\nctipseg,\ncmodali,\nccolect,\ncmarca,\nsmodelo,\nnanofab,\nemission1,\nrobot,\ntipo_corredor,\nsrc_sys_cd,\ntipo_nego,\ntipo_emission,\nquote_source,\nc_pdtocom,\nd_ded_00,\nd_ded_03,\nd_ded_05,\nd_ded_10,\ndim_lob_key,\nmdik,\ndim_broker_key,\ndim_branch_office_key,\ndim_prd_pln_hrchy_key,\nseg_policy_item_id,\nb_npoliza_1,\nb_ncertif_1,\nb_sproduc_1,\nb_ipirianuseg_1,\nb_ipritar_1,\nb_pdtocom_1,\nb_ifraquseg_1,\nb_cactivi_1,\nb_ttitulo_1,\nb_cagente_1,\nb_tbuscar_1,\nb_sperson_1,\nb_csituac_1,\ne_nombre_usuario,\ne_cperfil,\ne_desc_perfil_usuario,\ne_descuento_permitido,\nemission_web,\nemission_or_web,\nbusiness_type_indicator_1,\nbusiness_type_indicator_2,\nbusiness_type_indicator_3,\nfinal_business_type_indicator,\nmax_sid\nFROM \n(with a as (\nselect \n            s.SSEGURO SSEGURO,\n            DECODE(CAST(s.cestat AS VARCHAR) , CAST(4 AS VARCHAR), CAST((select p.npoliza from cdp_ods.sisaxis_cmi_propuesta p where CAST(p.sciclo AS VARCHAR) = s.crfaage and p.csistema='1' and p.ctipdoc=1) AS VARCHAR), '') n_poliza,\n            CAST((select p.npoliza from cdp_ods.sisaxis_cmi_propuesta p where p.sciclo = cast(decode(s.crfaage,'',null,s.crfaage) as numeric) and p.csistema='1' and p.ctipdoc=1 and p.npoliza is not null) AS VARCHAR) policy_web, --added as part of DID_239\n            s.ssolicit ssolicit,\n            s.cramo cramo,\n            s.sproduc sproduc,\n            t.nnumnif rut_cont,\n            t.cpertip,\n            t.csexper,\n            (SELECT P.TAPELLI FROM cdp_ods.SISAXIS_AGENTES  A LEFT JOIN cdp_ods.SISAXIS_PERSONAS  P ON A.SPERSON= P.SPERSON  AND A.CTIPAGE=1 WHERE A.CAGENTE = '00000'|| SUBSTRING(s.CAGENTE,LENGTH(s.CAGENTE)-2,3) )A_NOMBRE_SUCURSAL,\n            DECODE(t.cpertip, 1, RTRIM(LTRIM(t.tapelli1)) || ' ' || RTRIM(LTRIM(t.tapelli2)) || '- ' || RTRIM(LTRIM(t.tnombre)), NVL(RTRIM(LTRIM(t.tapelli)), RTRIM(LTRIM(t.tnombre)))) contratante,\n            a.nnumnif rut_asegurado,\n            DECODE(a.cpertip, 1, RTRIM (LTRIM (a.tapell1)) || ' ' || RTRIM (LTRIM (a.tapell2)) || '- ' || RTRIM (LTRIM (a.tnombre)), RTRIM (LTRIM (a.tnombre)) || ' ' || RTRIM (LTRIM (a.tapell1)) || RTRIM (LTRIM (a.tapell2))) asegurado,\n            s.falta falta,\n            cagente,\n            TO_NUMBER(SUBSTRING(s.CAGENTE,LENGTH(s.CAGENTE)-2,3),'999') A_ID_SUCURSAL,\n            s.cusuari cusuari,\n            s.fanula,\n            crfaage,\n            s.cestat,\n            s.fefecto,\n            s.fvencim,\n            s.fcaranu,\n            s.facepta,\n            s.CACTIVI CACTIVI,\n            s.cagrseg,\n            null as ctipseg,\n            null as cmodali,\n            null as ccolect,\n            null as cmarca,\n            null as smodelo,\n            null as nanofab,\n    cast(0 as INT) as emission1,\n            cast(0 as INT) as robot,\n            cast(0 as INT) as tipo_corredor,\n            cast('axis' as varchar(12)) as src_sys_cd,  \n            cast(0 as INT) as tipo_nego,\n            cast(0 as INT) as tipo_emission, \n            cast('web' as VARCHAR(8)) as quote_source\n\nfrom cdp_ods.sisaxis_solseguros s, cdp_ods.sisaxis_solidproductos i, cdp_ods.sisaxis_soltomadores t, cdp_ods.sisaxis_solasegurados a\nwhere s.cramo<>6 \nand t.ssolicit=s.ssolicit\nand a.ssolicit=s.ssolicit\nand s.ssolicit=i.ssolicit(+)\nand s.falta BETWEEN TO_DATE('01/01/2018', 'dd/MM/yyyy HH24:MI:SS')  AND getdate()),\n\nc as (\nSELECT T1.SSOLICIT AS C_SSOLICIT, \nnvl(MAX(PDTOCOM)/100,0) C_PDTOCOM\nFROM cdp_ods.SISAXIS_SOLGARANSEG T1 INNER JOIN (SELECT SSOLICIT FROM cdp_ods.SISAXIS_SOLSEGUROS WHERE \nFALTA BETWEEN TO_DATE('01/01/2018', 'dd/MM/yyyy HH24:MI:SS')  AND getdate() ) T2 \nON T1.SSOLICIT = T2.SSOLICIT\nGROUP BY T1.SSOLICIT),\n\nd as (\nSELECT T1.SSOLICIT AS D_SSOLICIT,\nMAX(CASE WHEN NPROP =1 THEN CRESPUE END) D_DED_00,\nMAX(CASE WHEN NPROP =2 THEN CRESPUE END) D_DED_03,\nMAX(CASE WHEN NPROP =3 THEN CRESPUE END) D_DED_05,\nMAX(CASE WHEN NPROP =4 THEN CRESPUE END) D_DED_10\nFROM cdp_ods.SISAXIS_SOLPREGUNSEGPROP T1 INNER JOIN  (SELECT SSOLICIT FROM cdp_ods.SISAXIS_SOLSEGUROS WHERE \nFALTA BETWEEN TO_DATE('01/01/2018', 'dd/MM/yyyy HH24:MI:SS') AND getdate() ) T2 \nON T1.SSOLICIT = T2.SSOLICIT\nWHERE CPREGUN =1000\nGROUP BY T1.SSOLICIT ),\n\nf as (\nSELECT   A.CAGENTE AS F_CAGENTE,   \n         SubString(P.NNUMNIF,1,Length(P.NNUMNIF)-1) +  SubString(P.NNUMNIF,Length(P.NNUMNIF),1)  F_RUT_CORREDOR,\n         REPLACE(TBUSCAR,'#','') F_NOMBRE_CORREDOR\nFROM CDP_ODS.SISAXIS_AGENTES A INNER JOIN CDP_ODS.SISAXIS_PERSONAS P ON A.SPERSON = P.SPERSON ),\ng as (\nSELECT CAST(CAST(sciclo AS NUMERIC(38,0)) AS VARCHAR) AS sciclo, count(1) as sciclo_count\nfrom cdp_ods.sisaxis_cmi_propuesta  where csistema=1 and ctipdoc=1 and npoliza is not null and npoliza > 0 group by sciclo -- and npoliza > 0\n)\n\n\nselect h.*, lob.dim_lob_key dim_lob_key, ins.mdik mdik, bro.dim_broker_key dim_broker_key, suc.dim_branch_office_key dim_branch_office_key,\nPLAN_HIRE.dim_prd_pln_hrchy_key dim_prd_pln_hrchy_key,\nnull as seg_policy_item_id,\nSEG2.NPOLIZA as B_NPOLIZA_1, \nSEG2.NCERTIF as B_NCERTIF_1, \nSEG2.SPRODUC as B_SPRODUC_1,\nSEG2.IPRIANUSEG as B_IPIRIANUSEG_1,\nnull as B_IPRITAR_1,\nnull as B_PDTOCOM_1,\nnull as B_IFRAQUSEG_1,\nnull as B_FEMISIO_1,\nnull as B_FEFECTO_1,\nnull as B_FIN_VIG_1,\nnull as B_FVENCIM_1,\nnull as B_CACTIVI_1,\nnull as B_FANULAC_1,\nnull as B_TTITULO_1,\nnull as B_CAGENTE_1,\nnull as B_ID_SUCURSAL_1,\nnull as B_NOMBRE_SUCURSAL_1,\nnull as B_TBUSCAR_1,\nnull as B_NNUMNIF_1,\nnull as B_SPERSON_1,\nnull as B_CMARCA_1,\nnull as B_SMODELO_1,\nnull as B_NANOFAB_1,\nnull as B_CSITUAC_1,\nnull as E_NOMBRE_USUARIO,\nnull as E_CUSUARI, \nnull as E_CPERFIL,\nnull as E_DESC_PERFIL_USUARIO,\nnull as E_DESCUENTO_PERMITIDO,\ncase when (sciclo_count>0)   then 1 else 0 end as emission_web,\ncase when (emission1=1 or emission_web=1) then 1 else 0 end as emission_or_web,\nnull as BUSINESS_TYPE_INDICATOR_1,\nnull as BUSINESS_TYPE_INDICATOR_2,\nnull as BUSINESS_TYPE_INDICATOR_3,\nnull as FINAL_BUSINESS_TYPE_INDICATOR\n\nfrom (\nselect acdfg.*, max_sid from\n(select acdf.*, g.*   from \n(select acd.*, f.* from \n(select ac.*,d.* from\n(select a.*,c.* from a \nleft join c\non a.SSOLICIT = c.C_SSOLICIT) ac\nleft join d on\nac.SSOLICIT = d.D_SSOLICIT) acd\nleft join f \non acd.CAGENTE = f.F_CAGENTE) acdf\nleft join g on\nacdf.CRFAAGE = g.sciclo) acdfg\nleft join \n(select 1 dummy, max(fact_quote_key) max_sid from cdp_dwh.fact_quotation_t) LKP_MAX_KEY\non LKP_MAX_KEY.dummy=1 ) h\nleft join (select * from cdp_dwh.dim_lob_t where src_sys_cd = 'axis') lob\non h.cramo = lob.lob_cd AND h.cusuari <> 'FPAXIS2' and h.cusuari <> 'ANIDA1'\nleft join (select insured_rut_num, max(dim_insured_key) as mdik  from cdp_dwh.dim_insured_t where src_sys_cd = 'axis' group by insured_rut_num) ins\non h.rut_asegurado = SUBSTRING(ins.insured_rut_num,1,LENGTH(ins.insured_rut_num)-1)\nleft join (select * from cdp_dwh.dim_broker_t where src_sys_cd = 'axis') bro\non h.f_rut_corredor = bro.broker_id\nleft join (select * from cdp_dwh.dim_branch_office_t where src_sys_cd = 'axis') suc\non h.a_id_sucursal = suc.branch_office_id\n\nLEFT JOIN(\nSELECT PLAN_HIRE.dim_prd_pln_hrchy_key,SEG.sseguro FROM\n(select * from cdp_ods.sisaxis_seguros WHERE ncertif > 0) SEG\n\nINNER JOIN cdp_dwh.dim_prd_pln_hrchy_t PLAN_HIRE\nON PLAN_HIRE.prd_cd=CAST(CAST(SEG.sproduc AS INTEGER) AS VARCHAR(10))\nAND PLAN_HIRE.lob_cd=CAST(CAST(SEG.cramo AS INTEGER) AS VARCHAR(10))\nAND PLAN_HIRE.pln_cd=CAST(CAST(SEG.cactivi AS INTEGER) AS VARCHAR(10))\nAND PLAN_HIRE.src_sys_cd='axis'\n)PLAN_HIRE\nON PLAN_HIRE.sseguro= h.sseguro\n--CISD-21662\nLEFT JOIN(\nselect * from CDP_ODS.SISAXIS_SEGUROS where cramo<>6)SEG2\nON SEG2.nsolici=h.ssolicit)\n;"
    }
]