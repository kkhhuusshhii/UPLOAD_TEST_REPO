[
    {
        "type": "customQuery",
        "path": "content.transformations[0].dataAdapter.object.customQuery",
        "value": "select src_sys_cd,\nbroker_id,\nbroker_name,\ncontact_name,\ncontact_email,\ncontact_phone,\nbroker_rut_num,\nbroker_status,\nbroker_person_type_cd,\nbroker_person_type_cd_desc,\nrec_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\nLKP_MAX_KEY.max_sid\nfrom(select \nsrc_sys_cd,\nbroker_id,\nbroker_name,\ncontact_name,\ncontact_email,\ncontact_phone,\nbroker_rut_num,\nbroker_status,\nbroker_person_type_cd,\nbroker_person_type_cd_desc,\nrec_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\n1 dummy from(select \nsrc_sys_cd,\nbroker_id,\nbroker_name,\ncontact_name,\ncontact_email,\ncontact_phone,\nbroker_rut_num,\nbroker_status,\nbroker_person_type_cd,\nbroker_person_type_cd_desc,\nrec_crt_dtm,\nrec_updt_dtm,\nactv_rec_ind,\nrow_number() over(partition by broker_id order by rec_crt_dtm_src desc) rnm from \n(select \na.src_sys_cd,\na.broker_id,\na.broker_name,\na.contact_name,\na.contact_email,\na.contact_phone,\na.broker_rut_num,\na.broker_status,\na.broker_person_type_cd,\na.broker_person_type_cd_desc,\na.rec_crt_dtm,\na.rec_updt_dtm,\na.actv_rec_ind,\na.rec_crt_dtm_src from \n(select distinct\nCAST('fecu' AS VARCHAR(10)) as src_sys_cd,\nCAST(c.rut as VARCHAR(35)) broker_id,\ncast(translate(c.name,'#','')as varchar(100)) broker_name,  --modified as part of DID_238\ncast(null as varchar(100)) contact_name,\ncast(null as varchar(100)) contact_email,\ncast(null as varchar(35)) contact_phone,\ncast(c.RUT as varchar(35)) broker_rut_num,\ncast(null as varchar(35)) broker_status,\ncast(c.person_type AS varchar(10)) broker_person_type_cd,\nCAST((case when person_type='B' THEN 'Banking'\nWHEN person_type='J' THEN 'Legal'\nWHEN person_type='N' THEN 'Natural'\nWHEN person_type='R' THEN 'Retail'  END) AS VARCHAR(80) ) broker_person_type_cd_desc,\nCURRENT_DATE as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n'Y' as actv_rec_ind,\nrec_crt_dtm rec_crt_dtm_src\nfrom cdp_stg_dwh.stg_fecu_company c\nUNION\nselect distinct\nCAST('fecu' AS VARCHAR(10)) as src_sys_cd,\nCAST(l.rut as VARCHAR(35)) broker_id,\ncast(translate(l.name,'#','') as varchar(100)) broker_name,   --modified as part of DID_238\ncast(null as varchar(100)) contact_name,\ncast(null as varchar(100)) contact_email,\ncast(null as varchar(35)) contact_phone,\ncast(l.RUT as varchar(35)) broker_rut_num,\ncast(null as varchar(35)) broker_status,\ncast(l.type_of_person AS varchar(10)) broker_person_type_cd,\nCAST((case when type_of_person='B' THEN 'Banking'\nWHEN type_of_person='J' THEN 'Legal'\nWHEN type_of_person='N' THEN 'Natural'\nWHEN type_of_person='R' THEN 'Retail'  END) AS VARCHAR(80) ) broker_person_type_cd_desc,\nCURRENT_DATE as rec_crt_dtm,\nCURRENT_DATE as rec_updt_dtm,\n'Y' as actv_rec_ind,\nrec_crt_dtm rec_crt_dtm_src\nfrom cdp_stg_dwh.stg_fecu_lob l) a\nleft outer join\n(select distinct broker_id from cdp_dwh.dim_broker_t\nwhere src_sys_cd in('axis','penta')) broker\non broker.broker_id=a.broker_id\nwhere broker.broker_id is null))\nwhere rnm=1\n) src\nleft outer join\n(select 1 dummy,max(dim_broker_key) max_sid  from  cdp_dwh.dim_broker_t) LKP_MAX_KEY\non src.dummy=LKP_MAX_KEY.dummy"
    },
    {
        "type": "customQuery",
        "path": "content.transformations[1].dataAdapter.object.customQuery",
        "value": "SELECT dim_broker_key,broker_id,src_sys_cd FROM cdp_dwh.dim_broker_t where src_sys_cd='fecu'"
    }
]